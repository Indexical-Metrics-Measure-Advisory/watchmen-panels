{"version":3,"sources":["assets/console-spaces-background.png","pages/console/available-spaces/index.tsx","pages/console/connected-space/components.tsx","pages/console/connected-space/available-resources/palette-context.tsx","pages/console/connected-space/available-resources/topic-detail.tsx","pages/console/connected-space/available-resources/types.ts","pages/console/connected-space/available-resources/utils.ts","pages/console/connected-space/available-resources/topic-rect.tsx","pages/console/connected-space/available-resources/topic-relation.tsx","pages/console/connected-space/available-resources/topic-relation-animation.tsx","pages/console/connected-space/available-resources/topic-selection.tsx","pages/console/connected-space/available-resources/palette.tsx","pages/console/connected-space/available-resources/resources-list.tsx","pages/console/connected-space/available-resources/index.tsx","pages/console/connected-space/space-context.tsx","pages/console/connected-space/utils.ts","pages/console/connected-space/dialog.tsx","pages/console/connected-space/group-view/index.tsx","pages/console/connected-space/list-view/types.ts","pages/console/connected-space/list-view/list-context.tsx","pages/console/connected-space/list-view/subject.tsx","pages/console/connected-space/list-view/utils.ts","pages/console/connected-space/list-view/group.tsx","pages/console/connected-space/list-view/list-by-group.tsx","pages/console/connected-space/list-view/list-by-visit.tsx","pages/console/connected-space/list-view/list-body.tsx","pages/component/radio.tsx","pages/console/connected-space/list-view/list-header.tsx","pages/console/connected-space/list-view/index.tsx","pages/console/connected-space/subject-view/components.tsx","pages/console/connected-space/subject-view/dataset/dataset-table-context.tsx","pages/console/connected-space/subject-view/dataset/dataset-header.tsx","pages/console/connected-space/subject-view/dataset/dataset-table-components.ts","pages/console/connected-space/subject-view/dataset/dataset-table.tsx","pages/console/connected-space/subject-view/dataset/dataset-table-drag-column.tsx","pages/console/connected-space/subject-view/dataset/types.ts","pages/console/connected-space/subject-view/dataset/dataset-table-wrapper.tsx","pages/console/connected-space/subject-view/dataset/dataset-table-scroll-shade.tsx","pages/console/connected-space/subject-view/dataset/dataset-table-selection.tsx","pages/console/connected-space/subject-view/dataset/utils.ts","pages/console/connected-space/subject-view/dataset/index.tsx","pages/console/connected-space/subject-view/dataset-def/column-factor.tsx","pages/console/connected-space/subject-view/dataset-def/column-topic.tsx","pages/console/connected-space/subject-view/dataset-def/column.tsx","pages/console/connected-space/subject-view/dataset-def/columns.tsx","pages/console/connected-space/subject-view/dataset-def/filter-expression-factor.tsx","pages/console/connected-space/subject-view/dataset-def/utils.ts","pages/console/connected-space/subject-view/dataset-def/filter-expression-operator.tsx","pages/console/connected-space/subject-view/dataset-def/filter-expression-topic.tsx","pages/component/calendar.tsx","pages/console/connected-space/subject-view/dataset-def/filter-expression-value.tsx","pages/console/connected-space/subject-view/dataset-def/filter-expression.tsx","pages/console/connected-space/subject-view/dataset-def/filter-joint.tsx","pages/console/connected-space/subject-view/dataset-def/filters.tsx","pages/console/connected-space/subject-view/dataset-def/joins.tsx","pages/console/connected-space/subject-view/dataset-def/index.tsx","pages/console/connected-space/subject-view/graphics/index.tsx","pages/console/connected-space/subject-view/index.tsx","pages/console/connected-space/space-body.tsx","pages/console/connected-space/tabs.tsx","pages/console/connected-space/space-header-dropdown-tab.tsx","pages/console/connected-space/space-header-title.tsx","pages/console/connected-space/space-header.tsx","pages/console/connected-space/index.tsx","assets/console-dashboard-background.png","pages/console/dashboard/create-dashboard-handler.tsx","pages/console/dashboard/add-chart-handler.tsx","pages/console/dashboard/dashboard.tsx","pages/console/dashboard/rename-dashboard-handler.tsx","pages/console/dashboard/delete-dashboard-handler.tsx","pages/console/dashboard/switch-dashboard-handler.tsx","pages/console/dashboard/index.tsx","pages/console/favorite/index.tsx","assets/console-home-background.png","pages/console/home/favorite-button.tsx","pages/console/home/home-section-card.tsx","pages/console/home/dashboard.tsx","pages/console/home/home-section.tsx","pages/console/home/home-section-header-button.tsx","pages/console/home/space.tsx","pages/console/home/index.tsx","pages/console/menu/index.tsx","assets/console-inbox-background.png","pages/console/message/common/see-all.tsx","pages/console/message/common/item.tsx","pages/console/message/common/types.ts","pages/console/message/common/tabs.tsx","pages/console/message/common/read-button.tsx","pages/console/message/inbox/mail-item.tsx","pages/console/message/inbox/index.tsx","assets/console-notifications-background.png","pages/console/message/notification/notification-item.tsx","pages/console/messenger.tsx","pages/console/message/notification/index.tsx","assets/console-settings-background.png","pages/console/settings/components.tsx","pages/console/settings/auto-save.tsx","pages/console/settings/mail-settings.tsx","pages/console/settings/notification-settings.tsx","pages/console/settings/index.tsx","assets/console-timeline-background.png","pages/console/timeline/index.tsx","pages/console/index.tsx"],"names":["AvailableSpacesContainer","styled","div","AvailableSpace","Title","Topics","ConnectButton","Reminder","AvailableSpaces","history","useHistory","useConsoleContext","spaces","initialized","connectedSpaces","connected","availableSpaces","available","addSpace","onConnectClicked","availableSpace","a","connectSpace","spaceId","dayjs","format","ConsoleSpaceType","PRIVATE","push","toConnectedSpace","Path","CONSOLE_CONNECTED_SPACE","connectId","console","groupCollapsed","error","groupEnd","background-image","BackgroundImage","title","sort","b","name","toLowerCase","localeCompare","map","topics","times","filter","space","length","computeConnectedTimes","onClick","icon","faPlug","data-visible","MenuStateAlignment","Container","attrs","Header","Body","PaletteEvent","Menu","align","LEFT","left","right","top","visible","itemCount","separatorCount","style","CENTER","RIGHT","height","Math","min","transform","opacity","pointerEvents","MenuItem","getPosition","getBoundingClientRect","hideMenu","options","containerRef","changeState","offsetX","offsetY","current","width","showMenu","state","useMenu","useEffect","hide","event","notInMe","target","window","addEventListener","removeEventListener","MenuSeparator","Context","React","createContext","displayName","PaletteContextProvider","props","children","useState","EventEmitter","emitter","topicMoved","topic","emit","TOPIC_MOVE","addTopicMovedListener","listener","on","removeTopicMovedListener","off","topicSelectionChanged","topicSelection","TOPIC_SELECTION_CHANGE","addTopicSelectionChangedListener","removeTopicSelectionChangedListener","topicRelationTransformed","topicRelation","TOPIC_RELATION_TRANSFORM","addTopicRelationTransformedListener","removeTopicRelationTransformedListener","context","Provider","value","usePalette","useContext","GraphicsRole","TopicDetailContainer","TopicDetailTriggerButton","FactorList","TopicHeader","NoData","TopicBody","TopicFactoryRow","TopicFactor","factor","type","label","topicRelations","topicId","linkRef","useRef","relations","relation","sourceTopicId","sourceFactorNames","includes","targetTopicId","targetFactorNames","useTooltip","show","tooltip","find","x","join","ref","rect","TooltipAlignment","mouseEnter","mouseLeave","showTooltip","onMouseEnter","onMouseLeave","faLink","TopicDetail","buttonRef","setVisible","setTopic","palette","onSelectionChanged","selectedTopic","faSoap","faTimes","factors","f1","f2","computeTopicFramePoints","coordinate","frame","y","bottom","findTopicGraphics","graphics","computeTopicRelationPoints","sourcePoints","targetPoints","drawn","controlX","useRightSide","computeTopicSelection","topicGraphics","g","Rect","rx","ry","cursor","dnd","NameText","text","pos","TopicRect","frameRect","namePos","forceUpdate","useForceUpdate","setDnd","onMouseDown","button","clientX","clientY","onMove","root","element","parent","parentElement","tagName","toUpperCase","findSvgRoot","onEnd","data-topic-id","data-topic-code","code","data-role","TOPIC","TOPIC_FRAME","TOPIC_NAME","Curve","path","d","lattice","TopicRelation","relationGraphics","gRef","repaint","points","data-topic-relation-id","relationId","TOPIC_RELATION","TOPIC_RELATION_LINK","TopicRelationAnimationFrames","keyframes","TopicRelationAnimationDot","display","offsetPath","TopicRelationAnimation","onTopicRelationTransformed","TopicSelection","selection","onTopicMove","TOPIC_SELECTION","PaletteContainer","PaletteSvg","svg","asTopicMap","reduce","set","Map","computeGraphics","size","topicMap","Array","from","querySelectorAll","forEach","topicRect","topicNameRect","topicFrame","getAttribute","nameRect","querySelector","getBBox","get","max","PaddingHorizontal","PaddingVertical","values","random","SvgPalette","svgRef","svgSize","setSvgSize","TopicWidthMin","TopicHeightMin","createInitGraphics","container","resize","clientWidth","clientHeight","resizeObserver","ResizeObserver","observe","disconnect","topicRelationMap","asTopicRelationMap","clearSelection","viewBox","Palette","ResourcesList","faBook","SpaceEvent","AvailableResourcesContent","AvailableResources","rest","getVisitAdvice","lastVisitTime","lastVisit","days","diff","findSubjectIndex","subject","subjects","findIndex","s","subjectId","findParentGroup","groups","group","createDeleteSubjectClickHandler","dialog","onDeleted","preventDefault","stopPropagation","doDeleteSubject","deleteSubject","index","splice","onConfirmClicked","data-widget","flexGrow","inkType","ButtonType","PRIMARY","DEFAULT","createDeleteGroupClickHandler","doDeleteGroup","deleteGroup","exists","createRenameClickHandler","asFullName","renameObject","onRenamed","onTextChanged","showDialog","createContent","trim","content","onRenameConfirmClicked","onChange","data-error","placeholder","SortType","SpaceContextProvider","location","useLocation","activeGroups","activeSubjects","store","isGroupOpened","some","groupId","openGroupIfCan","activeGroupId","toSpaceGroup","CONSOLE_CONNECTED_SPACE_GROUP","closeGroupIfCan","match","matchPath","pathname","params","CONSOLE_CONNECTED_SPACE_OVERALL","GROUP_CLOSED","addGroupClosedListener","removeGroupClosedListener","groupRenamed","GROUP_RENAMED","addGroupRenamedListener","removeGroupRenamedListener","isSubjectOpened","openSubjectIfCan","activeSubjectId","toSpaceSubject","CONSOLE_CONNECTED_SPACE_SUBJECT","closeSubjectIfCan","SUBJECT_CLOSED","addSubjectClosedListener","removeSubjectClosedListener","subjectRenamed","SUBJECT_RENAMED","addSubjectRenamedListener","removeSubjectRenamedListener","useSpaceContext","ViewType","ListViewEvent","GroupViewContainer","SubjectList","SubjectListHeader","SubjectListBody","SubjectListBodyWrapper","SubjectCard","GroupView","useParams","useDialog","setMin","BY_VISIT_ASC","setSort","s1","s2","BY_NAME_ASC","BY_NAME_DESC","BY_VISIT_DESC","onGroupDeleteClicked","onRenameGroupClicked","newName","renameGroup","onAddClicked","now","newSubject","topicCount","graphicsCount","createdAt","createSubject","onOpenClicked","onSubjectDeleteClicked","data-min","ignoreHorizontalPadding","center","faPenAlt","faTrashAlt","faPoll","faSortAlphaUp","faSortAlphaDown","faHistory","visitAdvice","data-visit-advice","fromNow","faBars","ListContextProvider","BY_GROUP","viewType","setViewType","toggleCollapsed","collapsed","COLLAPSED_CHANGED","addCollapsedChangedListener","removeCollapsedChangedListener","filterTextChanged","newFilter","FILTER_TEXT_CHANGED","addFilterTextChangedListener","removeFilterTextChangedListener","clearFilter","FILTER_CLEARED","addFilterClearedListener","removeFilterClearedListener","groupDeleted","subjectDeleted","functions","useListView","SubjectContainer","Subject","listView","deleteRef","onDeleteClicked","parentGroup","nameAs","forwardedRef","hasFilter","isGroupFilter","startsWith","matchesFilter","GroupContainer","colorSuffix","GroupHeader","GroupName","GroupBody","theme","t","consoleSubjectHeight","marginBottom","GroupItemHeader","decorateDisplaySubjects","filtering","Group","openable","removable","canAddSubject","setCollapsed","onCollapsedChanged","newCollapsed","onFilterTextChanged","onAddSubjectClicked","substr","getGroupFilterText","computeDisplaySubjects","displaySubjects","data-openable","faExternalLinkAlt","data-collapsed","faFlagCheckered","faExpandAlt","faCompressAlt","ListByGroup","ungroup","FromGroup","span","ListByVisit","timeGroups","all","timeGroup","BY_VISIT","Filter","FilterReminder","groupFiltering","ListBody","RadioButton","Radio","selected","onSelected","data-selected","NameFilter","Input","HeaderButtons","ViewTypeRadio","Button","filterTextChangeTimer","clearFilterTextChangeTimer","clearTimeout","ListHeader","filterRef","onFilterCleared","onViewTypeChanged","newViewType","setTimeout","ListView","DataSetTableEvent","SubjectPanelHeader","SubjectPanelBody","SubjectPanelBodyWrapper","DataSetTableContextProvider","selectionChange","inFixTable","rowIndex","columnIndex","SELECTION_CHANGED","addSelectionChangeListener","removeSelectionChangeListener","repaintSelection","REPAINT_SELECTION","addRepaintSelectionHandler","handler","removeRepaintSelectionHandler","fixColumnChange","fix","columnCount","FIX_COLUMN_CHANGED","addFixColumnChangeListener","removeFixColumnChangeListener","compressColumnWidth","COMPRESS_COLUMN_WIDTH","addColumnWidthCompressHandler","removeColumnWidthCompressHandler","dragColumnVisibleChange","DRAG_COLUMN_VISIBLE_CHANGED","addDragColumnVisibleChangeListener","removeDragColumnVisibleChangeListener","determineDragColumnVisible","Promise","resolve","once","REPLY_DRAG_COLUMN_VISIBLE","DETERMINE_DRAG_COLUMN_VISIBLE","addDragColumnVisibleDeterminationHandler","removeDragColumnVisibleDeterminationHandler","dragColumnStateChange","DRAG_COLUMN_STATE_CHANGED","addDragColumnStateChangeListener","removeDragColumnStateChangeListener","useDataSetTableContext","DataSetHeaderContainer","DataSetHeader","columnDefs","data","onHide","fetchData","download","header","fixed","column","alias","body","row","link","document","createElement","href","encodeURI","pageNumber","click","onDownloadAllClicked","fetchSubjectData","pageSize","faAngleLeft","pageCount","faAngleRight","rotate","faArrowAltCircleDown","faCloudDownloadAlt","HEADER_HEIGHT","ROW_HEIGHT","Wrapper","DataSetTableContainer","columns","autoFill","fixTableWidth","minWidth","rowCount","DataSetTableHeader","gridTemplateColumns","def","DataSetTableHeaderCell","gridColumn","borderRightColor","filler","HeaderCellButtons","DataSetTableBody","DataSetTableBodyCell","lastRow","borderBottom","RowSelection","scroll","ColumnSelection","DataSetResizeShade","DataSetScrollVerticalShade","heightOffset","DataSetScrollHorizontalShade","widthOffset","HeaderCell","isFixTable","last","gridColumnIndex","selectColumn","fixColumn","unfixColumn","sortColumnAsc","sortColumnDesc","dragging","cellRef","lastColumn","data-dragging","data-last-column","faSortAmountUpAlt","faSortAmountDown","faLockOpen","faLock","DataSetTable","forwardRef","displayColumns","rowNoColumnWidth","onColumnFixChange","onColumnSort","dragColumn","sortColumn","asc","allDisplayColumns","unshift","data-scrollable","data-rowno","data-filler","rows","data-last-row","ColumnSortBy","Behavior","DragColumnContainer","movementX","DragColumnHeader","DragColumnHeaderCell","DragColumnBody","marginTop","firstRowOffsetY","DragColumnBodyCell","DataSetTableDragColumn","startRowIndex","endRowIndex","setState","determinationListener","reply","stateChangeListener","newState","DataTableScrollShade","wrapperRef","dataTableRef","wrapper","dataTable","verticalScrollRef","horizontalScrollRef","scrollTop","scrollLeft","wrapperLeft","scrollWidth","scrollHeight","offsetWidth","offsetHeight","horizontalScrollLeft","position","borderTop","backgroundColor","computeRowSelectionPosition","rowTop","rowHeight","computeColumnSelectionPosition","columnLeft","columnWidth","columnHeight","dataTableClientWidth","verticalScroll","selectColumnDef","selectColumnWidth","selectColumnLeft","columnDef","totalWidth","DataSetTableSelection","rowSelectionRef","columnSelectionRef","horizontalScroll","setSelection","bar","transition","select","rowPos","colPos","useSelection","useImperativeHandle","onFixColumnChange","selectionColumnIndex","findDataTable","closest","computeTableColumnsRightPositions","widths","count","findPickedColumn","offsetLeft","table","mouseClientX","matchColumnIndex","tableColumnDefs","originalWidth","DataSetTableWrapper","fixTableRef","selectionRef","NONE","behavior","setBehavior","pickedColumn","setPickedColumn","arrangeFixedTableStyle","fixTable","scrollBarHeight","boxShadow","onDataTableScroll","onFixTableScroll","useDecorateFixStyle","onColumnWidthCompress","c","manageCursor","mouseClientY","avoidResize","fixColumns","changeBehavior","containerTop","containerLeft","abs","CAN_RESIZE","PICK_COLUMN","computeAndSetCursor","resetGridTemplateColumns","gridColumnCount","split","shouldReset","getDefIndex","repaintWhenDragging","sourceTable","sourceColumns","targetTable","targetColumns","dragColumnIndex","indexOf","sourceHeader","sourceBody","sourceIsFixTable","sourceGridTemplateColumns","targetHeader","targetBody","targetGridTemplateColumns","targetIsFixTable","targetColumnsWidths","targetTableLeft","targetScrollLeft","targetColumnIndex","targetColumnRightX","targetColumnLeftX","isTableInside","newSourceGridTemplateColumns","newTargetGridTemplateColumns","parseInt","total","dataTableHeader","dataTableBody","dataTableGridColumns","fixTableHeader","fixTableBody","fixTableGridColumns","computeSourceAndTarget","fromFixTable","toFixTable","dataTableLeft","dragColumnVisible","getSelection","removeAllRanges","DRAGGING","prepareToDragColumn","floor","ceil","READY_TO_DRAG","prepareToResizeColumn","findPickedColumnForResize","RESIZING","releaseDragColumn","sourceColumnIndex","placeholderIndex","ASC","DESC","r1","r2","ret","v1","v2","data-resize-state","onMouseMove","newGridTemplateColumns","resizeColumn","onMouseUp","resizeTable","filterColumns","factorMap","factorId","operator","ColumnExpressionOperator","secondaryFactorId","secondaryTopic","secondaryFactor","buildFactorMap","DataSetContainer","DataSetNoDef","DataSetLoading","DataSet","onVisibleChanged","switchToDefinition","dataset","loading","setLoading","setData","setColumnDefs","hasColumns","faSpinner","spin","ColumnFactorContainer","ColumnFactor","onFactorChanged","propNames","topicPropName","factorPropName","factorOptions","useSubjectContext","defs","onColumnFactorChanged","ColumnTopicContainer","ColumnTopic","onTopicChanged","topicOptions","onColumnTopicChanged","originTopicId","please","ColumnRowContainer","ExpressionOperators","ADD","SUBTRACT","MULTIPLY","DIVIDE","MODULUS","Column","removeColumn","onOperatorChanged","option","showFactor","showSecondTopic","showSecondFactor","secondaryTopicId","data-show-factor","data-show-secondary-topic","data-show-secondary-factor","SubjectColumns","spaceDef","onRemoveColumn","faPlus","c1","c2","factor1","f","factor2","topic1","topic2","ExpressionFactor","FilterExpressionFactor","grow","factorDropdownOptions","onFilterFactorChanged","ConsoleTopicFactorType","BOOLEAN","ExpressionOperator","EQUALS","DATETIME","ENUM","data-grow","isJointFilter","jointType","notExactDateTimeOperators","FilterExpressionOperator","YEAR_OF","HALF_YEAR_OF","QUARTER_OF","MONTH_OF","WEEK_OF_YEAR","WEEK_OF_MONTH","WEEKDAYS","TILL_NOW","needExactDateTime","operatorOptions","NOT_EQUALS","LESS","LESS_EQUALS","MORE","MORE_EQUALS","IN","NOT_IN","Operator","operatorDropdownOptions","opt","onFilterOperatorChanged","originalOperator","ExpressionTopic","FilterExpressionTopic","onFilterTopicChanged","getLastDateOfMonth","year","month","atBottom","innerHeight","Label","Picker","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","PickerHeader","PickerBody","PickerButtons","Calendar","className","active","onScroll","onBlurred","initValue","onDateClicked","date","clone","onTodayClicked","onYesterdayClicked","subtract","onWeekendClicked","day","onPrevWeekendClicked","onMonthEndClicked","add","onPrevMonthEndClicked","onYearEndClicked","onPrevYearEndClicked","currentValue","currentDisplayDate","currentDisplayTime","currentYear","currentMonth","currentDate","displayValue","currentDisplayMonth","firstDayOfDisplayMonth","displayYear","displayMonth","firstDate","weekday","lastDate","fill","v","previousMonth","previousYear","previousLastDate","nextMonth","nextYear","computeCalendarDays","today","todayYear","todayMonth","todayDate","onClearClicked","data-options-visible","role","tabIndex","onBlur","faCaretDown","faCalendarAlt","hour","minute","second","millisecond","faCaretLeft","faCaretRight","data-current-month","data-current","data-today","PlainFactorFilterValue","factorType","BooleanOptions","BooleanFactorFilterValue","onFilterValueOptionChanged","EnumItem","EnumFactorFilterValue","accept","valueOptions","JSON","parse","enum","valueDropdownOptions","data-checked","faCheck","DateTimeFactorFilterValue","DateTimeYearOfFactorFilterValue","TillNowOptions","DateTimeFactorFilterTillNowValue","ExpressionValueContainer","DateTimeEnums","HalfYear","Quarter","Month","WeekOfYear","WeekOfMonth","Weekdays","FilterExpressionValue","ExpressionRow","FilterExpression","removeFilter","showOperator","showValue","JointRow","Joint","Filters","FilterRow","childrenFiltersChanged","level","joint","isExpressionFilter","FilterJoint","filters","removeChildFilter","data-level","data-filters-count","FilterJointType","AND","OR","SubjectFilters","filterCount","countFilters","JoinRowContainer","JoinTypes","TopicJoinType","INNER","JoinRow","removeJoin","onTypeChanged","asLabel","typeName","topicName","factorName","secondaryTopicName","secondaryFactorName","factorsOfTopic","SubjectJoins","joins","onRemoveJoin","j1","j2","v4","DataSetDefinition","DataSetDef","saveSubject","save","changeCollapsed","key","topFilter","GraphicsContainer","Buttons","NoDef","Graphics","charts","buttonsPosition","setButtonsPosition","locked","setLocked","resetButtonsPosition","outerWidth","onCreateChartClicked","ConsoleSpaceSubjectChartType","BAR","indicators","dimensions","generateChartRect","onDeleteChart","chart","onToDefClicked","hasCharts","faThumbtack","faHighlighter","chartId","SubjectViewContainer","SubjectViewMenu","SubjectViewContent","definition","initDataSet","onDeleteSubjectClicked","onRenameSubjectClicked","changeVisible","faDatabase","faTable","faChartBar","SubjectView","found","findSubject","ConnectedSpaceBody","CONSOLE_CONNECTED_SPACE_RESOURCES","to","Tabs","TabContainer","Tab","moreClick","more","offset","DropdownTabContainer","DropdownMenuItem","DropdownTab","onTabClicked","onTabCloseClicked","showDropdown","dropdownItemsCount","faEllipsisH","DropdownTabWithData","tab","onClicked","onCloseClicked","dropdown","dropdownItems","items","onItemClicked","onItemCloseClicked","itemAsKey","asKey","itemAsLabel","menuState","setMenuState","onMenuItemClicked","item","onMenuItemCloseClicked","GroupTab","openedGroups","g1","g2","activeGroup","isGroupsActive","faCube","asSubjectLabel","SubjectTab","allSubjects","flat","getAllSubjects","openedSubjects","groupCompare","activeSubject","isSubjectsActive","SpaceHeaderTitle","deleteSpaceFromMemory","deleteSpace","spaceRenamed","menuShown","setMenuShown","onAddGroupClicked","newGroup","createGroup","onRenameClicked","renameConnectedSpace","PUBLIC","faGlobe","faCompactDisc","data-menu-shown","onDeleteConfirmClicked","deleteConnectedSpace","replace","CONSOLE_HOME","ConnectedSpaceHeader","isOverallActive","isResourcesActive","faServer","faBezierCurve","ConnectedSpaceContent","ConnectedSpace","createCreateDashboardClickHandler","onCreated","defaultValue","createDashboard","dashboard","AddChartContainer","buildSubjectOptions","buildChartOptions","DashboardContainer","DashboardHeader","DashboardTitle","DashboardBody","Dashboard","dashboards","addDashboard","deleteDashboard","saveHandle","setSaveHandle","onCopyClicked","url","navigator","clipboard","writeText","onCreateClicked","onChartDelete","doSaveChart","handle","saveDashboard","currentDashboard","dashboardId","faShare","renameDashboard","faPenSquare","log","INIT_MIN_WIDTH","CHART_ASPECT_RATIO","CHART_HEADER_HEIGHT","every","onSpaceChanged","refresh","selectedSpaceId","selectedSpace","onSubjectChanged","selectedSubjectId","selectedSubject","onChartChanged","selectedChart","selectedChartId","showReminder","onAddChartClicked","faTachometerAlt","onSwitched","candidates","DialogContent","onDashboardChanged","onSwitchClicked","faSatelliteDish","connectedSpace","subjectChart","doSave","settings","PageContainer","DashboardsContainer","Dashboards","addDashboardDeletedListener","removeDashboardDeletedListener","onDelete","canShow","FavoriteContainer","invoker","isMenuExpanded","consoleMenuWidth","pinnedLeft","FavoriteHeader","FavoriteBody","Favorite","useTheme","menuWidth","menu","favorites","pinned","pin","unpin","addDashboardRenamedListener","removeDashboardRenamedListener","addSpaceDeletedListener","removeSpaceDeletedListener","addSpaceRenamedListener","removeSpaceRenamedListener","onWindowClick","displayItemCount","onSpaceClicked","isConnectedSpaceOpened","onDashboardClicked","isDashboardOpened","toDashboard","CONSOLE_DASHBOARD","data-pinned","ConsoleFavoriteType","DASHBOARD","faSolarPanel","fav","SPACE","isFavSpace","x1","x2","FavBtn","FavoriteButton","toggle","isFavorite","data-favorite","faStar","HomeSectionCard","removeFromFavorite","remove","addIntoFavorite","findInFavorite","isFavDashboard","CONSOLE_DASHBOARDS","HomeSectionContainer","HomeSectionHeader","HomeSectionTitle","HomeSectionHeaderOperators","HomeSectionBody","ExpandButton","HomeSection","titleIcon","titleOperators","expanded","setExpanded","canExpand","data-can-expand","data-expanded","HomeSectionHeaderButton","Space","Home","reverse","faSatellite","CONSOLE_SPACES","MenuContainer","FavMenu","SpaceMenus","SpaceMenu","ConnectMenu","Placeholder","ConsoleMenu","maxWidth","consoleMenuMaxWidth","user","setMenuWidth","addSpaceAddedListener","removeSpaceAddedListener","showMenuItemTooltip","faHome","faBell","iconSize","CONSOLE_NOTIFICATION","faInbox","CONSOLE_INBOX","faComments","CONSOLE_TIMELINE","faCog","CONSOLE_SETTINGS","onResize","newWidth","SeeAll","ActiveTab","ReadAnimation","MessageItemContainer","MessageItemHeader","MessageItemSender","MessageItemSubject","MessageItemOperators","MessageItemBody","MessageItemBodyContent","MessageItemBodyImage","MessageItemCreateAt","ItemBody","createDate","image","line","ItemListContainer","ItemList","allLoaded","noData","TabsContainer","TabPlaceholder","HorizontalLoading","onUnreadClicked","onReadClicked","data-active","UNREAD","READ","unreadInitialized","readInitialized","faCheckCircle","Read","createLinkButtonBackgroundAnimation","ReadButton","readable","onRead","readOne","readRef","MailItem","sender","read","setRead","data-read","mails","Inbox","fetchUnread","fetchRead","activeTab","onSettingsClicked","CONSOLE_SETTINGS_INBOX","readAll","unread","allUnreadLoaded","allReadLoaded","MessageType","StateVisible","Operators","Sender","Category","colorType","CategoryLabel","CHART_TYPE_PUSHED","SPACE_PUSHED","TOPIC_PUSHED","FACTOR_PUSHED","REPORT_PUSHED","GROUP_JOINED","GROUP_LEFT","SPACE_JOINED","SPACE_LEFT","SUBSCRIBE_REPORT_CHANGED","SUBSCRIBE_REPORT_DELETED","CategoryColor","category","ConsoleNotificationCategory","NotificationItem","notifications","color-type","Notification","CONSOLE_SETTINGS_NOTIFICATION","Show","Content","Messenger","schedule","setSchedule","FALSE","onNotificationReceived","notification","TRUE","NOTIFICATION","ConsoleNotificationEvent","LATEST_RECEIVED","data-show","CLOSE","ItemContainer","ItemTitle","DropdownItemBody","AutoSave","Frequency","MIN_5","frequency","setFrequency","onFrequencyChanged","FrequencyOptions","MailSettings","mailFrequency","mailFrequencyChanged","NotificationTypeList","Notifications","NotificationSettings","notificationFrequency","notificationSubscriptionCategories","notificationFrequencyChanged","notificationCategorySubscriptionAdded","notificationCategorySubscriptionRemoved","checked","n","Bottom","SettingsPanel","Timeline","fontSize","ConsoleIndex"],"mappings":"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","file":"static/js/console.367dcdd6.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/console-spaces-background.f781711b.png\";","import { faPlug } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport dayjs from 'dayjs';\nimport React from 'react';\nimport { useHistory } from 'react-router-dom';\nimport styled from 'styled-components';\nimport BackgroundImage from '../../../assets/console-spaces-background.png';\nimport Path, { toConnectedSpace } from '../../../common/path';\nimport { connectSpace } from '../../../services/console/space';\nimport { ConnectedConsoleSpace, ConsoleSpace, ConsoleSpaceType } from '../../../services/console/types';\nimport { NarrowPageTitle } from '../../component/console/narrow-page-title';\nimport { NarrowContainer } from '../../component/console/page-container';\nimport { useConsoleContext } from '../context/console-context';\n\nconst AvailableSpacesContainer = styled.div`\n\tdisplay: grid;\n\tgrid-template-columns: 1fr;\n\tgrid-row-gap: var(--margin);\n\tmargin-top: 50px;\n`;\nconst AvailableSpace = styled.div`\n\tdisplay: grid;\n\tgrid-template-columns: 1fr 128px;\n\tborder-radius: var(--border-radius);\n\tpadding: calc(var(--margin) / 2) 0 calc(var(--margin) / 2) var(--margin);\n\tbox-shadow: var(--console-shadow);\n\toverflow: hidden;\n\ttransition: all 300ms ease-in-out;\n\t&:hover {\n\t\tbox-shadow: var(--console-hover-shadow);\n\t\t> div:last-child {\n\t\t\tmargin-left: 0;\n\t\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t\t}\n\t}\n`;\nconst Title = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\tfont-size: 2em;\n\tfont-family: var(--console-title-font-family);\n`;\nconst Topics = styled.div`\n\tgrid-row: 2;\n\tpadding: calc(var(--margin) / 2) 0 0;\n\topacity: 0.7;\n\tdisplay: flex;\n\tflex-direction: column;\n\t> span {\n\t\tfont-size: 0.8em;\n\t\tline-height: 20px;\n\t}\n`;\nconst ConnectButton = styled.div`\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tjustify-content: center;\n\tgrid-row: span 2;\n\tgrid-column: 2;\n\tmargin: calc(var(--margin) / -2) 0 calc(var(--margin) / -2) 128px;\n\tpadding: 0 calc(var(--margin) / 2);\n\tfont-variant: petite-caps;\n\tbackground-color: var(--console-primary-color);\n\tcolor: var(--invert-color);\n\tcursor: pointer;\n\tbox-shadow: none;\n\ttransition: all 300ms ease-in-out;\n\toverflow: hidden;\n\t> svg {\n\t\tpadding-top: calc(var(--margin) / 2);\n\t\tflex-grow: 1;\n\t\tfont-size: 4.5em;\n\t}\n\t> span {\n\t\tfont-variant: petite-caps;\n\t\theight: 2em;\n\t\tjustify-self: flex-start;\n\t}\n`;\nconst Reminder = styled.div`\n\tdisplay: block;\n\tfont-size: 2em;\n\tfont-family: var(--console-title-font-family);\n\topacity: 0;\n\theight: 0;\n\twidth: 100%;\n\ttransition: all 300ms ease-in-out;\n\ttext-align: center;\n\t&[data-visible=true] {\n\t\topacity: 0.5;\n\t\theight: 100px;\n\t}\n`;\n\nconst computeConnectedTimes = (connected: Array<ConnectedConsoleSpace>, spaceId: string) => {\n\t// eslint-disable-next-line\n\treturn connected.filter(space => space.spaceId == spaceId).length;\n};\n\nexport const AvailableSpaces = () => {\n\tconst history = useHistory();\n\tconst {\n\t\tspaces: {\n\t\t\tinitialized, connected: connectedSpaces, available: availableSpaces,\n\t\t\taddSpace\n\t\t}\n\t} = useConsoleContext();\n\n\tconst onConnectClicked = (availableSpace: ConsoleSpace) => async () => {\n\t\ttry {\n\t\t\tconst connected: ConnectedConsoleSpace = await connectSpace(availableSpace.spaceId, `Noname-${dayjs().format('YYYYMMDD')}`, ConsoleSpaceType.PRIVATE);\n\t\t\taddSpace(connected);\n\t\t\thistory.push(toConnectedSpace(Path.CONSOLE_CONNECTED_SPACE, connected.connectId));\n\t\t} catch (e) {\n\t\t\tconsole.groupCollapsed(`%cError on connect space.`, 'color:rgb(251,71,71)');\n\t\t\tconsole.error('SpaceId: ', availableSpace.spaceId);\n\t\t\tconsole.error(e);\n\t\t\tconsole.groupEnd();\n\t\t}\n\t};\n\n\treturn <NarrowContainer background-image={BackgroundImage}>\n\t\t<NarrowPageTitle title='Available Spaces'/>\n\t\t<AvailableSpacesContainer>\n\t\t\t{availableSpaces\n\t\t\t\t.sort((a, b) => (a.name || '').toLowerCase().localeCompare((b.name || '').toLowerCase()))\n\t\t\t\t.map((availableSpace) => {\n\t\t\t\t\tconst { spaceId, name, topics } = availableSpace;\n\t\t\t\t\tconst times = computeConnectedTimes(connectedSpaces, spaceId);\n\t\t\t\t\treturn <AvailableSpace key={spaceId}>\n\t\t\t\t\t\t<Title>{name}</Title>\n\t\t\t\t\t\t<Topics>\n\t\t\t\t\t\t\t<span>{topics.length === 0 ? 'No topic.' : (topics.length === 1 ? '1 topic contained.' : `${topics.length} topics contained.`)}</span>\n\t\t\t\t\t\t\t<span>{times === 0 ? 'Not connect yet.' : `Connected for ${times} time(s).`}</span>\n\t\t\t\t\t\t</Topics>\n\t\t\t\t\t\t<ConnectButton onClick={onConnectClicked(availableSpace)}>\n\t\t\t\t\t\t\t<FontAwesomeIcon icon={faPlug}/>\n\t\t\t\t\t\t\t<span>Connect</span>\n\t\t\t\t\t\t</ConnectButton>\n\t\t\t\t\t</AvailableSpace>;\n\t\t\t\t})}\n\t\t\t<Reminder data-visible={initialized && availableSpaces.length === 0}>\n\t\t\t\tNo available space, contact administrator for authorization please.\n\t\t\t</Reminder>\n\t\t\t<Reminder data-visible={!initialized}>\n\t\t\t\tLoading...\n\t\t\t</Reminder>\n\t\t</AvailableSpacesContainer>\n\t</NarrowContainer>;\n};","import React, { Dispatch, RefObject, useEffect } from 'react';\nimport styled from 'styled-components';\nimport { notInMe } from '../../../common/utils';\n\nexport const Container = styled.div.attrs({\n\t'data-widget': 'console-space-container'\n})`\n\tdisplay: flex;\n\tflex-direction: column;\n\tflex-grow: 1;\n`;\nexport const Header = styled.div.attrs({\n\t'data-widget': 'console-space-header'\n})`\n\tdisplay: flex;\n\tposition: sticky;\n\ttop: 0;\n\talign-items: center;\n\tpadding: 0 calc(var(--margin) / 2);\n\theight: var(--console-space-header-height);\n\tbackground-color: var(--invert-color);\n\tborder-bottom: var(--border);\n\tz-index: 2;\n`;\nexport const Body = styled.div.attrs({\n\t'data-widget': 'console-space-body'\n})`\n\tflex-grow: 1;\n\tdisplay: flex;\n`;\n\nexport enum MenuStateAlignment {\n\tLEFT = 'left',\n\tCENTER = 'center',\n\tRIGHT = 'right'\n}\n\nexport interface MenuState {\n\talign?: MenuStateAlignment\n\tleft: number;\n\tright: number;\n\ttop: number;\n\tvisible: boolean;\n}\n\nexport const Menu = styled.div.attrs<MenuState & { itemCount: number, separatorCount?: number }>\n(({\n\t  align = MenuStateAlignment.LEFT,\n\t  left, right, top,\n\t  visible, itemCount, separatorCount = 0\n  }) => {\n\treturn {\n\t\tstyle: {\n\t\t\tleft: align === MenuStateAlignment.LEFT ? left : (align === MenuStateAlignment.CENTER ? ((left + right) / 2) : 'unset'),\n\t\t\tright: align === MenuStateAlignment.RIGHT ? `calc(100vw - ${right}px)` : 'unset',\n\t\t\ttop,\n\t\t\theight: 2 + 30 * Math.min(10, itemCount) + separatorCount * 13,\n\t\t\ttransform: `${visible ? 'scaleY(1)' : 'scaleY(0)'} ${align === MenuStateAlignment.CENTER ? 'translateX(-50%)' : ''}`,\n\t\t\topacity: visible ? 1 : 0,\n\t\t\tpointerEvents: visible ? 'auto' : 'none'\n\t\t}\n\t};\n})<MenuState & { itemCount: number, separatorCount?: number }>`\n\tdisplay: flex;\n\tflex-direction: column;\n\tposition: fixed;\n\tfont-family: var(--font-family);\n\tmin-width: 200px;\n\tmax-width: 400px;\n\tbackground-color: var(--invert-color);\n\tborder-radius: var(--border-radius);\n\tborder: var(--border);\n\tbox-shadow: var(--console-hover-shadow);\n\ttransform-origin: top;\n\ttransition: transform 300ms ease-in-out, opacity 300ms ease-in-out;\n\toverflow-x: hidden;\n\toverflow-y: auto;\n\tz-index: 1000;\n`;\nexport const MenuItem = styled.div`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\tmin-height: 30px;\n\tpadding: 0 calc(var(--margin) / 2);\n\tfont-size: 0.8em;\n\tcolor: var(--console-font-color);\n\tcursor: pointer;\n\ttransition: all 300ms ease-in-out;\n\t&:hover {\n\t\tcolor: var(--console-primary-color);\n\t\ttext-decoration: underline;\n\t}\n\t> svg:first-child {\n\t\tmargin-right: calc(var(--margin) / 3);\n\t}\n\t> span {\n\t\tflex-grow: 1;\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\tmargin-top: -1px;\n\t\tmargin-left: 1px;\n\t}\n`;\nexport const getPosition = (div: HTMLDivElement) => div.getBoundingClientRect();\nexport const hideMenu = (options: {\n\tcontainerRef: React.RefObject<HTMLDivElement>;\n\tchangeState: React.Dispatch<React.SetStateAction<MenuState>>;\n\talign?: MenuStateAlignment;\n\toffsetX?: number;\n\toffsetY?: number;\n}) => {\n\tconst { containerRef, changeState, align, offsetX = 0, offsetY = 0 } = options;\n\n\tconst { top, left, width, height } = getPosition(containerRef.current!);\n\tchangeState({\n\t\tvisible: false,\n\t\talign,\n\t\tleft: left + offsetX,\n\t\tright: left + width + offsetX,\n\t\ttop: top + height + offsetY\n\t});\n};\nexport const showMenu = (options: {\n\tcontainerRef: RefObject<HTMLDivElement>,\n\tstate: MenuState,\n\tchangeState: Dispatch<React.SetStateAction<MenuState>>,\n\toffsetX?: number;\n\toffsetY?: number;\n}) => {\n\tconst { containerRef, state, changeState, offsetX = 0, offsetY = 0 } = options;\n\n\tif (state.visible) {\n\t\treturn;\n\t}\n\n\tconst { top, left, width, height } = getPosition(containerRef.current!);\n\tconst tobe = !state.visible;\n\tchangeState({\n\t\tvisible: tobe,\n\t\talign: state.align,\n\t\tleft: left + offsetX,\n\t\tright: left + width + offsetX,\n\t\ttop: top + height + offsetY\n\t});\n};\nexport const useMenu = (options: {\n\tcontainerRef: RefObject<HTMLDivElement>,\n\tstate: MenuState,\n\tchangeState: Dispatch<React.SetStateAction<MenuState>>,\n\toffsetX?: number;\n\toffsetY?: number;\n}) => {\n\tconst { containerRef, state, changeState, offsetX = 0, offsetY = 0 } = options;\n\n\tuseEffect(() => {\n\t\tif (containerRef.current) {\n\t\t\tconst { top, left, width, height } = getPosition(containerRef.current);\n\t\t\tchangeState({\n\t\t\t\tvisible: false,\n\t\t\t\talign: state.align,\n\t\t\t\tleft: left + offsetX,\n\t\t\t\tright: left + width + offsetX,\n\t\t\t\ttop: top + height + offsetY\n\t\t\t});\n\t\t}\n\t}, [ containerRef, state.align, offsetX, offsetY, changeState ]);\n\tuseEffect(() => {\n\t\tif (!state.visible) {\n\t\t\treturn;\n\t\t}\n\t\tconst hide = (event: Event) => {\n\t\t\tif (notInMe(containerRef.current!, event.target)) {\n\t\t\t\thideMenu({ containerRef, changeState, align: state.align, offsetX, offsetY });\n\t\t\t}\n\t\t};\n\t\twindow.addEventListener('scroll', hide, true);\n\t\twindow.addEventListener('click', hide, true);\n\t\twindow.addEventListener('focus', hide, true);\n\t\treturn () => {\n\t\t\twindow.removeEventListener('scroll', hide, true);\n\t\t\twindow.removeEventListener('click', hide, true);\n\t\t\twindow.removeEventListener('focus', hide, true);\n\t\t};\n\t}, [ state.visible, state.align, offsetX, offsetY, containerRef, changeState ]);\n};\n\nexport const MenuSeparator = styled.div`\n\tdisplay: block;\n\tmin-height: 1px;\n\tmargin: 6px 0;\n\tbackground-color: var(--border-color);\n`;\n","import { EventEmitter } from 'events';\nimport React, { useState } from 'react';\nimport { TopicGraphics, TopicRelationGraphics, TopicSelectionGraphics } from './types';\n\nexport enum PaletteEvent {\n\tTOPIC_MOVE = 'topic-move',\n\tTOPIC_SELECTION_CHANGE = 'topic-selection-change',\n\tTOPIC_RELATION_TRANSFORM = 'topic-relation-transform'\n}\n\nexport type TopicMovedListener = (topic: TopicGraphics) => void;\nexport type TopicSelectionChangedListener = (topicSelection: TopicSelectionGraphics) => void;\nexport type TopicRelationTransformedListener = (topicRelation: TopicRelationGraphics) => void;\n\nexport interface PaletteContext {\n\ttopicMoved: (topic: TopicGraphics) => void;\n\taddTopicMovedListener: (listener: TopicMovedListener) => void;\n\tremoveTopicMovedListener: (listener: TopicMovedListener) => void;\n\ttopicSelectionChanged: (topicSelection: TopicSelectionGraphics) => void;\n\taddTopicSelectionChangedListener: (listener: TopicSelectionChangedListener) => void;\n\tremoveTopicSelectionChangedListener: (listener: TopicSelectionChangedListener) => void;\n\ttopicRelationTransformed: (topicSelection: TopicRelationGraphics) => void;\n\taddTopicRelationTransformedListener: (listener: TopicRelationTransformedListener) => void;\n\tremoveTopicRelationTransformedListener: (listener: TopicRelationTransformedListener) => void;\n}\n\nconst Context = React.createContext<PaletteContext>({} as PaletteContext);\nContext.displayName = 'SpacePaletteContext';\n\nexport const PaletteContextProvider = (props: {\n\tchildren?: ((props: any) => React.ReactNode) | React.ReactNode;\n}) => {\n\tconst { children } = props;\n\n\tconst [ emitter ] = useState(new EventEmitter());\n\tconst [ context ] = useState<PaletteContext>({\n\t\ttopicMoved: (topic: TopicGraphics) => emitter.emit(PaletteEvent.TOPIC_MOVE, topic),\n\t\taddTopicMovedListener: (listener: TopicMovedListener) => emitter.on(PaletteEvent.TOPIC_MOVE, listener),\n\t\tremoveTopicMovedListener: (listener: TopicMovedListener) => emitter.off(PaletteEvent.TOPIC_MOVE, listener),\n\t\ttopicSelectionChanged: (topicSelection: TopicSelectionGraphics) => emitter.emit(PaletteEvent.TOPIC_SELECTION_CHANGE, topicSelection),\n\t\taddTopicSelectionChangedListener: (listener: TopicSelectionChangedListener) => emitter.on(PaletteEvent.TOPIC_SELECTION_CHANGE, listener),\n\t\tremoveTopicSelectionChangedListener: (listener: TopicSelectionChangedListener) => emitter.off(PaletteEvent.TOPIC_SELECTION_CHANGE, listener),\n\t\ttopicRelationTransformed: (topicRelation: TopicRelationGraphics) => emitter.emit(PaletteEvent.TOPIC_RELATION_TRANSFORM, topicRelation),\n\t\taddTopicRelationTransformedListener: (listener: TopicRelationTransformedListener) => emitter.on(PaletteEvent.TOPIC_RELATION_TRANSFORM, listener),\n\t\tremoveTopicRelationTransformedListener: (listener: TopicRelationTransformedListener) => emitter.off(PaletteEvent.TOPIC_RELATION_TRANSFORM, listener)\n\t});\n\n\treturn <Context.Provider value={context}>{children}</Context.Provider>;\n};\n\nexport const usePalette = () => {\n\treturn React.useContext(Context);\n};\n","import { faLink, faSoap, faTimes } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { useEffect, useRef, useState } from 'react';\nimport styled from 'styled-components';\nimport { ConsoleSpace, ConsoleTopic, ConsoleTopicFactor } from '../../../../services/console/types';\nimport { TooltipAlignment, useTooltip } from '../../../component/console/context/console-tooltip';\nimport { UserAvatar } from '../../../component/console/user-avatar';\nimport { usePalette } from './palette-context';\nimport { TopicSelectionGraphics } from './types';\n\nconst TopicDetailContainer = styled.div`\n\tdisplay: block;\n\tposition: absolute;\n\tright: 0;\n\tbottom: 0;\n\tpadding-right: calc(var(--margin) / 2);\n\tpadding-bottom: calc(var(--margin) / 2);\n\toverflow: hidden;\n\ttransition: all 300ms ease-in-out;\n\t&[data-visible=false] {\n\t\twidth: 96px;\n\t\theight: 96px;\n\t\t> div:last-child {\n\t\t\tmargin-top: 80px;\n\t\t\tmargin-left: 80px;\n\t\t\theight: 0;\n\t\t\twidth: 0;\n\t\t\tpadding: 0;\n\t\t\topacity: 0;\n\t\t\tpointer-events: none;\n\t\t}\n\t}\n\t&[data-visible=true] {\n\t\theight: calc(var(--margin) + 420px);\n\t\twidth: calc(var(--margin) + 320px);\n\t\tpadding-top: calc(var(--margin) / 2);\n\t\tpadding-left: calc(var(--margin) / 2);\n\t\t> div:first-child {\n\t\t\theight: 420px;\n\t\t\twidth: 320px;\n\t\t\topacity: 0;\n\t\t\tpointer-events: none;\n\t\t\tborder-radius: 0;\n\t\t\tborder-color: var(--console-primary-color);\n\t\t}\n\t\t> div:last-child {\n\t\t\tborder-color: var(--console-primary-color);\n\t\t}\n\t}\n`;\nconst TopicDetailTriggerButton = styled.div`\n\tdisplay: flex;\n\tposition: absolute;\n\talign-items: center;\n\tjustify-content: center;\n\tright: calc(var(--margin) / 2);\n\tbottom: calc(var(--margin) / 2);\n\tbackground-color: var(--console-favorite-color);\n\tcolor: var(--invert-color);\n\twidth: 64px;\n\theight: 64px;\n\tborder-radius: 100%;\n\tborder-style: solid;\n\tborder-color: var(--console-favorite-color);\n\tborder-width: 2px;\n\tfont-size: 2em;\n\tcursor: pointer;\n\ttransition: all 300ms ease-in-out;\n\t&:hover {\n\t\tbox-shadow: var(--console-hover-shadow);\n\t}\n`;\nconst FactorList = styled.div`\n\tdisplay: flex;\n\tflex-direction: column;\n\theight: 420px;\n\twidth: 320px;\n\tborder-radius: calc(var(--border-radius) * 2);\n\tborder-style: solid;\n\tborder-color: var(--console-favorite-color);\n\tborder-width: 2px;\n\tbox-shadow: var(--console-shadow);\n\tbackground-color: var(--invert-color);\n\topacity: 0.95;\n\ttransition: all 300ms ease-in-out;\n`;\nconst TopicHeader = styled.div`\n\tdisplay: flex;\n\theight: 40px;\n\talign-items: center;\n\tjustify-content: space-between;\n\tpadding: 0 calc(var(--margin) / 2);\n\tborder-bottom: var(--border);\n\tborder-color: var(--console-primary-color);\n\t> div:first-child {\n\t\tfont-family: var(--console-title-font-family);\n\t}\n\t> svg {\n\t\tcursor: pointer;\n\t\t&:hover {\n\t\t\tcolor: var(--console-primary-color);\n\t\t}\n\t}\n`;\nconst NoData = styled.div`\n\tpadding: 0 calc(var(--margin) / 2);\n\theight: 100%;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\topacity: 0.7;\n`;\nconst TopicBody = styled.div`\n\tflex-grow: 1;\n\tdisplay: flex;\n\tflex-direction: column;\n\toverflow-x: hidden;\n\toverflow-y: auto;\n\t&::-webkit-scrollbar {\n\t\tbackground-color: transparent;\n\t\twidth: 4px;\n\t}\n\t&::-webkit-scrollbar-track {\n\t\tbackground-color: var(--scrollbar-background-color);\n\t\tborder-radius: 2px;\n\t}\n\t&::-webkit-scrollbar-thumb {\n\t\tbackground-color: var(--console-favorite-color);\n\t\tborder-radius: 2px;\n\t}\n`;\nconst TopicFactoryRow = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\theight: 32px;\n\tpadding: 0 calc(var(--margin) / 3) 0 calc(var(--margin) / 4);\n\tborder-bottom: var(--border);\n\t> div:first-child {\n\t\ttransform: scale(0.6);\n\t}\n\t> div:nth-child(2) {\n\t\tfont-size: 0.8em;\n\t\tflex-grow: 1;\n\t}\n\t> div:nth-child(3) {\n\t\tfont-size: 0.8em;\n\t\tcolor: var(--console-primary-color);\n\t\tcursor: pointer;\n\t}\n`;\n\nconst TopicFactor = (props: {\n\tspace: ConsoleSpace;\n\ttopic: ConsoleTopic;\n\tfactor: ConsoleTopicFactor;\n}) => {\n\tconst { space, topic, factor } = props;\n\tconst { type, label } = factor;\n\n\tconst { topicRelations } = space;\n\tconst { topicId } = topic;\n\n\tconst linkRef = useRef<HTMLDivElement>(null);\n\tconst relations = (topicRelations || []).filter(relation => {\n\t\t// eslint-disable-next-line\n\t\tif (relation.sourceTopicId == topicId && relation.sourceFactorNames.includes(factor.name)) {\n\t\t\treturn true;\n\t\t\t// eslint-disable-next-line\n\t\t} else if (relation.targetTopicId == topicId && relation.targetFactorNames.includes(factor.name)) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t});\n\tconst asTooltip = () => {\n\t\treturn relations.map(relation => {\n\t\t\t// eslint-disable-next-line\n\t\t\tif (relation.sourceTopicId == topicId) {\n\t\t\t\t// eslint-disable-next-line\n\t\t\t\treturn space.topics.find(topic => relation.targetTopicId == topic.topicId)!.name;\n\t\t\t\t// eslint-disable-next-line\n\t\t\t} else if (relation.targetTopicId == topicId) {\n\t\t\t\t// eslint-disable-next-line\n\t\t\t\treturn space.topics.find(topic => relation.sourceTopicId == topic.topicId)!.name;\n\t\t\t}\n\t\t\treturn null;\n\t\t}).filter(x => x != null).join(', ');\n\t};\n\tconst { mouseEnter, mouseLeave } = useTooltip({\n\t\tshow: relations.length !== 0,\n\t\ttooltip: asTooltip(),\n\t\tref: linkRef,\n\t\trect: () => ({ align: TooltipAlignment.RIGHT, offsetX: -13, offsetY: 10 })\n\t});\n\n\treturn <TopicFactoryRow>\n\t\t<UserAvatar name={type} showTooltip={true}/>\n\t\t<div>{label}</div>\n\t\t{\n\t\t\trelations.length !== 0\n\t\t\t\t?\n\t\t\t\t<div onMouseEnter={mouseEnter} onMouseLeave={mouseLeave} ref={linkRef}><FontAwesomeIcon icon={faLink}/>\n\t\t\t\t</div>\n\t\t\t\t: null\n\t\t}\n\t</TopicFactoryRow>;\n};\n\nexport const TopicDetail = (props: { space: ConsoleSpace }) => {\n\tconst { space } = props;\n\n\tconst buttonRef = useRef<HTMLDivElement>(null);\n\tconst [ visible, setVisible ] = useState<boolean>(false);\n\tconst [ topic, setTopic ] = useState<ConsoleTopic | null>(null);\n\tconst palette = usePalette();\n\tuseEffect(() => {\n\t\tconst onSelectionChanged = ({ topicId, visible }: TopicSelectionGraphics) => {\n\t\t\tif (!visible) {\n\t\t\t\tsetTopic(null);\n\t\t\t} else {\n\t\t\t\t// eslint-disable-next-line\n\t\t\t\tconst selectedTopic = space.topics.find(topic => topic.topicId == topicId)!;\n\t\t\t\tif (selectedTopic !== topic) {\n\t\t\t\t\tsetTopic(selectedTopic);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tpalette.addTopicSelectionChangedListener(onSelectionChanged);\n\t\treturn () => {\n\t\t\tpalette.removeTopicSelectionChangedListener(onSelectionChanged);\n\t\t};\n\t}, [ palette, topic, space.topics ]);\n\n\tconst showDetail = () => setVisible(true);\n\tconst hideDetail = () => setVisible(false);\n\n\treturn <TopicDetailContainer data-visible={visible}>\n\t\t<TopicDetailTriggerButton ref={buttonRef} onClick={showDetail}>\n\t\t\t<FontAwesomeIcon icon={faSoap}/>\n\t\t</TopicDetailTriggerButton>\n\t\t<FactorList>\n\t\t\t<TopicHeader>\n\t\t\t\t<div>{topic?.name || 'No Selection'}</div>\n\t\t\t\t<FontAwesomeIcon icon={faTimes} onClick={hideDetail}/>\n\t\t\t</TopicHeader>\n\t\t\t<TopicBody>\n\t\t\t\t{\n\t\t\t\t\ttopic\n\t\t\t\t\t\t? topic.factors\n\t\t\t\t\t\t\t.sort((f1, f2) => f1.label.localeCompare(f2.label))\n\t\t\t\t\t\t\t.map(factor => {\n\t\t\t\t\t\t\t\treturn <TopicFactor key={factor.name} space={space} topic={topic} factor={factor}/>;\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t: <NoData>No Data</NoData>\n\t\t\t\t}\n\t\t\t</TopicBody>\n\t\t</FactorList>\n\t</TopicDetailContainer>;\n};","import { ConsoleTopic, ConsoleTopicRelationship } from '../../../../services/console/types';\n\nexport enum GraphicsRole {\n\tTOPIC = 'topic',\n\tTOPIC_FRAME = 'topic-frame',\n\tTOPIC_NAME = 'topic-name',\n\tTOPIC_RELATION = 'topic-relation',\n\tTOPIC_RELATION_LINK = 'topic-relation-link',\n\tTOPIC_SELECTION = 'topic-selection',\n}\n\nexport interface GraphicsPosition {\n\tx: number;\n\ty: number;\n}\n\nexport interface GraphicsSize {\n\twidth: number;\n\theight: number;\n}\n\nexport interface TopicCoordinate extends GraphicsPosition {\n}\n\nexport interface TopicFrame extends GraphicsPosition, GraphicsSize {\n}\n\nexport interface TopicName extends GraphicsPosition {\n}\n\nexport interface TopicRelationCurvePoints {\n\tdrawn: string;\n}\n\nexport interface TopicRelationGraphics {\n\trelation: ConsoleTopicRelationship;\n\tpoints: TopicRelationCurvePoints\n}\n\nexport interface TopicGraphics {\n\ttopic: ConsoleTopic;\n\trect: {\n\t\tcoordinate: TopicCoordinate;\n\t\tframe: TopicFrame;\n\t\tname: TopicName\n\t}\n}\n\nexport interface TopicSelectionGraphics {\n\tvisible: boolean;\n\ttopicId?: string;\n\trect: GraphicsPosition & GraphicsSize;\n}\n\nexport interface Graphics {\n\ttopics: Array<TopicGraphics>;\n\ttopicRelations: Array<TopicRelationGraphics>;\n\ttopicSelection: TopicSelectionGraphics\n}\n","import { Graphics, TopicFrame, TopicGraphics, TopicRelationCurvePoints } from './types';\n\nexport const findSvgRoot = (element: SVGGraphicsElement): SVGSVGElement => {\n\tlet parent = element.parentElement!;\n\twhile (parent.tagName.toUpperCase() !== 'SVG') {\n\t\tparent = parent.parentElement!;\n\t}\n\treturn parent as unknown as SVGSVGElement;\n};\n\nexport const TopicWidthMin = 150;\nexport const TopicHeightMin = 32;\nconst PaddingVertical = 8;\nconst FullPaddingVertical = PaddingVertical * 2;\nconst PaddingHorizontal = 16;\nconst FullPaddingHorizontal = PaddingHorizontal * 2;\nconst TitleOffsetY = 6.2;\n/** topic frame size */\nexport const computeTopicFrameSize = (topicNameRect: DOMRect) => {\n\treturn {\n\t\twidth: Math.max(topicNameRect.width + FullPaddingHorizontal, TopicWidthMin),\n\t\theight: topicNameRect.height + FullPaddingVertical\n\t};\n};\n/** topic name position relative to topic rect */\nexport const computeTopicNamePosition = (topicFrame: TopicFrame) => {\n\treturn { x: topicFrame.width / 2, y: topicFrame.height / 2 + TitleOffsetY };\n};\n\nconst computeTopicFramePoints = (topic: TopicGraphics) => {\n\tconst { rect: { coordinate, frame } } = topic;\n\treturn {\n\t\ttop: { x: coordinate.x + frame.x + frame.width / 2, y: coordinate.y + frame.y },\n\t\tright: { x: coordinate.x + frame.x + frame.width, y: coordinate.y + frame.y + frame.height / 2 },\n\t\tbottom: { x: coordinate.x + frame.x + frame.width / 2, y: coordinate.y + frame.y + frame.height },\n\t\tleft: { x: coordinate.x + frame.x, y: coordinate.y + frame.y + frame.height / 2 }\n\t};\n};\n\nexport const findTopicGraphics = (graphics: Graphics, topicId: string): TopicGraphics => {\n\t// eslint-disable-next-line\n\treturn graphics.topics.find(({ topic }) => topic.topicId == topicId)!;\n};\nexport const computeTopicRelationPoints = (options: {\n\tgraphics: Graphics;\n\tsourceTopicId: string;\n\ttargetTopicId: string;\n}): TopicRelationCurvePoints => {\n\tconst { graphics, sourceTopicId, targetTopicId } = options;\n\n\t// to find the start and end point position\n\tconst sourcePoints = computeTopicFramePoints(findTopicGraphics(graphics, sourceTopicId));\n\tconst targetPoints = computeTopicFramePoints(findTopicGraphics(graphics, targetTopicId));\n\n\tlet drawn = `M${sourcePoints.top.x},${(sourcePoints.top.y + sourcePoints.bottom.y) / 2} L${targetPoints.top.x},${(targetPoints.top.y + targetPoints.bottom.y) / 2}`;\n\t// noinspection DuplicatedCode\n\tswitch (true) {\n\t\tcase targetPoints.left.x - sourcePoints.right.x <= 200 && targetPoints.left.x - sourcePoints.right.x >= 0:\n\t\t\t// target on right of source, no overlap, small distance\n\t\t\tswitch (true) {\n\t\t\t\tcase  sourcePoints.bottom.y <= targetPoints.top.y:\n\t\t\t\t\t// target on bottom right, no overlap\n\t\t\t\t\tdrawn = `M${sourcePoints.bottom.x},${sourcePoints.bottom.y} Q${sourcePoints.bottom.x},${targetPoints.left.y} ${targetPoints.left.x},${targetPoints.left.y}`;\n\t\t\t\t\tbreak;\n\t\t\t\tcase sourcePoints.top.y >= targetPoints.bottom.y:\n\t\t\t\t\t// target on bottom top, no overlap\n\t\t\t\t\tdrawn = `M${sourcePoints.top.x},${sourcePoints.top.y} Q${sourcePoints.top.x},${targetPoints.left.y} ${targetPoints.left.x},${targetPoints.left.y}`;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t// vertical has overlap\n\t\t\t\t\tdrawn = `M${sourcePoints.right.x},${sourcePoints.right.y} L${targetPoints.left.x},${targetPoints.left.y}`;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase targetPoints.left.x - sourcePoints.right.x > 200:\n\t\t\t// target on right of source, no overlap, large distance\n\t\t\tswitch (true) {\n\t\t\t\tcase sourcePoints.bottom.y <= targetPoints.top.y:\n\t\t\t\tcase sourcePoints.top.y >= targetPoints.bottom.y:\n\t\t\t\t\t// target on bottom/top right, no overlap\n\t\t\t\t\tdrawn = [\n\t\t\t\t\t\t`M${sourcePoints.right.x},${sourcePoints.right.y}`,\n\t\t\t\t\t\t`C${sourcePoints.right.x + (targetPoints.left.x - sourcePoints.right.x) / 6},${sourcePoints.right.y}`,\n\t\t\t\t\t\t`${sourcePoints.right.x + (targetPoints.left.x - sourcePoints.right.x) / 3},${sourcePoints.right.y}`,\n\t\t\t\t\t\t`${sourcePoints.right.x + (targetPoints.left.x - sourcePoints.right.x) / 2},${(sourcePoints.right.y + targetPoints.left.y) / 2}`,\n\t\t\t\t\t\t`C${sourcePoints.right.x + (targetPoints.left.x - sourcePoints.right.x) / 3 * 2},${targetPoints.left.y}`,\n\t\t\t\t\t\t`${sourcePoints.right.x + (targetPoints.left.x - sourcePoints.right.x) / 6 * 5},${targetPoints.left.y}`,\n\t\t\t\t\t\t`${targetPoints.left.x},${targetPoints.left.y}`\n\t\t\t\t\t].join(' ');\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t// vertical has overlap\n\t\t\t\t\tdrawn = `M${sourcePoints.right.x},${sourcePoints.right.y} L${targetPoints.left.x},${targetPoints.left.y}`;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase sourcePoints.left.x - targetPoints.right.x <= 200 && sourcePoints.left.x - targetPoints.right.x >= 0:\n\t\t\t// target on left of source, no overlap, small distance\n\t\t\tswitch (true) {\n\t\t\t\tcase  sourcePoints.bottom.y <= targetPoints.top.y:\n\t\t\t\t\t// target on bottom left, no overlap\n\t\t\t\t\tdrawn = `M${sourcePoints.bottom.x},${sourcePoints.bottom.y} Q${sourcePoints.bottom.x},${targetPoints.right.y} ${targetPoints.right.x},${targetPoints.right.y}`;\n\t\t\t\t\tbreak;\n\t\t\t\tcase sourcePoints.top.y >= targetPoints.bottom.y:\n\t\t\t\t\t// target on bottom top, no overlap\n\t\t\t\t\tdrawn = `M${sourcePoints.top.x},${sourcePoints.top.y} Q${sourcePoints.top.x},${targetPoints.right.y} ${targetPoints.right.x},${targetPoints.right.y}`;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t// vertical has overlap\n\t\t\t\t\tdrawn = `M${sourcePoints.left.x},${sourcePoints.left.y} L${targetPoints.right.x},${targetPoints.right.y}`;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase sourcePoints.left.x - targetPoints.right.x > 200:\n\t\t\t// target on left of source, no overlap, large distance\n\t\t\tswitch (true) {\n\t\t\t\tcase sourcePoints.bottom.y <= targetPoints.top.y:\n\t\t\t\tcase sourcePoints.top.y >= targetPoints.bottom.y:\n\t\t\t\t\t// target on bottom/top right, no overlap\n\t\t\t\t\tdrawn = [\n\t\t\t\t\t\t`M${sourcePoints.left.x},${sourcePoints.left.y}`,\n\t\t\t\t\t\t`C${targetPoints.right.x + (sourcePoints.left.x - targetPoints.right.x) / 6 * 5},${sourcePoints.left.y}`,\n\t\t\t\t\t\t`${targetPoints.right.x + (sourcePoints.left.x - targetPoints.right.x) / 3 * 2},${sourcePoints.left.y}`,\n\t\t\t\t\t\t`${targetPoints.right.x + (sourcePoints.left.x - targetPoints.right.x) / 2},${(sourcePoints.left.y + targetPoints.right.y) / 2}`,\n\t\t\t\t\t\t`C${targetPoints.right.x + (sourcePoints.left.x - targetPoints.right.x) / 3},${targetPoints.right.y}`,\n\t\t\t\t\t\t`${targetPoints.right.x + (sourcePoints.left.x - targetPoints.right.x) / 6},${targetPoints.right.y}`,\n\t\t\t\t\t\t`${targetPoints.right.x},${targetPoints.right.y}`\n\t\t\t\t\t].join(' ');\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t// vertical has overlap\n\t\t\t\t\tdrawn = `M${sourcePoints.left.x},${sourcePoints.left.y} L${targetPoints.right.x},${targetPoints.right.y}`;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase targetPoints.top.y - sourcePoints.bottom.y <= 100 && targetPoints.top.y - sourcePoints.bottom.y >= 0:\n\t\tcase sourcePoints.top.y - targetPoints.bottom.y <= 100 && sourcePoints.top.y - targetPoints.bottom.y >= 0:\n\t\t\t// target on top/bottom of source, has horizontal overlap and no vertical overlap, small distance\n\t\t\tconst controlX = Math.min(sourcePoints.left.x, targetPoints.left.x) - 150;\n\t\t\tlet useRightSide = false;\n\t\t\tif (controlX <= 5) {\n\t\t\t\tuseRightSide = true;\n\t\t\t}\n\t\t\tif (useRightSide) {\n\t\t\t\tdrawn = [\n\t\t\t\t\t`M${sourcePoints.right.x},${sourcePoints.right.y}`,\n\t\t\t\t\t`Q${Math.min(sourcePoints.right.x, targetPoints.right.x) + 150},${(sourcePoints.right.y + targetPoints.right.y) / 2}`,\n\t\t\t\t\t`${targetPoints.right.x},${targetPoints.right.y}`\n\t\t\t\t].join(' ');\n\t\t\t} else {\n\t\t\t\tdrawn = [\n\t\t\t\t\t`M${sourcePoints.left.x},${sourcePoints.left.y}`,\n\t\t\t\t\t`Q${controlX},${(sourcePoints.left.y + targetPoints.left.y) / 2}`,\n\t\t\t\t\t`${targetPoints.left.x},${targetPoints.left.y}`\n\t\t\t\t].join(' ');\n\t\t\t}\n\t\t\tbreak;\n\t\tcase targetPoints.top.y - sourcePoints.bottom.y > 100:\n\t\t\t// target on top of source, has horizontal overlap and no vertical overlap, large distance\n\t\t\tdrawn = `M${sourcePoints.bottom.x},${sourcePoints.bottom.y} L${targetPoints.top.x},${targetPoints.top.y}`;\n\t\t\tbreak;\n\t\tcase sourcePoints.top.y - targetPoints.bottom.y > 100:\n\t\t\t// target on bottom of source, has horizontal overlap and no vertical overlap, large distance\n\t\t\tdrawn = `M${sourcePoints.top.x},${sourcePoints.top.y} L${targetPoints.bottom.x},${targetPoints.bottom.y}`;\n\t\t\tbreak;\n\t\tcase targetPoints.top.y >= sourcePoints.top.y:\n\t\t\t// overlap anyway\n\t\t\tdrawn = [\n\t\t\t\t`M${sourcePoints.top.x},${sourcePoints.top.y}`,\n\t\t\t\t`C${sourcePoints.top.x - 300},${sourcePoints.top.y - 300}`,\n\t\t\t\t`${targetPoints.bottom.x - 300},${targetPoints.bottom.y + 300}`,\n\t\t\t\t`${targetPoints.bottom.x},${targetPoints.bottom.y}`\n\t\t\t].join(' ');\n\t\t\tbreak;\n\t\tcase targetPoints.top.y < sourcePoints.top.y:\n\t\t\tdrawn = [\n\t\t\t\t`M${sourcePoints.bottom.x},${sourcePoints.bottom.y}`,\n\t\t\t\t`C${sourcePoints.bottom.x + 300},${sourcePoints.bottom.y + 300}`,\n\t\t\t\t`${targetPoints.top.x + 300},${targetPoints.top.y - 300}`,\n\t\t\t\t`${targetPoints.top.x},${targetPoints.top.y}`\n\t\t\t].join(' ');\n\t\t\tbreak;\n\t}\n\treturn { drawn };\n};\n\nexport const computeTopicSelection = (options: { topicId: string; graphics: Graphics }) => {\n\tconst { graphics, topicId } = options;\n\n\tconst topicGraphics = findTopicGraphics(graphics, topicId);\n\treturn {\n\t\tx: topicGraphics.rect.coordinate.x - 6,\n\t\ty: topicGraphics.rect.coordinate.y - 6,\n\t\twidth: topicGraphics.rect.frame.width + 12,\n\t\theight: topicGraphics.rect.frame.height + 12\n\t};\n};","import React, { useState } from 'react';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../../common/utils';\nimport { usePalette } from './palette-context';\nimport { GraphicsRole, TopicCoordinate, TopicFrame, TopicGraphics, TopicName } from './types';\nimport { findSvgRoot } from './utils';\n\nconst Container = styled.g.attrs<{ coordinate: TopicCoordinate }>(({ coordinate: { x, y } }) => {\n\treturn { transform: `translate(${x}, ${y})` };\n})<{ coordinate: TopicCoordinate }>``;\nconst Rect = styled.rect.attrs<{ frame: TopicFrame, dnd: boolean }>(({ frame: { x, y, width, height }, dnd }) => {\n\treturn { x, y, width, height, rx: 6, ry: 6, cursor: dnd ? 'move' : 'pointer' };\n})<{ frame: TopicFrame, dnd: boolean }>`\n\tstroke: var(--console-primary-color);\n\tstroke-width: 2px;\n\tfill: var(--invert-color);\n`;\nconst NameText = styled.text.attrs<{ dnd: boolean, pos: TopicName }>(({ dnd, pos: { x, y } }) => {\n\treturn { x, y, cursor: dnd ? 'move' : 'pointer' };\n})<{ dnd: boolean, pos: TopicName }>`\n\tfill: var(--console-font-color);\n\ttext-anchor: middle;\n\tfont-family: var(--console-title-font-family);\n\tfont-size: 1.1em;\n\tuser-select: none;\n`;\n\nexport const TopicRect = (props: { topic: TopicGraphics }) => {\n\tconst { topic: topicGraphics } = props;\n\tconst { topic, rect } = topicGraphics;\n\tconst { coordinate, frame: frameRect, name: namePos } = rect;\n\n\tconst palette = usePalette();\n\tconst forceUpdate = useForceUpdate();\n\tconst [ dnd, setDnd ] = useState<boolean>(false);\n\n\tconst onMouseDown = (event: React.MouseEvent) => {\n\t\tif (event.button === 0) {\n\t\t\tconst { clientX, clientY } = event;\n\t\t\tconst [ offsetX, offsetY ] = [ clientX - coordinate.x, clientY - coordinate.y ];\n\t\t\tconst onMove = ({ clientX: x, clientY: y }: MouseEvent) => {\n\t\t\t\trect.coordinate = { x: x - offsetX, y: y - offsetY };\n\t\t\t\tforceUpdate();\n\t\t\t\tpalette.topicMoved(topicGraphics);\n\t\t\t};\n\t\t\tconst root = findSvgRoot(event.target as SVGGraphicsElement);\n\t\t\tconst onEnd = () => {\n\t\t\t\troot.removeEventListener('mousemove', onMove);\n\t\t\t\troot.removeEventListener('mouseleave', onEnd);\n\t\t\t\troot.removeEventListener('mouseup', onEnd);\n\t\t\t\tsetDnd(false);\n\t\t\t};\n\t\t\troot.addEventListener('mousemove', onMove);\n\t\t\troot.addEventListener('mouseleave', onEnd);\n\t\t\troot.addEventListener('mouseup', onEnd);\n\t\t\tsetDnd(true);\n\t\t}\n\t};\n\n\treturn <Container onMouseDown={onMouseDown} coordinate={coordinate}\n\t                  data-topic-id={topic.topicId} data-topic-code={topic.code}\n\t                  data-role={GraphicsRole.TOPIC}>\n\t\t<Rect frame={frameRect} dnd={dnd}\n\t\t      data-topic-id={topic.topicId} data-topic-code={topic.code}\n\t\t      data-role={GraphicsRole.TOPIC_FRAME}/>\n\t\t<NameText pos={namePos} dnd={dnd} data-role={GraphicsRole.TOPIC_NAME}>{topic.name}</NameText>\n\t</Container>;\n};","import React, { useEffect, useRef } from 'react';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../../common/utils';\nimport { usePalette } from './palette-context';\nimport { Graphics, GraphicsRole, TopicGraphics, TopicRelationCurvePoints, TopicRelationGraphics } from './types';\nimport { computeTopicRelationPoints } from './utils';\n\nconst Curve = styled.path.attrs<{ lattice: TopicRelationCurvePoints }>(({ lattice: { drawn } }) => {\n\treturn { d: drawn };\n})<{ lattice: TopicRelationCurvePoints }>`\n\tstroke: var(--console-primary-color);\n\tstroke-width: 2px;\n\tfill: transparent;\n`;\n\nexport const TopicRelation = (props: {\n\tgraphics: Graphics;\n\trelation: TopicRelationGraphics;\n}) => {\n\tconst { graphics, relation: relationGraphics } = props;\n\tconst { relation } = relationGraphics;\n\n\tconst palette = usePalette();\n\tconst gRef = useRef<SVGGElement>(null);\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\tconst repaint = ({ topic }: TopicGraphics) => {\n\t\t\tconst { sourceTopicId, targetTopicId } = relation;\n\t\t\t// eslint-disable-next-line\n\t\t\tif (topic.topicId != sourceTopicId && topic.topicId != targetTopicId) {\n\t\t\t\t// irrelevant\n\t\t\t\treturn;\n\t\t\t}\n\t\t\trelationGraphics.points = computeTopicRelationPoints({ graphics, sourceTopicId, targetTopicId });\n\t\t\tforceUpdate();\n\t\t\tpalette.topicRelationTransformed(relationGraphics);\n\t\t};\n\t\tpalette.addTopicMovedListener(repaint);\n\t\treturn () => palette.removeTopicMovedListener(repaint);\n\t}, [ palette, relationGraphics, relation, graphics, forceUpdate ]);\n\n\treturn <g ref={gRef} data-topic-relation-id={relation.relationId} data-role={GraphicsRole.TOPIC_RELATION}>\n\t\t<Curve lattice={relationGraphics.points} data-role={GraphicsRole.TOPIC_RELATION_LINK}/>\n\t</g>;\n};","import React, { useEffect, useState } from 'react';\nimport styled, { keyframes } from 'styled-components';\nimport { useForceUpdate } from '../../../../common/utils';\nimport { usePalette } from './palette-context';\nimport { Graphics, TopicRelationCurvePoints, TopicRelationGraphics, TopicSelectionGraphics } from './types';\n\nconst TopicRelationAnimationFrames = keyframes`\n\tfrom {\n\t\toffset-distance: 0;\n\t}\n\tto {\n\t\toffset-distance: 100%;\n\t}\n`;\nconst TopicRelationAnimationDot = styled.div.attrs<{ lattice: TopicRelationCurvePoints, visible: boolean }>(({\n\t                                                                                                             lattice: { drawn },\n\t                                                                                                             visible\n                                                                                                             }) => {\n\treturn {\n\t\tstyle: {\n\t\t\tdisplay: visible ? 'block' : 'none',\n\t\t\toffsetPath: `path(\"${drawn}\")`\n\t\t}\n\t};\n})<{ lattice: TopicRelationCurvePoints, visible: boolean }>`\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 8px;\n\theight: 8px;\n\tbackground-color: var(--console-favorite-color);\n\tborder-radius: 100%;\n\toffset-distance: 0;\n\tanimation: ${TopicRelationAnimationFrames} 2s ease-in-out 0s infinite normal none;\n`;\n\nexport const TopicRelationAnimation = (props: {\n\tgraphics: Graphics;\n\trelation: TopicRelationGraphics;\n}) => {\n\tconst { graphics, relation: relationGraphics } = props;\n\tconst { relation } = relationGraphics;\n\n\tconst palette = usePalette();\n\tconst forceUpdate = useForceUpdate();\n\tconst [ visible, setVisible ] = useState(false);\n\tuseEffect(() => {\n\t\tconst onSelectionChanged = ({ topicId, visible }: TopicSelectionGraphics) => {\n\t\t\t// eslint-disable-next-line\n\t\t\tif (!visible || (topicId != relation.sourceTopicId && topicId != relation.targetTopicId)) {\n\t\t\t\tsetVisible(false);\n\t\t\t} else {\n\t\t\t\tsetVisible(true);\n\t\t\t}\n\t\t};\n\t\tconst onTopicRelationTransformed = ({ relation: { relationId } }: TopicRelationGraphics) => {\n\t\t\t// eslint-disable-next-line\n\t\t\tif (relationId == relation.relationId) {\n\t\t\t\tforceUpdate();\n\t\t\t}\n\t\t};\n\t\tpalette.addTopicSelectionChangedListener(onSelectionChanged);\n\t\tpalette.addTopicRelationTransformedListener(onTopicRelationTransformed);\n\t\treturn () => {\n\t\t\tpalette.removeTopicSelectionChangedListener(onSelectionChanged);\n\t\t\tpalette.removeTopicRelationTransformedListener(onTopicRelationTransformed);\n\t\t};\n\t}, [ palette, graphics, relation, forceUpdate ]);\n\n\treturn <TopicRelationAnimationDot lattice={relationGraphics.points} visible={visible}/>;\n};\n","import React, { useEffect } from 'react';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../../common/utils';\nimport { usePalette } from './palette-context';\nimport { Graphics, GraphicsPosition, GraphicsRole, GraphicsSize, TopicGraphics, TopicSelectionGraphics } from './types';\nimport { computeTopicSelection } from './utils';\n\nconst Container = styled.g.attrs<{ visible: boolean }>(({ visible }) => {\n\treturn { style: { display: visible ? 'block' : 'none' } };\n})<{ visible: boolean }>``;\nconst Rect = styled.rect.attrs<{ rect: GraphicsPosition & GraphicsSize }>(({ rect: { x, y, width, height } }) => {\n\treturn { x, y, rx: 8, ry: 8, width, height };\n})<{ rect: GraphicsPosition & GraphicsSize }>`\n\tstroke: var(--console-favorite-color);\n\tstroke-width: 2px;\n\tstroke-dasharray: 3px 3px;\n\tfill: transparent;\n\tz-index: -1;\n\tpointer-events: none;\n`;\n\nexport const TopicSelection = (props: { graphics: Graphics, selection: TopicSelectionGraphics }) => {\n\tconst { graphics, selection } = props;\n\n\tconst palette = usePalette();\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\tconst onSelectionChanged = () => forceUpdate();\n\t\tconst onTopicMove = ({ topic: { topicId } }: TopicGraphics) => {\n\t\t\t// eslint-disable-next-line\n\t\t\tif (topicId != selection.topicId) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tselection.topicId = topicId;\n\t\t\tselection.visible = true;\n\t\t\tselection.rect = computeTopicSelection({ graphics, topicId });\n\t\t\tforceUpdate();\n\t\t};\n\t\tpalette.addTopicSelectionChangedListener(onSelectionChanged);\n\t\tpalette.addTopicMovedListener(onTopicMove);\n\t\treturn () => {\n\t\t\tpalette.removeTopicSelectionChangedListener(onSelectionChanged);\n\t\t\tpalette.removeTopicMovedListener(onTopicMove);\n\t\t};\n\t}, [ palette, selection, graphics, forceUpdate ]);\n\n\treturn <Container data-role={GraphicsRole.TOPIC_SELECTION} visible={selection.visible}>\n\t\t<Rect rect={selection.rect} data-topic-id={selection.topicId}/>\n\t</Container>;\n};","import React, { Fragment, useEffect, useRef, useState } from 'react';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../../common/utils';\nimport { ConnectedConsoleSpace } from '../../../../services/console/types';\nimport { PaletteContextProvider, usePalette } from './palette-context';\nimport { TopicDetail } from './topic-detail';\nimport { TopicRect } from './topic-rect';\nimport { TopicRelation } from './topic-relation';\nimport { TopicRelationAnimation } from './topic-relation-animation';\nimport { TopicSelection } from './topic-selection';\nimport { Graphics, GraphicsRole, GraphicsSize, TopicGraphics, TopicRelationGraphics } from './types';\nimport {\n\tcomputeTopicFrameSize,\n\tcomputeTopicNamePosition,\n\tcomputeTopicRelationPoints,\n\tcomputeTopicSelection,\n\tTopicHeightMin,\n\tTopicWidthMin\n} from './utils';\n\nconst PaletteContainer = styled.div`\n\tposition: relative;\n\tflex-grow: 1;\n\tbackground-image: radial-gradient(var(--console-waive-color) 1px, transparent 0);\n\tbackground-size: 48px 48px;\n\toverflow: hidden;\n`;\nconst PaletteSvg = styled.svg`\n\tdisplay: block;\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n`;\n\nconst createInitGraphics = (space: ConnectedConsoleSpace): Graphics => {\n\tconst { topics, topicRelations = [] } = space;\n\treturn {\n\t\ttopics: topics.map(topic => {\n\t\t\treturn {\n\t\t\t\ttopic,\n\t\t\t\trect: {\n\t\t\t\t\tcoordinate: { x: 0, y: 0 },\n\t\t\t\t\tframe: { x: 0, y: 0, width: TopicWidthMin, height: TopicHeightMin },\n\t\t\t\t\tname: { x: TopicWidthMin / 2, y: TopicHeightMin / 2 }\n\t\t\t\t}\n\t\t\t};\n\t\t}),\n\t\ttopicRelations: topicRelations.map(relation => {\n\t\t\treturn {\n\t\t\t\trelation,\n\t\t\t\tpoints: { drawn: 'M0,0 L0,0' }\n\t\t\t};\n\t\t}),\n\t\ttopicSelection: {\n\t\t\tvisible: false,\n\t\t\trect: { x: 0, y: 0, width: 0, height: 0 }\n\t\t}\n\t};\n};\nconst asTopicMap = (graphics: Graphics) => {\n\treturn graphics.topics.reduce((map, topic) => {\n\t\tmap.set(topic.topic.topicId, topic);\n\t\treturn map;\n\t}, new Map<string, TopicGraphics>());\n};\nconst asTopicRelationMap = (graphics: Graphics) => {\n\treturn graphics.topicRelations.reduce((map, relation) => {\n\t\tmap.set(relation.relation.relationId, relation);\n\t\treturn map;\n\t}, new Map<string, TopicRelationGraphics>());\n};\nconst computeGraphics = (options: {\n\tgraphics: Graphics;\n\trepaint: () => void;\n\tsvg: SVGSVGElement;\n\tsize: GraphicsSize;\n}) => {\n\tconst { graphics, repaint, svg, size: { width, height } } = options;\n\n\t// compute topic size\n\tconst topicMap: Map<string, TopicGraphics> = asTopicMap(graphics);\n\tArray.from(svg.querySelectorAll(`g[data-role=${GraphicsRole.TOPIC}]`)).forEach(topicRect => {\n\t\tconst topicId = topicRect.getAttribute('data-topic-id')!;\n\t\tconst name = topicRect.querySelector(`text[data-role='${GraphicsRole.TOPIC_NAME}']`)! as SVGTextElement;\n\t\tconst nameRect = name.getBBox();\n\t\tconst rect = topicMap.get(topicId)!.rect;\n\t\trect.frame = { ...rect.frame, ...computeTopicFrameSize(nameRect) };\n\t\trect.name = computeTopicNamePosition(rect.frame);\n\t});\n\t// compute topic positions in palette, random\n\tArray.from(topicMap.values()).forEach(topicGraphics => {\n\t\tlet x = 30 + Math.random() * (width - topicGraphics.rect.frame.width - 60);\n\t\tlet y = 15 + Math.random() * (height - topicGraphics.rect.frame.height - 30);\n\t\ttopicGraphics.rect.coordinate = { x, y };\n\t});\n\n\t// compute topic relations\n\tgraphics.topicRelations.forEach(relation => {\n\t\tconst { relation: { sourceTopicId, targetTopicId } } = relation;\n\t\trelation.points = computeTopicRelationPoints({ graphics, sourceTopicId, targetTopicId });\n\t});\n\trepaint();\n};\n\nconst SvgPalette = (props: { space: ConnectedConsoleSpace }) => {\n\tconst { space } = props;\n\tconst { topics, topicRelations = [] } = space;\n\n\tconst palette = usePalette();\n\tconst svgRef = useRef<SVGSVGElement>(null);\n\tconst forceUpdate = useForceUpdate();\n\tconst [ svgSize, setSvgSize ] = useState<GraphicsSize>({ width: 300, height: 300 });\n\tconst [ graphics ] = useState<Graphics>(createInitGraphics(space));\n\tuseEffect(() => {\n\t\tconst svg = svgRef.current;\n\t\tif (svg) {\n\t\t\tconst container = svg.parentElement! as HTMLDivElement;\n\t\t\tconst resize = () => setSvgSize({ width: container.clientWidth, height: container.clientHeight });\n\t\t\t// @ts-ignore\n\t\t\tconst resizeObserver = new ResizeObserver(resize);\n\t\t\tresizeObserver.observe(container);\n\t\t\tresize();\n\t\t\tcomputeGraphics({\n\t\t\t\tgraphics,\n\t\t\t\trepaint: forceUpdate,\n\t\t\t\tsvg,\n\t\t\t\tsize: { width: container.clientWidth, height: container.clientHeight }\n\t\t\t});\n\t\t\treturn () => resizeObserver.disconnect();\n\t\t}\n\t\t// eslint-disable-next-line\n\t}, []);\n\n\tconst topicMap: Map<string, TopicGraphics> = asTopicMap(graphics);\n\tconst topicRelationMap: Map<string, TopicRelationGraphics> = asTopicRelationMap(graphics);\n\n\tconst clearSelection = () => {\n\t\tdelete graphics.topicSelection.topicId;\n\t\tgraphics.topicSelection.visible = false;\n\t\tpalette.topicSelectionChanged(graphics.topicSelection);\n\t};\n\tconst onSvgMouseDown = (event: React.MouseEvent) => {\n\t\tconst { button, target } = event;\n\t\tif (button === 2 || button === 1) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst element = target as SVGGraphicsElement;\n\t\tconst tagName = element.tagName.toUpperCase();\n\t\tif (tagName === 'SVG') {\n\t\t\tclearSelection();\n\t\t\treturn;\n\t\t}\n\n\t\tconst role = element.getAttribute('data-role') || '';\n\t\tswitch (role) {\n\t\t\tcase GraphicsRole.TOPIC_FRAME:\n\t\t\tcase GraphicsRole.TOPIC_NAME:\n\t\t\t\tconst topicRect = element.parentElement! as unknown as SVGGElement;\n\t\t\t\tconst topicId = topicRect.getAttribute('data-topic-id')!;\n\t\t\t\tgraphics.topicSelection.topicId = topicId;\n\t\t\t\tgraphics.topicSelection.visible = true;\n\t\t\t\tgraphics.topicSelection.rect = computeTopicSelection({ graphics, topicId });\n\t\t\t\tpalette.topicSelectionChanged(graphics.topicSelection);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tclearSelection();\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\treturn <Fragment>\n\t\t<PaletteSvg width={svgSize.width} height={svgSize.height}\n\t\t            viewBox={`0 0 ${svgSize.width} ${svgSize.height}`}\n\t\t            onMouseDown={onSvgMouseDown}\n\t\t            ref={svgRef}>\n\t\t\t{topicRelations.map(relation => {\n\t\t\t\tconst relationGraphics = topicRelationMap.get(relation.relationId)!;\n\t\t\t\treturn <TopicRelation graphics={graphics} relation={relationGraphics} key={relation.relationId}/>;\n\t\t\t})}\n\t\t\t{topics.map(topic => {\n\t\t\t\tconst topicGraphics = topicMap.get(topic.topicId)!;\n\t\t\t\treturn <TopicRect topic={topicGraphics} key={topic.code}/>;\n\t\t\t})}\n\t\t\t<TopicSelection graphics={graphics} selection={graphics.topicSelection}/>\n\t\t</PaletteSvg>\n\t\t{topicRelations.map(relation => {\n\t\t\tconst relationGraphics = topicRelationMap.get(relation.relationId)!;\n\t\t\treturn <TopicRelationAnimation graphics={graphics} relation={relationGraphics} key={relation.relationId}/>;\n\t\t})}\n\t\t<TopicDetail space={space}/>\n\t</Fragment>;\n};\n\nexport const Palette = (props: { space: ConnectedConsoleSpace }) => {\n\tconst { space } = props;\n\n\treturn <PaletteContainer>\n\t\t<PaletteContextProvider>\n\t\t\t<SvgPalette space={space}/>\n\t\t</PaletteContextProvider>\n\t</PaletteContainer>;\n};\n","import { faBook } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React from 'react';\nimport styled from 'styled-components';\nimport { ConnectedConsoleSpace } from '../../../../services/console/types';\n\nconst Container = styled.div`\n\tdisplay: flex;\n\tflex-direction: column;\n\twidth: 40px;\n\tborder-left: var(--border);\n\talign-items: center;\n\t> svg {\n\t\theight: 40px;\n\t\topacity: 0.7;\n\t}\n\t> div {\n\t\tposition: relative;\n\t\twriting-mode: vertical-lr;\n\t\tpadding: calc(var(--margin) / 2) 0;\n\t\tfont-family: var(--console-title-font-family);\n\t\tuser-select: none;\n\t\t&:not(:last-child):after {\n\t\t\tcontent: '';\n\t\t\tdisplay: block;\n\t\t\tposition: absolute;\n\t\t\tbottom: 0;\n\t\t\tleft: 10%;\n\t\t\twidth: 80%;\n\t\t\theight: 1px;\n\t\t\tbackground-color: var(--border-color);\n\t\t}\n\t\t&:nth-child(2) > span:first-child {\n\t\t\tcolor: var(--console-primary-color);\n\t\t}\n\t\t&:last-child > span:first-child {\n\t\t\tcolor: var(--console-success-color);\n\t\t}\n\t\t> span:first-child {\n\t\t\tpadding-bottom: calc(var(--margin) / 4);\n\t\t\tfont-weight: var(--font-bold);\n\t\t\tfont-size: 1.2em;\n\t\t}\n\t\t> span:last-child {\n\t\t\topacity: 0.7;\n\t\t}\n\t}\n`;\n\nexport const ResourcesList = (props: { space: ConnectedConsoleSpace }) => {\n\tconst { space } = props;\n\n\tconst { topics } = space;\n\n\treturn <Container>\n\t\t<FontAwesomeIcon icon={faBook}/>\n\t\t<div><span>{topics.length}</span><span>Topics</span></div>\n\t\t<div><span>5</span><span>Reports</span></div>\n\t</Container>;\n};","import React from 'react';\nimport styled from 'styled-components';\nimport { ConnectedConsoleSpace } from '../../../../services/console/types';\nimport { Palette } from './palette';\nimport { ResourcesList } from './resources-list';\n\nconst Container = styled.div`\n\tdisplay: flex;\n\tmin-height: 100%;\n\twidth: 100%;\n`;\n\nconst AvailableResourcesContent = (props: {\n\tspace: ConnectedConsoleSpace;\n}) => {\n\tconst { space } = props;\n\n\treturn <Container>\n\t\t<Palette space={space}/>\n\t\t<ResourcesList space={space}/>\n\t</Container>;\n};\n\nexport const AvailableResources = (props: {\n\tvisible: boolean;\n\tspace: ConnectedConsoleSpace;\n}) => {\n\tconst { visible, ...rest } = props;\n\n\tif (!visible) {\n\t\treturn null;\n\t}\n\n\treturn <AvailableResourcesContent {...rest}/>;\n};","import { EventEmitter } from 'events';\nimport React, { useState } from 'react';\nimport { matchPath, useHistory, useLocation } from 'react-router-dom';\nimport Path, { toConnectedSpace, toSpaceGroup, toSpaceSubject } from '../../../common/path';\nimport { ConnectedConsoleSpace, ConsoleSpaceGroup, ConsoleSpaceSubject } from '../../../services/console/types';\n\nexport enum SpaceEvent {\n\tGROUP_CLOSED = 'group-closed',\n\tGROUP_RENAMED = 'group-renamed',\n\tSUBJECT_CLOSED = 'subject-closed',\n\tSUBJECT_RENAMED = 'subject-renamed'\n}\n\nexport type ActiveGroups = Array<ConsoleSpaceGroup>;\nexport type ActiveSubjects = Array<ConsoleSpaceSubject>;\n\nexport type GroupClosedListener = (options: { space: ConnectedConsoleSpace, group: ConsoleSpaceGroup }) => void;\nexport type GroupRenamedListener = (options: { space: ConnectedConsoleSpace, group: ConsoleSpaceGroup }) => void;\nexport type SubjectClosedListener = (options: { space: ConnectedConsoleSpace, group?: ConsoleSpaceGroup, subject: ConsoleSpaceSubject }) => void;\nexport type SubjectRenamedListener = (options: { space: ConnectedConsoleSpace, group?: ConsoleSpaceGroup, subject: ConsoleSpaceSubject }) => void;\n\nexport interface SpaceContextStore {\n\tactiveGroupId?: string;\n\tactiveSubjectId?: string;\n}\n\nexport interface SpaceContext {\n\tstore: SpaceContextStore;\n\n\tisGroupOpened: (group: ConsoleSpaceGroup) => boolean;\n\topenGroupIfCan: (options: { space: ConnectedConsoleSpace, group: ConsoleSpaceGroup }) => void;\n\tcloseGroupIfCan: (options: { space: ConnectedConsoleSpace, group: ConsoleSpaceGroup }) => void;\n\taddGroupClosedListener: (listener: GroupClosedListener) => void;\n\tremoveGroupClosedListener: (listener: GroupClosedListener) => void;\n\tgroupRenamed: (options: { space: ConnectedConsoleSpace, group: ConsoleSpaceGroup }) => void;\n\taddGroupRenamedListener: (listener: GroupRenamedListener) => void;\n\tremoveGroupRenamedListener: (listener: GroupRenamedListener) => void;\n\n\tisSubjectOpened: (subject: ConsoleSpaceSubject) => boolean;\n\topenSubjectIfCan: (options: { space: ConnectedConsoleSpace, group?: ConsoleSpaceGroup, subject: ConsoleSpaceSubject }) => void;\n\tcloseSubjectIfCan: (options: { space: ConnectedConsoleSpace, group?: ConsoleSpaceGroup, subject: ConsoleSpaceSubject }) => void;\n\taddSubjectClosedListener: (listener: SubjectClosedListener) => void;\n\tremoveSubjectClosedListener: (listener: SubjectClosedListener) => void;\n\tsubjectRenamed: (options: { space: ConnectedConsoleSpace, group?: ConsoleSpaceGroup, subject: ConsoleSpaceSubject }) => void;\n\taddSubjectRenamedListener: (listener: SubjectRenamedListener) => void;\n\tremoveSubjectRenamedListener: (listener: SubjectRenamedListener) => void;\n}\n\nconst Context = React.createContext<SpaceContext>({} as SpaceContext);\nContext.displayName = 'SpaceContext';\n\nexport const SpaceContextProvider = (props: {\n\tchildren?: ((props: any) => React.ReactNode) | React.ReactNode;\n}) => {\n\tconst { children } = props;\n\n\tconst location = useLocation();\n\tconst history = useHistory();\n\tconst [ emitter ] = useState(new EventEmitter());\n\tconst [ activeGroups ] = useState<ActiveGroups>([]);\n\tconst [ activeSubjects ] = useState<ActiveSubjects>([]);\n\tconst [ store ] = useState<SpaceContextStore>({} as SpaceContextStore);\n\n\t// eslint-disable-next-line\n\tconst isGroupOpened = (group: ConsoleSpaceGroup) => activeGroups.some(g => g.groupId == group.groupId);\n\tconst openGroupIfCan = (options: { space: ConnectedConsoleSpace, group: ConsoleSpaceGroup }) => {\n\t\tconst { space, group } = options;\n\t\t// eslint-disable-next-line\n\t\tconst index = activeGroups.findIndex(g => g.groupId == group.groupId);\n\t\tif (index === -1) {\n\t\t\t// not opened\n\t\t\tactiveGroups.push(group);\n\t\t}\n\t\tstore.activeGroupId = group.groupId;\n\t\thistory.push(toSpaceGroup(Path.CONSOLE_CONNECTED_SPACE_GROUP, space.connectId, group.groupId));\n\t};\n\tconst closeGroupIfCan = (options: { space: ConnectedConsoleSpace, group: ConsoleSpaceGroup }) => {\n\t\tconst { space, group } = options;\n\t\t// eslint-disable-next-line\n\t\tconst index = activeGroups.findIndex(g => g.groupId == group.groupId);\n\t\tif (index !== -1) {\n\t\t\tactiveGroups.splice(index, 1);\n\t\t\tconst match = matchPath<{ groupId: string }>(location.pathname, Path.CONSOLE_CONNECTED_SPACE_GROUP);\n\t\t\t// eslint-disable-next-line\n\t\t\tif (match && match.params.groupId == group.groupId) {\n\t\t\t\t// current is active tab, and active group\n\t\t\t\tif (activeGroups.length === 0) {\n\t\t\t\t\t// no more group opened\n\t\t\t\t\tdelete store.activeGroupId;\n\t\t\t\t\thistory.push(toConnectedSpace(Path.CONSOLE_CONNECTED_SPACE_OVERALL, space.connectId));\n\t\t\t\t} else if (index !== 0) {\n\t\t\t\t\t// not first one, use previous one\n\t\t\t\t\tstore.activeGroupId = activeGroups[index - 1].groupId;\n\t\t\t\t\thistory.push(toSpaceGroup(Path.CONSOLE_CONNECTED_SPACE_GROUP, space.connectId, activeGroups[index - 1].groupId));\n\t\t\t\t} else {\n\t\t\t\t\tstore.activeGroupId = activeGroups[0].groupId;\n\t\t\t\t\thistory.push(toSpaceGroup(Path.CONSOLE_CONNECTED_SPACE_GROUP, space.connectId, activeGroups[0].groupId));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// whether current is active tab or not\n\t\t\t\t// eslint-disable-next-line\n\t\t\t\tif (store.activeGroupId == group.groupId) {\n\t\t\t\t\t// current is active group\n\t\t\t\t\tif (activeGroups.length === 0) {\n\t\t\t\t\t\t// no more group opened\n\t\t\t\t\t\tdelete store.activeGroupId;\n\t\t\t\t\t} else if (index !== 0) {\n\t\t\t\t\t\t// not first one, use previous one\n\t\t\t\t\t\tstore.activeGroupId = activeGroups[index - 1].groupId;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstore.activeGroupId = activeGroups[0].groupId;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\temitter.emit(SpaceEvent.GROUP_CLOSED, { space, group });\n\t\t\t}\n\t\t}\n\t};\n\tconst addGroupClosedListener = (listener: GroupClosedListener) => emitter.on(SpaceEvent.GROUP_CLOSED, listener);\n\tconst removeGroupClosedListener = (listener: GroupClosedListener) => emitter.off(SpaceEvent.GROUP_CLOSED, listener);\n\tconst groupRenamed = (options: { space: ConnectedConsoleSpace, group: ConsoleSpaceGroup }) => {\n\t\tconst { space, group } = options;\n\t\temitter.emit(SpaceEvent.GROUP_RENAMED, { space, group });\n\t};\n\tconst addGroupRenamedListener = (listener: GroupRenamedListener) => emitter.on(SpaceEvent.GROUP_RENAMED, listener);\n\tconst removeGroupRenamedListener = (listener: GroupRenamedListener) => emitter.off(SpaceEvent.GROUP_RENAMED, listener);\n\n\t// eslint-disable-next-line\n\tconst isSubjectOpened = (subject: ConsoleSpaceSubject) => activeSubjects.some(s => s.subjectId == subject.subjectId);\n\tconst openSubjectIfCan = (options: { space: ConnectedConsoleSpace, group?: ConsoleSpaceGroup, subject: ConsoleSpaceSubject }) => {\n\t\tconst { space, subject } = options;\n\t\t// eslint-disable-next-line\n\t\tconst index = activeSubjects.findIndex(s => s.subjectId == subject.subjectId);\n\t\tif (index === -1) {\n\t\t\t// not opened\n\t\t\tactiveSubjects.push(subject);\n\t\t}\n\t\tstore.activeSubjectId = subject.subjectId;\n\t\thistory.push(toSpaceSubject(Path.CONSOLE_CONNECTED_SPACE_SUBJECT, space.connectId, subject.subjectId));\n\t};\n\tconst closeSubjectIfCan = (options: { space: ConnectedConsoleSpace, group?: ConsoleSpaceGroup, subject: ConsoleSpaceSubject }) => {\n\t\tconst { space, group, subject } = options;\n\t\t// eslint-disable-next-line\n\t\tconst index = activeSubjects.findIndex(s => s.subjectId == subject.subjectId);\n\t\tif (index !== -1) {\n\t\t\tactiveSubjects.splice(index, 1);\n\t\t\tconst match = matchPath<{ subjectId: string }>(location.pathname, Path.CONSOLE_CONNECTED_SPACE_SUBJECT);\n\t\t\t// eslint-disable-next-line\n\t\t\tif (match && match.params.subjectId == subject.subjectId) {\n\t\t\t\t// current is active tab, and active subject\n\t\t\t\tif (activeSubjects.length === 0) {\n\t\t\t\t\t// no more subject opened\n\t\t\t\t\tdelete store.activeSubjectId;\n\t\t\t\t\thistory.push(toConnectedSpace(Path.CONSOLE_CONNECTED_SPACE_OVERALL, space.connectId));\n\t\t\t\t} else if (index !== 0) {\n\t\t\t\t\t// not first one, use previous one\n\t\t\t\t\tstore.activeSubjectId = activeSubjects[index - 1].subjectId;\n\t\t\t\t\thistory.push(toSpaceSubject(Path.CONSOLE_CONNECTED_SPACE_SUBJECT, space.connectId, activeSubjects[index - 1].subjectId));\n\t\t\t\t} else {\n\t\t\t\t\tstore.activeSubjectId = activeSubjects[0].subjectId;\n\t\t\t\t\thistory.push(toSpaceSubject(Path.CONSOLE_CONNECTED_SPACE_SUBJECT, space.connectId, activeSubjects[0].subjectId));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// whether current is active tab or not\n\t\t\t\t// eslint-disable-next-line\n\t\t\t\tif (store.activeSubjectId == subject.subjectId) {\n\t\t\t\t\t// current is active subject\n\t\t\t\t\tif (activeSubjects.length === 0) {\n\t\t\t\t\t\t// no more subject opened\n\t\t\t\t\t\tdelete store.activeSubjectId;\n\t\t\t\t\t} else if (index !== 0) {\n\t\t\t\t\t\t// not first one, use previous one\n\t\t\t\t\t\tstore.activeSubjectId = activeSubjects[index - 1].subjectId;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstore.activeSubjectId = activeSubjects[0].subjectId;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\temitter.emit(SpaceEvent.SUBJECT_CLOSED, { space, group, subject });\n\t\t\t}\n\t\t}\n\t};\n\tconst addSubjectClosedListener = (listener: SubjectClosedListener) => emitter.on(SpaceEvent.SUBJECT_CLOSED, listener);\n\tconst removeSubjectClosedListener = (listener: SubjectClosedListener) => emitter.off(SpaceEvent.SUBJECT_CLOSED, listener);\n\tconst subjectRenamed = (options: { space: ConnectedConsoleSpace, group?: ConsoleSpaceGroup, subject: ConsoleSpaceSubject }) => {\n\t\tconst { space, group, subject } = options;\n\t\temitter.emit(SpaceEvent.SUBJECT_RENAMED, { space, group, subject });\n\t};\n\tconst addSubjectRenamedListener = (listener: SubjectRenamedListener) => emitter.on(SpaceEvent.SUBJECT_RENAMED, listener);\n\tconst removeSubjectRenamedListener = (listener: SubjectRenamedListener) => emitter.off(SpaceEvent.SUBJECT_RENAMED, listener);\n\n\treturn <Context.Provider value={{\n\t\tstore,\n\n\t\tisGroupOpened,\n\t\topenGroupIfCan,\n\t\tcloseGroupIfCan,\n\t\taddGroupClosedListener,\n\t\tremoveGroupClosedListener,\n\t\tgroupRenamed,\n\t\taddGroupRenamedListener,\n\t\tremoveGroupRenamedListener,\n\n\t\tisSubjectOpened,\n\t\topenSubjectIfCan,\n\t\tcloseSubjectIfCan,\n\t\taddSubjectClosedListener,\n\t\tremoveSubjectClosedListener,\n\t\tsubjectRenamed,\n\t\taddSubjectRenamedListener,\n\t\tremoveSubjectRenamedListener\n\t}}>{children}</Context.Provider>;\n};\n\nexport const useSpaceContext = () => {\n\treturn React.useContext(Context);\n};\n","import dayjs from 'dayjs';\nimport { ConnectedConsoleSpace, ConsoleSpaceGroup, ConsoleSpaceSubject } from '../../../services/console/types';\n\nexport const getVisitAdvice = (lastVisitTime: string) => {\n\tconst lastVisit = dayjs(lastVisitTime);\n\tconst days = dayjs().diff(lastVisit, 'day');\n\tif (days > 365) {\n\t\treturn 'ancient';\n\t} else if (days > 30) {\n\t\treturn 'year';\n\t} else if (days > 7) {\n\t\treturn 'month';\n\t} else if (days > 1) {\n\t\treturn 'week';\n\t}\n\treturn 'recent';\n};\n\nexport const findSubjectIndex = (subject: ConsoleSpaceSubject, subjects: Array<ConsoleSpaceSubject>): number => {\n\t// eslint-disable-next-line\n\treturn subjects.findIndex(s => s.subjectId == subject.subjectId);\n};\nexport const findParentGroup = (subject: ConsoleSpaceSubject, space: ConnectedConsoleSpace): ConsoleSpaceGroup | undefined => {\n\tif (findSubjectIndex(subject, space.subjects) !== -1) {\n\t\treturn void 0;\n\t} else {\n\t\treturn space.groups.find(group => findSubjectIndex(subject, group.subjects) !== -1);\n\t}\n};\n","import React, { Fragment } from 'react';\nimport { deleteGroup, deleteSubject } from '../../../services/console/space';\nimport { ConnectedConsoleSpace, ConsoleSpaceGroup, ConsoleSpaceSubject } from '../../../services/console/types';\nimport Button, { ButtonType } from '../../component/button';\nimport Input from '../../component/input';\nimport { DialogContext } from '../../context/dialog';\nimport { findSubjectIndex } from './utils';\n\nexport const createDeleteSubjectClickHandler = (options: {\n\tdialog: DialogContext,\n\tspace: ConnectedConsoleSpace;\n\tgroup?: ConsoleSpaceGroup;\n\tsubject: ConsoleSpaceSubject;\n\t/** on deleted, subject already be deleted from memory, refresh display  */\n\tonDeleted: (options: {\n\t\tspace: ConnectedConsoleSpace;\n\t\tgroup?: ConsoleSpaceGroup;\n\t\tsubject: ConsoleSpaceSubject;\n\t}) => void;\n}) => async (event: React.MouseEvent) => {\n\tconst { dialog, space, group, subject, onDeleted } = options;\n\n\tevent.preventDefault();\n\tevent.stopPropagation();\n\n\tconst label = group ? `${space.name} / ${group.name} / ${subject.name}` : `${space.name} / ${subject.name}`;\n\tconst doDeleteSubject = async (options: {\n\t\tspace: ConnectedConsoleSpace;\n\t\tgroup?: ConsoleSpaceGroup;\n\t\tsubject: ConsoleSpaceSubject;\n\t}) => {\n\t\tconst { space, group, subject } = options;\n\n\t\ttry {\n\t\t\tawait deleteSubject(subject);\n\t\t} catch (e) {\n\t\t\tconsole.groupCollapsed(`%cError on delete group.`, 'color:rgb(251,71,71)');\n\t\t\tconsole.error('Space: ', space);\n\t\t\tconsole.error('Group: ', group);\n\t\t\tconsole.error('Subject:', subject);\n\t\t\tconsole.error(e);\n\t\t\tconsole.groupEnd();\n\t\t}\n\t\t// display group is not the really parent group\n\t\tif (!group) {\n\t\t\tconst index = findSubjectIndex(subject, space.subjects);\n\t\t\tspace.subjects.splice(index, 1);\n\t\t} else {\n\t\t\tconst index = findSubjectIndex(subject, group.subjects);\n\t\t\tgroup.subjects.splice(index as number, 1);\n\t\t}\n\t};\n\tconst onConfirmClicked = async () => {\n\t\tawait doDeleteSubject({ space, group, subject });\n\t\tonDeleted({ space, group, subject });\n\t\tdialog.hide();\n\t};\n\n\tdialog.show(\n\t\t<div data-widget='dialog-console-delete'>\n\t\t\t<span>Are you sure to delete subject?</span>\n\t\t\t<span data-widget='dialog-console-object'>{label}</span>\n\t\t</div>,\n\t\t<Fragment>\n\t\t\t<div style={{ flexGrow: 1 }}/>\n\t\t\t<Button inkType={ButtonType.PRIMARY} onClick={onConfirmClicked}>Yes</Button>\n\t\t\t<Button inkType={ButtonType.DEFAULT} onClick={dialog.hide}>Cancel</Button>\n\t\t</Fragment>\n\t);\n};\n\nexport const createDeleteGroupClickHandler = (options: {\n\tdialog: DialogContext,\n\tspace: ConnectedConsoleSpace;\n\tgroup: ConsoleSpaceGroup;\n\t/** on deleted, subject already be deleted from memory, refresh display  */\n\tonDeleted: (options: {\n\t\tspace: ConnectedConsoleSpace;\n\t\tgroup: ConsoleSpaceGroup;\n\t}) => void;\n}) => async (event: React.MouseEvent) => {\n\tconst { dialog, space, group, onDeleted } = options;\n\n\tevent.preventDefault();\n\tevent.stopPropagation();\n\n\tconst doDeleteGroup = async (options: { space: ConnectedConsoleSpace; group: ConsoleSpaceGroup; }) => {\n\t\tconst { space, group } = options;\n\t\ttry {\n\t\t\tawait deleteGroup(group);\n\t\t} catch (e) {\n\t\t\tconsole.groupCollapsed(`%cError on delete group.`, 'color:rgb(251,71,71)');\n\t\t\tconsole.error('Space: ', space);\n\t\t\tconsole.error('Group: ', group);\n\t\t\tconsole.error(e);\n\t\t\tconsole.groupEnd();\n\t\t}\n\t\tconst index = space.groups.findIndex(exists => exists === group);\n\t\tspace.groups.splice(index, 1);\n\t};\n\tconst onConfirmClicked = async () => {\n\t\tawait doDeleteGroup({ space, group });\n\t\tonDeleted({ space, group });\n\t\tdialog.hide();\n\t};\n\tdialog.show(\n\t\t<div data-widget='dialog-console-delete'>\n\t\t\t<span>Are you sure to delete group?</span>\n\t\t\t<span data-widget='dialog-console-object'>{space.name} / {group.name}</span>\n\t\t</div>,\n\t\t<Fragment>\n\t\t\t<div style={{ flexGrow: 1 }}/>\n\t\t\t<Button inkType={ButtonType.PRIMARY} onClick={onConfirmClicked}>Yes</Button>\n\t\t\t<Button inkType={ButtonType.DEFAULT} onClick={dialog.hide}>Cancel</Button>\n\t\t</Fragment>\n\t);\n};\n\nexport const createRenameClickHandler = (options: {\n\tdialog: DialogContext,\n\tspace: ConnectedConsoleSpace;\n\tgroup?: ConsoleSpaceGroup;\n\tsubject?: ConsoleSpaceSubject;\n\tasFullName: (options: { space: ConnectedConsoleSpace; group?: ConsoleSpaceGroup; subject?: ConsoleSpaceSubject; }) => string;\n\trenameObject: (options: { space: ConnectedConsoleSpace; group?: ConsoleSpaceGroup; subject?: ConsoleSpaceSubject; }, newName: string) => void;\n\tonRenamed: (options: { space: ConnectedConsoleSpace; group?: ConsoleSpaceGroup; subject?: ConsoleSpaceSubject; }) => void;\n}) => async (event: React.MouseEvent) => {\n\tconst { dialog, space, group, subject, asFullName, renameObject, onRenamed } = options;\n\n\tevent.preventDefault();\n\tevent.stopPropagation();\n\n\tlet name = '';\n\tconst onTextChanged = (event: React.ChangeEvent<HTMLInputElement>) => {\n\t\tname = event.target.value;\n\t\tshowDialog(createContent(!(name.trim())));\n\t};\n\tconst showDialog = (content: JSX.Element) => {\n\t\tdialog.show(\n\t\t\tcontent,\n\t\t\t<Fragment>\n\t\t\t\t<div style={{ flexGrow: 1 }}/>\n\t\t\t\t<Button inkType={ButtonType.PRIMARY} onClick={onRenameConfirmClicked}>Yes</Button>\n\t\t\t\t<Button inkType={ButtonType.DEFAULT} onClick={dialog.hide}>Cancel</Button>\n\t\t\t</Fragment>\n\t\t);\n\t};\n\tconst createContent = (error: boolean = false) => {\n\t\treturn <div data-widget='dialog-console-rename'>\n\t\t\t<span>Rename <span data-widget='dialog-console-object'>{asFullName({\n\t\t\t\tspace,\n\t\t\t\tgroup,\n\t\t\t\tsubject\n\t\t\t})}</span> to:</span>\n\t\t\t<Input onChange={onTextChanged} value={name}\n\t\t\t       data-error={error}\n\t\t\t       placeholder='new name...'/>\n\t\t\t<span>Name is required.</span>\n\t\t</div>;\n\t};\n\tconst onRenameConfirmClicked = async () => {\n\t\tif (!(name.trim())) {\n\t\t\tshowDialog(createContent(true));\n\t\t\treturn;\n\t\t}\n\t\trenameObject({ space, group, subject }, name.trim());\n\t\tonRenamed({ space, group, subject });\n\t\tdialog.hide();\n\t};\n\tshowDialog(createContent());\n};","import { faTrashAlt } from '@fortawesome/free-regular-svg-icons';\nimport {\n\tfaBars,\n\tfaHistory,\n\tfaPenAlt,\n\tfaPoll,\n\tfaSortAlphaDown,\n\tfaSortAlphaUp,\n\tfaTimes\n} from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport dayjs from 'dayjs';\nimport React, { useState } from 'react';\nimport { useParams } from 'react-router-dom';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../../common/utils';\nimport { createSubject, renameGroup } from '../../../../services/console/space';\nimport { ConnectedConsoleSpace, ConsoleSpaceSubject } from '../../../../services/console/types';\nimport { LinkButton } from '../../../component/console/link-button';\nimport { useDialog } from '../../../context/dialog';\nimport { createDeleteGroupClickHandler, createDeleteSubjectClickHandler, createRenameClickHandler } from '../dialog';\nimport { useSpaceContext } from '../space-context';\nimport { findParentGroup, getVisitAdvice } from '../utils';\n\nenum SortType {\n\tBY_NAME_ASC = 'by-name-asc',\n\tBY_NAME_DESC = 'by-name-desc',\n\tBY_VISIT_ASC = 'by-visit-asc',\n\tBY_VISIT_DESC = 'by-visit-desc',\n}\n\nconst GroupViewContainer = styled.div.attrs({\n\t'data-widget': 'console-group-view'\n})`\n\tdisplay: flex;\n\tposition: relative;\n\twidth: 100%;\n\t&[data-min=true] {\n\t\t> button {\n\t\t\topacity: 1;\n\t\t\tpointer-events: auto;\n\t\t\t&:hover {\n\t\t\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t\t\t}\n\t\t}\n\t}\n\t> button {\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\topacity: 0;\n\t\tfont-family: var(--console-title-font-family);\n\t\tcolor: var(--invert-color);\n\t\tbackground-color: var(--console-primary-color);\n\t\ttop: calc(var(--margin) / 2);\n\t\tleft: calc(var(--margin) / 2);\n\t\twhite-space: nowrap;\n\t\tpadding: 6px calc(var(--margin) / 2);\n\t\tborder-radius: var(--border-radius);\n\t\tbox-shadow: var(--console-primary-shadow);\n\t\tpointer-events: none;\n\t\tz-index: 1;\n\t\ttransition: all 300ms ease-in-out;\n\t\t&:hover:before {\n\t\t\tdisplay: none;\n\t\t}\n\t}\n`;\nconst SubjectList = styled.div.attrs({\n\t'data-widget': 'console-group-view-subject-list'\n})`\n\tdisplay: flex;\n\tflex-direction: column;\n\twidth: 300px;\n\theight: 100%;\n\tborder-right: var(--border);\n\tbox-shadow: var(--console-hover-shadow);\n\ttransition: all 300ms ease-in-out;\n\toverflow: hidden;\n\t&[data-min=true] {\n\t\twidth: 0;\n\t\tborder-right-width: 0;\n\t}\n`;\nconst SubjectListHeader = styled.div.attrs({\n\t'data-widget': 'console-group-view-subject-list-header'\n})`\n\tdisplay: flex;\n\talign-items: center;\n\theight: 40px;\n\tpadding: 0 calc(var(--margin) / 2);\n\tborder-bottom: var(--border);\n\ttransition: all 300ms ease-in-out;\n\t> div:first-child {\n\t\tflex-grow: 1;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tfont-family: var(--console-title-font-family);\n\t\toverflow: hidden;\n\t\twhite-space: nowrap;\n\t\ttext-overflow: ellipsis;\n\t}\n\t> button {\n\t\theight: 20px;\n\t\t&:hover {\n\t\t\tcolor: var(--console-primary-color);\n\t\t}\n\t}\n`;\nconst SubjectListBody = styled.div.attrs({\n\t'data-widget': 'console-group-view-subject-list-body'\n})`\n\tflex-grow: 1;\n\tdisplay: flex;\n\tposition: relative;\n\tflex-direction: column;\n`;\nconst SubjectListBodyWrapper = styled.div`\n\tdisplay: flex;\n\tflex-direction: column;\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n\toverflow-x: hidden;\n\toverflow-y: auto;\n\tpadding: calc(var(--margin) / 2) calc(var(--margin) / 2);\n\t&::-webkit-scrollbar {\n\t\tbackground-color: transparent;\n\t\twidth: 4px;\n\t}\n\t&::-webkit-scrollbar-track {\n\t\tbackground-color: var(--scrollbar-background-color);\n\t\tborder-radius: 2px;\n\t}\n\t&::-webkit-scrollbar-thumb {\n\t\tbackground-color: var(--console-favorite-color);\n\t\tborder-radius: 2px;\n\t}\n`;\nconst SubjectCard = styled.div`\n\tdisplay: grid;\n\tposition: relative;\n\tgrid-template-columns: 1fr auto;\n\tgrid-column-gap: 8px;\n\tgrid-row-gap: 8px;\n\tborder-radius: calc(var(--border-radius) * 2);\n\tborder: var(--border);\n\tpadding: 0 calc(var(--margin) / 2) calc(var(--margin) / 2);\n\tbox-shadow: var(--console-shadow);\n\tcursor: pointer;\n\tmargin-bottom: calc(var(--margin) / 2);\n\ttransition: all 300ms ease-in-out;\n\t&:last-child {\n\t\tmargin-bottom: 0;\n\t}\n\t&:hover {\n\t\tbox-shadow: var(--console-hover-shadow);\n\t\t> div:first-child {\n\t\t\t> button {\n\t\t\t\topacity: 1;\n\t\t\t}\n\t\t}\n\t}\n\t&:before {\n\t\tcontent: '';\n\t\tposition: absolute;\n\t\ttop: -1px;\n\t\tleft: -1px;\n\t\twidth: calc(100% + 2px);\n\t\theight: calc(100% + 2px);\n\t\tborder-radius: calc(var(--border-radius) * 2);\n\t\tbackground-color: transparent;\n\t\tz-index: 1;\n\t\t//opacity: 0.2;\n\t\tpointer-events: none;\n\t}\n\t&[data-visit-advice=recent] {\n\t\tborder-color: transparent;\n\t\t&:before {\n\t\t\tbackground-color: var(--console-bg-color-recent);\n\t\t}\n\t}\n\t&[data-visit-advice=week] {\n\t\tborder-color: transparent;\n\t\t&:before {\n\t\t\tbackground-color: var(--console-bg-color-week);\n\t\t}\n\t}\n\t&[data-visit-advice=month] {\n\t\tborder-color: transparent;\n\t\t&:before {\n\t\t\tbackground-color: var(--console-bg-color-month);\n\t\t}\n\t}\n\t&[data-visit-advice=year] {\n\t\tborder-color: transparent;\n\t\t&:before {\n\t\t\tbackground-color: var(--console-bg-color-year);\n\t\t}\n\t}\n\t&[data-visit-advice=ancient] {\n\t\tborder-color: transparent;\n\t\t&:before {\n\t\t\tbackground-color: var(--console-bg-color-ancient);\n\t\t}\n\t}\n\t> div {\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t}\n\t> div:first-child {\n\t\tgrid-column: span 2;\n\t\tfont-family: var(--console-title-font-family);\n\t\theight: 40px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: space-between;\n\t\tborder-bottom: var(--border);\n\t\t> button {\n\t\t\topacity: 0;\n\t\t}\n\t}\n\t> div:not(:first-child) {\n\t\tfont-size: 0.8em;\n\t}\n\t> div:nth-child(2n + 1):not(:first-child) {\n\t\tjustify-self: end;\n\t}\n`;\n\nexport const GroupView = (props: {\n\tspace: ConnectedConsoleSpace;\n\tvisible: boolean;\n}) => {\n\tconst { space, visible } = props;\n\n\tconst { groupId } = useParams<{ groupId: string }>();\n\tconst dialog = useDialog();\n\tconst { closeGroupIfCan, groupRenamed, openSubjectIfCan, closeSubjectIfCan } = useSpaceContext();\n\tconst forceUpdate = useForceUpdate();\n\tconst [ min, setMin ] = useState<boolean>(false);\n\tconst [ sort, setSort ] = useState<SortType>(SortType.BY_VISIT_ASC);\n\n\tif (!visible) {\n\t\treturn null;\n\t}\n\n\t// eslint-disable-next-line\n\tconst group = space.groups.find(g => g.groupId == groupId)!;\n\tconst subjects = group.subjects.sort((s1, s2) => {\n\t\tswitch (sort) {\n\t\t\tcase SortType.BY_NAME_ASC:\n\t\t\t\treturn s1.name.toUpperCase().localeCompare(s2.name.toUpperCase());\n\t\t\tcase SortType.BY_NAME_DESC:\n\t\t\t\treturn s2.name.toUpperCase().localeCompare(s1.name.toUpperCase());\n\t\t\tcase SortType.BY_VISIT_DESC:\n\t\t\t\treturn s1.lastVisitTime.toUpperCase().localeCompare(s2.lastVisitTime.toUpperCase());\n\t\t\tcase SortType.BY_VISIT_ASC:\n\t\t\tdefault:\n\t\t\t\treturn s2.lastVisitTime.toUpperCase().localeCompare(s1.lastVisitTime.toUpperCase());\n\t\t}\n\t});\n\n\tconst onGroupDeleteClicked = createDeleteGroupClickHandler({\n\t\tdialog, space, group,\n\t\tonDeleted: ({ space, group }) => closeGroupIfCan({ space, group })\n\t});\n\tconst onRenameGroupClicked = createRenameClickHandler({\n\t\tdialog, space, group,\n\t\tasFullName: () => `${space.name} / ${group!.name}`,\n\t\trenameObject: (options, newName) => group.name = newName,\n\t\tonRenamed: () => {\n\t\t\tgroupRenamed({ space, group });\n\t\t\trenameGroup(group.groupId, group.name);\n\t\t\tforceUpdate();\n\t\t}\n\t});\n\tconst onAddClicked = async () => {\n\t\tconst now = dayjs().format('YYYY-MM-DD HH:mm:ss');\n\t\tconst newSubject = {\n\t\t\tsubjectId: '',\n\t\t\tname: 'Noname',\n\t\t\ttopicCount: 0,\n\t\t\tgraphicsCount: 0,\n\t\t\tlastVisitTime: now,\n\t\t\tcreatedAt: now\n\t\t};\n\t\tgroup.subjects.push(newSubject);\n\t\tawait createSubject({ space, group, subject: newSubject });\n\t\topenSubjectIfCan({ space, group, subject: newSubject });\n\t};\n\tconst onSortByNameAscClicked = () => setSort(SortType.BY_NAME_ASC);\n\tconst onSortByNameDescClicked = () => setSort(SortType.BY_NAME_DESC);\n\tconst onSortByVisitAscClicked = () => setSort(SortType.BY_VISIT_ASC);\n\tconst onSortByVisitDescClicked = () => setSort(SortType.BY_VISIT_DESC);\n\tconst onMaxClicked = () => setMin(false);\n\tconst onMinClicked = () => setMin(true);\n\tconst onOpenClicked = (subject: ConsoleSpaceSubject) => () => openSubjectIfCan({ space, group, subject });\n\tconst onSubjectDeleteClicked = (subject: ConsoleSpaceSubject) => createDeleteSubjectClickHandler({\n\t\tdialog,\n\t\tspace,\n\t\tgroup: findParentGroup(subject, space),\n\t\tsubject,\n\t\tonDeleted: ({ space, group, subject }) => closeSubjectIfCan({ space, group, subject })\n\t});\n\n\treturn <GroupViewContainer data-min={min}>\n\t\t<SubjectList data-min={min}>\n\t\t\t<SubjectListHeader>\n\t\t\t\t<div>{group.name}</div>\n\t\t\t\t<LinkButton onClick={onRenameGroupClicked} ignoreHorizontalPadding={true} tooltip='Rename'\n\t\t\t\t            center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faPenAlt}/>\n\t\t\t\t</LinkButton>\n\t\t\t\t<LinkButton onClick={onGroupDeleteClicked} ignoreHorizontalPadding={true} tooltip='Delete Group'\n\t\t\t\t            center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faTrashAlt}/>\n\t\t\t\t</LinkButton>\n\t\t\t\t<LinkButton onClick={onMinClicked} ignoreHorizontalPadding={true} tooltip='Minimize' center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faTimes}/>\n\t\t\t\t</LinkButton>\n\t\t\t</SubjectListHeader>\n\t\t\t<SubjectListHeader>\n\t\t\t\t<div>Subjects</div>\n\t\t\t\t<LinkButton onClick={onAddClicked} ignoreHorizontalPadding={true} tooltip='Add Subject' center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faPoll}/>\n\t\t\t\t</LinkButton>\n\t\t\t\t<LinkButton onClick={onSortByNameAscClicked} ignoreHorizontalPadding={true}\n\t\t\t\t            tooltip='Sort by Name, Ascending' center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faSortAlphaUp}/>\n\t\t\t\t</LinkButton>\n\t\t\t\t<LinkButton onClick={onSortByNameDescClicked} ignoreHorizontalPadding={true}\n\t\t\t\t            tooltip='Sort by Name, Descending' center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faSortAlphaDown}/>\n\t\t\t\t</LinkButton>\n\t\t\t\t<LinkButton onClick={onSortByVisitAscClicked} ignoreHorizontalPadding={true}\n\t\t\t\t            tooltip='Sort by Visit, Latest on Top' center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faHistory} style={{ transform: 'rotateY(180deg)' }}/>\n\t\t\t\t</LinkButton>\n\t\t\t\t<LinkButton onClick={onSortByVisitDescClicked} ignoreHorizontalPadding={true}\n\t\t\t\t            tooltip='Sort by Visit, Latest on Bottom' center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faHistory}/>\n\t\t\t\t</LinkButton>\n\t\t\t</SubjectListHeader>\n\t\t\t<SubjectListBody>\n\t\t\t\t<SubjectListBodyWrapper>\n\t\t\t\t\t{subjects.length === 0\n\t\t\t\t\t\t? <div>No Subject.</div>\n\t\t\t\t\t\t: subjects.map(subject => {\n\t\t\t\t\t\t\tconst visitAdvice = getVisitAdvice(subject.lastVisitTime);\n\t\t\t\t\t\t\treturn <SubjectCard data-visit-advice={visitAdvice} key={subject.subjectId}\n\t\t\t\t\t\t\t                    onClick={onOpenClicked(subject)}>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<span>{subject.name}</span>\n\t\t\t\t\t\t\t\t\t<LinkButton onClick={onSubjectDeleteClicked(subject)} ignoreHorizontalPadding={true}\n\t\t\t\t\t\t\t\t\t            tooltip='Delete Subject' center={true}>\n\t\t\t\t\t\t\t\t\t\t<FontAwesomeIcon icon={faTrashAlt}/>\n\t\t\t\t\t\t\t\t\t</LinkButton>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div>Topics:</div>\n\t\t\t\t\t\t\t\t<div>{subject.topicCount}</div>\n\t\t\t\t\t\t\t\t<div>Graphics:</div>\n\t\t\t\t\t\t\t\t<div>{subject.graphicsCount}</div>\n\t\t\t\t\t\t\t\t<div>Created At:</div>\n\t\t\t\t\t\t\t\t<div>{dayjs(subject.createdAt).fromNow()}</div>\n\t\t\t\t\t\t\t\t<div>Last Visit:</div>\n\t\t\t\t\t\t\t\t<div>{dayjs(subject.lastVisitTime).fromNow()}</div>\n\t\t\t\t\t\t\t</SubjectCard>;\n\t\t\t\t\t\t})}\n\t\t\t\t</SubjectListBodyWrapper>\n\t\t\t</SubjectListBody>\n\t\t</SubjectList>\n\t\t<LinkButton onClick={onMaxClicked} ignoreHorizontalPadding={true}\n\t\t            tooltip='Show Group View Menus'>\n\t\t\t<FontAwesomeIcon icon={faBars}/>\n\t\t</LinkButton>\n\t</GroupViewContainer>;\n};","export enum ViewType {\n\tBY_GROUP = 'by-group',\n\tBY_VISIT = 'by-visit'\n}\n","import { EventEmitter } from 'events';\nimport React, { useState } from 'react';\nimport { useForceUpdate } from '../../../../common/utils';\nimport { ConnectedConsoleSpace, ConsoleSpaceGroup, ConsoleSpaceSubject } from '../../../../services/console/types';\nimport { ViewType } from './types';\n\nexport enum ListViewEvent {\n\tCOLLAPSED_CHANGED = 'collapsed-changed',\n\tFILTER_TEXT_CHANGED = 'filter-text-changed',\n\t/**\n\t * is not invoked by filter input, but link on list body.\n\t * filter text monitor this event, and invoke filter text changed immediately\n\t */\n\tFILTER_CLEARED = 'filter-cleared'\n}\n\nexport type ToggleCollapsedListener = (collapsed: boolean) => void;\nexport type FilterTextChangedListener = (text: string) => void;\nexport type FilterClearedListener = () => void;\n\nexport interface ListContextStore {\n\tfilter: string;\n}\n\nexport interface ListContext {\n\tstore: ListContextStore;\n\n\tviewType: ViewType;\n\tsetViewType: (viewType: ViewType) => void;\n\n\ttoggleCollapsed: (collapsed: boolean) => void;\n\taddCollapsedChangedListener: (listener: ToggleCollapsedListener) => void;\n\tremoveCollapsedChangedListener: (listener: ToggleCollapsedListener) => void;\n\n\tfilterTextChanged: (text: string) => void;\n\taddFilterTextChangedListener: (listener: FilterTextChangedListener) => void;\n\tremoveFilterTextChangedListener: (listener: FilterTextChangedListener) => void;\n\n\tclearFilter: () => void;\n\taddFilterClearedListener: (listener: FilterClearedListener) => void;\n\tremoveFilterClearedListener: (listener: FilterClearedListener) => void;\n\n\tgroupDeleted: (options: { space: ConnectedConsoleSpace, group: ConsoleSpaceGroup }) => void;\n\tsubjectDeleted: (options: { space: ConnectedConsoleSpace, group?: ConsoleSpaceGroup, subject: ConsoleSpaceSubject }) => void;\n}\n\nconst Context = React.createContext<ListContext>({} as ListContext);\nContext.displayName = 'SpaceListContext';\n\nexport const ListContextProvider = (props: {\n\tchildren?: ((props: any) => React.ReactNode) | React.ReactNode;\n}) => {\n\tconst { children } = props;\n\n\tconst [ emitter ] = useState(new EventEmitter());\n\tconst forceUpdate = useForceUpdate();\n\tconst [ store ] = useState<ListContextStore>({ filter: '' });\n\tconst [ viewType, setViewType ] = useState<ViewType>(ViewType.BY_GROUP);\n\tconst [ functions ] = useState({\n\t\ttoggleCollapsed: (collapsed: boolean) => emitter.emit(ListViewEvent.COLLAPSED_CHANGED, collapsed),\n\t\taddCollapsedChangedListener: (listener: ToggleCollapsedListener) => emitter.on(ListViewEvent.COLLAPSED_CHANGED, listener),\n\t\tremoveCollapsedChangedListener: (listener: ToggleCollapsedListener) => emitter.off(ListViewEvent.COLLAPSED_CHANGED, listener),\n\n\t\tfilterTextChanged: (text: string) => {\n\t\t\tconst newFilter = (text || '').trim();\n\t\t\tif (store.filter !== newFilter) {\n\t\t\t\tstore.filter = newFilter;\n\t\t\t\temitter.emit(ListViewEvent.FILTER_TEXT_CHANGED, newFilter);\n\t\t\t}\n\t\t},\n\t\taddFilterTextChangedListener: (listener: FilterTextChangedListener) => emitter.on(ListViewEvent.FILTER_TEXT_CHANGED, listener),\n\t\tremoveFilterTextChangedListener: (listener: FilterTextChangedListener) => emitter.off(ListViewEvent.FILTER_TEXT_CHANGED, listener),\n\n\t\tclearFilter: () => emitter.emit(ListViewEvent.FILTER_CLEARED),\n\t\taddFilterClearedListener: (listener: FilterClearedListener) => emitter.on(ListViewEvent.FILTER_CLEARED, listener),\n\t\tremoveFilterClearedListener: (listener: FilterClearedListener) => emitter.off(ListViewEvent.FILTER_CLEARED, listener),\n\n\t\tgroupDeleted: (options: { space: ConnectedConsoleSpace, group: ConsoleSpaceGroup }) => forceUpdate(),\n\t\tsubjectDeleted: (options: { space: ConnectedConsoleSpace, group?: ConsoleSpaceGroup, subject: ConsoleSpaceSubject }) => forceUpdate()\n\t});\n\n\treturn <Context.Provider value={{\n\t\tstore,\n\t\tviewType, setViewType,\n\t\t...functions\n\t}}>{children}</Context.Provider>;\n};\n\nexport const useListView = () => {\n\treturn React.useContext(Context);\n};\n","import { faTrashAlt } from '@fortawesome/free-regular-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport dayjs from 'dayjs';\nimport React, { Fragment, useRef } from 'react';\nimport styled from 'styled-components';\nimport { ConnectedConsoleSpace, ConsoleSpaceGroup, ConsoleSpaceSubject } from '../../../../services/console/types';\nimport { TooltipAlignment, useTooltip } from '../../../component/console/context/console-tooltip';\nimport { useDialog } from '../../../context/dialog';\nimport { createDeleteSubjectClickHandler } from '../dialog';\nimport { useSpaceContext } from '../space-context';\nimport { findParentGroup, findSubjectIndex, getVisitAdvice } from '../utils';\nimport { useListView } from './list-context';\n\nconst SubjectContainer = styled.div.attrs({\n\t'data-widget': 'console-list-view-subject'\n})`\n\tdisplay: grid;\n\tgrid-template-columns: 1fr 80px 80px 120px 120px 32px;\n\tgrid-column-gap: calc(var(--margin) / 3);\n\talign-items: center;\n\theight: var(--console-subject-height);\n\tmargin: 0 calc(var(--margin) / 2) 1px;\n\tpadding: 0 calc(var(--margin) / 2);\n\tbackground-color: var(--bg-color);\n\tcursor: pointer;\n\t&:nth-child(2) {\n\t\tborder-top-left-radius: calc(var(--border-radius));\n\t\tborder-top-right-radius: calc(var(--border-radius));\n\t}\n\t&:last-child {\n\t\tborder-bottom-left-radius: calc(var(--border-radius));\n\t\tborder-bottom-right-radius: calc(var(--border-radius));\n\t\tmargin-bottom: 0;\n\t}\n\t&:hover {\n\t\tbox-shadow: var(--console-hover-shadow);\n\t\tz-index: 1;\n\t\t> div:first-child {\n\t\t\tcolor: var(--console-primary-color);\n\t\t}\n\t\t> div:last-child:not(:first-child) {\n\t\t\topacity: 0.9;\n\t\t\tpointer-events: auto;\n\t\t\t&:hover {\n\t\t\t\topacity: 1;\n\t\t\t\tcolor: var(--console-primary-color);\n\t\t\t}\n\t\t}\n\t}\n\t> div {\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\tfont-size: 0.8em;\n\t}\n\t> div:not(:first-child) {\n\t\topacity: 0.6;\n\t\tfont-family: var(--console-title-font-family);\n\t}\n\t> div:last-child:not(:first-child) {\n\t\tjustify-self: end;\n\t\tfont-size: 1em;\n\t\topacity: 0;\n\t\ttransition: all 300ms ease-in-out;\n\t\tpointer-events: none;\n\t}\n\t> div[data-visit-advice=week] {\n\t\tcolor: var(--console-color-week);\n\t}\n\t> div[data-visit-advice=month] {\n\t\tcolor: var(--console-color-month);\n\t}\n\t> div[data-visit-advice=year] {\n\t\tcolor: var(--console-color-year);\n\t}\n\t> div[data-visit-advice=ancient] {\n\t\tcolor: var(--console-color-ancient);\n\t}\n`;\n\nexport const Subject = (props: {\n\tspace: ConnectedConsoleSpace;\n\tgroup: ConsoleSpaceGroup;\n\tsubject: ConsoleSpaceSubject & { nameAs?: ((props: any) => React.ReactNode) | React.ReactNode };\n}) => {\n\tconst { space, subject } = props;\n\n\tconst dialog = useDialog();\n\tconst listView = useListView();\n\tconst { openSubjectIfCan, closeSubjectIfCan } = useSpaceContext();\n\tconst deleteRef = useRef<HTMLElement>(null);\n\tconst { mouseEnter, mouseLeave } = useTooltip({\n\t\tshow: true,\n\t\ttooltip: 'Delete Subject',\n\t\tref: deleteRef,\n\t\trect: () => ({ align: TooltipAlignment.RIGHT, offsetY: 10, offsetX: -13 })\n\t});\n\n\tconst visitAdvice = getVisitAdvice(subject.lastVisitTime);\n\tconst onSubjectClicked = () => {\n\t\tlet parentGroup: ConsoleSpaceGroup | undefined;\n\t\tconst index = findSubjectIndex(subject, space.subjects);\n\t\tif (index === -1) {\n\t\t\tparentGroup = findParentGroup(subject, space)!;\n\t\t}\n\t\topenSubjectIfCan({ space, group: parentGroup, subject });\n\t};\n\tconst onDeleteClicked = createDeleteSubjectClickHandler({\n\t\tdialog,\n\t\tspace,\n\t\tgroup: findParentGroup(subject, space),\n\t\tsubject,\n\t\tonDeleted: ({ space, group, subject }) => {\n\t\t\tlistView.subjectDeleted({ space, group, subject });\n\t\t\tcloseSubjectIfCan({ space, group, subject });\n\t\t}\n\t});\n\n\treturn <SubjectContainer onClick={onSubjectClicked}>\n\t\t<div>\n\t\t\t<span>{subject.nameAs || subject.name}</span>\n\t\t</div>\n\t\t{\n\t\t\t// eslint-disable-next-line\n\t\t\tsubject.subjectId == '-1'\n\t\t\t\t? null\n\t\t\t\t: <Fragment>\n\t\t\t\t\t<div>{subject.topicCount}</div>\n\t\t\t\t\t<div>{subject.graphicsCount}</div>\n\t\t\t\t\t<div data-visit-advice={visitAdvice}>{dayjs(subject.lastVisitTime).fromNow()}</div>\n\t\t\t\t\t<div>{dayjs(subject.createdAt).fromNow()}</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<FontAwesomeIcon icon={faTrashAlt} onClick={onDeleteClicked}\n\t\t\t\t\t\t                 forwardedRef={deleteRef}\n\t\t\t\t\t\t                 onMouseEnter={mouseEnter} onMouseLeave={mouseLeave}/>\n\t\t\t\t\t</div>\n\t\t\t\t</Fragment>\n\t\t}\n\t</SubjectContainer>;\n};","export const hasFilter = (filter?: string) => !!filter;\nexport const isGroupFilter = (filter: string) => filter.startsWith('g:');\nexport const getGroupFilterText = (filter: string) => filter.substr(2);\nexport const matchesFilter = (text: string, filter: string) => text.toUpperCase().includes(filter.toUpperCase());","import {\n\tfaCompressAlt,\n\tfaExpandAlt,\n\tfaExternalLinkAlt,\n\tfaFlagCheckered,\n\tfaTrashAlt\n} from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport dayjs from 'dayjs';\nimport React, { useEffect, useState } from 'react';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../../common/utils';\nimport { createSubject } from '../../../../services/console/space';\nimport { ConnectedConsoleSpace, ConsoleSpaceGroup, ConsoleSpaceSubject } from '../../../../services/console/types';\nimport { Theme } from '../../../../theme/types';\nimport { LinkButton } from '../../../component/console/link-button';\nimport { useDialog } from '../../../context/dialog';\nimport { createDeleteGroupClickHandler } from '../dialog';\nimport { useSpaceContext } from '../space-context';\nimport { useListView } from './list-context';\nimport { Subject } from './subject';\nimport { getGroupFilterText, hasFilter, isGroupFilter, matchesFilter } from './utils';\n\nconst GroupContainer = styled.div.attrs({\n\t'data-widget': 'console-list-view-group'\n})<{ colorSuffix?: string }>`\n\tdisplay: flex;\n\tflex-direction: column;\n\tposition: relative;\n\tborder-radius: calc(var(--border-radius) * 2);\n\tbackground-color: ${({ colorSuffix }) => colorSuffix ? `var(--console-bg-color-${colorSuffix})` : 'var(--console-group-bg-color)'};\n\tpadding: 0 calc(var(--margin) / 2);\n\tmargin-bottom: var(--margin);\n\toverflow: hidden;\n\ttransition: all 300ms ease-in-out;\n\t&:before {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\twidth: 4px;\n\t\theight: 100%;\n\t\tbackground-color: ${({ colorSuffix }) => colorSuffix ? `var(--console-color-${colorSuffix})` : 'var(--console-group-quote-color)'};\n\t}\n\t&:hover {\n\t\tdiv[data-widget='console-list-view-header-buttons'] {\n\t\t\topacity: 1;\n\t\t\tpointer-events: auto;\n\t\t}\n\t\tdiv[data-widget='console-list-view-subject-header'] {\n\t\t\t> div:first-child > button {\n\t\t\t\topacity: 1;\n\t\t\t\tpointer-events: auto;\n\t\t\t}\n\t\t}\n\t}\n\t&[data-visible=false] {\n\t\tmargin-bottom: 0;\n\t\t> div {\n\t\t\theight: 0;\n\t\t}\n\t}\n`;\nconst GroupHeader = styled.div.attrs({\n\t'data-widget': 'console-list-view-group-header'\n})`\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\theight: 44px;\n\t> div:first-child {\n\t\tfont-family: var(--console-title-font-family);\n\t}\n\t> div:last-child {\n\t\tdisplay: flex;\n\t\topacity: 0;\n\t\tpointer-events: none;\n\t\ttransition: all 300ms ease-in-out;\n\t\t&[data-collapsed=true] {\n\t\t\t> button:last-child > svg {\n\t\t\t\ttransform: rotateZ(180deg);\n\t\t\t}\n\t\t}\n\t\t> button {\n\t\t\tfont-size: 0.8em;\n\t\t\tfont-weight: var(--font-bold);\n\t\t\tcolor: var(--console-primary-color);\n\t\t\topacity: 0.6;\n\t\t\t&:hover {\n\t\t\t\topacity: 1;\n\t\t\t}\n\t\t\t&:last-child {\n\t\t\t\t> svg {\n\t\t\t\t\ttransition: all 300ms ease-in-out;\n\t\t\t\t}\n\t\t\t}\n\t\t\t> svg {\n\t\t\t\tmargin-right: calc(var(--margin) / 4);\n\t\t\t}\n\t\t}\n\t}\n`;\nconst GroupName = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\t&[data-openable=true]:hover {\n\t\tcursor: pointer;\n\t\t> span {\n\t\t\tcolor: var(--console-primary-color);\n\t\t}\n\t\t> svg {\n\t\t\tcolor: var(--console-primary-color);\n\t\t\topacity: 1;\n\t\t\tpointer-events: auto;\n\t\t}\n\t}\n\t> svg {\n\t\tmargin-left: calc(var(--margin) / 4);\n\t\topacity: 0;\n\t\tpointer-events: none;\n\t\ttransition: all 300ms ease-in-out;\n\t}\n`;\nconst GroupBody = styled.div.attrs<{ itemCount: number, visible: boolean }>(({ theme, itemCount, visible }) => {\n\tconst t = theme as Theme;\n\treturn {\n\t\t'data-widget': 'console-list-view-group-body',\n\t\tstyle: {\n\t\t\theight: visible ? `calc(1.9em + ${itemCount} * ${t.consoleSubjectHeight + 1}px - 1px)` : 0,\n\t\t\tmarginBottom: visible ? 'calc(var(--margin) / 2)' : 0\n\t\t}\n\t};\n})<{ itemCount: number, visible: boolean }>`\n\tdisplay: flex;\n\tflex-direction: column;\n\ttransition: all 300ms ease-in-out;\n\tmargin: 0 calc(var(--margin) / -2);\n\toverflow: hidden;\n`;\nconst GroupItemHeader = styled.div.attrs({\n\t'data-widget': 'console-list-view-subject-header'\n})`\n\tdisplay: grid;\n\talign-items: center;\n\tgrid-template-columns: 1fr 80px 80px 120px 120px 32px;\n\tgrid-column-gap: calc(var(--margin) / 3);\n\tfont-family: var(--console-title-font-family);\n\tfont-size: 0.8em;\n\tpadding: 0 calc(var(--margin) / 2);\n\tmargin: 0 calc(var(--margin) / 2);\n\theight: 1.6em;\n\tmargin-bottom: 0.5em;\n\t> div:not(:first-child) {\n\t\topacity: 0.5;\n\t}\n`;\n\nconst decorateDisplaySubjects = (subjects: Array<ConsoleSpaceSubject>, filtering: boolean): Array<ConsoleSpaceSubject> => {\n\tif (subjects.length === 0) {\n\t\treturn [ {\n\t\t\tsubjectId: '-1',\n\t\t\tname: filtering ? 'No matched.' : 'No subject.',\n\t\t\ttopicCount: 0,\n\t\t\tgraphicsCount: 0,\n\t\t\tlastVisitTime: '',\n\t\t\tcreatedAt: ''\n\t\t} ];\n\t} else {\n\t\treturn subjects;\n\t}\n};\nconst computeDisplaySubjects = (options: {\n\tfilter: string;\n\tsubjects: Array<ConsoleSpaceSubject>;\n\tgroup: ConsoleSpaceGroup;\n}): {\n\tvisible: boolean;\n\tsubjects: Array<ConsoleSpaceSubject>;\n} => {\n\tconst { filter, subjects, group } = options;\n\n\tif (!hasFilter(filter)) {\n\t\treturn { visible: true, subjects: decorateDisplaySubjects(subjects, false) };\n\t} else if (isGroupFilter(filter)) {\n\t\tconst name = getGroupFilterText(filter);\n\t\tif (!matchesFilter(group.name, name)) {\n\t\t\treturn { visible: false, subjects: decorateDisplaySubjects(subjects, false) };\n\t\t} else {\n\t\t\treturn { visible: true, subjects: decorateDisplaySubjects(subjects, false) };\n\t\t}\n\t} else {\n\t\treturn {\n\t\t\tvisible: true,\n\t\t\tsubjects: decorateDisplaySubjects(subjects.filter(subject => matchesFilter(subject.name, filter)), true)\n\t\t};\n\t}\n};\n\nexport const Group = (props: {\n\tspace: ConnectedConsoleSpace;\n\tgroup: ConsoleSpaceGroup;\n\tcolorSuffix?: string;\n\topenable?: boolean;\n\tremovable?: boolean;\n\tcanAddSubject?: boolean;\n}) => {\n\tconst { space, group, colorSuffix, openable = true, removable = true, canAddSubject = true } = props;\n\tconst { subjects } = group;\n\n\tconst dialog = useDialog();\n\tconst { openGroupIfCan, closeGroupIfCan, openSubjectIfCan } = useSpaceContext();\n\tconst listView = useListView();\n\tconst forceUpdate = useForceUpdate();\n\tconst [ collapsed, setCollapsed ] = useState<boolean>(false);\n\tuseEffect(() => {\n\t\tconst onCollapsedChanged = (newCollapsed: boolean) => {\n\t\t\tif (newCollapsed === collapsed) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetCollapsed(newCollapsed);\n\t\t};\n\t\tconst onFilterTextChanged = () => forceUpdate();\n\t\tlistView.addCollapsedChangedListener(onCollapsedChanged);\n\t\tlistView.addFilterTextChangedListener(onFilterTextChanged);\n\t\treturn () => {\n\t\t\tlistView.removeCollapsedChangedListener(onCollapsedChanged);\n\t\t\tlistView.removeFilterTextChangedListener(onFilterTextChanged);\n\t\t};\n\t}, [ listView, collapsed, forceUpdate ]);\n\n\tconst onOpenGroupClicked = () => openGroupIfCan({ space, group });\n\tconst onToggleExpand = () => setCollapsed(!collapsed);\n\tconst onAddSubjectClicked = async () => {\n\t\tconst now = dayjs().format('YYYY-MM-DD HH:mm:ss');\n\t\tconst newSubject = {\n\t\t\tsubjectId: '',\n\t\t\tname: 'Noname',\n\t\t\ttopicCount: 0,\n\t\t\tgraphicsCount: 0,\n\t\t\tlastVisitTime: now,\n\t\t\tcreatedAt: now\n\t\t};\n\t\tgroup.subjects.push(newSubject);\n\t\tawait createSubject({ space, group, subject: newSubject });\n\t\topenSubjectIfCan({ space, group, subject: newSubject });\n\t};\n\n\tconst { visible, subjects: displaySubjects } = computeDisplaySubjects({\n\t\tfilter: listView.store.filter,\n\t\tsubjects,\n\t\tgroup\n\t});\n\tconst onDeleteClicked = createDeleteGroupClickHandler({\n\t\tdialog,\n\t\tspace,\n\t\tgroup,\n\t\tonDeleted: ({ space, group }) => {\n\t\t\tlistView.groupDeleted({ space, group });\n\t\t\tcloseGroupIfCan({ space, group });\n\t\t}\n\t});\n\n\treturn <GroupContainer data-visible={visible} colorSuffix={colorSuffix}>\n\t\t<GroupHeader>\n\t\t\t<GroupName data-openable={openable} onClick={openable ? onOpenGroupClicked : (void 0)}>\n\t\t\t\t<span>{group.name}</span>\n\t\t\t\t{openable ? <FontAwesomeIcon icon={faExternalLinkAlt}/> : null}\n\t\t\t</GroupName>\n\t\t\t<div data-widget='console-list-view-header-buttons' data-collapsed={collapsed}>\n\t\t\t\t{canAddSubject\n\t\t\t\t\t? <LinkButton onClick={onAddSubjectClicked}>\n\t\t\t\t\t\t<FontAwesomeIcon icon={faFlagCheckered}/>\n\t\t\t\t\t\t<span>Add Subject</span>\n\t\t\t\t\t</LinkButton>\n\t\t\t\t\t: null}\n\t\t\t\t{removable\n\t\t\t\t\t? <LinkButton onClick={onDeleteClicked}>\n\t\t\t\t\t\t<FontAwesomeIcon icon={faTrashAlt}/>\n\t\t\t\t\t\t<span>Delete Group</span>\n\t\t\t\t\t</LinkButton>\n\t\t\t\t\t: null\n\t\t\t\t}\n\t\t\t\t<LinkButton onClick={onToggleExpand}>\n\t\t\t\t\t<FontAwesomeIcon icon={collapsed ? faExpandAlt : faCompressAlt}/>\n\t\t\t\t\t{collapsed ? 'Expand' : 'Collapse'}\n\t\t\t\t</LinkButton>\n\t\t\t</div>\n\t\t</GroupHeader>\n\t\t<GroupBody visible={!collapsed && visible} itemCount={displaySubjects.length}>\n\t\t\t<GroupItemHeader>\n\t\t\t\t<div/>\n\t\t\t\t<div>Relevant Topics</div>\n\t\t\t\t<div>Graphics</div>\n\t\t\t\t<div>Last Visit</div>\n\t\t\t\t<div>Created At</div>\n\t\t\t</GroupItemHeader>\n\t\t\t{displaySubjects.map(subject => {\n\t\t\t\treturn <Subject space={space} group={group} subject={subject} key={subject.subjectId}/>;\n\t\t\t})}\n\t\t</GroupBody>\n\t</GroupContainer>;\n};","import React from 'react';\nimport styled from 'styled-components';\nimport { ConnectedConsoleSpace, ConsoleSpaceGroup } from '../../../../services/console/types';\nimport { Group } from './group';\nimport { useListView } from './list-context';\nimport { ViewType } from './types';\n\nconst Container = styled.div.attrs({\n\t'data-widget': 'console-list-by-group'\n})`\n\tdisplay: flex;\n\tflex-direction: column;\n\tflex-grow: 1;\n`;\n\nexport const ListByGroup = (props: { space: ConnectedConsoleSpace }) => {\n\tconst { space } = props;\n\tconst { subjects, groups } = space;\n\n\tconst { viewType } = useListView();\n\n\tlet ungroup: ConsoleSpaceGroup | null = null;\n\tif (subjects && subjects.length !== 0) {\n\t\tungroup = {\n\t\t\tgroupId: '-1',\n\t\t\tname: 'Ungrouped',\n\t\t\tsubjects\n\t\t};\n\t}\n\n\treturn <Container data-visible={viewType === ViewType.BY_GROUP}>\n\t\t{ungroup ?\n\t\t\t<Group space={space} group={ungroup} colorSuffix='ungroup' openable={false} removable={false}/> : null}\n\t\t{groups.map(group => {\n\t\t\treturn <Group space={space} group={group} key={group.groupId}/>;\n\t\t})}\n\t</Container>;\n};","import dayjs from 'dayjs';\nimport React, { Fragment } from 'react';\nimport styled from 'styled-components';\nimport { ConnectedConsoleSpace, ConsoleSpaceGroup, ConsoleSpaceSubject } from '../../../../services/console/types';\nimport { Group } from './group';\nimport { useListView } from './list-context';\nimport { ViewType } from './types';\n\nconst Container = styled.div.attrs({\n\t'data-widget': 'console-list-by-visit'\n})`\n\tdisplay: flex;\n\tflex-direction: column;\n\tflex-grow: 1;\n`;\n\nconst FromGroup = styled.span`\n\tdisplay: inline-block;\n\topacity: 0.5;\n\tmargin-left: calc(var(--margin) / 3);\n\ttransform-origin: left bottom;\n\ttransform: scale(0.8);\n`;\n\nexport const ListByVisit = (props: { space: ConnectedConsoleSpace }) => {\n\tconst { space } = props;\n\tconst { subjects, groups } = space;\n\n\tconst { viewType } = useListView();\n\n\tconst timeGroups: Array<ConsoleSpaceGroup & { colorSuffix: string }> = [\n\t\t{ groupId: '-1', name: 'Most Recently', subjects: [], colorSuffix: 'recent' },\n\t\t{ groupId: '-2', name: 'In A Week', subjects: [], colorSuffix: 'week' },\n\t\t{ groupId: '-3', name: 'In A Month', subjects: [], colorSuffix: 'month' },\n\t\t{ groupId: '-4', name: 'In A Year', subjects: [], colorSuffix: 'year' },\n\t\t{ groupId: '-5', name: 'Long Long Ago', subjects: [], colorSuffix: 'ancient' }\n\t];\n\n\tconst now = dayjs();\n\t[ ...subjects, ...groups.reduce((all, group) => {\n\t\tall.push(...group.subjects.map(subject => {\n\t\t\treturn {\n\t\t\t\t...subject,\n\t\t\t\tnameAs: <Fragment>\n\t\t\t\t\t<span>{subject.name}</span>\n\t\t\t\t\t<FromGroup>{group.name}</FromGroup>\n\t\t\t\t</Fragment>\n\t\t\t};\n\t\t}));\n\t\treturn all;\n\t}, [] as Array<ConsoleSpaceSubject>) ].forEach(subject => {\n\t\tconst { lastVisitTime } = subject;\n\t\tconst days = now.diff(dayjs(lastVisitTime), 'day');\n\t\tif (days > 365) {\n\t\t\ttimeGroups[4].subjects.push(subject);\n\t\t} else if (days > 30) {\n\t\t\ttimeGroups[3].subjects.push(subject);\n\t\t} else if (days > 7) {\n\t\t\ttimeGroups[2].subjects.push(subject);\n\t\t} else if (days > 1) {\n\t\t\ttimeGroups[1].subjects.push(subject);\n\t\t} else {\n\t\t\ttimeGroups[0].subjects.push(subject);\n\t\t}\n\t});\n\ttimeGroups.forEach(timeGroup =>\n\t\ttimeGroup.subjects\n\t\t\t.sort((s1, s2) => s2.lastVisitTime.localeCompare(s1.lastVisitTime)));\n\n\treturn <Container data-visible={viewType === ViewType.BY_VISIT}>\n\t\t{timeGroups.map(group => {\n\t\t\treturn <Group space={space} group={group}\n\t\t\t              colorSuffix={group.colorSuffix}\n\t\t\t              openable={false} removable={false} canAddSubject={false}\n\t\t\t              key={group.groupId}/>;\n\t\t})}\n\t</Container>;\n};","import React, { useEffect } from 'react';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../../common/utils';\nimport { ConnectedConsoleSpace } from '../../../../services/console/types';\nimport { ListByGroup } from './list-by-group';\nimport { ListByVisit } from './list-by-visit';\nimport { useListView } from './list-context';\nimport { ViewType } from './types';\nimport { hasFilter, isGroupFilter } from './utils';\n\nconst Container = styled.div.attrs({\n\t'data-widget': 'console-list-view-body'\n})`\n\tdisplay: flex;\n\tflex-direction: column;\n`;\nconst Filter = styled.div`\n\talign-self: center;\n\tfont-size: 0.8em;\n\theight: 0;\n\tmargin-bottom: 0;\n\toverflow: hidden;\n\ttransition: all 300ms ease-in-out;\n\t&[data-visible=true] {\n\t\theight: 16px;\n\t\tmargin-bottom: var(--margin);\n\t}\n\t> span {\n\t\ttext-decoration: underline;\n\t\tcursor: pointer;\n\t}\n`;\n\nconst FilterReminder = () => {\n\tconst listView = useListView();\n\tconst { store: { filter } } = listView;\n\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\tlistView.addFilterTextChangedListener(forceUpdate);\n\t\treturn () => {\n\t\t\tlistView.removeFilterTextChangedListener(forceUpdate);\n\t\t};\n\t}, [ listView, filter, forceUpdate ]);\n\n\tconst filtering = hasFilter(filter);\n\tconst groupFiltering = isGroupFilter(filter);\n\tconst onClearFilterClicked = () => listView.clearFilter();\n\n\treturn <Filter data-visible={filtering}>\n\t\t{groupFiltering ? 'Groups' : 'Subjects'} are hidden. To show all contents, <span onClick={onClearFilterClicked}>clear filter</span>\n\t</Filter>;\n};\n\nexport const ListBody = (props: { space: ConnectedConsoleSpace }) => {\n\tconst { space } = props;\n\n\tconst { viewType } = useListView();\n\n\treturn <Container>\n\t\t{viewType === ViewType.BY_GROUP ? <ListByGroup space={space}/> : null}\n\t\t{viewType === ViewType.BY_VISIT ? <ListByVisit space={space}/> : null}\n\t\t<FilterReminder/>\n\t</Container>;\n};","import React from 'react';\nimport styled from 'styled-components';\n\nconst RadioButton = styled.div.attrs(() => ({\n\t'data-widget': 'radio'\n}))`\n\tdisplay: block;\n\tposition: relative;\n\twidth: 22px;\n\theight: 22px;\n\tborder: var(--border);\n\tborder-width: 2px;\n\tborder-radius: 100%;\n\tcursor: pointer;\n\ttransition: all 300ms ease-in-out;\n\t&:hover {\n\t\tborder-color: var(--primary-color);\n\t}\n\t&:before {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\ttop: 50%;\n\t\tleft: 50%;\n\t\twidth: 0;\n\t\theight: 0;\n\t\tborder-radius: 100%;\n\t\ttransition: all 300ms ease-in-out;\n\t}\n\t&[data-selected=true] {\n\t\t&:before {\n\t\t\ttop: 1px;\n\t\t\tleft: 1px;\n\t\t\twidth: 16px;\n\t\t\theight: 16px;\n\t\t\tbackground-color: var(--border-color);\n\t\t}\n\t\t&:hover:before {\n\t\t\tbackground-color: var(--primary-color);\n\t\t}\n\t}\n`;\n\nconst Radio = (props: {\n\tselected: boolean;\n\tonSelected?: () => void\n}) => {\n\tconst { selected, onSelected } = props;\n\n\treturn <RadioButton data-selected={selected} onClick={() => !selected && onSelected && onSelected()}/>;\n};\n\nexport default Radio;","import React, { useEffect, useRef } from 'react';\nimport styled from 'styled-components';\nimport { ConnectedConsoleSpace } from '../../../../services/console/types';\nimport { TooltipAlignment, useTooltip } from '../../../component/console/context/console-tooltip';\nimport Input from '../../../component/input';\nimport Radio from '../../../component/radio';\nimport { useListView } from './list-context';\nimport { ViewType } from './types';\n\nconst Container = styled.div.attrs({\n\t'data-widget': 'console-list-view-header'\n})`\n\tdisplay: flex;\n\talign-items: center;\n\tmargin-bottom: calc(var(--margin) / 2);\n\t> div:first-child {\n\t\tflex-grow: 1;\n\t}\n`;\nconst NameFilter = styled(Input)`\n\tmin-width: 200px;\n\tfont-size: 0.8em;\n\t&:hover {\n\t\tborder-color: var(--console-primary-color);\n\t}\n\t&:focus {\n\t\tborder-color: var(--console-primary-color);\n\t\tbox-shadow: var(--console-hover-shadow);\n\t}\n`;\nconst HeaderButtons = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\t> div {\n\t\tdisplay: flex;\n\t\tposition: relative;\n\t\talign-items: center;\n\t\tpadding: 0 calc(var(--margin) / 3);\n\t\t&:not(:first-child) {\n\t\t\t&:before {\n\t\t\t\tcontent: '';\n\t\t\t\tdisplay: block;\n\t\t\t\tposition: absolute;\n\t\t\t\ttop: 20%;\n\t\t\t\tleft: 0;\n\t\t\t\twidth: 1px;\n\t\t\t\theight: 60%;\n\t\t\t\tbackground-color: var(--border-color);\n\t\t\t}\n\t\t}\n\t\t> *:not(:first-child) {\n\t\t\tmargin-left: calc(var(--margin) / 4);\n\t\t}\n\t}\n`;\nconst ViewTypeRadio = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\tborder-radius: var(--border-radius);\n\tcursor: pointer;\n\t&:hover {\n\t\tcolor: var(--console-primary-color);\n\t\t> div:first-child {\n\t\t\tborder-color: var(--console-primary-color);\n\t\t\t&:before {\n\t\t\t\tbackground-color: var(--console-primary-color);\n\t\t\t}\n\t\t}\n\t}\n\t> div:first-child {\n\t\tmargin-top: 2px;\n\t\tmargin-right: calc(var(--margin) / 5);\n\t\ttransform: scale(0.7);\n\t\ttransform-origin: center center;\n\t\t&:hover {\n\t\t\tborder-color: var(--console-primary-color);\n\t\t\t&:before {\n\t\t\t\tbackground-color: var(--console-primary-color);\n\t\t\t}\n\t\t}\n\t}\n\t> span {\n\t\tfont-size: 0.8em;\n\t\tfont-weight: var(--font-demi-bold);\n\t\ttransition: all 300ms ease-in-out;\n\t}\n`;\nconst Button = styled.button`\n\tdisplay: flex;\n\tposition: relative;\n\theight: 24px;\n\talign-items: center;\n\tjustify-content: center;\n\tmargin: 0 calc(var(--margin) / -4);\n\tpadding: 0 calc(var(--margin) / 4);\n\tborder: 0;\n\tborder-radius: var(--border-radius);\n\tfont-family: var(--console-font-family);\n\tfont-size: 0.8em;\n\tfont-weight: var(--font-demi-bold);\n\tappearance: none;\n\toutline: none;\n\tcolor: var(--console-font-color);\n\tbackground-color: transparent;\n\tcursor: pointer;\n\ttransition: all 300ms ease-in-out;\n\t&[data-visible=false] {\n\t\topacity: 0;\n\t\tpointer-events: none;\n\t}\n\t&:hover {\n\t\tcolor: var(--console-primary-color);\n\t\tbackground-color: var(--invert-color);\n\t\tbox-shadow: var(--console-hover-shadow);\n\t}\n\t> svg {\n\t\tmargin-right: calc(var(--margin) / 4);\n\t}\n`;\n\nlet filterTextChangeTimer: number | null = null;\nconst clearFilterTextChangeTimer = () => {\n\tif (filterTextChangeTimer != null) {\n\t\tclearTimeout(filterTextChangeTimer);\n\t}\n\n};\nexport const ListHeader = (props: {\n\tspace: ConnectedConsoleSpace\n}) => {\n\tconst { viewType, setViewType, toggleCollapsed } = useListView();\n\n\tconst filterRef = useRef<HTMLInputElement>(null);\n\tconst listView = useListView();\n\tconst { mouseEnter, mouseLeave } = useTooltip({\n\t\tshow: true,\n\t\tref: filterRef,\n\t\ttooltip: 'Filter group by \"g:name\"',\n\t\trect: () => ({ align: TooltipAlignment.LEFT, offsetY: 8 })\n\t});\n\tuseEffect(() => {\n\t\tconst onFilterCleared = () => {\n\t\t\tfilterRef.current!.value = '';\n\t\t\t// force invoke text changed\n\t\t\tlistView.filterTextChanged('');\n\t\t};\n\t\tlistView.addFilterClearedListener(onFilterCleared);\n\t\treturn () => {\n\t\t\tlistView.removeFilterClearedListener(onFilterCleared);\n\t\t};\n\t}, [ listView ]);\n\n\tconst onFilterTextChanged = (event: React.ChangeEvent<HTMLInputElement>) => {\n\t\tconst value = (event.target.value || '').trim();\n\n\t\tclearFilterTextChangeTimer();\n\t\tfilterTextChangeTimer = setTimeout(() => {\n\t\t\tclearFilterTextChangeTimer();\n\t\t\tlistView.filterTextChanged(value);\n\t\t}, 300);\n\t};\n\tconst onViewTypeChanged = (newViewType: ViewType) => () => {\n\t\tif (newViewType === viewType) {\n\t\t\treturn;\n\t\t}\n\t\tsetViewType(newViewType);\n\t};\n\n\treturn <Container>\n\t\t<div>\n\t\t\t<NameFilter placeholder='Filter by name...' onChange={onFilterTextChanged}\n\t\t\t            ref={filterRef} onMouseEnter={mouseEnter} onMouseLeave={mouseLeave}/>\n\t\t</div>\n\t\t<HeaderButtons>\n\t\t\t<div>\n\t\t\t\t<ViewTypeRadio onClick={onViewTypeChanged(ViewType.BY_GROUP)}>\n\t\t\t\t\t<Radio selected={viewType === ViewType.BY_GROUP}/>\n\t\t\t\t\t<span>By Group</span>\n\t\t\t\t</ViewTypeRadio>\n\t\t\t\t<ViewTypeRadio onClick={onViewTypeChanged(ViewType.BY_VISIT)}>\n\t\t\t\t\t<Radio selected={viewType === ViewType.BY_VISIT}/>\n\t\t\t\t\t<span>By Visit</span>\n\t\t\t\t</ViewTypeRadio>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<Button onClick={() => toggleCollapsed(true)}>Collapse All</Button>\n\t\t\t\t<Button onClick={() => toggleCollapsed(false)}>Expand All</Button>\n\t\t\t</div>\n\t\t</HeaderButtons>\n\t</Container>;\n};","import React from 'react';\nimport styled from 'styled-components';\nimport { ConnectedConsoleSpace } from '../../../../services/console/types';\nimport { ListBody } from './list-body';\nimport { ListContextProvider } from './list-context';\nimport { ListHeader } from './list-header';\n\nconst Container = styled.div.attrs({\n\t'data-widget': 'console-list-view-container'\n})`\n\tdisplay: flex;\n\tflex-direction: column;\n\tmin-height: 100%;\n\twidth: 100%;\n\tpadding: calc(var(--margin) / 2) var(--margin);\n`;\n\nexport const ListView = (props: { visible: boolean; space: ConnectedConsoleSpace }) => {\n\tconst { visible, space } = props;\n\n\tif (!visible) {\n\t\treturn null;\n\t}\n\n\treturn <ListContextProvider>\n\t\t<Container>\n\t\t\t<ListHeader space={space}/>\n\t\t\t<ListBody space={space}/>\n\t\t</Container>\n\t</ListContextProvider>;\n};","import styled from 'styled-components';\n\nexport const SubjectPanelHeader = styled.div.attrs({\n\t'data-widget': 'console-subject-view-panel-header'\n})`\n\tdisplay: flex;\n\talign-items: center;\n\theight: 40px;\n\tpadding: 0 calc(var(--margin) / 2);\n\tborder-bottom: var(--border);\n\ttransition: all 300ms ease-in-out;\n\t> div:first-child {\n\t\tflex-grow: 1;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tfont-family: var(--console-title-font-family);\n\t\toverflow: hidden;\n\t\twhite-space: nowrap;\n\t\ttext-overflow: ellipsis;\n\t\t> span:nth-child(2) {\n\t\t\tmargin-left: calc(var(--margin) / 4);\n\t\t\tfont-size: 0.8em;\n\t\t\tbackground-color: var(--console-primary-color);\n\t\t\tcolor: var(--invert-color);\n\t\t\tpadding: 1px 10px;\n\t\t\tborder-radius: 0.8em;\n\t\t\theight: 1.6em;\n\t\t\ttransform: scale(0.7,0.7);\n\t\t\topacity: 0.7;\n\t\t}\n\t}\n\t> button {\n\t\theight: 20px;\n\t\t&:hover {\n\t\t\tcolor: var(--console-primary-color);\n\t\t}\n\t}\n`;\nexport const SubjectPanelBody = styled.div.attrs({\n\t'data-widget': 'console-subject-view-panel-body'\n})`\n\tflex-grow: 1;\n\tdisplay: flex;\n\tposition: relative;\n\tflex-direction: column;\n\tborder-bottom: var(--border);\n\ttransition: all 300ms ease-in-out;\n\t&:last-child {\n\t\tborder-bottom: 0;\n\t}\n\t&[data-visible=false] {\n\t\tflex-grow: 0;\n\t\tmargin-top: -1px;\n\t}\n`;\nexport const SubjectPanelBodyWrapper = styled.div.attrs({\n\t'data-widget': 'console-subject-panel-body-wrapper'\n})`\n\tdisplay: flex;\n\tflex-direction: column;\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n\toverflow-x: hidden;\n\toverflow-y: auto;\n\t&::-webkit-scrollbar {\n\t\tbackground-color: transparent;\n\t\twidth: 4px;\n\t}\n\t&::-webkit-scrollbar-track {\n\t\tbackground-color: var(--scrollbar-background-color);\n\t\tborder-radius: 2px;\n\t}\n\t&::-webkit-scrollbar-thumb {\n\t\tbackground-color: var(--console-favorite-color);\n\t\tborder-radius: 2px;\n\t}\n`;\n","import { EventEmitter } from 'events';\nimport React, { useState } from 'react';\n\nexport enum DataSetTableEvent {\n\tSELECTION_CHANGED = 'selection-changed',\n\tREPAINT_SELECTION = 'repaint-selection',\n\tFIX_COLUMN_CHANGED = 'fix-column-changed',\n\tCOMPRESS_COLUMN_WIDTH = 'compress-column-width',\n\tDRAG_COLUMN_VISIBLE_CHANGED = 'drag-column-visible-changed',\n\tREPLY_DRAG_COLUMN_VISIBLE = 'reply-drag-column-visible',\n\tDETERMINE_DRAG_COLUMN_VISIBLE = 'determine-drag-column-visible',\n\tDRAG_COLUMN_STATE_CHANGED = 'drag-column-state-changed',\n}\n\nexport interface DragColumnState {\n\tleft: number;\n\theight: number;\n\tstartRowIndex: number;\n\tendRowIndex: number;\n\tfirstRowOffsetY: number;\n\tmovementX: number;\n}\n\nexport type SelectionChangeListener = (inFixTable: boolean, rowIndex: number, columnIndex: number) => void;\nexport type RepaintSelectionHandler = () => void;\nexport type FixColumnChangeListener = (fix: boolean, columnIndex: number) => void;\nexport type ColumnWidthCompressHandler = () => void;\nexport type DragColumnVisibleChangeListener = (visible: boolean) => void;\nexport type DragColumnChangeStateListener = (state: Partial<DragColumnState>) => void;\nexport type DragColumnVisibleDeterminationHandler = (reply: (visible: boolean) => void) => void;\n\nexport interface DataSetTableContext {\n\tselectionChange: (inFixTable: boolean, rowIndex: number, columnIndex: number) => void;\n\taddSelectionChangeListener: (listener: SelectionChangeListener) => void;\n\tremoveSelectionChangeListener: (listener: SelectionChangeListener) => void;\n\n\trepaintSelection: () => void;\n\taddRepaintSelectionHandler: (handler: RepaintSelectionHandler) => void;\n\tremoveRepaintSelectionHandler: (handler: RepaintSelectionHandler) => void;\n\n\tfixColumnChange: (fix: boolean, columnCount: number) => void;\n\taddFixColumnChangeListener: (listener: FixColumnChangeListener) => void;\n\tremoveFixColumnChangeListener: (listener: FixColumnChangeListener) => void;\n\n\tcompressColumnWidth: () => void;\n\taddColumnWidthCompressHandler: (handler: ColumnWidthCompressHandler) => void;\n\tremoveColumnWidthCompressHandler: (handler: ColumnWidthCompressHandler) => void;\n\n\tdragColumnVisibleChange: (visible: boolean) => void;\n\taddDragColumnVisibleChangeListener: (listener: DragColumnVisibleChangeListener) => void;\n\tremoveDragColumnVisibleChangeListener: (listener: DragColumnVisibleChangeListener) => void;\n\tdetermineDragColumnVisible: () => Promise<boolean>;\n\taddDragColumnVisibleDeterminationHandler: (listener: DragColumnVisibleDeterminationHandler) => void;\n\tremoveDragColumnVisibleDeterminationHandler: (listener: DragColumnVisibleDeterminationHandler) => void;\n\n\tdragColumnStateChange: (state: Partial<DragColumnState>) => void;\n\taddDragColumnStateChangeListener: (listener: DragColumnChangeStateListener) => void;\n\tremoveDragColumnStateChangeListener: (listener: DragColumnChangeStateListener) => void;\n}\n\nconst Context = React.createContext<DataSetTableContext>({} as DataSetTableContext);\nContext.displayName = 'DataSetTableContext';\n\nexport const DataSetTableContextProvider = (props: {\n\tchildren?: ((props: any) => React.ReactNode) | React.ReactNode;\n}) => {\n\tconst { children } = props;\n\n\tconst [ emitter ] = useState(new EventEmitter());\n\n\treturn <Context.Provider value={{\n\t\tselectionChange: (inFixTable: boolean, rowIndex: number, columnIndex: number) => emitter.emit(DataSetTableEvent.SELECTION_CHANGED, inFixTable, rowIndex, columnIndex),\n\t\taddSelectionChangeListener: (listener: SelectionChangeListener) => emitter.on(DataSetTableEvent.SELECTION_CHANGED, listener),\n\t\tremoveSelectionChangeListener: (listener: SelectionChangeListener) => emitter.off(DataSetTableEvent.SELECTION_CHANGED, listener),\n\n\t\trepaintSelection: () => emitter.emit(DataSetTableEvent.REPAINT_SELECTION),\n\t\taddRepaintSelectionHandler: (handler: RepaintSelectionHandler) => emitter.on(DataSetTableEvent.REPAINT_SELECTION, handler),\n\t\tremoveRepaintSelectionHandler: (handler: RepaintSelectionHandler) => emitter.off(DataSetTableEvent.REPAINT_SELECTION, handler),\n\n\t\tfixColumnChange: (fix: boolean, columnCount: number) => emitter.emit(DataSetTableEvent.FIX_COLUMN_CHANGED, fix, columnCount),\n\t\taddFixColumnChangeListener: (listener: FixColumnChangeListener) => emitter.on(DataSetTableEvent.FIX_COLUMN_CHANGED, listener),\n\t\tremoveFixColumnChangeListener: (listener: FixColumnChangeListener) => emitter.off(DataSetTableEvent.FIX_COLUMN_CHANGED, listener),\n\n\t\tcompressColumnWidth: () => emitter.emit(DataSetTableEvent.COMPRESS_COLUMN_WIDTH),\n\t\taddColumnWidthCompressHandler: (handler: ColumnWidthCompressHandler) => emitter.on(DataSetTableEvent.COMPRESS_COLUMN_WIDTH, handler),\n\t\tremoveColumnWidthCompressHandler: (handler: ColumnWidthCompressHandler) => emitter.off(DataSetTableEvent.COMPRESS_COLUMN_WIDTH, handler),\n\n\t\tdragColumnVisibleChange: (visible: boolean) => emitter.emit(DataSetTableEvent.DRAG_COLUMN_VISIBLE_CHANGED, visible),\n\t\taddDragColumnVisibleChangeListener: (listener: DragColumnVisibleChangeListener) => emitter.on(DataSetTableEvent.DRAG_COLUMN_VISIBLE_CHANGED, listener),\n\t\tremoveDragColumnVisibleChangeListener: (listener: DragColumnVisibleChangeListener) => emitter.off(DataSetTableEvent.DRAG_COLUMN_VISIBLE_CHANGED, listener),\n\n\t\tdetermineDragColumnVisible: (): Promise<boolean> => {\n\t\t\treturn new Promise(resolve => {\n\t\t\t\temitter.once(DataSetTableEvent.REPLY_DRAG_COLUMN_VISIBLE, (visible: boolean) => resolve(visible));\n\t\t\t\temitter.emit(DataSetTableEvent.DETERMINE_DRAG_COLUMN_VISIBLE, (visible: boolean) => emitter.emit(DataSetTableEvent.REPLY_DRAG_COLUMN_VISIBLE, visible));\n\t\t\t});\n\t\t},\n\t\taddDragColumnVisibleDeterminationHandler: (handler: DragColumnVisibleDeterminationHandler) => emitter.on(DataSetTableEvent.DETERMINE_DRAG_COLUMN_VISIBLE, handler),\n\t\tremoveDragColumnVisibleDeterminationHandler: (handler: DragColumnVisibleDeterminationHandler) => emitter.off(DataSetTableEvent.DETERMINE_DRAG_COLUMN_VISIBLE, handler),\n\n\t\tdragColumnStateChange: (state: Partial<DragColumnState>) => emitter.emit(DataSetTableEvent.DRAG_COLUMN_STATE_CHANGED, state),\n\t\taddDragColumnStateChangeListener: (listener: DragColumnChangeStateListener) => emitter.on(DataSetTableEvent.DRAG_COLUMN_STATE_CHANGED, listener),\n\t\tremoveDragColumnStateChangeListener: (listener: DragColumnChangeStateListener) => emitter.off(DataSetTableEvent.DRAG_COLUMN_STATE_CHANGED, listener)\n\t}}>{children}</Context.Provider>;\n};\n\nexport const useDataSetTableContext = () => {\n\treturn React.useContext(Context);\n};\n","import {\n\tfaAngleLeft,\n\tfaAngleRight,\n\tfaArrowAltCircleDown,\n\tfaCloudDownloadAlt,\n\tfaCompressAlt,\n\tfaTimes\n} from '@fortawesome/free-solid-svg-icons';\nimport {FontAwesomeIcon} from '@fortawesome/react-fontawesome';\nimport React from 'react';\nimport styled from 'styled-components';\nimport {DataPage} from '../../../../../services/admin/types';\nimport {ConsoleSpaceSubject} from '../../../../../services/console/types';\nimport {LinkButton} from '../../../../component/console/link-button';\nimport {SubjectPanelHeader} from '../components';\nimport {useDataSetTableContext} from './dataset-table-context';\nimport {ColumnDefs} from \"./types\";\nimport {fetchSubjectData} from \"../../../../../services/console/space\";\nimport dayjs from \"dayjs\";\n\nconst DataSetHeaderContainer = styled(SubjectPanelHeader)`\n\t> div:first-child {\n\t\tflex-grow: 0;\n\t\tmargin-right: var(--margin);\n\t}\n\t> div:nth-child(2) {\n\t\tflex-grow: 1;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: flex-end;\n\t\tfont-family: var(--console-title-font-family);\n\t\tfont-size: 0.8em;\n\t\tmargin-right: var(--margin);\n\t\t> div {\n\t\t\tpadding: 0 calc(var(--margin) / 4);\n\t\t\tfont-variant: petite-caps;\n\t\t\t> span {\n\t\t\t\tfont-variant: unicase;\n\t\t\t}\n\t\t}\n\t\t> button {\n\t\t\tfont-weight: normal;\n\t\t\tcolor: inherit;\n\t\t\twidth: 24px;\n\t\t\theight: 24px;\n\t\t}\n\t\t> button[data-visible=false] {\n\t\t\tdisplay: none;\n\t\t}\n\t}\n\t> button {\n\t\twidth: 24px;\n\t\theight: 24px;\n\t\tmargin-left: calc(var(--margin) / 8);\n\t}\n`;\n\nexport const DataSetHeader = (props: {\n\tsubject: ConsoleSpaceSubject;\n\tcolumnDefs: ColumnDefs;\n\tdata: DataPage<Array<any>>;\n\tonHide: () => void;\n\tfetchData: (pageNumber: number) => void;\n}) => {\n\tconst {subject, columnDefs, data, onHide, fetchData} = props;\n\n\tconst {selectionChange, compressColumnWidth} = useDataSetTableContext();\n\tconst onPreviousPageClicked = () => {\n\t\tfetchData(data.pageNumber - 1);\n\t\tselectionChange(false, -1, -1);\n\t};\n\tconst onNextPageClicked = () => {\n\t\tfetchData(data.pageNumber + 1);\n\t\tselectionChange(false, -1, -1);\n\t};\n\n\tconst download = (data: DataPage<Array<any>>) => {\n\t\tconst header = [\n\t\t\t'',\n\t\t\t...columnDefs.fixed.map(column => column.alias || column.factor.label || column.factor.name),\n\t\t\t...columnDefs.data.map(column => column.alias || column.factor.label || column.factor.name)\n\t\t].join('\\t');\n\t\tconst body = data.data.map((row, rowIndex) => `${rowIndex + 1}\\t${row.join('\\t')}`).join('\\n');\n\t\tconst content = `${header}\\n${body}\\n`;\n\t\tconst link = document.createElement('a');\n\t\tlink.href = 'data:text/csv;charset=utf-8,' + encodeURI(content);\n\t\tlink.target = '_blank';\n\t\t//provide the name for the CSV file to be downloaded\n\t\tlink.download = `${subject.name}-Page${data.pageNumber}-TotalItemCount${data.data.length}-${dayjs().format('YYYYMMDDHHmmss')}.csv`;\n\t\tlink.click();\n\t};\n\n\tconst onDownloadCurrentClicked = () => {\n\t\tdownload(data);\n\t};\n\tconst onDownloadAllClicked = async () => {\n\t\tconst data = await fetchSubjectData({subjectId: subject.subjectId, pageNumber: 1, pageSize: 50000});\n\t\tdownload(data);\n\t};\n\n\treturn <DataSetHeaderContainer>\n\t\t<div>Dataset of {subject.name}</div>\n\t\t<div>\n\t\t\t{data.pageNumber !== 1\n\t\t\t\t? <LinkButton ignoreHorizontalPadding={true}\n\t\t\t\t              tooltip='Previous Page' center={true} offsetY={6}\n\t\t\t\t              onClick={onPreviousPageClicked}>\n\t\t\t\t\t<FontAwesomeIcon icon={faAngleLeft}/>\n\t\t\t\t</LinkButton>\n\t\t\t\t: null}\n\t\t\t<div>\n\t\t\t\t{data.itemCount} Row{data.itemCount !== 1 ? 's' : ''} Total, <span>#</span>{data.pageNumber} of {data.pageCount} Pages.\n\t\t\t</div>\n\t\t\t{data.pageNumber !== data.pageCount\n\t\t\t\t? <LinkButton ignoreHorizontalPadding={true}\n\t\t\t\t              tooltip='Next Page' center={true} offsetY={6}\n\t\t\t\t              onClick={onNextPageClicked}>\n\t\t\t\t\t<FontAwesomeIcon icon={faAngleRight}/>\n\t\t\t\t</LinkButton>\n\t\t\t\t: null}\n\t\t</div>\n\t\t<LinkButton onClick={compressColumnWidth} ignoreHorizontalPadding={true} tooltip='Compress Columns'\n\t\t            right={true} offsetX={-6}>\n\t\t\t<FontAwesomeIcon icon={faCompressAlt} transform={{rotate: 45}}/>\n\t\t</LinkButton>\n\t\t<LinkButton onClick={onDownloadCurrentClicked} ignoreHorizontalPadding={true} tooltip='Download Current Page'\n\t\t            right={true} offsetX={-6}>\n\t\t\t<FontAwesomeIcon icon={faArrowAltCircleDown}/>\n\t\t</LinkButton>\n\t\t<LinkButton onClick={onDownloadAllClicked} ignoreHorizontalPadding={true} tooltip='Download All Pages'\n\t\t            right={true} offsetX={-6}>\n\t\t\t<FontAwesomeIcon icon={faCloudDownloadAlt}/>\n\t\t</LinkButton>\n\t\t<LinkButton onClick={onHide} ignoreHorizontalPadding={true} tooltip='Minimize'\n\t\t            right={true} offsetX={-6}>\n\t\t\t<FontAwesomeIcon icon={faTimes}/>\n\t\t</LinkButton>\n\t</DataSetHeaderContainer>;\n\n};","import styled from 'styled-components';\nimport { DataSetTableProps } from './types';\n\nexport const TITLE_HEIGHT = 40;\nexport const HEADER_HEIGHT = 32;\nexport const ROW_HEIGHT = 24;\nexport const DEFAULT_COLUMN_WIDTH = 200;\nexport const FILLER_MIN_WIDTH = 40;\nexport const RESIZE_DEVIATION = 3;\nexport const MIN_COLUMN_WIDTH = 100;\nexport const MAX_COLUMN_WIDTH = 500;\nexport const DRAG_DEVIATION = 10;\n\nexport const Wrapper = styled.div.attrs({\n\t'data-widget': 'console-subject-view-dataset-table-wrapper'\n})`\n\tdisplay: flex;\n\tposition: absolute;\n\ttop: ${TITLE_HEIGHT}px;\n\tleft: 0;\n\twidth: 100%;\n\theight: calc(100% - ${TITLE_HEIGHT}px);\n\t&[data-resize-state=pick-column],\n\t&[data-resize-state=ready-to-drag],\n\t&[data-resize-state=dragging] {\n\t\tcursor: move;\n\t}\n\t&[data-resize-state=can-resize],\n\t&[data-resize-state=resizing] {\n\t\tcursor: col-resize;\n\t}\n`;\n\nexport const DataSetTableContainer = styled.div\n\t.attrs<DataSetTableProps>(\n\t\t({ columns, autoFill }) => {\n\t\t\tconst fixTableWidth = columns.reduce((width, column) => width + column.width, 0);\n\t\t\treturn {\n\t\t\t\t'data-widget': 'console-subject-view-dataset-table',\n\t\t\t\tstyle: {\n\t\t\t\t\tminWidth: autoFill ? 'unset' : fixTableWidth\n\t\t\t\t}\n\t\t\t};\n\t\t})<DataSetTableProps & { rowCount: number }>`\n\tdisplay: flex;\n\tflex-direction: column;\n\tposition: relative;\n\theight: 100%;\n\t&:first-child {\n\t\toverflow-x: hidden;\n\t\toverflow-y: auto;\n\t\t> div:nth-child(2) > div:after {\n\t\t\tcontent: '';\n\t\t\tdisplay: block;\n\t\t\tposition: absolute;\n\t\t\tleft: 0;\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t\tbackground-color: var(--console-primary-color);\n\t\t\topacity: 0.02;\n\t\t}\n\t\t&:after {\n\t\t\tcontent: '';\n\t\t\tdisplay: block;\n\t\t\tposition: absolute;\n\t\t\ttop: 0;\n\t\t\tright: 0;\n\t\t\twidth: 1px;\n\t\t\theight: ${({ rowCount }) => ROW_HEIGHT * rowCount}px;\n\t\t\tbackground-color: var(--border-color);\n\t\t}\n\t\t&::-webkit-scrollbar {\n\t\t\tbackground-color: transparent;\n\t\t\twidth: 0;\n\t\t}\n\t}\n\t&:nth-child(2) {\n\t\tflex-grow: 1;\n\t\toverflow: auto;\n\t}\n\t&[data-scrollable=false]:nth-child(2) {\n\t\toverflow: hidden;\n\t}\n`;\n\nexport const DataSetTableHeader = styled.div\n\t.attrs<DataSetTableProps>(({ columns, autoFill }) => {\n\t\treturn {\n\t\t\t'data-widget': 'console-subject-view-dataset-table-header',\n\t\t\tstyle: {\n\t\t\t\t// each data column hold 2 physical columns, the first is show data, the second is for show drag placeholder\n\t\t\t\tgridTemplateColumns: autoFill ? `0 ${columns.map(def => `${def.width}px 0`).join(' ')} minmax(${FILLER_MIN_WIDTH}px, 1fr)` : `0 ${columns.map(def => `${def.width}px 0`).join(' ')}`\n\t\t\t}\n\t\t};\n\t})<DataSetTableProps>`\n\tdisplay: grid;\n\tposition: sticky;\n\ttop: 0;\n\tjustify-items: stretch;\n\talign-items: stretch;\n\theight: ${HEADER_HEIGHT}px;\n\tz-index: 1;\n`;\n\nexport const DataSetTableHeaderCell = styled.div\n\t.attrs<{ column: number, filler?: true }>(({ column, filler }) => {\n\t\treturn {\n\t\t\t'data-widget': 'console-subject-view-dataset-table-header-cell',\n\t\t\tstyle: {\n\t\t\t\tgridColumn: column,\n\t\t\t\tborderRightColor: filler ? 'transparent' : 'var(--border-color)'\n\t\t\t}\n\t\t};\n\t})<{ lastColumn: boolean, column: number, filler?: true }>`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\tfont-size: 0.8em;\n\tfont-family: var(--console-title-font-family);\n\tbackground-color: var(--bg-color);\n\tpadding: 0 8px;\n\tborder-right: var(--border);\n\tborder-bottom: var(--border);\n\tbox-shadow: -1px 0 0 0 var(--border-color);\n\t&:not([data-rowno=true]):not([data-filler=true]) {\n\t\t&:hover {\n\t\t\t> div[data-widget='console-subject-view-dataset-table-header-cell-buttons'] {\n\t\t\t\topacity: 1;\n\t\t\t\tpointer-events: auto;\n\t\t\t\ttransition: all 300ms ease-in-out;\n\t\t\t}\n\t\t}\n\t}\n\t&[data-dragging=true] {\n\t\tdisplay: none;\n\t}\n\t> span {\n\t\tflex-grow: 1;\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t}\n\t> button {\n\t\topacity: 0.7;\n\t\tfont-size: 0.9em;\n\t\t> svg:nth-child(2) {\n\t\t\tdisplay: block;\n\t\t\tposition: absolute;\n\t\t\tz-index: 1;\n\t\t\ttop: 50%;\n\t\t\tleft: 50%;\n\t\t\ttransform: translate(-50%, -50%) scale(0.8);\n\t\t\ttransform-origin: center center;\n\t\t}\n\t}\n`;\nexport const HeaderCellButtons = styled.div.attrs({\n\t'data-widget': 'console-subject-view-dataset-table-header-cell-buttons'\n})`\n\tdisplay: flex;\n\tposition: absolute;\n\theight: 31px;\n\ttop: 0;\n\tright: 0;\n\tpadding: calc(var(--margin) / 8);\n\tbackground-color: var(--bg-color);\n\topacity: 0;\n\tpointer-events: none;\n\t> button {\n\t\tfont-size: 0.9em;\n\t\twidth: 24px;\n\t}\n`;\n\nexport const DataSetTableBody = styled.div\n\t.attrs<DataSetTableProps>(({ columns, autoFill }) => {\n\t\treturn {\n\t\t\t'data-widget': 'console-subject-view-dataset-table-body',\n\t\t\tstyle: {\n\t\t\t\t// each data column hold 2 physical columns, the first is show data, the second is for show drag placeholder\n\t\t\t\tgridTemplateColumns: autoFill ? `0 ${columns.map(def => `${def.width}px 0`).join(' ')} minmax(${FILLER_MIN_WIDTH}px, 1fr)` : `0 ${columns.map(def => `${def.width}px 0`).join(' ')}`\n\t\t\t}\n\t\t};\n\t})<DataSetTableProps>`\n\tdisplay: grid;\n\tjustify-items: stretch;\n\talign-items: stretch;\n\tgrid-auto-rows: ${ROW_HEIGHT}px;\n`;\n\nexport const DataSetTableBodyCell = styled.div\n\t.attrs<{ lastRow: boolean, column: number, filler?: true }>(({ lastRow, column, filler }) => {\n\t\treturn {\n\t\t\t'data-widget': 'console-subject-view-dataset-table-body-cell',\n\t\t\tstyle: {\n\t\t\t\tgridColumn: column,\n\t\t\t\tborderBottom: lastRow ? 0 : 'var(--border)',\n\t\t\t\tborderRightColor: filler ? 'transparent' : 'var(--border-color)'\n\t\t\t}\n\t\t};\n\t})<{ lastRow: boolean, lastColumn: boolean, column: number, filler?: true }>`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\tfont-size: 0.8em;\n\tpadding: 0 8px;\n\tbackground-color: var(--invert-color);\n\tborder-right: var(--border);\n\tbox-shadow: -1px 0 0 0 var(--border-color);\n\t&[data-rowno=true] {\n\t\t&:hover {\n\t\t\tcursor: e-resize;\n\t\t}\n\t\t> span {\n\t\t\tfont-family: var(--console-title-font-family);\n\t\t\ttransform: scale(0.8);\n\t\t\ttransform-origin: left;\n\t\t}\n\t}\n\t&[data-last-row=true] {\n\t\tbox-shadow: -1px 0 0 0 var(--border-color), 0 1px 0 0 var(--border-color);\n\t}\n\t&[data-dragging=true] {\n\t\tdisplay: none;\n\t}\n\t> span {\n\t\tflex-grow: 1;\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t}\n`;\n\nexport const RowSelection = styled.div\n\t.attrs<{ index: number, top: number, height: number, scroll: number }>(({ index, top, height, scroll }) => {\n\t\treturn {\n\t\t\t'data-widget': 'console-subject-view-dataset-table-row-selection',\n\t\t\tstyle: {\n\t\t\t\tdisplay: index === -1 ? 'none' : 'block',\n\t\t\t\ttop,\n\t\t\t\twidth: `calc(100% - ${scroll}px)`,\n\t\t\t\theight: height + 1\n\t\t\t}\n\t\t};\n\t})<{ index: number, top: number, height: number, scroll: number }>`\n\tposition: absolute;\n\tleft: 0;\n\tbackground-color: var(--console-favorite-color);\n\topacity: 0.1;\n\tpointer-events: none;\n\ttransition: top 300ms ease-in-out;\n\tz-index: 10;\n`;\n\nexport const ColumnSelection = styled.div\n\t.attrs<{ index: number, left: number, width: number, height: number, scroll: number }>(\n\t\t({ index, left, width, height, scroll }\n\t\t) => {\n\t\t\treturn {\n\t\t\t\t'data-widget': 'console-subject-view-dataset-table-column-selection',\n\t\t\t\tstyle: {\n\t\t\t\t\tdisplay: index !== -1 ? 'block' : 'none',\n\t\t\t\t\tleft,\n\t\t\t\t\twidth: width,\n\t\t\t\t\theight: height === 0 ? `calc(100% + 1px - ${scroll}px)` : height\n\t\t\t\t}\n\t\t\t};\n\t\t})<{ index: number, left: number, width: number, height: number, scroll: number }>`\n\tposition: absolute;\n\ttop: 0;\n\tbackground-color: var(--console-favorite-color);\n\topacity: 0.05;\n\tpointer-events: none;\n\ttransition: left 300ms ease-in-out;\n\tz-index: 10;\n`;\n\nexport const DataSetResizeShade = styled.div`\n\tdisplay: block;\n\tposition: absolute;\n\tz-index: 20;\n\ttop: 0;\n\tleft: 0;\n\twidth: 0;\n\theight: 100%;\n\t//background-color: rgba(0, 0, 0, 0.05);\n\t&[data-visible=true] {\n\t\twidth: 100%;\n\t}\n`;\n\nexport const DataSetScrollVerticalShade = styled.div\n\t.attrs<{ width: number, heightOffset: number, visible: boolean }>(\n\t\t({ width, heightOffset, visible }) => {\n\t\t\treturn {\n\t\t\t\tstyle: {\n\t\t\t\t\twidth,\n\t\t\t\t\theight: `calc(100% - ${heightOffset}px)`,\n\t\t\t\t\tdisplay: visible ? 'block' : 'none'\n\t\t\t\t}\n\t\t\t};\n\t\t})<{ width: number, heightOffset: number, visible: boolean }>`\n\tposition: absolute;\n\ttop: 0;\n\tright: 0;\n\theight: 100%;\n\tz-index: 15;\n\toverflow-x: hidden;\n\toverflow-y: scroll;\n`;\n\nexport const DataSetScrollHorizontalShade = styled.div\n\t.attrs<{ left: number, height: number, widthOffset: number, visible: boolean }>(\n\t\t({ left, height, widthOffset, visible }) => {\n\t\t\treturn {\n\t\t\t\tstyle: {\n\t\t\t\t\tdisplay: visible ? 'block' : 'none',\n\t\t\t\t\tleft,\n\t\t\t\t\twidth: `calc(100% - ${left}px - ${widthOffset}px)`,\n\t\t\t\t\theight\n\t\t\t\t}\n\t\t\t};\n\t\t})<{ left: number, height: number, widthOffset: number, visible: boolean }>`\n\tposition: absolute;\n\tbottom: 0;\n\tleft: 0;\n\tz-index: 15;\n\toverflow-y: hidden;\n\toverflow-x: scroll;\n`;","import { faLock, faLockOpen, faSortAmountDown, faSortAmountUpAlt } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { ForwardedRef, forwardRef, Fragment, useRef } from 'react';\nimport { DataPage } from '../../../../../services/admin/types';\nimport { LinkButton } from '../../../../component/console/link-button';\nimport {\n\tDataSetTableBody,\n\tDataSetTableBodyCell,\n\tDataSetTableContainer,\n\tDataSetTableHeader,\n\tDataSetTableHeaderCell,\n\tHeaderCellButtons\n} from './dataset-table-components';\nimport { useDataSetTableContext } from './dataset-table-context';\nimport { ColumnDef, FactorColumnDef, SequenceColumnDef } from './types';\n\nconst HeaderCell = (props: {\n\tcolumn: FactorColumnDef;\n\tisFixTable: boolean;\n\tlast: boolean;\n\tgridColumnIndex: number;\n\tselectColumn: (event: React.MouseEvent<HTMLDivElement>) => void;\n\tfixColumn: (event: React.MouseEvent<HTMLButtonElement>) => void;\n\tunfixColumn: (event: React.MouseEvent<HTMLButtonElement>) => void;\n\tsortColumnAsc: (event: React.MouseEvent<HTMLButtonElement>) => void;\n\tsortColumnDesc: (event: React.MouseEvent<HTMLButtonElement>) => void;\n\tdragging: boolean;\n}) => {\n\tconst {\n\t\tcolumn, isFixTable,\n\t\tlast, gridColumnIndex,\n\t\tselectColumn, fixColumn, unfixColumn, sortColumnAsc, sortColumnDesc,\n\t\tdragging\n\t} = props;\n\n\tconst cellRef = useRef<HTMLDivElement>(null);\n\n\treturn <DataSetTableHeaderCell lastColumn={last} column={gridColumnIndex}\n\t                               onClick={selectColumn}\n\t                               data-dragging={dragging}\n\t                               data-last-column={last}\n\t                               ref={cellRef}>\n\t\t<span>{column.alias || column.factor.label || column.factor.name}</span>\n\t\t<HeaderCellButtons>\n\t\t\t<LinkButton ignoreHorizontalPadding={true} tooltip='Sort Ascending'\n\t\t\t            right={true} offsetX={-6} offsetY={6}\n\t\t\t            onClick={sortColumnAsc}>\n\t\t\t\t<FontAwesomeIcon icon={faSortAmountUpAlt}/>\n\t\t\t</LinkButton>\n\t\t\t<LinkButton ignoreHorizontalPadding={true} tooltip='Sort Descending'\n\t\t\t            right={true} offsetX={-6} offsetY={6}\n\t\t\t            onClick={sortColumnDesc}>\n\t\t\t\t<FontAwesomeIcon icon={faSortAmountDown}/>\n\t\t\t</LinkButton>\n\t\t\t{isFixTable\n\t\t\t\t? <LinkButton ignoreHorizontalPadding={true} tooltip='Unfix Me and Follows'\n\t\t\t\t              right={true} offsetX={-6} offsetY={6}\n\t\t\t\t              onClick={unfixColumn}>\n\t\t\t\t\t<FontAwesomeIcon icon={faLockOpen}/>\n\t\t\t\t</LinkButton>\n\t\t\t\t: <LinkButton ignoreHorizontalPadding={true} tooltip='Fix Columns to Here'\n\t\t\t\t              right={true} offsetX={-6} offsetY={6}\n\t\t\t\t              onClick={fixColumn}>\n\t\t\t\t\t<FontAwesomeIcon icon={faLock}/>\n\t\t\t\t</LinkButton>}\n\t\t</HeaderCellButtons>\n\t</DataSetTableHeaderCell>;\n};\n\nexport const DataSetTable = forwardRef((props: {\n\tdisplayColumns: Array<FactorColumnDef>;\n\tdata: DataPage<Array<any>>;\n\tisFixTable: boolean;\n\trowNoColumnWidth: number;\n\tonColumnFixChange: (column: FactorColumnDef, fix: boolean) => void;\n\tonColumnSort: (column: FactorColumnDef, asc: boolean) => void;\n\tdragColumn?: FactorColumnDef;\n}, ref: ForwardedRef<HTMLDivElement>) => {\n\tconst {\n\t\tdisplayColumns,\n\t\tisFixTable,\n\t\trowNoColumnWidth,\n\t\tdata: { data, pageNumber, pageSize },\n\t\tonColumnFixChange, onColumnSort,\n\t\tdragColumn\n\t} = props;\n\n\tconst { selectionChange } = useDataSetTableContext();\n\tconst onSelectionChanged = (rowIndex: number, columnIndex: number) => (event: React.MouseEvent<HTMLDivElement>) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tselectionChange(isFixTable, rowIndex, columnIndex);\n\t};\n\tconst fixColumn = (fix: boolean, column: FactorColumnDef) => (event: React.MouseEvent<HTMLButtonElement>) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tonColumnFixChange(column, fix);\n\t};\n\tconst sortColumn = (asc: boolean, column: FactorColumnDef) => (event: React.MouseEvent<HTMLButtonElement>) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tonColumnSort(column, asc);\n\t};\n\n\tconst allDisplayColumns: Array<ColumnDef> = [ ...displayColumns ];\n\tif (isFixTable) {\n\t\tallDisplayColumns.unshift({ fixed: true, width: rowNoColumnWidth } as SequenceColumnDef);\n\t}\n\tconst autoFill = !isFixTable;\n\n\treturn <DataSetTableContainer columns={allDisplayColumns} autoFill={autoFill} rowCount={data.length}\n\t                              data-scrollable={!dragColumn}\n\t                              ref={ref}>\n\t\t<DataSetTableHeader columns={allDisplayColumns} autoFill={autoFill}>\n\t\t\t{isFixTable\n\t\t\t\t? <DataSetTableHeaderCell lastColumn={displayColumns.length === 0}\n\t\t\t\t                          column={2}\n\t\t\t\t                          data-rowno={true}>\n\t\t\t\t\t<span>#</span>\n\t\t\t\t</DataSetTableHeaderCell>\n\t\t\t\t: null}\n\t\t\t{displayColumns.map((column, columnIndex, columns) => {\n\t\t\t\tconst lastColumn = isFixTable && columnIndex === columns.length - 1;\n\t\t\t\treturn <HeaderCell column={column}\n\t\t\t\t                   isFixTable={isFixTable}\n\t\t\t\t                   last={lastColumn}\n\t\t\t\t                   gridColumnIndex={(columnIndex + (isFixTable ? 1 : 0) + 1) * 2}\n\t\t\t\t                   selectColumn={onSelectionChanged(-1, columnIndex)}\n\t\t\t\t                   fixColumn={fixColumn(true, column)}\n\t\t\t\t                   unfixColumn={fixColumn(false, column)}\n\t\t\t\t                   sortColumnAsc={sortColumn(true, column)}\n\t\t\t\t                   sortColumnDesc={sortColumn(false, column)}\n\t\t\t\t                   dragging={column === dragColumn}\n\t\t\t\t                   key={`0-${columnIndex}`}/>;\n\t\t\t})}\n\t\t\t{autoFill\n\t\t\t\t? <DataSetTableHeaderCell lastColumn={false}\n\t\t\t\t                          column={allDisplayColumns.length * 2 + 2}\n\t\t\t\t                          data-filler={true}/>\n\t\t\t\t: null}\n\t\t</DataSetTableHeader>\n\t\t<DataSetTableBody columns={allDisplayColumns} autoFill={autoFill}>\n\t\t\t{data.map((row, rowIndex, rows) => {\n\t\t\t\tconst lastRow = rows.length - 1 === rowIndex;\n\t\t\t\treturn <Fragment key={`${rowIndex}`}>\n\t\t\t\t\t{isFixTable\n\t\t\t\t\t\t? <DataSetTableBodyCell lastRow={lastRow} lastColumn={displayColumns.length === 0}\n\t\t\t\t\t\t                        column={2}\n\t\t\t\t\t\t                        onClick={onSelectionChanged(rowIndex, -1)}\n\t\t\t\t\t\t                        data-last-row={lastRow}\n\t\t\t\t\t\t                        data-rowno={true}>\n\t\t\t\t\t\t\t<span>{pageSize * (pageNumber - 1) + rowIndex + 1}</span>\n\t\t\t\t\t\t</DataSetTableBodyCell>\n\t\t\t\t\t\t: null}\n\t\t\t\t\t{displayColumns.map((def, columnIndex, columns) => {\n\t\t\t\t\t\tconst lastColumn = isFixTable && columnIndex === columns.length - 1;\n\t\t\t\t\t\treturn <DataSetTableBodyCell lastRow={lastRow} lastColumn={lastColumn}\n\t\t\t\t\t\t                             column={(columnIndex + (isFixTable ? 1 : 0) + 1) * 2}\n\t\t\t\t\t\t                             onClick={onSelectionChanged(rowIndex, columnIndex)}\n\t\t\t\t\t\t                             data-dragging={def === dragColumn}\n\t\t\t\t\t\t                             data-last-row={lastRow} data-last-column={lastColumn}\n\t\t\t\t\t\t                             key={`${rowIndex}-${columnIndex}`}>\n\t\t\t\t\t\t\t<span>{`${row[def.index]}`}</span>\n\t\t\t\t\t\t</DataSetTableBodyCell>;\n\t\t\t\t\t})}\n\t\t\t\t\t{autoFill\n\t\t\t\t\t\t? <DataSetTableBodyCell lastRow={lastRow} lastColumn={false}\n\t\t\t\t\t\t                        column={allDisplayColumns.length * 2 + 2}\n\t\t\t\t\t\t                        data-last-row={lastRow}\n\t\t\t\t\t\t                        data-filler={true}/>\n\t\t\t\t\t\t: null}\n\t\t\t\t</Fragment>;\n\t\t\t})}\n\t\t</DataSetTableBody>\n\t</DataSetTableContainer>;\n});\n","import React, { ForwardedRef, forwardRef, useEffect, useState } from 'react';\nimport styled from 'styled-components';\nimport { DataPage } from '../../../../../services/admin/types';\nimport { HEADER_HEIGHT, ROW_HEIGHT } from './dataset-table-components';\nimport { DragColumnState, useDataSetTableContext } from './dataset-table-context';\nimport { FactorColumnDef } from './types';\n\ninterface ContainerProps {\n\tleft?: number;\n\twidth: number;\n\theight: number;\n\tmovementX: number;\n}\n\nconst DragColumnContainer = styled.div\n\t.attrs<ContainerProps>((\n\t\t{ left = 10, width, height, movementX }\n\t) => {\n\t\tconst rotate = Math.max(-10, Math.min(10, movementX / 10));\n\t\treturn {\n\t\t\t'data-widget': 'console-subject-view-dataset-drag-column',\n\t\t\tstyle: {\n\t\t\t\ttop: -1,\n\t\t\t\tleft,\n\t\t\t\twidth,\n\t\t\t\theight: height + 1,\n\t\t\t\ttransform: `translateY(${HEADER_HEIGHT}px) rotate(${rotate}deg)`\n\t\t\t}\n\t\t};\n\t})<ContainerProps>`\n\tdisplay: flex;\n\tflex-direction: column;\n\tposition: absolute;\n\toverflow: hidden;\n\tborder-bottom: var(--border);\n\tz-index: 30;\n\tcursor: move;\n\tpointer-events: none;\n\ttransform-origin: center center;\n\tbox-shadow: var(--console-favorite-shadow);\n\t&[data-visible=false] {\n\t\tdisplay: none;\n\t}\n\t&:after {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tbackground-color: var(--console-favorite-color);\n\t\topacity: 0.1;\n\t\tz-index: 2;\n\t}\n`;\nconst DragColumnHeader = styled.div.attrs({\n\t'data-widget': 'console-subject-view-dataset-drag-column-header'\n})`\n\tdisplay: flex;\n\talign-items: stretch;\n\tmin-height: ${HEADER_HEIGHT + 1}px;\n\tz-index: 1;\n`;\nconst DragColumnHeaderCell = styled.div.attrs({\n\t'data-widget': 'console-subject-view-dataset-drag-column-header-cell'\n})`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\tfont-size: 0.8em;\n\tfont-family: var(--console-title-font-family);\n\tbackground-color: var(--bg-color);\n\tpadding: 0 8px;\n\twidth: 100%;\n\tborder: var(--border);\n\t> span {\n\t\tflex-grow: 1;\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t}\n`;\nconst DragColumnBody = styled.div.attrs<{ firstRowOffsetY: number }>(({ firstRowOffsetY }) => {\n\treturn {\n\t\t'data-widget': 'console-subject-view-dataset-drag-column-body',\n\t\tstyle: { marginTop: 0 - firstRowOffsetY }\n\t};\n})<{ firstRowOffsetY: number }>`\n\tdisplay: grid;\n\tjustify-items: stretch;\n\talign-items: stretch;\n\tgrid-auto-rows: ${ROW_HEIGHT}px;\n`;\nconst DragColumnBodyCell = styled.div.attrs({\n\t'data-widget': 'console-subject-view-dataset-drag-column-body-cell'\n})`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\tfont-size: 0.8em;\n\tpadding: 1px 8px 0;\n\tbackground-color: var(--invert-color);\n\tborder: var(--border);\n\tborder-top: 0;\n\t> span {\n\t\tflex-grow: 1;\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t}\n`;\n\nexport const DataSetTableDragColumn = forwardRef((props: {\n\tcolumn?: FactorColumnDef;\n\tdata: DataPage<Array<any>>;\n}, ref: ForwardedRef<HTMLDivElement>) => {\n\tconst {\n\t\tcolumn, data: { data }\n\t} = props;\n\n\tconst {\n\t\taddDragColumnStateChangeListener, removeDragColumnStateChangeListener,\n\t\taddDragColumnVisibleChangeListener, removeDragColumnVisibleChangeListener,\n\t\taddDragColumnVisibleDeterminationHandler, removeDragColumnVisibleDeterminationHandler\n\t} = useDataSetTableContext();\n\n\tconst [ visible, setVisible ] = useState(false);\n\tconst [ state, setState ] = useState<DragColumnState>({\n\t\tleft: 0,\n\t\theight: 0,\n\t\tstartRowIndex: 0,\n\t\tendRowIndex: 0,\n\t\tfirstRowOffsetY: 0,\n\t\tmovementX: 0\n\t});\n\tuseEffect(() => {\n\t\tconst determinationListener = (reply: (visible: boolean) => void) => reply(visible);\n\t\tconst stateChangeListener = (newState: Partial<DragColumnState>) => setState({ ...state, ...newState });\n\t\taddDragColumnVisibleDeterminationHandler(determinationListener);\n\t\taddDragColumnVisibleChangeListener(setVisible);\n\t\taddDragColumnStateChangeListener(stateChangeListener);\n\n\t\treturn () => {\n\t\t\tremoveDragColumnVisibleDeterminationHandler(determinationListener);\n\t\t\tremoveDragColumnVisibleChangeListener(setVisible);\n\t\t\tremoveDragColumnStateChangeListener(stateChangeListener);\n\t\t};\n\t}, [\n\t\taddDragColumnVisibleDeterminationHandler, addDragColumnVisibleChangeListener, addDragColumnStateChangeListener,\n\t\tvisible, state,\n\t\tremoveDragColumnVisibleDeterminationHandler, removeDragColumnVisibleChangeListener, removeDragColumnStateChangeListener\n\t]);\n\n\tif (!column || !state) {\n\t\treturn null;\n\t}\n\n\tconst { width } = column;\n\tconst { left, height, startRowIndex, endRowIndex, firstRowOffsetY, movementX } = state;\n\n\treturn <DragColumnContainer left={left} width={width} height={height} movementX={movementX}\n\t                            data-visible={visible}\n\t                            ref={ref}>\n\t\t<DragColumnHeader>\n\t\t\t<DragColumnHeaderCell>\n\t\t\t\t<span>{column.factor.label || column.factor.name}</span>\n\t\t\t</DragColumnHeaderCell>\n\t\t</DragColumnHeader>\n\t\t<DragColumnBody firstRowOffsetY={firstRowOffsetY}>\n\t\t\t{data.map((row, rowIndex) => {\n\t\t\t\tif (rowIndex < startRowIndex || rowIndex > endRowIndex) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\treturn <DragColumnBodyCell key={`${rowIndex}`}>\n\t\t\t\t\t<span>{`${row[column.index]}`}</span>\n\t\t\t\t</DragColumnBodyCell>;\n\t\t\t})}\n\t\t</DragColumnBody>\n\t</DragColumnContainer>;\n});","import { ColumnExpressionOperator, ConsoleTopic, ConsoleTopicFactor } from '../../../../../services/console/types';\n\nexport type FactorMap = Map<string, { topic: ConsoleTopic, factor: ConsoleTopicFactor }>;\n\nexport enum ColumnSortBy {\n\tASC = 'asc',\n\tDESC = 'desc'\n}\n\nexport interface ColumnDef {\n\tfixed: boolean;\n\twidth: number;\n\tindex: number;\n\tsort?: ColumnSortBy;\n}\n\nexport interface FactorColumnDef extends ColumnDef {\n\ttopic: ConsoleTopic;\n\tfactor: ConsoleTopicFactor;\n\toperator?: ColumnExpressionOperator;\n\tsecondaryTopic?: ConsoleTopic;\n\tsecondaryFactor?: ConsoleTopicFactor;\n\talias?: string;\n}\n\nexport interface SequenceColumnDef extends ColumnDef {\n}\n\nexport interface DataSetTableProps {\n\tcolumns: Array<ColumnDef>,\n\tautoFill: boolean\n}\n\nexport interface ColumnDefs {\n\tfixed: Array<FactorColumnDef>;\n\tdata: Array<FactorColumnDef>;\n}\n\nexport interface TableSelection {\n\tinFixTable: boolean;\n\trow: number;\n\trowTop: number;\n\trowHeight: number;\n\n\tcolumn: number;\n\tcolumnLeft: number;\n\tcolumnWidth: number;\n\tcolumnHeight: number;\n\n\tverticalScroll: number;\n\thorizontalScroll: number;\n}\n\nexport interface SelectionRef {\n\tselection: () => TableSelection;\n}","import React, { RefObject, useEffect, useRef, useState } from 'react';\nimport { useForceUpdate } from '../../../../../common/utils';\nimport { DataPage } from '../../../../../services/admin/types';\nimport { ConnectedConsoleSpace, ConsoleSpaceSubject } from '../../../../../services/console/types';\nimport { DataSetTable } from './dataset-table';\nimport {\n\tDataSetResizeShade,\n\tDRAG_DEVIATION,\n\tFILLER_MIN_WIDTH,\n\tHEADER_HEIGHT,\n\tMAX_COLUMN_WIDTH,\n\tMIN_COLUMN_WIDTH,\n\tRESIZE_DEVIATION,\n\tROW_HEIGHT,\n\tWrapper\n} from './dataset-table-components';\nimport { useDataSetTableContext } from './dataset-table-context';\nimport { DataSetTableDragColumn } from './dataset-table-drag-column';\nimport { DataTableScrollShade } from './dataset-table-scroll-shade';\nimport { DataSetTableSelection } from './dataset-table-selection';\nimport { ColumnDefs, ColumnSortBy, FactorColumnDef, SelectionRef } from './types';\n\nenum Behavior {\n\tNONE = 'none',\n\tPICK_COLUMN = 'pick-column',\n\tCAN_RESIZE = 'can-resize',\n\tRESIZING = 'resizing',\n\tREADY_TO_DRAG = 'ready-to-drag',\n\tDRAGGING = 'dragging'\n}\n\ninterface PickedColumn {\n\tcolumn: FactorColumnDef;\n\t// offset-x between mouse down point to wrapper left\n\toffsetX: number;\n\toriginalWidth: number;\n}\n\ninterface PickColumnOptions {\n\twrapperLeft: number;\n\ttable: HTMLDivElement;\n\tmouseClientX: number;\n\tcolumnDefs: ColumnDefs\n\tisFixTable: boolean;\n\trowNoColumnWidth: number;\n}\n\nconst findDataTable = (element: HTMLElement): HTMLDivElement | null => {\n\tconst widgetType = element.getAttribute('data-widget');\n\tif (widgetType !== 'console-subject-view-dataset-table') {\n\t\treturn element.closest('div[data-widget=\"console-subject-view-dataset-table\"]') as HTMLDivElement;\n\t}\n\treturn element as HTMLDivElement;\n};\n\nconst computeTableColumnsRightPositions = (displayColumns: Array<FactorColumnDef>) => {\n\tconst widths = displayColumns.map(column => column.width);\n\tfor (let index = 1, count = widths.length; index < count; index++) {\n\t\twidths[index] += widths[index - 1];\n\t}\n\treturn widths;\n};\n\nconst computeAndSetCursor = (options: {\n\ttable: HTMLDivElement;\n\tmouseClientX: number;\n\tmouseClientY: number;\n\tisFixTable: boolean;\n\trowNoColumnWidth: number;\n\tdisplayColumns: Array<FactorColumnDef>;\n\tfixColumns: Array<FactorColumnDef>;\n\tchangeBehavior: (state: Behavior) => void;\n}) => {\n\tconst {\n\t\ttable, mouseClientX, mouseClientY,\n\t\tisFixTable, rowNoColumnWidth,\n\t\tdisplayColumns, fixColumns,\n\t\tchangeBehavior\n\t} = options;\n\n\tconst { top: containerTop, left: containerLeft } = table.getBoundingClientRect();\n\tif (mouseClientY - containerTop > HEADER_HEIGHT) {\n\t\t// not in header\n\t\tchangeBehavior(Behavior.NONE);\n\t\treturn;\n\t}\n\tconst left = mouseClientX - containerLeft;\n\tif (isFixTable && left <= rowNoColumnWidth) {\n\t\t// in row number column\n\t\tchangeBehavior(Behavior.NONE);\n\t\treturn;\n\t}\n\n\t// compute every resize point\n\tconst widths = computeTableColumnsRightPositions(displayColumns);\n\n\tif (!isFixTable && left > widths[widths.length - 1] + RESIZE_DEVIATION - table.scrollLeft) {\n\t\t// in filler column\n\t\tchangeBehavior(Behavior.NONE);\n\t\treturn;\n\t}\n\n\tconst offsetLeft = isFixTable ? left - rowNoColumnWidth : left;\n\tlet canResize;\n\tif (isFixTable) {\n\t\tcanResize = widths.some(width => Math.abs(width - offsetLeft) <= RESIZE_DEVIATION);\n\t} else {\n\t\t// resize self, or last fix column\n\t\tcanResize = (fixColumns.length !== 0 && offsetLeft <= RESIZE_DEVIATION)\n\t\t\t|| widths.some(width => Math.abs(width - offsetLeft - table.scrollLeft) <= RESIZE_DEVIATION);\n\t}\n\tchangeBehavior(canResize ? Behavior.CAN_RESIZE : Behavior.PICK_COLUMN);\n};\n\nconst findPickedColumn = (options: PickColumnOptions & { matchColumnIndex: (widths: Array<number>, offsetLeft: number) => number }): PickedColumn => {\n\tconst { wrapperLeft, table, mouseClientX, columnDefs, isFixTable, rowNoColumnWidth, matchColumnIndex } = options;\n\n\tconst tableColumnDefs = isFixTable ? columnDefs.fixed : columnDefs.data;\n\tlet offsetLeft: number;\n\tif (isFixTable) {\n\t\toffsetLeft = mouseClientX - table.getBoundingClientRect().left - rowNoColumnWidth;\n\t} else {\n\t\toffsetLeft = mouseClientX - table.getBoundingClientRect().left + table.scrollLeft;\n\t}\n\tconst widths = computeTableColumnsRightPositions(tableColumnDefs);\n\tconst index = matchColumnIndex(widths, offsetLeft);\n\treturn {\n\t\tcolumn: tableColumnDefs[index],\n\t\toffsetX: mouseClientX - wrapperLeft,\n\t\toriginalWidth: tableColumnDefs[index].width\n\t};\n};\n\nconst findPickedColumnForResize = (options: PickColumnOptions): PickedColumn => {\n\tconst { wrapperLeft, table, mouseClientX, columnDefs, isFixTable } = options;\n\n\tif (!isFixTable && mouseClientX - table.getBoundingClientRect().left <= RESIZE_DEVIATION) {\n\t\t// to resize the last column of fix table\n\t\treturn {\n\t\t\tcolumn: columnDefs.fixed[columnDefs.fixed.length - 1],\n\t\t\toffsetX: mouseClientX - wrapperLeft,\n\t\t\toriginalWidth: columnDefs.fixed[columnDefs.fixed.length - 1].width\n\t\t};\n\t}\n\tconst matchColumnIndex = (widths: Array<number>, offsetLeft: number) => {\n\t\treturn widths.findIndex(width => Math.abs(width - offsetLeft) <= RESIZE_DEVIATION);\n\t};\n\treturn findPickedColumn({ ...options, matchColumnIndex });\n};\n\nconst findPickedColumnForDrag = (options: PickColumnOptions): PickedColumn => {\n\tconst matchColumnIndex = (widths: Array<number>, offsetLeft: number) => {\n\t\treturn widths.findIndex((width, index) => {\n\t\t\treturn width > offsetLeft && (index === 0 || widths[index - 1] < offsetLeft);\n\t\t});\n\t};\n\treturn findPickedColumn({ ...options, matchColumnIndex });\n};\n\nconst useDecorateFixStyle = (options: {\n\tfixTableRef: RefObject<HTMLDivElement>;\n\tdataTableRef: RefObject<HTMLDivElement>;\n}) => {\n\tconst { fixTableRef, dataTableRef } = options;\n\n\tconst arrangeFixedTableStyle = () => {\n\t\tif (!dataTableRef.current || !fixTableRef.current) {\n\t\t\treturn;\n\t\t}\n\t\tconst dataTable = dataTableRef.current;\n\t\tconst fixTable = fixTableRef.current;\n\t\tconst scrollBarHeight = dataTable.offsetHeight - dataTable.clientHeight;\n\t\tfixTable.style.height = `calc(100% - ${scrollBarHeight}px)`;\n\t\tfixTable.style.boxShadow = `0 1px 0 0 var(--border-color)`;\n\t};\n\n\t// link scroll between fixed table and data table\n\tuseEffect(() => {\n\t\tif (!dataTableRef.current || !fixTableRef.current) {\n\t\t\treturn;\n\t\t}\n\t\tconst dataTable = dataTableRef.current;\n\t\tconst fixTable = fixTableRef.current;\n\t\tconst onDataTableScroll = () => {\n\t\t\tarrangeFixedTableStyle();\n\t\t\tfixTable.scrollTop = dataTable.scrollTop;\n\t\t};\n\t\tsetTimeout(arrangeFixedTableStyle, 100);\n\t\tdataTable.addEventListener('scroll', onDataTableScroll);\n\t\t// synchronize scroll top to data table\n\t\tconst onFixTableScroll = () => dataTable.scrollTop = fixTable.scrollTop;\n\t\tfixTable.addEventListener('scroll', onFixTableScroll);\n\t\treturn () => {\n\t\t\tdataTable.removeEventListener('scroll', onDataTableScroll);\n\t\t\tfixTable.removeEventListener('scroll', onFixTableScroll);\n\t\t};\n\t});\n\n\treturn arrangeFixedTableStyle;\n};\n\nexport const DataSetTableWrapper = (props: {\n\tspace: ConnectedConsoleSpace;\n\tsubject: ConsoleSpaceSubject;\n\tcolumnDefs: ColumnDefs;\n\tdata: DataPage<Array<any>>;\n}) => {\n\tconst { columnDefs, data } = props;\n\n\tconst {\n\t\tfixColumnChange, repaintSelection, selectionChange,\n\t\tdragColumnVisibleChange, dragColumnStateChange, determineDragColumnVisible,\n\t\taddColumnWidthCompressHandler, removeColumnWidthCompressHandler\n\t} = useDataSetTableContext();\n\tconst wrapperRef = useRef<HTMLDivElement>(null);\n\tconst fixTableRef = useRef<HTMLDivElement>(null);\n\tconst dataTableRef = useRef<HTMLDivElement>(null);\n\tconst selectionRef = useRef<SelectionRef>(null);\n\tconst [ rowNoColumnWidth ] = useState(40);\n\tconst [ behavior, setBehavior ] = useState<Behavior>(Behavior.NONE);\n\tconst [ pickedColumn, setPickedColumn ] = useState<PickedColumn | null>(null);\n\tconst forceUpdate = useForceUpdate();\n\tconst arrangeFixedTableStyle = useDecorateFixStyle({ fixTableRef, dataTableRef });\n\tuseEffect(() => {\n\t\tconst onColumnWidthCompress = () => {\n\t\t\tcolumnDefs.fixed.forEach(c => c.width = MIN_COLUMN_WIDTH);\n\t\t\tcolumnDefs.data.forEach(c => c.width = MIN_COLUMN_WIDTH);\n\t\t\tforceUpdate();\n\t\t};\n\t\taddColumnWidthCompressHandler(onColumnWidthCompress);\n\t\treturn () => removeColumnWidthCompressHandler(onColumnWidthCompress);\n\t});\n\n\tconst manageCursor = (options: { table: HTMLDivElement | null, mouseClientX: number, mouseClientY: number, avoidResize: boolean }) => {\n\t\tconst { table } = options;\n\t\tif (!table) {\n\t\t\t// target is wrapper itself, when mouse in left-bottom corner and there is horizontal scroll bar shown\n\t\t\treturn;\n\t\t}\n\t\tconst { mouseClientX, mouseClientY, avoidResize } = options;\n\t\tcomputeAndSetCursor({\n\t\t\ttable,\n\t\t\tmouseClientX,\n\t\t\tmouseClientY,\n\t\t\tisFixTable: table === fixTableRef.current,\n\t\t\trowNoColumnWidth,\n\t\t\tdisplayColumns: table === fixTableRef.current ? columnDefs.fixed : columnDefs.data,\n\t\t\tfixColumns: columnDefs.fixed,\n\t\t\tchangeBehavior: avoidResize ? (state: Behavior) => {\n\t\t\t\tsetBehavior(state === Behavior.CAN_RESIZE ? Behavior.PICK_COLUMN : state);\n\t\t\t} : setBehavior\n\t\t});\n\t};\n\n\tconst resizeColumn = (mouseClientX: number) => {\n\t\tif (!pickedColumn) {\n\t\t\treturn;\n\t\t}\n\t\tconst { left: wrapperLeft } = wrapperRef.current!.getBoundingClientRect();\n\t\tconst movementX = mouseClientX - wrapperLeft - pickedColumn.offsetX;\n\t\tpickedColumn.column.width = Math.min(Math.max(MIN_COLUMN_WIDTH, pickedColumn.originalWidth + movementX), MAX_COLUMN_WIDTH);\n\n\t\tconst isFixTable = columnDefs.fixed.includes(pickedColumn.column);\n\t\tconst table = isFixTable ? fixTableRef.current! : dataTableRef.current!;\n\t\tconst columns = isFixTable ? columnDefs.fixed : columnDefs.data;\n\t\tconst header = table.querySelector('div[data-widget=\"console-subject-view-dataset-table-header\"]')! as HTMLDivElement;\n\t\tconst body = table.querySelector('div[data-widget=\"console-subject-view-dataset-table-body\"]')! as HTMLDivElement;\n\t\tconst gridTemplateColumns = header.style.gridTemplateColumns.split(' ');\n\t\t// physical column is on (definition column index + 1) * 2, starts from 1;\n\t\t// width declaration in grid template columns css also is on (definition column index + 1) * 2, starts from 0, therefore index must plus 1 additional;\n\t\t// in fix table, there are row number columns, one for show, one for keep rank with real columns.\n\t\tgridTemplateColumns[(columns.indexOf(pickedColumn.column) + (isFixTable ? 1 : 0)) * 2 + 1] = `${pickedColumn.column.width}px`;\n\t\tconst newGridTemplateColumns = gridTemplateColumns.join(' ');\n\t\theader.style.gridTemplateColumns = newGridTemplateColumns;\n\t\tbody.style.gridTemplateColumns = newGridTemplateColumns;\n\t\tif (isFixTable) {\n\t\t\t// left of data table doesn't change when resize column in fix table\n\t\t\tconst dataTable = dataTableRef.current!;\n\t\t\t// css includes row number column here\n\t\t\tconst left = gridTemplateColumns.map(width => parseInt(width)).reduce((total, width) => total + width, 0);\n\t\t\tdataTable.style.left = `${left}px`;\n\t\t\tdataTable.style.position = 'absolute';\n\t\t\tdataTable.style.width = `calc(100% - ${left}px)`;\n\t\t}\n\t\trepaintSelection();\n\t\tarrangeFixedTableStyle();\n\t};\n\n\t// reset the placeholder columns width to zero,\n\t// reset the real columns width to original,\n\t// because don't know the previous status\n\tconst resetGridTemplateColumns = (options: {\n\t\telement: HTMLDivElement;\n\t\tcolumns: Array<FactorColumnDef>;\n\t\tisFixTable: boolean;\n\t}) => {\n\t\tconst { element, columns, isFixTable } = options;\n\n\t\tconst gridColumnCount = columns.length * 2;\n\t\tconst shouldReset = (index: number) => isFixTable ? (index > 1 && index < gridColumnCount + 3) : (index < gridColumnCount + 1);\n\t\tconst getDefIndex = (index: number) => isFixTable ? ((index - 3) / 2) : ((index - 1) / 2);\n\t\treturn element.style.gridTemplateColumns.split(' ').map((width, index) => {\n\t\t\tif (shouldReset(index)) {\n\t\t\t\t// recover all width\n\t\t\t\treturn (index % 2 === 0) ? '0px' : `${columns[getDefIndex(index)].width}px`;\n\t\t\t} else {\n\t\t\t\t// last minmax column\n\t\t\t\treturn width;\n\t\t\t}\n\t\t});\n\t};\n\tconst repaintWhenDragging = (options: {\n\t\tmouseClientX: number;\n\t\tsourceTable: HTMLDivElement;\n\t\tsourceColumns: Array<FactorColumnDef>;\n\t\ttargetTable: HTMLDivElement;\n\t\ttargetColumns: Array<FactorColumnDef>;\n\t\tpickedColumn: FactorColumnDef;\n\t}) => {\n\t\tconst {\n\t\t\tmouseClientX,\n\t\t\tsourceTable, sourceColumns,\n\t\t\ttargetTable, targetColumns,\n\t\t\tpickedColumn\n\t\t} = options;\n\n\t\t// handle source table\n\t\tconst dragColumnIndex = sourceColumns.indexOf(pickedColumn);\n\t\tconst sourceHeader = sourceTable.querySelector<HTMLDivElement>('div[data-widget=\"console-subject-view-dataset-table-header\"]')!;\n\t\tconst sourceBody = sourceTable.querySelector<HTMLDivElement>('div[data-widget=\"console-subject-view-dataset-table-body\"]')!;\n\t\tconst sourceIsFixTable = sourceTable === fixTableRef.current;\n\t\tconst sourceGridTemplateColumns = resetGridTemplateColumns({\n\t\t\telement: sourceHeader,\n\t\t\tcolumns: sourceColumns,\n\t\t\tisFixTable: sourceIsFixTable\n\t\t});\n\t\tif (sourceIsFixTable) {\n\t\t\tsourceGridTemplateColumns[(dragColumnIndex + 1) * 2 + 1] = '0';\n\t\t} else {\n\t\t\tsourceGridTemplateColumns[(dragColumnIndex + 1) * 2 - 1] = '0';\n\t\t}\n\n\t\t// handle target table\n\t\tconst targetIsFixTable = targetTable === fixTableRef.current;\n\t\tconst targetColumnsWidths = computeTableColumnsRightPositions(targetColumns);\n\t\tconst { left: targetTableLeft } = targetTable.getBoundingClientRect();\n\t\tconst targetScrollLeft = targetTable.scrollLeft;\n\t\tconst targetColumnIndex = targetColumnsWidths.findIndex(width => {\n\t\t\t// fix table has row number column\n\t\t\treturn width - targetScrollLeft > mouseClientX - targetTableLeft - (targetIsFixTable ? rowNoColumnWidth : 0);\n\t\t});\n\t\tlet targetHeader, targetBody, targetGridTemplateColumns;\n\t\tif (sourceTable === targetTable) {\n\t\t\ttargetHeader = sourceHeader;\n\t\t\ttargetBody = sourceBody;\n\t\t\ttargetGridTemplateColumns = sourceGridTemplateColumns;\n\t\t} else {\n\t\t\ttargetHeader = targetTable.querySelector<HTMLDivElement>('div[data-widget=\"console-subject-view-dataset-table-header\"]')!;\n\t\t\ttargetBody = targetTable.querySelector<HTMLDivElement>('div[data-widget=\"console-subject-view-dataset-table-body\"]')!;\n\t\t\ttargetGridTemplateColumns = resetGridTemplateColumns({\n\t\t\t\telement: targetHeader,\n\t\t\t\tcolumns: targetColumns,\n\t\t\t\tisFixTable: targetIsFixTable\n\t\t\t});\n\t\t}\n\t\tif (targetColumnIndex === -1) {\n\t\t\t// console.group();\n\t\t\t// console.info('target is fix table:', targetIsFixTable);\n\t\t\t// console.info('mouse client x:', mouseClientX, ', target scroll left:', targetScrollLeft);\n\t\t\t// console.info('fix table left:', fixTableRef.current!.getBoundingClientRect().left);\n\t\t\t// console.info('data table left:', dataTableRef.current!.getBoundingClientRect().left);\n\t\t\t// console.info('column widths:', targetColumnsWidths.join(', '));\n\t\t\t// console.groupEnd();\n\t\t\t// 2 scenarios here:\n\t\t\tif (targetIsFixTable) {\n\t\t\t\t// 1. in fix table, dragging column is from data table, and mouse is at right of all fixed columns.\n\t\t\t\t// the tricky scenario as below,\n\t\t\t\t// when a column is from data table, move into fix table, and now it is at tail of last column of fix table (mouse client x in right half of fix table column),\n\t\t\t\t// physically, the mouse client x is still in fix table (sometimes it is moved to data table, catch by above logic branch, not in this discussion),\n\t\t\t\t// and in repaint function call, even the last column right position is less than mouse client x,\n\t\t\t\t// then the target column cannot be found, the undefined error raised in repaint function call.\n\t\t\t\t// root cause of this scenario is table width must be resized when a dragging column move in and out, a column placeholder is simulated for reminding current situation.\n\t\t\t\t// for fix this, it will be treated same as dragging column still in fix table, as last column.\n\t\t\t\ttargetGridTemplateColumns[(targetColumns.length + 1) * 2] = `${pickedColumn.width}px`;\n\t\t\t} else {\n\t\t\t\t// 2. in data table, mouse is at right of all columns.\n\t\t\t\ttargetGridTemplateColumns[targetColumns.length * 2 + 1] = `${pickedColumn.width}px`;\n\t\t\t}\n\t\t} else {\n\t\t\tconst targetColumnRightX = targetColumnsWidths[targetColumnIndex];\n\t\t\tconst targetColumnLeftX = targetColumnRightX - targetColumns[targetColumnIndex].width;\n\t\t\tconst targetColumnCenterX = (targetColumnRightX + targetColumnLeftX) / 2;\n\t\t\tif (mouseClientX - targetTableLeft > targetColumnCenterX - targetScrollLeft) {\n\t\t\t\t// drag column after this\n\t\t\t\ttargetGridTemplateColumns[(targetColumnIndex + 1) * 2 + (targetIsFixTable ? 2 : 0)] = `${pickedColumn.width}px`;\n\t\t\t} else {\n\t\t\t\t// drag column before this\n\t\t\t\ttargetGridTemplateColumns[(targetColumnIndex + 1) * 2 + (targetIsFixTable ? 2 : 0) - 2] = `${pickedColumn.width}px`;\n\t\t\t}\n\t\t}\n\n\t\t// repaint\n\t\tconst isTableInside = sourceTable === targetTable;\n\t\tif (!isTableInside) {\n\t\t\t// ignore once when move column inside\n\t\t\tconst newSourceGridTemplateColumns = sourceGridTemplateColumns.join(' ');\n\t\t\tsourceHeader.style.gridTemplateColumns = newSourceGridTemplateColumns;\n\t\t\tsourceBody.style.gridTemplateColumns = newSourceGridTemplateColumns;\n\t\t}\n\t\tconst newTargetGridTemplateColumns = targetGridTemplateColumns.join(' ');\n\t\ttargetHeader.style.gridTemplateColumns = newTargetGridTemplateColumns;\n\t\ttargetBody.style.gridTemplateColumns = newTargetGridTemplateColumns;\n\n\t\t// move column from one table to another, should change fix table width and data table left.\n\t\t// even move inside table, since column might be move out and move in again, therefore compute width and left is required.\n\t\tlet fixTableWidth;\n\t\tlet fixTable;\n\t\tlet dataTable;\n\t\tif (sourceIsFixTable) {\n\t\t\t// source from fix table\n\t\t\tfixTableWidth = sourceGridTemplateColumns.map(width => parseInt(width)).reduce((total, width) => total + width, 0);\n\t\t\tif (isTableInside) {\n\t\t\t\t// target to fix table\n\t\t\t\tfixTable = sourceTable;\n\t\t\t\t// reset data table since processing above is all about fix table\n\t\t\t\tdataTable = dataTableRef.current!;\n\t\t\t\tconst dataTableHeader = dataTable.querySelector<HTMLDivElement>('div[data-widget=\"console-subject-view-dataset-table-header\"]')!;\n\t\t\t\tconst dataTableBody = dataTable.querySelector<HTMLDivElement>('div[data-widget=\"console-subject-view-dataset-table-body\"]')!;\n\t\t\t\tconst dataTableGridColumns = `0 ${columnDefs.data.map(column => `${column.width}px 0`).join(' ')} minmax(${FILLER_MIN_WIDTH}px, 1fr)`;\n\t\t\t\tdataTableHeader.style.gridTemplateColumns = dataTableGridColumns;\n\t\t\t\tdataTableBody.style.gridTemplateColumns = dataTableGridColumns;\n\t\t\t} else {\n\t\t\t\t// target to data table\n\t\t\t\tfixTable = sourceTable;\n\t\t\t\tdataTable = targetTable;\n\t\t\t}\n\t\t} else {\n\t\t\t// source from data table\n\t\t\tif (isTableInside) {\n\t\t\t\t// target to data table\n\t\t\t\t// reset fix table since processing above is all about data table\n\t\t\t\tfixTable = fixTableRef.current!;\n\t\t\t\tconst fixTableHeader = fixTable.querySelector<HTMLDivElement>('div[data-widget=\"console-subject-view-dataset-table-header\"]')!;\n\t\t\t\tconst fixTableBody = fixTable.querySelector<HTMLDivElement>('div[data-widget=\"console-subject-view-dataset-table-body\"]')!;\n\t\t\t\tconst fixTableGridColumns = `0 ${rowNoColumnWidth}px 0 ${columnDefs.fixed.map(column => `${column.width}px 0`).join(' ')}`;\n\t\t\t\tfixTableHeader.style.gridTemplateColumns = fixTableGridColumns;\n\t\t\t\tfixTableBody.style.gridTemplateColumns = fixTableGridColumns;\n\t\t\t\tfixTableWidth = columnDefs.fixed.reduce((width, column) => width + column.width, rowNoColumnWidth);\n\t\t\t\tdataTable = sourceTable;\n\t\t\t} else {\n\t\t\t\t// target to fix table\n\t\t\t\tfixTableWidth = targetGridTemplateColumns.map(width => parseInt(width)).reduce((total, width) => total + width, 0);\n\t\t\t\tfixTable = targetTable;\n\t\t\t\tdataTable = sourceTable;\n\t\t\t}\n\t\t}\n\t\tfixTable.style.minWidth = 'unset';\n\t\tfixTable.style.width = `${fixTableWidth}px`;\n\t\tdataTable.style.left = `${fixTableWidth}px`;\n\t\tdataTable.style.position = 'absolute';\n\t\tdataTable.style.width = `calc(100% - ${fixTableWidth}px)`;\n\t};\n\n\tconst computeSourceAndTarget = (mouseClientX: number, column: FactorColumnDef) => {\n\t\tconst dataTable = dataTableRef.current!;\n\t\tconst fixTable = fixTableRef.current!;\n\t\tconst dataTableLeft = dataTable.getBoundingClientRect().left;\n\t\tlet fromFixTable, toFixTable, sourceTable, sourceColumns, targetTable, targetColumns;\n\t\tif (columnDefs.data.includes(column)) {\n\t\t\tfromFixTable = false;\n\t\t\tsourceTable = dataTable;\n\t\t\tsourceColumns = columnDefs.data;\n\t\t} else {\n\t\t\tfromFixTable = true;\n\t\t\tsourceTable = fixTable;\n\t\t\tsourceColumns = columnDefs.fixed;\n\t\t}\n\t\tif (mouseClientX >= dataTableLeft) {\n\t\t\ttoFixTable = false;\n\t\t\ttargetTable = dataTable;\n\t\t\ttargetColumns = columnDefs.data;\n\t\t} else {\n\t\t\ttoFixTable = true;\n\t\t\ttargetTable = fixTable;\n\t\t\ttargetColumns = columnDefs.fixed;\n\t\t}\n\t\treturn { fromFixTable, toFixTable, sourceTable, sourceColumns, targetTable, targetColumns };\n\t};\n\n\tconst dragColumn = async (mouseClientX: number) => {\n\t\tif (!pickedColumn) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst wrapper = wrapperRef.current!;\n\t\tconst { left: wrapperLeft } = wrapper.getBoundingClientRect();\n\n\t\tconst movementX = mouseClientX - wrapperLeft - pickedColumn.offsetX;\n\t\tconst dragColumnVisible = await determineDragColumnVisible();\n\t\tif (!dragColumnVisible && Math.abs(movementX) <= DRAG_DEVIATION) {\n\t\t\t// start dragging when movement reach deviation\n\t\t\treturn;\n\t\t}\n\n\t\t// table content should be selected since shade is not shown now,\n\t\t// force clear selection to avoid confusing\n\t\twindow.getSelection()?.removeAllRanges();\n\t\tdragColumnStateChange({\n\t\t\tleft: mouseClientX - wrapperLeft - pickedColumn.column.width / 2,\n\t\t\tmovementX\n\t\t});\n\t\tif (behavior !== Behavior.DRAGGING) {\n\t\t\t// auto select the dragging column, remove the current column selection\n\t\t\tconst selection = selectionRef.current!.selection();\n\t\t\tselectionChange(selection.inFixTable, selection.row, -1);\n\t\t\tsetBehavior(Behavior.DRAGGING);\n\t\t}\n\t\tif (!dragColumnVisible) {\n\t\t\tdragColumnVisibleChange(true);\n\t\t}\n\t\tconst {\n\t\t\tsourceTable,\n\t\t\tsourceColumns,\n\t\t\ttargetTable,\n\t\t\ttargetColumns\n\t\t} = computeSourceAndTarget(mouseClientX, pickedColumn.column);\n\t\t// repaint drag column placeholder\n\t\trepaintWhenDragging({\n\t\t\tmouseClientX, sourceTable, sourceColumns, targetTable, targetColumns, pickedColumn: pickedColumn.column\n\t\t});\n\t};\n\n\tconst onMouseMove = (event: React.MouseEvent<HTMLDivElement>) => {\n\t\tif (behavior === Behavior.RESIZING && pickedColumn) {\n\t\t\tresizeColumn(event.clientX);\n\t\t} else if ((behavior === Behavior.READY_TO_DRAG || behavior === Behavior.DRAGGING) && pickedColumn) {\n\t\t\t// noinspection JSIgnoredPromiseFromCall\n\t\t\tdragColumn(event.clientX);\n\t\t} else {\n\t\t\t// nothing decide yet, just manager cursor to remind user\n\t\t\tmanageCursor({\n\t\t\t\ttable: findDataTable(event.target as HTMLElement),\n\t\t\t\tmouseClientX: event.clientX,\n\t\t\t\tmouseClientY: event.clientY,\n\t\t\t\tavoidResize: false\n\t\t\t});\n\t\t}\n\t};\n\n\tconst prepareToDragColumn = (table: HTMLDivElement, mouseClientX: number) => {\n\t\tconst isFixTable = table === fixTableRef.current;\n\t\tconst wrapperLeft = wrapperRef.current!.getBoundingClientRect().left;\n\t\tconst pickedColumn = findPickedColumnForDrag({\n\t\t\twrapperLeft,\n\t\t\ttable,\n\t\t\tmouseClientX,\n\t\t\tcolumnDefs,\n\t\t\tisFixTable,\n\t\t\trowNoColumnWidth\n\t\t});\n\t\tsetPickedColumn(pickedColumn);\n\t\tconst { scrollTop } = table;\n\t\tconst height = Math.min(table.clientHeight, HEADER_HEIGHT + data.data.length * ROW_HEIGHT);\n\t\tconst startRowIndex = Math.floor(scrollTop / ROW_HEIGHT);\n\t\tconst endRowIndex = startRowIndex + Math.ceil((height - HEADER_HEIGHT) / ROW_HEIGHT + 2);\n\n\t\tdragColumnStateChange({\n\t\t\theight,\n\t\t\tstartRowIndex,\n\t\t\tendRowIndex,\n\t\t\tfirstRowOffsetY: scrollTop % ROW_HEIGHT,\n\t\t\tmovementX: 0\n\t\t});\n\t\tsetBehavior(Behavior.READY_TO_DRAG);\n\t};\n\n\tconst prepareToResizeColumn = (table: HTMLDivElement, mouseClientX: number) => {\n\t\tsetPickedColumn(findPickedColumnForResize({\n\t\t\twrapperLeft: wrapperRef.current!.getBoundingClientRect().left,\n\t\t\ttable,\n\t\t\tmouseClientX,\n\t\t\tcolumnDefs,\n\t\t\tisFixTable: table === fixTableRef.current,\n\t\t\trowNoColumnWidth\n\t\t}));\n\t\tsetBehavior(Behavior.RESIZING);\n\t};\n\n\tconst onMouseDown = (event: React.MouseEvent<HTMLDivElement>) => {\n\t\tif (behavior === Behavior.CAN_RESIZE) {\n\t\t\t// start to resize column\n\t\t\tprepareToResizeColumn(findDataTable(event.target as HTMLElement)!, event.clientX);\n\t\t} else if (behavior === Behavior.PICK_COLUMN) {\n\t\t\t// start to resize column\n\t\t\tprepareToDragColumn(findDataTable(event.target as HTMLElement)!, event.clientX);\n\t\t}\n\t};\n\n\tconst releaseDragColumn = (mouseClientX: number) => {\n\t\tif (!pickedColumn) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst dragColumn = pickedColumn.column;\n\t\tconst { fromFixTable, toFixTable } = computeSourceAndTarget(mouseClientX, dragColumn);\n\t\tlet sourceColumnIndex;\n\t\tif (fromFixTable) {\n\t\t\tsourceColumnIndex = columnDefs.fixed.indexOf(dragColumn);\n\t\t\tcolumnDefs.fixed.splice(sourceColumnIndex, 1);\n\t\t} else {\n\t\t\tsourceColumnIndex = columnDefs.data.indexOf(dragColumn);\n\t\t\tcolumnDefs.data.splice(sourceColumnIndex, 1);\n\t\t}\n\t\tconst fixTable = fixTableRef.current!;\n\t\tconst dataTable = dataTableRef.current!;\n\t\tlet targetColumnIndex;\n\t\t// detect the move to index, convert the placeholder index to column index\n\t\tif (toFixTable) {\n\t\t\t// in grid template columns css, placeholder index is 2, 4, 6, ..., column length * 2 + 2\n\t\t\tconst fixTableHeader = fixTable.querySelector<HTMLDivElement>('div[data-widget=\"console-subject-view-dataset-table-header\"]')!;\n\t\t\tconst fixTableBody = fixTable.querySelector<HTMLDivElement>('div[data-widget=\"console-subject-view-dataset-table-body\"]')!;\n\t\t\tconst placeholderWidths = fixTableHeader.style.gridTemplateColumns.split(' ')\n\t\t\t\t.filter((width, index) => index >= 2 && index % 2 === 0).map(width => parseInt(width));\n\t\t\tconst placeholderIndex = placeholderWidths.findIndex(width => width !== 0);\n\t\t\tif (fromFixTable) {\n\t\t\t\t// if drag column is from fix table, it depends on the relationship between source column index and target column index\n\t\t\t\tif (placeholderIndex === sourceColumnIndex || placeholderIndex - 1 === sourceColumnIndex) {\n\t\t\t\t\t// actually doesn't change columns order\n\t\t\t\t\ttargetColumnIndex = sourceColumnIndex;\n\t\t\t\t} else if (placeholderIndex < sourceColumnIndex) {\n\t\t\t\t\t// move backward, use placeholder index as target column index\n\t\t\t\t\ttargetColumnIndex = placeholderIndex;\n\t\t\t\t} else {\n\t\t\t\t\t// move forward, use placeholder index subtract 1\n\t\t\t\t\ttargetColumnIndex = placeholderIndex - 1;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// otherwise drag column is from data table, simply use placeholder index as target column index\n\t\t\t\ttargetColumnIndex = placeholderIndex;\n\t\t\t}\n\t\t\tcolumnDefs.fixed.splice(targetColumnIndex, 0, dragColumn);\n\t\t\tconst fixTableGridColumns = `0 ${rowNoColumnWidth}px 0 ${columnDefs.fixed.map(column => `${column.width}px 0`).join(' ')}`;\n\t\t\tfixTableHeader.style.gridTemplateColumns = fixTableGridColumns;\n\t\t\tfixTableBody.style.gridTemplateColumns = fixTableGridColumns;\n\t\t} else {\n\t\t\t// in grid template columns css, placeholder index is 0, 2, 4, 6, ..., column length * 2\n\t\t\tconst dataTableHeader = dataTable.querySelector<HTMLDivElement>('div[data-widget=\"console-subject-view-dataset-table-header\"]')!;\n\t\t\tconst dataTableBody = dataTable.querySelector<HTMLDivElement>('div[data-widget=\"console-subject-view-dataset-table-body\"]')!;\n\t\t\tconst placeholderWidths = dataTableHeader.style.gridTemplateColumns.split(' ')\n\t\t\t\t.filter((width, index) => index % 2 === 0).map(width => parseInt(width));\n\t\t\tconst placeholderIndex = placeholderWidths.findIndex(width => width !== 0);\n\t\t\tif (fromFixTable) {\n\t\t\t\t// if drag column is from fix table, simply use placeholder index as target column index\n\t\t\t\ttargetColumnIndex = placeholderIndex;\n\t\t\t} else {\n\t\t\t\t// otherwise, it depends on the relationship between source column index and target column index\n\t\t\t\tif (placeholderIndex === sourceColumnIndex || placeholderIndex - 1 === sourceColumnIndex) {\n\t\t\t\t\t// actually doesn't change columns order\n\t\t\t\t\ttargetColumnIndex = sourceColumnIndex;\n\t\t\t\t} else if (placeholderIndex < sourceColumnIndex) {\n\t\t\t\t\t// move backward, use placeholder index as target column index\n\t\t\t\t\ttargetColumnIndex = placeholderIndex;\n\t\t\t\t} else {\n\t\t\t\t\t// move forward, use placeholder index subtract 1\n\t\t\t\t\ttargetColumnIndex = placeholderIndex - 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tcolumnDefs.data.splice(targetColumnIndex, 0, dragColumn);\n\t\t\tconst dataTableGridColumns = `0 ${columnDefs.data.map(column => `${column.width}px 0`).join(' ')} minmax(${FILLER_MIN_WIDTH}px, 1fr)`;\n\t\t\tdataTableHeader.style.gridTemplateColumns = dataTableGridColumns;\n\t\t\tdataTableBody.style.gridTemplateColumns = dataTableGridColumns;\n\t\t}\n\t\t// recover table styles\n\t\tfixTable.style.minWidth = `${columnDefs.fixed.reduce((width, column) => width + column.width, rowNoColumnWidth)}px`;\n\t\tfixTable.style.width = '';\n\t\tdataTable.style.left = '';\n\t\tdataTable.style.position = '';\n\t\tdataTable.style.width = '';\n\t\tsetPickedColumn(null);\n\t\tdragColumnVisibleChange(false);\n\t\tsetBehavior(Behavior.NONE);\n\t\tconst selection = selectionRef.current!.selection();\n\t\tselectionChange(toFixTable, selection.row, targetColumnIndex);\n\t};\n\tconst onMouseUp = (event: React.MouseEvent<HTMLDivElement>) => {\n\t\tif (behavior === Behavior.RESIZING) {\n\t\t\t// recover data table layout\n\t\t\tconst dataTable = dataTableRef.current!;\n\t\t\tdataTable.style.left = '';\n\t\t\tdataTable.style.position = '';\n\t\t\tdataTable.style.width = '';\n\t\t\t// always fire mouse up on resize shade, find resize table by state\n\t\t\tconst resizeTable = columnDefs.fixed.some(c => c === pickedColumn?.column) ? fixTableRef.current : dataTableRef.current;\n\t\t\t// clear resize data\n\t\t\tsetPickedColumn(null);\n\t\t\t// recover cursor\n\t\t\tmanageCursor({\n\t\t\t\ttable: resizeTable,\n\t\t\t\tmouseClientX: event.clientX,\n\t\t\t\tmouseClientY: event.clientY,\n\t\t\t\tavoidResize: true\n\t\t\t});\n\t\t} else if (behavior === Behavior.READY_TO_DRAG) {\n\t\t\tsetPickedColumn(null);\n\t\t\tdragColumnVisibleChange(false);\n\t\t\tsetBehavior(Behavior.PICK_COLUMN);\n\t\t} else if (behavior === Behavior.DRAGGING) {\n\t\t\treleaseDragColumn(event.clientX);\n\t\t}\n\t};\n\tconst onMouseLeave = (event: React.MouseEvent<HTMLDivElement>) => {\n\t\tif (behavior === Behavior.RESIZING) {\n\t\t\t// recover data table layout\n\t\t\tconst dataTable = dataTableRef.current!;\n\t\t\tdataTable.style.left = '';\n\t\t\tdataTable.style.position = '';\n\t\t\tdataTable.style.width = '';\n\t\t\tsetPickedColumn(null);\n\t\t\tsetBehavior(Behavior.NONE);\n\t\t} else if (behavior === Behavior.READY_TO_DRAG) {\n\t\t\tsetPickedColumn(null);\n\t\t\tdragColumnVisibleChange(false);\n\t\t\tsetBehavior(Behavior.PICK_COLUMN);\n\t\t} else if (behavior === Behavior.DRAGGING) {\n\t\t\treleaseDragColumn(event.clientX);\n\t\t}\n\t};\n\tconst onColumnFixChange = (column: FactorColumnDef, fix: boolean) => {\n\t\t// defs must be synchronized to memory immediately, otherwise selection cannot compute positions correctly\n\t\t// according to this, here change the state, and call force update manually.\n\t\tif (fix) {\n\t\t\t// move leading columns and me from data columns to fix columns\n\t\t\tconst index = columnDefs.data.indexOf(column);\n\t\t\tcolumnDefs.fixed = [ ...columnDefs.fixed, ...columnDefs.data.splice(0, index + 1) ];\n\t\t\tfixColumnChange(fix, index + 1);\n\t\t\tforceUpdate();\n\t\t} else {\n\t\t\t// move me and tailing columns from fix columns to data columns\n\t\t\tconst index = columnDefs.fixed.indexOf(column);\n\t\t\tconst count = columnDefs.fixed.length - index;\n\t\t\tcolumnDefs.data = [ ...columnDefs.fixed.splice(index), ...columnDefs.data ];\n\t\t\tfixColumnChange(fix, count);\n\t\t\tforceUpdate();\n\t\t}\n\t};\n\tconst onColumnSort = (column: FactorColumnDef, asc: boolean) => {\n\t\tconst index = column.index;\n\t\tif (asc && column.sort === ColumnSortBy.ASC) {\n\t\t\treturn;\n\t\t}\n\t\tif (!asc && column.sort === ColumnSortBy.DESC) {\n\t\t\treturn;\n\t\t}\n\n\t\tdata.data.sort((r1, r2) => {\n\t\t\tlet ret;\n\t\t\tconst v1 = r1[index];\n\t\t\tconst v2 = r2[index];\n\t\t\tif (v1 == null) {\n\t\t\t\tret = -1;\n\t\t\t} else if (v2 == null) {\n\t\t\t\tret = 1;\n\t\t\t} else if (typeof v1 === 'number' && typeof v2 === 'number') {\n\t\t\t\tret = v1 - v2;\n\t\t\t} else if (typeof v1 === 'boolean' && typeof v2 === 'boolean') {\n\t\t\t\tret = !v1 ? -1 : (!v2 ? 1 : 0);\n\t\t\t} else {\n\t\t\t\tret = `${v1}`.toUpperCase().localeCompare(`${v2}`.toUpperCase());\n\t\t\t}\n\t\t\treturn asc ? ret : ret * -1;\n\t\t});\n\t\tcolumn.sort = asc ? ColumnSortBy.ASC : ColumnSortBy.DESC;\n\t\tcolumnDefs.fixed.filter(c => c !== column).forEach(c => delete c.sort);\n\t\tcolumnDefs.data.filter(c => c !== column).forEach(c => delete c.sort);\n\t\tforceUpdate();\n\t};\n\n\treturn <Wrapper data-resize-state={behavior}\n\t                onMouseMove={onMouseMove} onMouseDown={onMouseDown} onMouseUp={onMouseUp}\n\t                onMouseLeave={onMouseLeave}\n\t                ref={wrapperRef}>\n\t\t<DataSetTable displayColumns={columnDefs.fixed}\n\t\t              isFixTable={true} rowNoColumnWidth={rowNoColumnWidth}\n\t\t              data={data}\n\t\t              onColumnFixChange={onColumnFixChange} onColumnSort={onColumnSort}\n\t\t              dragColumn={behavior === Behavior.DRAGGING ? pickedColumn?.column : (void 0)}\n\t\t              ref={fixTableRef}/>\n\t\t<DataSetTable displayColumns={columnDefs.data}\n\t\t              isFixTable={false} rowNoColumnWidth={rowNoColumnWidth}\n\t\t              data={data}\n\t\t              onColumnFixChange={onColumnFixChange} onColumnSort={onColumnSort}\n\t\t              dragColumn={behavior === Behavior.DRAGGING ? pickedColumn?.column : (void 0)}\n\t\t              ref={dataTableRef}/>\n\t\t<DataSetTableSelection data={data} columnDefs={columnDefs}\n\t\t                       rowNoColumnWidth={rowNoColumnWidth}\n\t\t                       dataTableRef={dataTableRef} ref={selectionRef}/>\n\t\t<DataSetResizeShade data-visible={behavior === Behavior.RESIZING || behavior === Behavior.DRAGGING}/>\n\t\t<DataSetTableDragColumn data={data} column={pickedColumn?.column}/>\n\t\t<DataTableScrollShade wrapperRef={wrapperRef} dataTableRef={dataTableRef}\n\t\t                      visible={behavior === Behavior.DRAGGING}/>\n\t</Wrapper>;\n};","import React, { Fragment, RefObject, useEffect, useRef } from 'react';\nimport { DataSetScrollHorizontalShade, DataSetScrollVerticalShade } from './dataset-table-components';\n\nexport const DataTableScrollShade = (props: {\n\twrapperRef: RefObject<HTMLDivElement>;\n\tdataTableRef: RefObject<HTMLDivElement>;\n\tvisible: boolean;\n}) => {\n\tconst { wrapperRef, dataTableRef, visible } = props;\n\n\tconst wrapper = wrapperRef.current;\n\tconst dataTable = dataTableRef.current;\n\n\tconst verticalScrollRef = useRef<HTMLDivElement>(null);\n\tconst horizontalScrollRef = useRef<HTMLDivElement>(null);\n\tuseEffect(() => {\n\t\tif (!visible || !dataTable || !verticalScrollRef.current || !horizontalScrollRef.current) {\n\t\t\treturn;\n\t\t}\n\t\tconst { scrollTop, scrollLeft } = dataTable;\n\t\tverticalScrollRef.current.scrollTop = scrollTop;\n\t\thorizontalScrollRef.current.scrollLeft = scrollLeft;\n\t});\n\n\tif (!wrapper || !dataTable) {\n\t\treturn null;\n\t}\n\n\tconst { left: wrapperLeft } = wrapper.getBoundingClientRect();\n\tconst { clientWidth, clientHeight, scrollWidth, scrollHeight, offsetWidth, offsetHeight } = dataTable;\n\tconst { left: horizontalScrollLeft } = dataTable.getBoundingClientRect();\n\n\treturn <Fragment>\n\t\t<DataSetScrollVerticalShade width={offsetWidth - clientWidth}\n\t\t                            heightOffset={offsetHeight - clientHeight}\n\t\t                            visible={visible}\n\t\t                            ref={verticalScrollRef}>\n\t\t\t<div style={{ width: 1, height: scrollHeight }}/>\n\t\t</DataSetScrollVerticalShade>\n\t\t<DataSetScrollHorizontalShade left={horizontalScrollLeft - wrapperLeft} height={offsetHeight - clientHeight}\n\t\t                              widthOffset={offsetWidth - clientWidth}\n\t\t                              visible={visible}\n\t\t                              ref={horizontalScrollRef}>\n\t\t\t<div style={{ width: scrollWidth, height: 1 }}/>\n\t\t</DataSetScrollHorizontalShade>\n\t\t{/* bottom left paster */}\n\t\t<div style={{\n\t\t\tdisplay: visible ? 'block' : 'none',\n\t\t\tposition: 'absolute',\n\t\t\tbottom: 0,\n\t\t\tleft: 0,\n\t\t\twidth: horizontalScrollLeft - wrapperLeft,\n\t\t\theight: offsetHeight - clientHeight,\n\t\t\tborderTop: 'var(--border)',\n\t\t\tbackgroundColor: 'var(--bg-color)'\n\t\t}}/>\n\t\t{/* bottom right paster */}\n\t\t<div style={{\n\t\t\tdisplay: visible ? 'block' : 'none',\n\t\t\tposition: 'absolute',\n\t\t\tbottom: 0,\n\t\t\tright: 0,\n\t\t\twidth: offsetWidth - clientWidth,\n\t\t\theight: offsetHeight - clientHeight,\n\t\t\tbackgroundColor: 'var(--bg-color)'\n\t\t}}/>\n\t</Fragment>;\n};","import React, {\n\tForwardedRef,\n\tforwardRef,\n\tFragment,\n\tRefObject,\n\tuseEffect,\n\tuseImperativeHandle,\n\tuseRef,\n\tuseState\n} from 'react';\nimport { DataPage } from '../../../../../services/admin/types';\nimport { ColumnSelection, HEADER_HEIGHT, ROW_HEIGHT, RowSelection } from './dataset-table-components';\nimport { useDataSetTableContext } from './dataset-table-context';\nimport { ColumnDefs, SelectionRef, TableSelection } from './types';\n\nconst computeRowSelectionPosition = (options: {\n\trowIndex: number;\n\tscrollTop: number;\n\tclientHeight: number\n}) => {\n\tconst { rowIndex } = options;\n\tif (rowIndex === -1) {\n\t\treturn { rowTop: 0, rowHeight: 0 };\n\t}\n\n\tconst { scrollTop, clientHeight } = options;\n\n\tconst top = 32 - 1;\n\tlet rowTop = rowIndex === -1 ? 0 : top + 24 * rowIndex - scrollTop;\n\tlet rowHeight = ROW_HEIGHT;\n\tif (rowTop + rowHeight <= top || rowTop > clientHeight) {\n\t\treturn { rowTop: 0, rowHeight: 0 };\n\t}\n\tif (rowTop < top) {\n\t\trowHeight -= top - rowTop;\n\t\trowHeight = Math.max(0, rowHeight);\n\t\trowTop = top;\n\t}\n\tif (rowTop + rowHeight > clientHeight) {\n\t\trowHeight = clientHeight - rowTop;\n\t}\n\treturn { rowTop, rowHeight };\n};\n\nconst computeColumnSelectionPosition = (options: {\n\tinFixTable: boolean;\n\tcolumnIndex: number;\n\tscrollLeft: number;\n\tdataTableClientWidth: number;\n\tverticalScroll: boolean;\n\tdata: DataPage<Array<any>>;\n\tcolumnDefs: ColumnDefs;\n\trowNoColumnWidth: number;\n}) => {\n\tconst { columnIndex } = options;\n\tif (columnIndex === -1) {\n\t\treturn { columnLeft: 0, columnWidth: 0, columnHeight: 0 };\n\t}\n\n\tconst {\n\t\tinFixTable,\n\t\tscrollLeft,\n\t\tdataTableClientWidth,\n\t\tverticalScroll,\n\t\tdata,\n\t\tcolumnDefs,\n\t\trowNoColumnWidth\n\t} = options;\n\n\tconst selectColumnDef = inFixTable ? columnDefs.fixed[columnIndex] : columnDefs.data[columnIndex];\n\tconst selectColumnWidth = selectColumnDef?.width || 0;\n\t// compute left in my table, total width of previous columns\n\tconst selectColumnLeft = (inFixTable ? columnDefs.fixed : columnDefs.data).reduce((left, columnDef, index) => {\n\t\tif (index < columnIndex) {\n\t\t\tleft += columnDef.width;\n\t\t}\n\t\treturn left;\n\t}, 0);\n\n\tlet columnWidth = selectColumnWidth;\n\tlet columnLeft;\n\tconst fixTableWidth = columnDefs.fixed.reduce((left, column) => left + column.width, rowNoColumnWidth);\n\tconst totalWidth = fixTableWidth + dataTableClientWidth;\n\tif (inFixTable) {\n\t\tcolumnLeft = selectColumnLeft + rowNoColumnWidth;\n\t} else {\n\t\tcolumnLeft = fixTableWidth + selectColumnLeft - scrollLeft;\n\t\tif (columnLeft + columnWidth <= fixTableWidth || columnLeft >= totalWidth) {\n\t\t\t// column is hide in fix table\n\t\t\t// or column is beyond total width\n\t\t\treturn { columnLeft: 0, columnWidth: 0, columnHeight: 0 };\n\t\t}\n\t\tif (columnLeft < fixTableWidth) {\n\t\t\tcolumnWidth -= fixTableWidth - columnLeft;\n\t\t\tcolumnWidth = Math.max(0, columnWidth);\n\t\t\tcolumnLeft = fixTableWidth;\n\t\t}\n\t}\n\tif (columnWidth + columnLeft > totalWidth) {\n\t\tcolumnWidth = totalWidth - columnLeft;\n\t}\n\treturn {\n\t\tcolumnLeft,\n\t\tcolumnWidth,\n\t\tcolumnHeight: verticalScroll ? 0 : data.data.length * ROW_HEIGHT + HEADER_HEIGHT\n\t};\n};\n\nconst buildDefaultSelection = () => ({\n\trow: -1,\n\trowTop: 0,\n\trowHeight: 0,\n\tcolumn: -1,\n\tcolumnLeft: 0,\n\tcolumnWidth: 0,\n\tcolumnHeight: 0,\n\tinFixTable: false,\n\tverticalScroll: 0,\n\thorizontalScroll: 0\n});\n\nconst useSelection = (options: {\n\tdata: DataPage<Array<any>>;\n\tcolumnDefs: ColumnDefs;\n\tdataTableRef: RefObject<HTMLDivElement>;\n\trowNoColumnWidth: number;\n\trowSelectionRef: RefObject<HTMLDivElement>;\n\tcolumnSelectionRef: RefObject<HTMLDivElement>;\n}) => {\n\tconst {\n\t\tdata, columnDefs, rowNoColumnWidth,\n\t\tdataTableRef, rowSelectionRef, columnSelectionRef\n\t} = options;\n\n\tconst { addRepaintSelectionHandler, removeRepaintSelectionHandler } = useDataSetTableContext();\n\tconst [ selection, setSelection ] = useState<TableSelection>(buildDefaultSelection());\n\tconst select = (inFixTable: boolean, rowIndex: number, columnIndex: number) => {\n\t\tif (!dataTableRef.current) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst dataTable = dataTableRef.current;\n\t\tconst { offsetWidth, offsetHeight, clientWidth, clientHeight, scrollTop, scrollLeft } = dataTable;\n\t\tconst scroll = {\n\t\t\tverticalScroll: offsetWidth - clientWidth,\n\t\t\thorizontalScroll: offsetHeight - clientHeight\n\t\t};\n\n\t\tconst rowPos = computeRowSelectionPosition({ rowIndex, scrollTop, clientHeight });\n\t\tconst colPos = computeColumnSelectionPosition({\n\t\t\tinFixTable,\n\t\t\tcolumnIndex,\n\t\t\tscrollLeft,\n\t\t\tdataTableClientWidth: clientWidth,\n\t\t\tverticalScroll: offsetWidth !== clientWidth,\n\t\t\tdata,\n\t\t\tcolumnDefs,\n\t\t\trowNoColumnWidth\n\t\t});\n\n\t\tsetSelection({\n\t\t\trow: rowIndex,\n\t\t\t...rowPos,\n\t\t\tcolumn: columnIndex,\n\t\t\t...colPos,\n\t\t\tinFixTable,\n\t\t\t...scroll\n\t\t});\n\t};\n\n\tuseEffect(() => {\n\t\t// compute and set new positions of row and column selection here.\n\t\t// in case of handle scroll, transition is not needed; in the meantime, refresh by state change is not as fast as hoped.\n\t\t// therefore, use plain javascript to clear transition css and set positions.\n\t\t// and synchronize selection state after a short time (setTimeout on several milliseconds), and remove the transition clearing.\n\t\t// selection state synchronization is required, otherwise cannot response click cell/row header/column header correctly.\n\t\tconst repaintSelection = () => {\n\t\t\tif (!dataTableRef.current) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst dataTable = dataTableRef.current;\n\n\t\t\tlet {\n\t\t\t\tinFixTable,\n\t\t\t\trow: rowIndex,\n\t\t\t\tcolumn: columnIndex,\n\t\t\t\trowTop,\n\t\t\t\trowHeight,\n\t\t\t\tcolumnLeft,\n\t\t\t\tcolumnWidth\n\t\t\t} = selection;\n\n\t\t\tif (rowIndex !== -1 && rowSelectionRef.current) {\n\t\t\t\tconst { scrollTop, clientHeight } = dataTable;\n\t\t\t\tconst { rowTop: top, rowHeight: height } = computeRowSelectionPosition({\n\t\t\t\t\trowIndex,\n\t\t\t\t\tscrollTop,\n\t\t\t\t\tclientHeight\n\t\t\t\t});\n\t\t\t\tconst bar = rowSelectionRef.current;\n\t\t\t\tbar.style.transition = 'none';\n\t\t\t\tbar.style.top = `${top}px`;\n\t\t\t\tbar.style.height = `${height}px`;\n\t\t\t\trowTop = top;\n\t\t\t\trowHeight = height;\n\t\t\t}\n\t\t\tif (columnIndex !== -1 && columnSelectionRef.current) {\n\t\t\t\tconst { scrollLeft, clientWidth: dataTableClientWidth, offsetHeight, clientHeight } = dataTable;\n\t\t\t\tconst { columnLeft: left, columnWidth: width } = computeColumnSelectionPosition({\n\t\t\t\t\tinFixTable,\n\t\t\t\t\tcolumnIndex,\n\t\t\t\t\tscrollLeft,\n\t\t\t\t\tdataTableClientWidth,\n\t\t\t\t\tverticalScroll: offsetHeight !== clientHeight,\n\t\t\t\t\tdata,\n\t\t\t\t\tcolumnDefs,\n\t\t\t\t\trowNoColumnWidth\n\t\t\t\t});\n\t\t\t\tconst bar = columnSelectionRef.current;\n\t\t\t\tbar.style.transition = 'none';\n\t\t\t\tbar.style.left = `${left}px`;\n\t\t\t\tbar.style.width = `${width}px`;\n\t\t\t\tcolumnLeft = left;\n\t\t\t\tcolumnWidth = width;\n\t\t\t}\n\t\t\tif (rowIndex !== -1 || columnIndex !== -1) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tsetSelection({ ...selection, rowTop, rowHeight, columnLeft, columnWidth });\n\t\t\t\t\trowSelectionRef.current && (rowSelectionRef.current.style.transition = '');\n\t\t\t\t\tcolumnSelectionRef.current && (columnSelectionRef.current.style.transition = '');\n\t\t\t\t}, 5);\n\t\t\t}\n\t\t};\n\t\tconst dataTable = dataTableRef.current;\n\t\tdataTable?.addEventListener('scroll', repaintSelection);\n\t\taddRepaintSelectionHandler(repaintSelection);\n\t\treturn () => {\n\t\t\tdataTable?.removeEventListener('scroll', repaintSelection);\n\t\t\tremoveRepaintSelectionHandler(repaintSelection);\n\t\t};\n\t});\n\n\treturn { selection, select };\n};\n\nexport const DataSetTableSelection = forwardRef((props: {\n\tdata: DataPage<Array<any>>;\n\tcolumnDefs: ColumnDefs;\n\tdataTableRef: RefObject<HTMLDivElement>;\n\trowNoColumnWidth: number;\n}, ref: ForwardedRef<SelectionRef>) => {\n\tconst {\n\t\tdata, columnDefs, dataTableRef,\n\t\trowNoColumnWidth\n\t} = props;\n\n\tconst {\n\t\taddSelectionChangeListener, removeSelectionChangeListener,\n\t\taddFixColumnChangeListener, removeFixColumnChangeListener\n\t} = useDataSetTableContext();\n\tconst rowSelectionRef = useRef<HTMLDivElement>(null);\n\tconst columnSelectionRef = useRef<HTMLDivElement>(null);\n\tconst { selection, select } = useSelection({\n\t\tdata,\n\t\tcolumnDefs,\n\t\trowNoColumnWidth,\n\t\tdataTableRef,\n\t\trowSelectionRef,\n\t\tcolumnSelectionRef\n\t});\n\tuseImperativeHandle(ref, () => ({ selection: () => selection }));\n\tuseEffect(() => {\n\t\tconst onFixColumnChange = (fix: boolean, columnCount: number) => {\n\t\t\tconst { column: selectionColumnIndex, inFixTable } = selection;\n\t\t\tif (selectionColumnIndex === -1) {\n\t\t\t\t// no selection column\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (inFixTable) {\n\t\t\t\t// current selection column in fix table\n\t\t\t\tif (fix) {\n\t\t\t\t\t// append columns to fix table, do nothing\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\t// move columns from fix table to data table\n\t\t\t\t\tif (selectionColumnIndex < columnDefs.fixed.length) {\n\t\t\t\t\t\t// selection column still in fix table, do nothing\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// selection column move to data table\n\t\t\t\t\t\tselect(false, selection.row, selectionColumnIndex - columnDefs.fixed.length);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// current selection column in data table\n\t\t\t\tif (fix) {\n\t\t\t\t\t// move columns from data table to fix table\n\t\t\t\t\tif (selectionColumnIndex >= columnCount) {\n\t\t\t\t\t\t// selection column remains in data table\n\t\t\t\t\t\tselect(false, selection.row, selectionColumnIndex - columnCount);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// selection column moves to fix table\n\t\t\t\t\t\t// index starts from original fix columns count\n\t\t\t\t\t\tselect(true, selection.row, columnDefs.fixed.length - columnCount + selectionColumnIndex);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// move columns from fix table to data table\n\t\t\t\t\t// index always be increased, because of columns prepended\n\t\t\t\t\tselect(false, selection.row, selectionColumnIndex + columnCount);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\taddSelectionChangeListener(select);\n\t\taddFixColumnChangeListener(onFixColumnChange);\n\t\treturn () => {\n\t\t\tremoveSelectionChangeListener(select);\n\t\t\tremoveFixColumnChangeListener(onFixColumnChange);\n\t\t};\n\t});\n\n\treturn <Fragment>\n\t\t<RowSelection index={selection.row}\n\t\t              top={selection.rowTop} height={selection.rowHeight}\n\t\t              scroll={selection.verticalScroll}\n\t\t              ref={rowSelectionRef}/>\n\t\t<ColumnSelection index={selection.column}\n\t\t                 left={selection.columnLeft} width={selection.columnWidth} height={selection.columnHeight}\n\t\t                 scroll={selection.horizontalScroll}\n\t\t                 ref={columnSelectionRef}/>\n\t</Fragment>;\n});","import {\n\tColumnExpressionOperator,\n\tConsoleSpaceSubjectDataSetColumn,\n\tConsoleTopic\n} from '../../../../../services/console/types';\nimport { DEFAULT_COLUMN_WIDTH } from './dataset-table-components';\nimport { FactorColumnDef, FactorMap } from './types';\n\nexport const filterColumns = (options: {\n\tcolumns: Array<ConsoleSpaceSubjectDataSetColumn>;\n\tfactorMap: FactorMap;\n}) => {\n\tconst { columns, factorMap } = options;\n\n\treturn columns.map((column, columnIndex) => {\n\t\tconst { factorId } = column;\n\t\tif (!factorId) {\n\t\t\t// ignore definition which doesn't include factor\n\t\t\treturn null;\n\t\t}\n\n\t\tconst { topic, factor } = factorMap.get(factorId) || {};\n\t\tif (!topic || !factor) {\n\t\t\t// ignore factor which cannot find definition\n\t\t\treturn null;\n\t\t}\n\n\t\tconst { operator } = column;\n\t\tif (!!operator && operator !== ColumnExpressionOperator.NONE) {\n\t\t\t// a computed column\n\t\t\tconst { secondaryFactorId } = column;\n\t\t\tif (!secondaryFactorId) {\n\t\t\t\t// ignore definition which doesn't include secondary factor\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst { topic: secondaryTopic, factor: secondaryFactor } = factorMap.get(secondaryFactorId) || {};\n\t\t\tif (!secondaryTopic || !secondaryFactor) {\n\t\t\t\t// ignore factor which cannot find definition\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t// initial width is 200 pixels\n\t\t\treturn {\n\t\t\t\ttopic, factor, secondaryTopic, secondaryFactor,\n\t\t\t\tfixed: false,\n\t\t\t\twidth: DEFAULT_COLUMN_WIDTH, index: columnIndex,\n\t\t\t\talias: column.alias\n\t\t\t};\n\t\t} else {\n\t\t\t// initial width is 200 pixels\n\t\t\treturn {\n\t\t\t\ttopic, factor,\n\t\t\t\tfixed: false,\n\t\t\t\twidth: DEFAULT_COLUMN_WIDTH, index: columnIndex,\n\t\t\t\talias: column.alias\n\t\t\t};\n\t\t}\n\t}).filter(x => x) as Array<FactorColumnDef>;\n};\n\nexport const buildFactorMap = (topics: Array<ConsoleTopic>): FactorMap => {\n\treturn topics.reduce((map, topic) => {\n\t\ttopic.factors.forEach(factor => {\n\t\t\tmap.set(factor.factorId, { topic, factor });\n\t\t});\n\t\treturn map;\n\t}, new Map());\n};\n","import {faSpinner} from '@fortawesome/free-solid-svg-icons';\nimport {FontAwesomeIcon} from '@fortawesome/react-fontawesome';\nimport React, {useEffect, useState} from 'react';\nimport styled from 'styled-components';\nimport {DataPage} from '../../../../../services/admin/types';\nimport {fetchSubjectData} from '../../../../../services/console/space';\nimport {ConnectedConsoleSpace, ConsoleSpaceSubject} from '../../../../../services/console/types';\nimport {DataSetHeader} from './dataset-header';\nimport {DataSetTableContextProvider} from './dataset-table-context';\nimport {DataSetTableWrapper} from './dataset-table-wrapper';\nimport {ColumnDefs} from './types';\nimport {buildFactorMap, filterColumns} from './utils';\n\nconst DataSetContainer = styled.div.attrs({\n\t'data-widget': 'console-subject-view-dataset'\n})`\n\talign-self: flex-end;\n\tdisplay: flex;\n\tposition: absolute;\n\tflex-direction: column;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n\tbackground-color: var(--bg-color);\n\ttransition: top 300ms ease-in-out, height 300ms ease-in-out, opacity 300ms ease-in-out;\n\toverflow: hidden;\n\t&[data-visible=false] {\n\t\topacity: 0;\n\t\ttop: 100%;\n\t\theight: 0;\n\t\tpointer-events: none;\n\t}\n`;\nconst DataSetNoDef = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tposition: absolute;\n\ttop: 40px;\n\tleft: 0;\n\theight: calc(100% - 40px);\n\twidth: 100%;\n\tfont-family: var(--console-title-font-family);\n\tfont-size: 1.4em;\n\t> span > span {\n\t\ttext-decoration: underline;\n\t\tcursor: pointer;\n\t}\n`;\nconst DataSetLoading = styled.div`\n\tdisplay: none;\n\talign-items: center;\n\tjustify-content: center;\n\tposition: absolute;\n\ttop: 40px;\n\tleft: 0;\n\theight: calc(100% - 40px);\n\twidth: 100%;\n\tfont-size: 1.4em;\n\tz-index: 1;\n\t&[data-visible=true] {\n\t\tdisplay: flex;\n\t}\n\t&:before {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tbackground-color: var(--invert-color);\n\t\topacity: 0.3;\n\t}\n\t> svg {\n\t\tfont-size: 5em;\n\t\topacity: 0.3;\n\t}\n`;\n\nexport const DataSet = (props: {\n\tspace: ConnectedConsoleSpace;\n\tsubject: ConsoleSpaceSubject;\n\tvisible: boolean\n\tonVisibleChanged: (visible: boolean) => void;\n\tswitchToDefinition: () => void;\n}) => {\n\tconst {\n\t\tspace, subject,\n\t\tvisible, onVisibleChanged, switchToDefinition\n\t} = props;\n\n\tconst { dataset = {} } = subject;\n\tconst { columns = [] } = dataset;\n\n\tconst [ loading, setLoading ] = useState(false);\n\tconst [ data, setData ] = useState<DataPage<Array<any>>>({\n\t\titemCount: 0,\n\t\tpageNumber: 1,\n\t\tpageSize: 1,\n\t\tpageCount: 1,\n\t\tdata: []\n\t});\n\n\tconst fetchData = (pageNumber: number = 1) => {\n\t\t(async () => {\n\t\t\ttry {\n\t\t\t\tsetLoading(true);\n\t\t\t\tconst data = await fetchSubjectData({ subjectId: subject.subjectId, pageNumber, pageSize: 100 });\n\t\t\t\tsetData(data);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.groupCollapsed(`%cError on fetch subject data.`, 'color:rgb(251,71,71)');\n\t\t\t\tconsole.error(e);\n\t\t\t\tconsole.groupEnd();\n\t\t\t} finally {\n\t\t\t\tsetLoading(false);\n\t\t\t}\n\t\t})();\n\t};\n\tconst [ columnDefs, setColumnDefs ] = useState<ColumnDefs>(() => {\n\t\treturn {\n\t\t\tfixed: [],\n\t\t\tdata: filterColumns({ columns: subject.dataset?.columns || [], factorMap: buildFactorMap(space.topics) })\n\t\t};\n\t});\n\n\t// fetch data\n\tuseEffect(() => {\n\t\tif (!visible) {\n\t\t\treturn;\n\t\t}\n\t\t// rebuild columns in case of definition was changed\n\t\tsetColumnDefs({\n\t\t\tfixed: [],\n\t\t\tdata: filterColumns({ columns: subject.dataset?.columns || [], factorMap: buildFactorMap(space.topics) })\n\t\t});\n\t\tfetchData();\n\t\t// eslint-disable-next-line\n\t}, [ visible ]);\n\n\tconst onToDefClicked = () => switchToDefinition();\n\n\tconst hasColumns = columns.length !== 0;\n\n\treturn <DataSetTableContextProvider>\n\t\t<DataSetContainer data-visible={visible}>\n\t\t\t<DataSetHeader subject={subject} data={data}\n\t\t\t               columnDefs={columnDefs}\n\t\t\t               onHide={() => onVisibleChanged(false)}\n\t\t\t               fetchData={fetchData}/>\n\t\t\t{hasColumns\n\t\t\t\t? <DataSetTableWrapper space={space} subject={subject}\n\t\t\t\t                       columnDefs={columnDefs}\n\t\t\t\t                       data={data}/>\n\t\t\t\t: <DataSetNoDef>\n\t\t\t\t\t<span>No column defined yet, switch to <span onClick={onToDefClicked}>definition</span>?</span>\n\t\t\t\t</DataSetNoDef>}\n\t\t\t<DataSetLoading data-visible={loading}>\n\t\t\t\t<FontAwesomeIcon icon={faSpinner} spin={true}/>\n\t\t\t</DataSetLoading>\n\t\t</DataSetContainer>\n\t</DataSetTableContextProvider>;\n};","import React from 'react';\nimport styled from 'styled-components';\nimport {\n\tConsoleSpaceSubjectDataSetColumn,\n\tConsoleSpaceSubjectDataSetJoin\n} from '../../../../../services/console/types';\nimport Dropdown, { DropdownOption } from '../../../../component/dropdown';\nimport { useSubjectContext } from '../context';\n\nconst ColumnFactorContainer = styled.div`\n\tbackground-color: var(--console-subject-topic-bg-color);\n\tflex-grow: 1;\n\tflex-basis: 0;\n\t//max-width: calc(50% - 15px);\n\t> div,\n\t> div[data-widget=dropdown]:focus {\n\t\tfont-size: 0.8em;\n\t\tborder-radius: 0;\n\t\tmargin-left: -1px;\n\t\twidth: calc(100% + 1px);\n\t}\n`;\n\nexport const ColumnFactor = (props: {\n\tcolumn: ConsoleSpaceSubjectDataSetColumn | ConsoleSpaceSubjectDataSetJoin;\n\tonFactorChanged: () => void;\n\tpropNames: [ 'topicId', 'factorId' ] | [ 'secondaryTopicId', 'secondaryFactorId' ]\n}) => {\n\tconst { column, onFactorChanged, propNames: [ topicPropName, factorPropName ] } = props;\n\n\tconst topicId = column[topicPropName];\n\tconst factorId = column[factorPropName];\n\n\tconst { defs: { factors: factorOptions } } = useSubjectContext();\n\n\tconst onColumnFactorChanged = async ({ value }: DropdownOption) => {\n\t\tcolumn[factorPropName] = value as string;\n\t\tonFactorChanged();\n\t};\n\n\treturn <ColumnFactorContainer>\n\t\t<Dropdown options={factorOptions[topicId || ''] || []}\n\t\t          value={factorId} onChange={onColumnFactorChanged}/>\n\t</ColumnFactorContainer>;\n};","import React from 'react';\nimport styled from 'styled-components';\nimport {\n\tConsoleSpaceSubjectDataSetColumn,\n\tConsoleSpaceSubjectDataSetJoin\n} from '../../../../../services/console/types';\nimport Dropdown, { DropdownOption } from '../../../../component/dropdown';\nimport { useSubjectContext } from '../context';\n\nconst ColumnTopicContainer = styled.div`\n\tbackground-color: var(--console-subject-topic-bg-color);\n\tflex-grow: 1;\n\tflex-basis: 0;\n\toverflow: hidden;\n\t//max-width: calc(50% - 16px);\n\t&:first-child {\n\t\tborder-top-left-radius: var(--border-radius);\n\t\tborder-bottom-left-radius: var(--border-radius);\n\t}\n\t&:not(:first-child) > div[data-widget=dropdown] {\n\t\tborder-top-left-radius: 0;\n\t\tborder-bottom-left-radius: 0;\n\t\tmargin-left: -1px;\n\t\twidth: calc(100% + 1px);\n\t}\n\t> div,\n\t> div[data-widget=dropdown]:focus {\n\t\tfont-size: 0.8em;\n\t\tborder-top-right-radius: 0;\n\t\tborder-bottom-right-radius: 0;\n\t}\n`;\n\nexport const ColumnTopic = (props: {\n\tcolumn: ConsoleSpaceSubjectDataSetColumn | ConsoleSpaceSubjectDataSetJoin;\n\tonTopicChanged: () => void;\n\tpropNames: [ 'topicId', 'factorId' ] | [ 'secondaryTopicId', 'secondaryFactorId' ];\n}) => {\n\tconst { column, onTopicChanged, propNames: [ topicPropName, factorPropName ] } = props;\n\n\tconst { defs: { topics: topicOptions } } = useSubjectContext();\n\n\tconst onColumnTopicChanged = async ({ value }: DropdownOption) => {\n\t\tconst originTopicId = column[topicPropName];\n\t\tcolumn[topicPropName] = value as string;\n\t\t// eslint-disable-next-line\n\t\tif (originTopicId != column[topicPropName]) {\n\t\t\tdelete column[factorPropName];\n\t\t\tonTopicChanged();\n\t\t}\n\t};\n\n\treturn <ColumnTopicContainer>\n\t\t<Dropdown options={topicOptions} please='Topic?'\n\t\t          value={column[topicPropName]} onChange={onColumnTopicChanged}/>\n\t</ColumnTopicContainer>;\n};","import { faTimes } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React from 'react';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../../../common/utils';\nimport { ColumnExpressionOperator, ConsoleSpaceSubjectDataSetColumn } from '../../../../../services/console/types';\nimport { LinkButton } from '../../../../component/console/link-button';\nimport Dropdown, { DropdownOption } from '../../../../component/dropdown';\nimport Input from '../../../../component/input';\nimport { ColumnFactor } from './column-factor';\nimport { ColumnTopic } from './column-topic';\n\nconst ColumnRowContainer = styled.div.attrs({\n\t'data-widget': 'console-subject-view-column-row'\n})`\n\tdisplay: flex;\n\tpadding: 0 calc(var(--margin) / 2);\n\tmargin-top: calc(var(--margin) / 4);\n\t&:last-child {\n\t\tmargin-bottom: calc(var(--margin) / 4);\n\t}\n\t&[data-show-factor=false] {\n\t\t> div:nth-child(2),\n\t\t> div:nth-child(2) > div[data-widget=dropdown] {\n\t\t\tflex-grow: 0;\n\t\t\twidth: 0;\n\t\t\tborder: 0;\n\t\t\tpadding: 0;\n\t\t}\n\t}\n\t&[data-show-factor=true] {\n\t\t> div:nth-child(2) {\n\t\t\tflex-grow: 1;\n\t\t}\n\t}\n\t&[data-show-secondary-topic=false] {\n\t\t> div:nth-child(4),\n\t\t> div:nth-child(4) > div[data-widget=dropdown],\n\t\t> div:nth-child(5),\n\t\t> div:nth-child(5) > div[data-widget=dropdown] {\n\t\t\tflex-grow: 0;\n\t\t\twidth: 0;\n\t\t\tborder: 0;\n\t\t\tpadding: 0;\n\t\t}\n\t}\n\t&[data-show-secondary-topic=true] {\n\t\t> div:nth-child(4) {\n\t\t\tflex-grow: 1;\n\t\t}\n\t}\n\t&[data-show-secondary-factor=false] {\n\t\t> div:nth-child(5),\n\t\t> div:nth-child(5) > div[data-widget=dropdown] {\n\t\t\tflex-grow: 0;\n\t\t\twidth: 0;\n\t\t\tborder: 0;\n\t\t\tpadding: 0;\n\t\t}\n\t}\n\t&[data-show-secondary-factor=true] {\n\t\t> div:nth-child(5) {\n\t\t\tflex-grow: 1;\n\t\t}\n\t}\n\t> div[data-widget=dropdown] {\n\t\tfont-size: 0.8em;\n\t\tflex-grow: 0;\n\t\tborder-radius: 0;\n\t\tborder-left-color: transparent;\n\t\tmargin-left: -1px;\n\t\tmax-width: 100px;\n\t}\n\t> input {\n\t\tborder-radius: 0;\n\t\tborder-left-color: transparent;\n\t\tmargin-left: -1px;\n\t\tfont-size: 0.8em;\n\t}\n\t> button {\n\t\tmin-width: 32px;\n\t\tborder: var(--border);\n\t\tborder-left-color: transparent;\n\t\tborder-top-right-radius: var(--border-radius);\n\t\tborder-bottom-right-radius: var(--border-radius);\n\t\tmargin-left: -1px;\n\t\t&:hover:before {\n\t\t\tborder-top-left-radius: 0;\n\t\t\tborder-bottom-left-radius: 0;\n\t\t}\n\t}\n`;\n\nconst ExpressionOperators = [\n\t{ value: ColumnExpressionOperator.NONE, label: 'As is' },\n\t{ value: ColumnExpressionOperator.ADD, label: 'Add' },\n\t{ value: ColumnExpressionOperator.SUBTRACT, label: 'Subtract' },\n\t{ value: ColumnExpressionOperator.MULTIPLY, label: 'Multiply' },\n\t{ value: ColumnExpressionOperator.DIVIDE, label: 'Divide' },\n\t{ value: ColumnExpressionOperator.MODULUS, label: 'Modulus' }\n];\n\nexport const Column = (props: {\n\tcolumn: ConsoleSpaceSubjectDataSetColumn;\n\tremoveColumn: (column: ConsoleSpaceSubjectDataSetColumn) => void;\n}) => {\n\tconst { column, removeColumn } = props;\n\n\tconst forceUpdate = useForceUpdate();\n\n\tconst onOperatorChanged = async (option: DropdownOption) => {\n\t\tcolumn.operator = option.value as ColumnExpressionOperator;\n\t\tforceUpdate();\n\t};\n\tconst onAliasChanged = (event: React.ChangeEvent<HTMLInputElement>) => {\n\t\tcolumn.alias = event.target.value;\n\t\tforceUpdate();\n\t};\n\tconst onColumnRemoveClicked = () => removeColumn(column);\n\n\tconst showFactor = !!column.topicId;\n\n\tconst showSecondTopic = !!column.operator && column.operator !== ColumnExpressionOperator.NONE;\n\tconst showSecondFactor = showSecondTopic && !!column.secondaryTopicId;\n\n\treturn <ColumnRowContainer data-show-factor={showFactor}\n\t                           data-show-secondary-topic={showSecondTopic}\n\t                           data-show-secondary-factor={showSecondFactor}>\n\t\t<ColumnTopic column={column} propNames={[ 'topicId', 'factorId' ]}\n\t\t             onTopicChanged={forceUpdate}/>\n\t\t<ColumnFactor column={column} propNames={[ 'topicId', 'factorId' ]}\n\t\t              onFactorChanged={forceUpdate}/>\n\t\t<Dropdown value={column.operator || ColumnExpressionOperator.NONE} options={ExpressionOperators}\n\t\t          onChange={onOperatorChanged}/>\n\t\t<ColumnTopic column={column} propNames={[ 'secondaryTopicId', 'secondaryFactorId' ]}\n\t\t             onTopicChanged={forceUpdate}/>\n\t\t<ColumnFactor column={column} propNames={[ 'secondaryTopicId', 'secondaryFactorId' ]}\n\t\t              onFactorChanged={forceUpdate}/>\n\t\t<Input placeholder='Alias'\n\t\t       value={column.alias || ''} onChange={onAliasChanged}/>\n\t\t<LinkButton onClick={onColumnRemoveClicked} ignoreHorizontalPadding={true}\n\t\t            tooltip={'Remove Column'} center={true}>\n\t\t\t<FontAwesomeIcon icon={faTimes}/>\n\t\t</LinkButton>\n\t</ColumnRowContainer>;\n};\n","import { faCompressAlt, faExpandAlt, faPlus, faSortAlphaDown } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { Fragment } from 'react';\nimport { useForceUpdate } from '../../../../../common/utils';\nimport {\n\tConnectedConsoleSpace,\n\tConsoleSpaceSubject,\n\tConsoleSpaceSubjectDataSetColumn\n} from '../../../../../services/console/types';\nimport { LinkButton } from '../../../../component/console/link-button';\nimport { SubjectPanelBody, SubjectPanelBodyWrapper, SubjectPanelHeader } from '../components';\nimport { useSubjectContext } from '../context';\nimport { Column } from './column';\n\nexport const SubjectColumns = (props: {\n\tspace: ConnectedConsoleSpace;\n\tsubject: ConsoleSpaceSubject;\n\tcollapsed: boolean;\n\tonCollapsedChanged: (collapsed: boolean) => void;\n}) => {\n\tconst {\n\t\tsubject,\n\t\tcollapsed, onCollapsedChanged\n\t} = props;\n\n\tconst { dataset = {} } = subject;\n\tconst { columns = [] } = dataset;\n\n\tconst { defs: { space: spaceDef } } = useSubjectContext();\n\tconst forceUpdate = useForceUpdate();\n\n\tconst onSortClicked = () => {\n\t\tcolumns.sort((c1, c2) => {\n\t\t\tif (!c1.topicId) {\n\t\t\t\treturn !c2.topicId ? 0 : 1;\n\t\t\t} else if (!c2.topicId) {\n\t\t\t\treturn -1;\n\t\t\t\t// eslint-disable-next-line\n\t\t\t} else if (c1.topicId == c2.topicId) {\n\t\t\t\tif (!c1.factorId) {\n\t\t\t\t\treturn !c2.factorId ? 0 : 1;\n\t\t\t\t} else if (!c2.factorId) {\n\t\t\t\t\treturn -1;\n\t\t\t\t\t// eslint-disable-next-line\n\t\t\t\t} else if (c1.factorId == c2.factorId) {\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\t\t\t\t// eslint-disable-next-line\n\t\t\t\tconst topic = spaceDef.topics.find(t => t.topicId == c1.topicId)!;\n\t\t\t\t// eslint-disable-next-line\n\t\t\t\tconst factor1 = topic.factors.find(f => f.factorId == c1.factorId)!;\n\t\t\t\t// eslint-disable-next-line\n\t\t\t\tconst factor2 = topic.factors.find(f => f.factorId == c2.factorId)!;\n\t\t\t\treturn factor1.label.toUpperCase().localeCompare(factor2.label.toUpperCase());\n\t\t\t} else {\n\t\t\t\t// eslint-disable-next-line\n\t\t\t\tconst topic1 = spaceDef.topics.find(t => t.topicId == c1.topicId)!;\n\t\t\t\t// eslint-disable-next-line\n\t\t\t\tconst topic2 = spaceDef.topics.find(t => t.topicId == c2.topicId)!;\n\t\t\t\treturn topic1.name.toUpperCase().localeCompare(topic2.name.toUpperCase());\n\t\t\t}\n\t\t});\n\t\tforceUpdate();\n\t};\n\tconst onAddColumnClicked = () => {\n\t\tconst column = {};\n\t\tcolumns.push(column);\n\t\tonCollapsedChanged(false);\n\t\tforceUpdate();\n\t};\n\tconst onRemoveColumn = (column: ConsoleSpaceSubjectDataSetColumn) => {\n\t\tconst index = columns.indexOf(column);\n\t\tcolumns.splice(index, 1);\n\t\tforceUpdate();\n\t};\n\n\treturn <Fragment>\n\t\t<SubjectPanelHeader>\n\t\t\t<div>\n\t\t\t\t<span>Columns</span>\n\t\t\t\t<span>{columns.length}</span>\n\t\t\t</div>\n\t\t\t<LinkButton onClick={onAddColumnClicked} ignoreHorizontalPadding={true}\n\t\t\t            tooltip='Add Column' center={true}>\n\t\t\t\t<FontAwesomeIcon icon={faPlus}/>\n\t\t\t</LinkButton>\n\t\t\t<LinkButton onClick={onSortClicked} ignoreHorizontalPadding={true}\n\t\t\t            tooltip='Sort' center={true}>\n\t\t\t\t<FontAwesomeIcon icon={faSortAlphaDown}/>\n\t\t\t</LinkButton>\n\t\t\t<LinkButton onClick={() => onCollapsedChanged(!collapsed)} ignoreHorizontalPadding={true}\n\t\t\t            tooltip={`${collapsed ? 'Expand' : 'Collapse'} Columns Definition`} center={true}>\n\t\t\t\t<FontAwesomeIcon icon={collapsed ? faExpandAlt : faCompressAlt}/>\n\t\t\t</LinkButton>\n\t\t</SubjectPanelHeader>\n\t\t<SubjectPanelBody data-visible={!collapsed}>\n\t\t\t<SubjectPanelBodyWrapper>\n\t\t\t\t{columns.map((column, index) => {\n\t\t\t\t\tconst { topicId, factorId } = column;\n\t\t\t\t\treturn <Column key={`${topicId}-${factorId}-${index}`}\n\t\t\t\t\t               column={column}\n\t\t\t\t\t               removeColumn={onRemoveColumn}/>;\n\t\t\t\t})}\n\t\t\t</SubjectPanelBodyWrapper>\n\t\t</SubjectPanelBody>\n\t</Fragment>;\n};","import React from 'react';\nimport styled from 'styled-components';\nimport {\n\tConsoleSpaceSubjectDataSetFilterExpression,\n\tConsoleTopicFactorType,\n\tFilterExpressionOperator as ExpressionOperator\n} from '../../../../../services/console/types';\nimport Dropdown, { DropdownOption } from '../../../../component/dropdown';\nimport { useSubjectContext } from '../context';\n\nconst ExpressionFactor = styled.div`\n\tbackground-color: var(--console-subject-topic-bg-color);\n\tmin-width: 0;\n\tflex-grow: 0;\n\tflex-basis: 0;\n\toverflow-x: hidden;\n\ttransition: all 300ms ease-in-out;\n\t&[data-visible=true] {\n\t\tmin-width: 150px;\n\t}\n\t&[data-grow=true] {\n\t\tflex-grow: 1;\n\t}\n\t> div,\n\t> div[data-widget=dropdown]:focus {\n\t\tfont-size: 0.8em;\n\t\tborder-radius: 0;\n\t\tmargin-left: -1px;\n\t\twidth: calc(100% + 1px);\n\t}\n`;\n\nexport const FilterExpressionFactor = (props: {\n\tfilter: ConsoleSpaceSubjectDataSetFilterExpression;\n\tonFactorChanged: () => void;\n\tvisible: boolean;\n\tgrow: boolean;\n}) => {\n\tconst { filter, onFactorChanged, visible, grow } = props;\n\n\tconst { defs: { factors: factorOptions } } = useSubjectContext();\n\n\tconst { topicId, factorId } = filter;\n\tconst factorDropdownOptions = factorOptions[`${topicId}`] || [];\n\n\tconst onFilterFactorChanged = async (option: DropdownOption) => {\n\t\tfilter.factorId = option.value as string;\n\t\tconst { type } = (option as any).factor;\n\t\tif (type === ConsoleTopicFactorType.BOOLEAN) {\n\t\t\tfilter.operator = ExpressionOperator.EQUALS;\n\t\t\tfilter.value = 'true';\n\t\t} else if (type === ConsoleTopicFactorType.DATETIME) {\n\t\t\tfilter.operator = ExpressionOperator.EQUALS;\n\t\t\tdelete filter.value;\n\t\t} else if (type === ConsoleTopicFactorType.ENUM) {\n\t\t\tfilter.operator = ExpressionOperator.EQUALS;\n\t\t\tdelete filter.value;\n\t\t} else {\n\t\t\tdelete filter.operator;\n\t\t\tdelete filter.value;\n\t\t}\n\t\tonFactorChanged();\n\t};\n\n\treturn <ExpressionFactor data-visible={visible} data-grow={grow}>\n\t\t<Dropdown options={factorDropdownOptions} value={factorId} onChange={onFilterFactorChanged}/>\n\t</ExpressionFactor>;\n};","import {\n\tConsoleSpaceSubjectDataSetFilter,\n\tConsoleSpaceSubjectDataSetFilterExpression,\n\tConsoleSpaceSubjectDataSetFilterJoint,\n\tFilterExpressionOperator\n} from '../../../../../services/console/types';\n\nexport const isJointFilter = (filter: ConsoleSpaceSubjectDataSetFilter): filter is ConsoleSpaceSubjectDataSetFilterJoint => !!(filter as any).jointType;\nexport const isExpressionFilter = (filter: ConsoleSpaceSubjectDataSetFilter): filter is ConsoleSpaceSubjectDataSetFilterExpression => !(filter as any).jointType;\n\nexport const notExactDateTimeOperators = [\n\tFilterExpressionOperator.YEAR_OF, FilterExpressionOperator.HALF_YEAR_OF,\n\tFilterExpressionOperator.QUARTER_OF, FilterExpressionOperator.MONTH_OF,\n\tFilterExpressionOperator.WEEK_OF_YEAR, FilterExpressionOperator.WEEK_OF_MONTH,\n\tFilterExpressionOperator.WEEKDAYS, FilterExpressionOperator.TILL_NOW\n];\nexport const needExactDateTime = (operator?: FilterExpressionOperator): boolean => {\n\treturn !!operator && !notExactDateTimeOperators.includes(operator);\n};\n","import React from 'react';\nimport styled from 'styled-components';\nimport {\n\tConsoleSpaceSubjectDataSetFilterExpression,\n\tConsoleTopicFactorType,\n\tFilterExpressionOperator as ExpressionOperator\n} from '../../../../../services/console/types';\nimport Dropdown, { DropdownOption } from '../../../../component/dropdown';\nimport { useSubjectContext } from '../context';\nimport { needExactDateTime, notExactDateTimeOperators } from './utils';\n\nconst operatorOptions: Array<{ value: ExpressionOperator, label: string }> = [\n\t{ value: ExpressionOperator.EQUALS, label: 'Is' },\n\t{ value: ExpressionOperator.NOT_EQUALS, label: 'Is not' },\n\t{ value: ExpressionOperator.LESS, label: 'Less than' },\n\t{ value: ExpressionOperator.LESS_EQUALS, label: 'Less than or equal to' },\n\t{ value: ExpressionOperator.MORE, label: 'Greater than' },\n\t{ value: ExpressionOperator.MORE_EQUALS, label: 'Greater than or equal to' },\n\t{ value: ExpressionOperator.IN, label: 'In set' },\n\t{ value: ExpressionOperator.NOT_IN, label: 'Not in set' },\n\t{ value: ExpressionOperator.TILL_NOW, label: 'Till now' },\n\t{ value: ExpressionOperator.YEAR_OF, label: 'Year of' },\n\t{ value: ExpressionOperator.HALF_YEAR_OF, label: 'Half year of' },\n\t{ value: ExpressionOperator.QUARTER_OF, label: 'Quarter of' },\n\t{ value: ExpressionOperator.MONTH_OF, label: 'Month of' },\n\t{ value: ExpressionOperator.WEEK_OF_YEAR, label: 'Week of year' },\n\t{ value: ExpressionOperator.WEEK_OF_MONTH, label: 'Week of month' },\n\t{ value: ExpressionOperator.WEEKDAYS, label: 'Weekday' }\n];\n\nconst Operator = styled.div`\n\tflex-grow: 0;\n\tflex-basis: 0;\n\tdisplay: flex;\n\toverflow-x: hidden;\n\ttransition: all 300ms ease-in-out;\n\t&[data-visible=true] {\n\t\tmin-width: 150px;\n\t}\n\t&[data-grow=true] {\n\t\tflex-grow: 1;\n\t}\n\t> div,\n\t> div[data-widget=dropdown]:focus {\n\t\tfont-size: 0.8em;\n\t\tborder-radius: 0;\n\t\tmargin-left: -1px;\n\t\twidth: calc(100% + 1px);\n\t}\n`;\n\nexport const FilterExpressionOperator = (props: {\n\tfilter: ConsoleSpaceSubjectDataSetFilterExpression;\n\tonOperatorChanged: () => void;\n\tvisible: boolean;\n\tgrow: boolean;\n}) => {\n\tconst { filter, onOperatorChanged, visible, grow } = props;\n\tconst { topicId, factorId } = filter;\n\n\tconst { defs: { factors: factorOptions } } = useSubjectContext();\n\tconst factorDropdownOptions = factorOptions[`${topicId}`] || [];\n\t// eslint-disable-next-line\n\tconst factor = (factorDropdownOptions.find(f => f.value == factorId) || {}).factor;\n\tconst { type } = factor || {};\n\n\tlet operatorDropdownOptions = operatorOptions;\n\tif (type === ConsoleTopicFactorType.BOOLEAN) {\n\t\toperatorDropdownOptions = operatorDropdownOptions.filter(opt => [ ExpressionOperator.EQUALS ].includes(opt.value));\n\t} else if (type === ConsoleTopicFactorType.DATETIME) {\n\t\toperatorDropdownOptions = operatorDropdownOptions\n\t\t\t.filter(opt => ![ ExpressionOperator.IN, ExpressionOperator.NOT_IN ].includes(opt.value))\n\t\t\t.map(({ value, label }) => {\n\t\t\t\tswitch (value) {\n\t\t\t\t\tcase ExpressionOperator.LESS:\n\t\t\t\t\t\tlabel = 'Earlier than';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase ExpressionOperator.LESS_EQUALS:\n\t\t\t\t\t\tlabel = 'Earlier than or is';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase ExpressionOperator.MORE:\n\t\t\t\t\t\tlabel = 'Later than';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase ExpressionOperator.MORE_EQUALS:\n\t\t\t\t\t\tlabel = 'Later than or is';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t}\n\t\t\t\treturn { value, label };\n\t\t\t});\n\t} else if (type === ConsoleTopicFactorType.ENUM) {\n\t\toperatorDropdownOptions = operatorDropdownOptions.filter(opt => [ ExpressionOperator.EQUALS, ExpressionOperator.NOT_EQUALS ].includes(opt.value));\n\t} else {\n\t\toperatorDropdownOptions = operatorDropdownOptions.filter(opt => !notExactDateTimeOperators.includes(opt.value));\n\t}\n\n\tconst onFilterOperatorChanged = async ({ value }: DropdownOption) => {\n\t\tconst originalOperator = filter.operator;\n\t\tfilter.operator = value as ExpressionOperator;\n\t\tif (type === ConsoleTopicFactorType.DATETIME\n\t\t\t&& !!originalOperator && originalOperator !== filter.operator\n\t\t\t&& (!needExactDateTime(originalOperator) || !needExactDateTime(filter.operator))) {\n\t\t\tdelete filter.value;\n\t\t}\n\t\tonOperatorChanged();\n\t};\n\n\treturn <Operator data-visible={visible} data-grow={grow}>\n\t\t<Dropdown options={operatorDropdownOptions} value={filter.operator} onChange={onFilterOperatorChanged}/>\n\t</Operator>;\n};","import React from 'react';\nimport styled from 'styled-components';\nimport { ConsoleSpaceSubjectDataSetFilterExpression } from '../../../../../services/console/types';\nimport Dropdown, { DropdownOption } from '../../../../component/dropdown';\nimport { useSubjectContext } from '../context';\n\nconst ExpressionTopic = styled.div`\n\tbackground-color: var(--console-subject-topic-bg-color);\n\tmin-width: 150px;\n\tflex-grow: 0;\n\tflex-basis: 0;\n\tborder-top-left-radius: var(--border-radius);\n\tborder-bottom-left-radius: var(--border-radius);\n\ttransition: all 300ms ease-in-out;\n\t&[data-grow=true] {\n\t\tflex-grow: 1;\n\t}\n\t> div,\n\t> div[data-widget=dropdown]:focus {\n\t\tfont-size: 0.8em;\n\t\tborder-top-right-radius: 0;\n\t\tborder-bottom-right-radius: 0;\n\t}\n`;\n\nexport const FilterExpressionTopic = (props: {\n\tfilter: ConsoleSpaceSubjectDataSetFilterExpression;\n\tonTopicChanged: () => void;\n\tgrow: boolean;\n}) => {\n\tconst { filter, onTopicChanged, grow } = props;\n\tconst { defs: { topics: topicOptions } } = useSubjectContext();\n\n\tconst onFilterTopicChanged = async ({ value }: DropdownOption) => {\n\t\tconst originTopicId = filter.topicId;\n\t\tfilter.topicId = value as string;\n\t\t// eslint-disable-next-line\n\t\tif (originTopicId != filter.topicId) {\n\t\t\tdelete filter.factorId;\n\t\t\tdelete filter.operator;\n\t\t\tdelete filter.value;\n\t\t\tonTopicChanged();\n\t\t}\n\t};\n\n\treturn <ExpressionTopic data-grow={grow}>\n\t\t<Dropdown options={topicOptions} value={filter.topicId} onChange={onFilterTopicChanged}\n\t\t          please='Topic?'/>\n\t</ExpressionTopic>;\n};","import { faCalendarAlt } from '@fortawesome/free-regular-svg-icons';\nimport { faCaretDown, faCaretLeft, faCaretRight } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport dayjs, { Dayjs } from 'dayjs';\nimport React, { useEffect, useRef, useState } from 'react';\nimport styled from 'styled-components';\n\ninterface State {\n\tactive: boolean;\n\ttop: number;\n\tleft: number;\n\twidth: number;\n\theight: number;\n\tinitValue?: Dayjs;\n\tvalue?: Dayjs;\n\tdisplayValue?: Dayjs;\n}\n\nconst getPosition = (container: HTMLDivElement) => {\n\tconst rect = container.getBoundingClientRect();\n\treturn {\n\t\ttop: rect.top,\n\t\tleft: rect.left,\n\t\twidth: rect.width,\n\t\theight: rect.height\n\t};\n};\n\nconst getLastDateOfMonth = (year: number, month: number): 28 | 29 | 30 | 31 => {\n\tswitch (month + 1) {\n\t\tcase 4:\n\t\tcase 6:\n\t\tcase 9:\n\t\tcase 11:\n\t\t\treturn 30;\n\t\tcase 2:\n\t\t\treturn year % 400 === 0 ? 29 : (year % 100 === 0 ? 28 : (year % 4 === 0) ? 29 : 28);\n\t\tdefault:\n\t\t\treturn 31;\n\t}\n};\n\nconst computeCalendarDays = (firstDate: Dayjs) => {\n\tconst weekday = firstDate.day();\n\tconst year = firstDate.year();\n\tconst month = firstDate.month();\n\tconst lastDate = getLastDateOfMonth(year, month);\n\tconst days = new Array(lastDate).fill(1).map((v, index) => {\n\t\treturn { year, month, date: index + 1 };\n\t});\n\tif (weekday !== 0) {\n\t\tconst previousMonth = month === 0 ? 11 : (month - 1);\n\t\tconst previousYear = month === 0 ? (year - 1) : year;\n\t\tlet previousLastDate = getLastDateOfMonth(previousYear, previousMonth);\n\t\tfor (let index = weekday - 1; index >= 0; index--) {\n\t\t\tdays.unshift({ year: previousYear, month: previousMonth, date: previousLastDate-- });\n\t\t}\n\t}\n\tconst length = days.length;\n\tif (length < 42) {\n\t\tconst nextMonth = month === 11 ? 0 : (month + 1);\n\t\tconst nextYear = month === 11 ? (year + 1) : year;\n\t\tlet date = 1;\n\t\tfor (let index = days.length; index < 42; index++) {\n\t\t\tdays.push({ year: nextYear, month: nextMonth, date: date++ });\n\t\t}\n\t}\n\treturn days;\n};\n\nconst Container = styled.div.attrs<State>(() => {\n\treturn { 'data-widget': 'calendar' };\n})<State>(({ top, height }) => {\n\tconst atBottom = top + height + 290 < window.innerHeight;\n\treturn `\n\t\tposition: relative;\n\t\tpadding: 6px var(--input-indent);\n\t\toutline: none;\n\t\tappearance: none;\n\t\tborder: var(--border);\n\t\tborder-radius: var(--border-radius);\n\t\tfont-size: var(--font-size);\n\t\theight: var(--height);\n\t\tline-height: var(--line-height);\n\t\tcolor: var(--font-color);\n\t\tbackground-color: transparent;\n\t\ttransition: all 300ms ease-in-out;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tcursor: pointer;\n\t\twidth: 100%;\n\t\t> svg {\n\t\t\topacity: 0;\n\t\t\tmargin-left: var(--letter-gap);\n\t\t\ttransition: all 300ms ease-in-out;\n\t\t}\n\t\t&:hover,\n\t\t&:focus {\n\t\t\t> svg {\n\t\t\t\topacity: 1;\n\t\t\t}\n\t\t}\n\t\t&[data-options-visible=true]:focus {\n\t\t\tborder-bottom-left-radius: ${atBottom ? 0 : 'var(--border-radius)'};\n\t\t\tborder-bottom-right-radius: ${atBottom ? 0 : 'var(--border-radius)'};\n\t\t\tborder-top-left-radius: ${atBottom ? 'var(--border-radius)' : 0};\n\t\t\tborder-top-right-radius: ${atBottom ? 'var(--border-radius)' : 0};\n\t\t\t> div:last-child {\n\t\t\t\topacity: 1;\n\t\t\t\tpointer-events: auto;\n\t\t\t}\n\t\t}\n\t`;\n});\nconst Label = styled.span`\n\twhite-space: nowrap;\n\ttext-overflow: ellipsis;\n\toverflow-x: hidden;\n\tflex-grow: 1;\n`;\nconst Picker = styled.div.attrs<State>(({ top, left, width, height }) => {\n\tconst atBottom = top + height + 290 < window.innerHeight;\n\treturn {\n\t\tstyle: {\n\t\t\ttop: atBottom ? (top + height - 1) : 'unset',\n\t\t\tbottom: atBottom ? 'unset' : `calc(100vh - ${top + 1}px)`,\n\t\t\tleft,\n\t\t\tborderTopLeftRadius: atBottom ? 0 : 'var(--border-radius)',\n\t\t\tborderTopRightRadius: (atBottom && width >= 364) ? 0 : 'var(--border-radius)',\n\t\t\tborderBottomLeftRadius: atBottom ? 'var(--border-radius)' : 0,\n\t\t\tborderBottomRightRadius: (atBottom || width < 364) ? 'var(--border-radius)' : 0\n\t\t}\n\t};\n})<State>`\n\tdisplay: flex;\n\tflex-direction: column;\n\tposition: fixed;\n\twidth: 364px;\n\tpointer-events: none;\n\topacity: 0;\n\tbackground-color: var(--bg-color);\n\tborder: var(--border);\n\ttransition: opacity 300ms ease-in-out;\n\tz-index: 999;\n`;\nconst PickerHeader = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\tborder-bottom: var(--border);\n\theight: 32px;\n\tpadding: 0 0 0 calc(var(--margin) / 2);\n\t> svg {\n\t\twidth: 32px;\n\t\tmargin-right: calc(var(--margin) / 2);\n\t}\n\t> span:nth-child(2) {\n\t\tmargin-right: calc(var(--margin) / 2);\n\t\tfont-weight: var(--font-bold);\n\t}\n\t> span:nth-child(4) {\n\t\tflex-grow: 1;\n\t}\n\t> span:nth-child(5),\n\t> span:nth-child(6) {\n\t\tdisplay: flex;\n\t\tposition: relative;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tpadding: 0 calc(var(--margin) / 3);\n\t\theight: 33px;\n\t\tmin-width: 50px;\n\t\tmargin-top: -1px;\n\t\tbackground-color: var(--primary-color);\n\t\tcolor: var(--invert-color);\n\t\tcursor: pointer;\n\t}\n\t> span:nth-child(6) {\n\t\tmargin-right: -1px;\n\t\tborder-top-right-radius: var(--border-radius);\n\t\t&:before {\n\t\t\tcontent: '';\n\t\t\tdisplay: block;\n\t\t\tposition: absolute;\n\t\t\ttop: 25%;\n\t\t\tleft: 0;\n\t\t\twidth: 1px;\n\t\t\theight: 50%;\n\t\t\tbackground-color: var(--invert-color);\n\t\t}\n\t}\n`;\nconst PickerBody = styled.div`\n\tdisplay: grid;\n\tgrid-template-columns: auto 1fr;\n\t> div:first-child {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgrid-row: span 2;\n\t\tborder-right: var(--border);\n\t\t> span {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\theight: 32px;\n\t\t\tpadding: 0 calc(var(--margin) / 2);\n\t\t\tcursor: pointer;\n\t\t\tuser-select: none;\n\t\t\ttransition: all 300ms ease-in-out;\n\t\t\t&:hover {\n\t\t\t\tbackground-color: var(--hover-color);\n\t\t\t}\n\t\t}\n\t}\n\t> div:nth-last-child(2) {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: space-between;\n\t\theight: 32px;\n\t\tpadding: 0 calc(var(--margin) / 2);\n\t\t> span {\n\t\t\tfont-weight: var(--font-bold);\n\t\t}\n\t\t> div {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\t> span {\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: center;\n\t\t\t\tfont-weight: var(--font-bold);\n\t\t\t\tborder-radius: var(--border-radius);\n\t\t\t\tuser-select: none;\n\t\t\t\ttransition: all 300ms ease-in-out;\n\t\t\t\t&:hover {\n\t\t\t\t\tbackground-color: var(--hover-color);\n\t\t\t\t}\n\t\t\t\t&:first-child {\n\t\t\t\t\ttransform: scale(0.8);\n\t\t\t\t\ttransform-origin: right;\n\t\t\t\t\tpadding: 2px 6px;\n\t\t\t\t}\n\t\t\t\t&:not(:first-child) {\n\t\t\t\t\theight: 20px;\n\t\t\t\t\twidth: 24px;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t> div:last-child {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: repeat(7, 32px);\n\t\tgrid-template-rows: repeat(7, 32px);\n\t\t> span {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tjustify-content: center;\n\t\t\tposition: relative;\n\t\t\ttext-align: center;\n\t\t\t&:nth-child(-n + 7) {\n\t\t\t\tcolor: var(--primary-color);\n\t\t\t\tfont-weight: var(--font-bold);\n\t\t\t\topacity: 0.7;\n\t\t\t}\n\t\t\t&:first-child,\n\t\t\t&:nth-child(7) {\n\t\t\t\tcolor: var(--danger-color);\n\t\t\t}\n\t\t\t&:not(:nth-child(-n + 7)) {\n\t\t\t\t&:before {\n\t\t\t\t\tcontent: '';\n\t\t\t\t\tdisplay: block;\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\ttop: 4px;\n\t\t\t\t\tleft: 4px;\n\t\t\t\t\theight: 24px;\n\t\t\t\t\twidth: 24px;\n\t\t\t\t\tborder-radius: 100%;\n\t\t\t\t\tbackground-color: var(--hover-color);\n\t\t\t\t\topacity: 0;\n\t\t\t\t\tz-index: -1;\n\t\t\t\t\ttransition: all 300ms ease-in-out;\n\t\t\t\t}\n\t\t\t\t&:hover:before {\n\t\t\t\t\topacity: 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\t&[data-current-month=false] {\n\t\t\t\tcolor: var(--hover-color);\n\t\t\t\t&:hover {\n\t\t\t\t\tcolor: var(--primary-color);\n\t\t\t\t}\n\t\t\t}\n\t\t\t&[data-today=true] {\n\t\t\t\tfont-weight: var(--font-bold);\n\t\t\t\tcolor: var(--primary-color);\n\t\t\t}\n\t\t\t&[data-current=true] {\n\t\t\t\tcolor: var(--invert-color);\n\t\t\t\t&:before {\n\t\t\t\t\tbackground-color: var(--invert-color);\n\t\t\t\t\tbox-shadow: 0 0 11px 0 rgba(0, 0, 0, 0.1);\n\t\t\t\t\topacity: 1;\n\t\t\t\t\tz-index: -2;\n\t\t\t\t}\n\t\t\t\t&:after {\n\t\t\t\t\tcontent: '';\n\t\t\t\t\tdisplay: block;\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\ttop: 7px;\n\t\t\t\t\tleft: 7px;\n\t\t\t\t\theight: 18px;\n\t\t\t\t\twidth: 18px;\n\t\t\t\t\tborder-radius: 100%;\n\t\t\t\t\tbackground-color: var(--primary-color);\n\t\t\t\t\tz-index: -1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n`;\nconst PickerButtons = styled.div`\n\tdisplay: flex;\n\tposition: absolute;\n\tbottom: -1px;\n\tright: -1px;\n\t> div {\n\t\tdisplay: flex;\n\t\tposition: relative;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tpadding: 0 calc(var(--margin) / 3);\n\t\tmin-width: 80px;\n\t\theight: 32px;\n\t\tbackground-color: var(--primary-color);\n\t\tcolor: var(--invert-color);\n\t\tbox-shadow: 0 0 11px 0 rgba(0, 0, 0, 0.1);\n\t\tcursor: pointer;\n\t\tz-index: 1;\n\t}\n\t> div:first-child {\n\t\tborder-top-left-radius: var(--border-radius);\n\t}\n\t> div:last-child {\n\t\tborder-bottom-right-radius: var(--border-radius);\n\t\t&:before {\n\t\t\tcontent: '';\n\t\t\tdisplay: block;\n\t\t\tposition: absolute;\n\t\t\ttop: 25%;\n\t\t\tleft: 0;\n\t\t\twidth: 1px;\n\t\t\theight: 50%;\n\t\t\tbackground-color: var(--invert-color);\n\t\t}\n\t}\n`;\n\nexport const Calendar = (props: {\n\tclassName?: string,\n\tonChange: (value?: string) => Promise<void | { active: boolean }>,\n\tvalue?: string,\n}) => {\n\tconst { className, onChange, value, ...rest } = props;\n\n\tconst containerRef = useRef<HTMLDivElement>(null);\n\tconst [ state, setState ] = useState<State>({\n\t\tactive: false,\n\t\ttop: 0,\n\t\tleft: 0,\n\t\twidth: 0,\n\t\theight: 0,\n\t\tvalue: (void 0)\n\t});\n\n\tuseEffect(() => {\n\t\tconst onScroll = () => {\n\t\t\tif (!state.active) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst { top, left, width, height } = getPosition(containerRef.current!);\n\t\t\tsetState({ ...state, top, left, width, height });\n\t\t};\n\t\twindow.addEventListener('scroll', onScroll, true);\n\t\treturn () => {\n\t\t\twindow.removeEventListener('scroll', onScroll, true);\n\t\t};\n\t});\n\n\tconst onClicked = () => {\n\t\tif (state.active) {\n\t\t\treturn;\n\t\t}\n\t\tconst { top, left, width, height } = getPosition(containerRef.current!);\n\t\tconst currentDate = value ? dayjs(value) : dayjs();\n\t\tsetState({\n\t\t\tactive: true,\n\t\t\ttop,\n\t\t\tleft,\n\t\t\twidth,\n\t\t\theight,\n\t\t\tinitValue: currentDate,\n\t\t\tvalue: currentDate,\n\t\t\tdisplayValue: currentDate\n\t\t});\n\t};\n\tconst onBlurred = async () => {\n\t\tif (state.initValue === state.value) {\n\t\t\tsetState({ ...state, active: false });\n\t\t} else {\n\t\t\tsetState({ ...state, active: false });\n\t\t\tawait onChange(state.value!.format('YYYY/MM/DD HH:mm:ss'));\n\t\t}\n\t};\n\tconst onDayStartClicked = () => setState({\n\t\t...state,\n\t\tvalue: state.value!.hour(0).minute(0).second(0).millisecond(0)\n\t});\n\tconst onDayEndClicked = () => setState({\n\t\t...state,\n\t\tvalue: state.value!.hour(23).minute(59).second(59).millisecond(999)\n\t});\n\tconst onDateClicked = (date: Dayjs) => () => setState({\n\t\t...state,\n\t\tvalue: date.clone()\n\t});\n\tconst onTodayClicked = onDateClicked(dayjs());\n\tconst onYesterdayClicked = onDateClicked(dayjs().subtract(1, 'day'));\n\tconst onWeekendClicked = onDateClicked(dayjs().day(6));\n\tconst onPrevWeekendClicked = onDateClicked(dayjs().day(6).subtract(1, 'week'));\n\tconst onMonthEndClicked = onDateClicked(dayjs().date(1).add(1, 'month').subtract(1, 'day'));\n\tconst onPrevMonthEndClicked = onDateClicked(dayjs().date(1).subtract(1, 'day'));\n\tconst onYearEndClicked = onDateClicked(dayjs().month(11).date(31));\n\tconst onPrevYearEndClicked = onDateClicked(dayjs().month(11).date(31).subtract(1, 'year'));\n\n\tconst currentValue = state.value || dayjs();\n\tconst currentDisplayDate = currentValue.format('DD/MM/YYYY');\n\tconst currentDisplayTime = currentValue.format('HH:mm:ss');\n\tconst currentYear = currentValue.year();\n\tconst currentMonth = currentValue.month();\n\tconst currentDate = currentValue.date();\n\n\tconst displayValue = state.displayValue || dayjs();\n\tconst currentDisplayMonth = displayValue.format('MMM YYYY');\n\tconst firstDayOfDisplayMonth = displayValue.clone().date(1);\n\tconst displayYear = displayValue.year();\n\tconst displayMonth = displayValue.month();\n\tconst days = computeCalendarDays(firstDayOfDisplayMonth);\n\n\tconst today = dayjs();\n\tconst todayYear = today.year();\n\tconst todayMonth = today.month();\n\tconst todayDate = today.date();\n\n\tconst onGotoTodayClicked = () => setState({ ...state, displayValue: today });\n\tconst onGotoPrevMonthClicked = () => setState({ ...state, displayValue: state.displayValue!.subtract(1, 'month') });\n\tconst onGotoNextMonthClicked = () => setState({ ...state, displayValue: state.displayValue!.add(1, 'month') });\n\n\tconst onClearClicked = async () => {\n\t\tconst ret = await onChange();\n\t\tif (!ret || !ret.active) {\n\t\t\tsetState({ ...state, active: false });\n\t\t}\n\t};\n\tconst onConfirmClicked = async () => {\n\t\tconst ret = await onChange(state.value!.format('YYYY/MM/DD HH:mm:ss'));\n\t\tif (!ret || !ret.active) {\n\t\t\tsetState({ ...state, active: false });\n\t\t}\n\t};\n\n\treturn <Container className={className}\n\t                  data-options-visible={state.active}\n\t                  {...state}\n\t                  {...rest}\n\t                  role='input' tabIndex={0} ref={containerRef}\n\t                  onClick={onClicked} onBlur={onBlurred}>\n\t\t<Label>{value}</Label>\n\t\t<FontAwesomeIcon icon={faCaretDown}/>\n\t\t<Picker {...state}>\n\t\t\t<PickerHeader>\n\t\t\t\t<FontAwesomeIcon icon={faCalendarAlt}/>\n\t\t\t\t<span>{currentDisplayDate}</span>\n\t\t\t\t<span>{currentDisplayTime}</span>\n\t\t\t\t<span/>\n\t\t\t\t<span onClick={onDayStartClicked}>Start</span>\n\t\t\t\t<span onClick={onDayEndClicked}>End</span>\n\t\t\t</PickerHeader>\n\t\t\t<PickerBody>\n\t\t\t\t<div>\n\t\t\t\t\t<span onClick={onTodayClicked}>Today</span>\n\t\t\t\t\t<span onClick={onYesterdayClicked}>Yesterday</span>\n\t\t\t\t\t<span onClick={onWeekendClicked}>This Weekend</span>\n\t\t\t\t\t<span onClick={onPrevWeekendClicked}>Previous Weekend</span>\n\t\t\t\t\t<span onClick={onMonthEndClicked}>This Month</span>\n\t\t\t\t\t<span onClick={onPrevMonthEndClicked}>Previous Month</span>\n\t\t\t\t\t<span onClick={onYearEndClicked}>This Year</span>\n\t\t\t\t\t<span onClick={onPrevYearEndClicked}>Previous Year</span>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<span>{currentDisplayMonth}</span>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<span onClick={onGotoTodayClicked}>TODAY</span>\n\t\t\t\t\t\t<span onClick={onGotoPrevMonthClicked}><FontAwesomeIcon icon={faCaretLeft}/></span>\n\t\t\t\t\t\t<span onClick={onGotoNextMonthClicked}><FontAwesomeIcon icon={faCaretRight}/></span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<span>S</span>\n\t\t\t\t\t<span>M</span>\n\t\t\t\t\t<span>T</span>\n\t\t\t\t\t<span>W</span>\n\t\t\t\t\t<span>T</span>\n\t\t\t\t\t<span>F</span>\n\t\t\t\t\t<span>S</span>\n\t\t\t\t\t{days.map(({ year, month, date }) => {\n\t\t\t\t\t\treturn <span key={`${year}/${month}/${date}`}\n\t\t\t\t\t\t             data-current-month={year === displayYear && month === displayMonth}\n\t\t\t\t\t\t             data-current={year === currentYear && month === currentMonth && date === currentDate}\n\t\t\t\t\t\t             data-today={year === todayYear && month === todayMonth && date === todayDate}\n\t\t\t\t\t\t             onClick={onDateClicked(dayjs().year(year).month(month).date(date))}>\n\t\t\t\t\t\t\t{date}\n\t\t\t\t\t\t</span>;\n\t\t\t\t\t})}\n\t\t\t\t</div>\n\t\t\t</PickerBody>\n\t\t\t<PickerButtons>\n\t\t\t\t<div onClick={onClearClicked}>Clear</div>\n\t\t\t\t<div onClick={onConfirmClicked}>Confirm</div>\n\t\t\t</PickerButtons>\n\t\t</Picker>\n\t</Container>;\n};","import { faCheck } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport dayjs from 'dayjs';\nimport React from 'react';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../../../common/utils';\nimport {\n\tConsoleSpaceSubjectDataSetFilterExpression,\n\tConsoleTopicFactor,\n\tConsoleTopicFactorType,\n\tFilterExpressionOperator as ExpressionOperator\n} from '../../../../../services/console/types';\nimport { Calendar } from '../../../../component/calendar';\nimport Dropdown, { DropdownOption } from '../../../../component/dropdown';\nimport Input from '../../../../component/input';\nimport { useSubjectContext } from '../context';\nimport { needExactDateTime } from './utils';\n\nconst PlainFactorFilterValue = (props: {\n\tfilter: ConsoleSpaceSubjectDataSetFilterExpression;\n\tfactorType?: ConsoleTopicFactorType;\n}) => {\n\tconst { filter, factorType } = props;\n\tconst forceUpdate = useForceUpdate();\n\n\tif (!factorType || [ ConsoleTopicFactorType.BOOLEAN, ConsoleTopicFactorType.ENUM, ConsoleTopicFactorType.DATETIME ].includes(factorType)) {\n\t\treturn null;\n\t}\n\n\tconst onFilterValueChanged = (event: React.ChangeEvent<HTMLInputElement>) => {\n\t\tfilter.value = event.target.value;\n\t\tforceUpdate();\n\t};\n\treturn <Input value={filter.value || ''} onChange={onFilterValueChanged}/>;\n};\n\nconst BooleanOptions = [ { value: 'true', label: 'True' }, { value: 'false', label: 'False' } ];\nconst BooleanFactorFilterValue = (props: {\n\tfilter: ConsoleSpaceSubjectDataSetFilterExpression;\n\tfactorType?: ConsoleTopicFactorType;\n}) => {\n\tconst { filter, factorType } = props;\n\tconst forceUpdate = useForceUpdate();\n\n\tif (factorType !== ConsoleTopicFactorType.BOOLEAN) {\n\t\treturn null;\n\t}\n\n\tconst onFilterValueOptionChanged = async ({ value }: DropdownOption) => {\n\t\tfilter.value = value as string;\n\t\tforceUpdate();\n\t};\n\n\treturn <Dropdown options={BooleanOptions} value={filter.value} onChange={onFilterValueOptionChanged}/>;\n};\n\nconst EnumItem = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\t&[data-checked=true] {\n\t\t> svg {\n\t\t\topacity: 1;\n\t\t\tcolor: var(--console-primary-color);\n\t\t}\n\t}\n\t> svg {\n\t\tcolor: var(--console-waive-color);\n\t\topacity: 0.3;\n\t\tmargin-right: calc(var(--margin) / 3);\n\t}\n\t> span {\n\t\tflex-grow: 1;\n\t}\n`;\n\nconst EnumFactorFilterValue = (props: {\n\tfilter: ConsoleSpaceSubjectDataSetFilterExpression;\n\tfactor?: ConsoleTopicFactor;\n\toptions?: Array<DropdownOption>;\n\taccept: (factor: ConsoleTopicFactor, filter: ConsoleSpaceSubjectDataSetFilterExpression) => boolean;\n}) => {\n\tconst { filter, factor, options, accept } = props;\n\tconst { value } = filter;\n\tconst forceUpdate = useForceUpdate();\n\n\tif (!factor || !accept(factor, filter)) {\n\t\treturn null;\n\t}\n\n\tconst values = (value || '').split(',').map(v => v.trim()).filter(v => v);\n\tconst valueOptions = options || JSON.parse(factor!.enum!);\n\tconst valueDropdownOptions = valueOptions.map(({ value, label }: { value: string, label: string }) => {\n\t\treturn {\n\t\t\tvalue,\n\t\t\tlabel: <EnumItem data-checked={values.includes(value)}>\n\t\t\t\t<FontAwesomeIcon icon={faCheck}/>\n\t\t\t\t<span>{label}</span>\n\t\t\t</EnumItem>\n\t\t};\n\t});\n\tconst onFilterValueOptionChanged = async ({ value }: DropdownOption): Promise<{ active: boolean }> => {\n\t\tconst v = value as string;\n\t\tif (values.includes(v)) {\n\t\t\tfilter.value = values.filter(value => value !== v).join(',');\n\t\t\tif (!filter.value) {\n\t\t\t\tdelete filter.value;\n\t\t\t}\n\t\t} else {\n\t\t\tfilter.value = [ ...values, v ].join(',');\n\t\t}\n\t\tforceUpdate();\n\t\treturn { active: true };\n\t};\n\tconst renderSelect = (value: string | number | boolean) => {\n\t\tconst values = ((value as string) || '').split(',').map(v => v.trim());\n\t\treturn values.map(value => {\n\t\t\treturn valueOptions.find(({ value: v }: { value: string }) => v === value)!.label;\n\t\t}).join(', ');\n\t};\n\treturn <Dropdown options={valueDropdownOptions} value={value} onChange={onFilterValueOptionChanged}\n\t                 select={renderSelect}/>;\n};\n\nconst DateTimeFactorFilterValue = (props: {\n\tfilter: ConsoleSpaceSubjectDataSetFilterExpression;\n\tfactor?: ConsoleTopicFactor;\n}) => {\n\tconst { filter, factor } = props;\n\tconst { operator, value } = filter;\n\n\tconst forceUpdate = useForceUpdate();\n\n\tif (!factor || factor.type !== ConsoleTopicFactorType.DATETIME || !needExactDateTime(operator)) {\n\t\treturn null;\n\t}\n\n\tconst onFilterValueOptionChanged = async (value?: string) => {\n\t\tfilter.value = value;\n\t\tforceUpdate();\n\t};\n\n\treturn <Calendar value={value as string} onChange={onFilterValueOptionChanged}/>;\n};\n\nconst DateTimeYearOfFactorFilterValue = (props: {\n\tfilter: ConsoleSpaceSubjectDataSetFilterExpression;\n\tfactorType?: ConsoleTopicFactorType;\n}) => {\n\tconst { filter, factorType } = props;\n\tconst { operator } = filter;\n\tconst forceUpdate = useForceUpdate();\n\n\tif (!factorType || factorType !== ConsoleTopicFactorType.DATETIME || operator !== ExpressionOperator.YEAR_OF) {\n\t\treturn null;\n\t}\n\n\tconst onFilterValueChanged = (event: React.ChangeEvent<HTMLInputElement>) => {\n\t\tfilter.value = event.target.value;\n\t\tforceUpdate();\n\t};\n\treturn <Input value={filter.value || ''} onChange={onFilterValueChanged}\n\t              placeholder='Full year concatenated by comma'/>;\n};\n\nconst TillNowOptions = [\n\t{ value: '1', label: 'In 3 days' },\n\t{ value: '2', label: 'In 5 days' },\n\t{ value: '3', label: 'In 7 days' },\n\t{ value: '4', label: 'In 10 days' },\n\t{ value: '5', label: 'In 15 days' },\n\t{ value: '6', label: 'In 30 days' },\n\t{ value: '7', label: 'This week' },\n\t{ value: '8', label: 'This month' },\n\t{ value: '9', label: 'This quarter' },\n\t{ value: '10', label: 'This half year' },\n\t{ value: '11', label: 'This year' }\n];\nconst DateTimeFactorFilterTillNowValue = (props: {\n\tfilter: ConsoleSpaceSubjectDataSetFilterExpression;\n\tfactorType?: ConsoleTopicFactorType;\n}) => {\n\tconst { filter, factorType } = props;\n\tconst { operator } = filter;\n\tconst forceUpdate = useForceUpdate();\n\n\tif (factorType !== ConsoleTopicFactorType.DATETIME || operator !== ExpressionOperator.TILL_NOW) {\n\t\treturn null;\n\t}\n\n\tconst onFilterValueOptionChanged = async ({ value }: DropdownOption) => {\n\t\tfilter.value = value as string;\n\t\tforceUpdate();\n\t};\n\n\treturn <Dropdown options={TillNowOptions} value={filter.value} onChange={onFilterValueOptionChanged}/>;\n};\n\nconst ExpressionValueContainer = styled.div`\n\twidth: 0;\n\tflex-grow: 0;\n\toverflow-x: hidden;\n\tmargin-left: -1px;\n\ttransition: all 300ms ease-in-out;\n\t&[data-visible=true] {\n\t\tflex-grow: 1;\n\t}\n\t> input,\n\t> div[data-widget=dropdown],\n\t> div[data-widget=dropdown]:focus,\n\t> div[data-widget=calendar],\n\t> div[data-widget=calendar]:focus {\n\t\tfont-size: 0.8em;\n\t\tborder-radius: 0;\n\t}\n\t> input {\n\t\twidth: 100%;\n\t}\n`;\n\nconst now = dayjs();\nconst DateTimeEnums = {\n\tHalfYear: {\n\t\toptions: [ { value: '1', label: 'First half' }, { value: '2', label: 'Second half' } ],\n\t\taccept: (factor: ConsoleTopicFactor, filter: ConsoleSpaceSubjectDataSetFilterExpression) => factor.type === ConsoleTopicFactorType.DATETIME && filter.operator === ExpressionOperator.HALF_YEAR_OF\n\t},\n\tQuarter: {\n\t\toptions: [\n\t\t\t{ value: '1', label: 'First quarter' },\n\t\t\t{ value: '2', label: 'Second quarter' },\n\t\t\t{ value: '3', label: 'Third quarter' },\n\t\t\t{ value: '4', label: 'Fourth quarter' }\n\t\t],\n\t\taccept: (factor: ConsoleTopicFactor, filter: ConsoleSpaceSubjectDataSetFilterExpression) => factor.type === ConsoleTopicFactorType.DATETIME && filter.operator === ExpressionOperator.QUARTER_OF\n\t},\n\tMonth: {\n\t\toptions: new Array(12).fill(1).map((v, index) => {\n\t\t\treturn {\n\t\t\t\tvalue: `${index}`,\n\t\t\t\tlabel: now.month(index).format('MMMM')\n\t\t\t};\n\t\t}),\n\t\taccept: (factor: ConsoleTopicFactor, filter: ConsoleSpaceSubjectDataSetFilterExpression) => factor.type === ConsoleTopicFactorType.DATETIME && filter.operator === ExpressionOperator.MONTH_OF\n\t},\n\tWeekOfYear: {\n\t\toptions: new Array(52).fill(1).map((v, index) => {\n\t\t\tconst x = index + 1;\n\t\t\tconst y = x % 10;\n\t\t\treturn {\n\t\t\t\tvalue: `${x}`,\n\t\t\t\tlabel: y === 1 ? `${x}st` : (y === 2 ? `${x}nd` : (y === 3 ? `${x}rd` : `${x}th`))\n\t\t\t};\n\t\t}),\n\t\taccept: (factor: ConsoleTopicFactor, filter: ConsoleSpaceSubjectDataSetFilterExpression) => factor.type === ConsoleTopicFactorType.DATETIME && filter.operator === ExpressionOperator.WEEK_OF_YEAR\n\t},\n\tWeekOfMonth: {\n\t\toptions: new Array(5).fill(1).map((v, index) => {\n\t\t\tconst x = index + 1;\n\t\t\tconst y = x % 10;\n\t\t\treturn {\n\t\t\t\tvalue: `${x}`,\n\t\t\t\tlabel: y === 1 ? `${x}st` : (y === 2 ? `${x}nd` : (y === 3 ? `${x}rd` : `${x}th`))\n\t\t\t};\n\t\t}),\n\t\taccept: (factor: ConsoleTopicFactor, filter: ConsoleSpaceSubjectDataSetFilterExpression) => factor.type === ConsoleTopicFactorType.DATETIME && filter.operator === ExpressionOperator.WEEK_OF_MONTH\n\t},\n\tWeekdays: {\n\t\toptions: [\n\t\t\t...new Array(7).fill(1).map((v, index) => {\n\t\t\t\treturn {\n\t\t\t\t\tvalue: `${index}`,\n\t\t\t\t\tlabel: now.day(index).format('dddd')\n\t\t\t\t};\n\t\t\t}),\n\t\t\t{ value: '7', label: 'Workdays' },\n\t\t\t{ value: '8', label: 'Weekend' }\n\t\t],\n\t\taccept: (factor: ConsoleTopicFactor, filter: ConsoleSpaceSubjectDataSetFilterExpression) => factor.type === ConsoleTopicFactorType.DATETIME && filter.operator === ExpressionOperator.WEEKDAYS\n\t}\n};\n\nexport const FilterExpressionValue = (props: {\n\tfilter: ConsoleSpaceSubjectDataSetFilterExpression;\n\tvisible: boolean;\n}) => {\n\tconst { filter, visible } = props;\n\tconst { topicId, factorId } = filter;\n\n\tconst { defs: { factors: factorOptions } } = useSubjectContext();\n\tconst factorDropdownOptions = factorOptions[`${topicId}`] || [];\n\t// eslint-disable-next-line\n\tconst factor = (factorDropdownOptions.find(f => f.value == factorId) || {}).factor;\n\tconst { type: factorType } = factor || {};\n\n\treturn <ExpressionValueContainer data-visible={visible}>\n\t\t<PlainFactorFilterValue filter={filter} factorType={factorType}/>\n\t\t<BooleanFactorFilterValue filter={filter} factorType={factorType}/>\n\t\t<EnumFactorFilterValue filter={filter} factor={factor}\n\t\t                       accept={(factor) => factor.type === ConsoleTopicFactorType.ENUM}/>\n\t\t<DateTimeFactorFilterValue filter={filter} factor={factor}/>\n\t\t<DateTimeYearOfFactorFilterValue filter={filter} factorType={factorType}/>\n\t\t<EnumFactorFilterValue filter={filter} factor={factor} {...DateTimeEnums.HalfYear}/>\n\t\t<EnumFactorFilterValue filter={filter} factor={factor} {...DateTimeEnums.Quarter}/>\n\t\t<EnumFactorFilterValue filter={filter} factor={factor} {...DateTimeEnums.Month}/>\n\t\t<EnumFactorFilterValue filter={filter} factor={factor} {...DateTimeEnums.WeekOfYear}/>\n\t\t<EnumFactorFilterValue filter={filter} factor={factor} {...DateTimeEnums.WeekOfMonth}/>\n\t\t<EnumFactorFilterValue filter={filter} factor={factor} {...DateTimeEnums.Weekdays}/>\n\t\t<DateTimeFactorFilterTillNowValue filter={filter} factorType={factorType}/>\n\t</ExpressionValueContainer>;\n};","import { faTimes } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React from 'react';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../../../common/utils';\nimport { ConsoleSpaceSubjectDataSetFilterExpression } from '../../../../../services/console/types';\nimport { LinkButton } from '../../../../component/console/link-button';\nimport { FilterExpressionFactor } from './filter-expression-factor';\nimport { FilterExpressionOperator } from './filter-expression-operator';\nimport { FilterExpressionTopic } from './filter-expression-topic';\nimport { FilterExpressionValue } from './filter-expression-value';\n\nconst ExpressionRow = styled.div`\n\tdisplay: flex;\n\tposition: relative;\n\tpadding: 0 calc(var(--margin) / 2);\n\tmargin-top: calc(var(--margin) / 4);\n\t> button {\n\t\twidth: 32px;\n\t\tmin-width: 32px;\n\t\tborder: var(--border);\n\t\tborder-left-color: transparent;\n\t\tborder-top-right-radius: var(--border-radius);\n\t\tborder-bottom-right-radius: var(--border-radius);\n\t\tmargin-left: -1px;\n\t\t&:hover:before {\n\t\t\tborder-top-left-radius: 0;\n\t\t\tborder-bottom-left-radius: 0;\n\t\t}\n\t}\n`;\n\nexport const FilterExpression = (props: {\n\tfilter: ConsoleSpaceSubjectDataSetFilterExpression;\n\tremoveFilter: (filter: ConsoleSpaceSubjectDataSetFilterExpression) => void;\n\tlevel: number;\n}) => {\n\tconst { filter, removeFilter } = props;\n\n\tconst forceUpdate = useForceUpdate();\n\n\tconst onFilterRemoveClicked = () => removeFilter(filter);\n\n\tconst showFactor = !!filter.topicId;\n\tconst showOperator = !!filter.factorId;\n\tconst showValue = !!filter.operator;\n\n\treturn <ExpressionRow>\n\t\t<FilterExpressionTopic filter={filter} onTopicChanged={forceUpdate} grow={!showFactor}/>\n\t\t<FilterExpressionFactor filter={filter} onFactorChanged={forceUpdate}\n\t\t                        visible={showFactor} grow={showFactor && !showOperator}/>\n\t\t<FilterExpressionOperator filter={filter} onOperatorChanged={forceUpdate}\n\t\t                          visible={showOperator} grow={showOperator && !showValue}/>\n\t\t<FilterExpressionValue filter={filter} visible={showValue}/>\n\t\t<LinkButton onClick={onFilterRemoveClicked} ignoreHorizontalPadding={true}\n\t\t            tooltip={'Remove Filter'} center={true}>\n\t\t\t<FontAwesomeIcon icon={faTimes}/>\n\t\t</LinkButton>\n\t</ExpressionRow>;\n};","import React from 'react';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../../../common/utils';\nimport {\n\tConsoleSpaceSubjectDataSetFilter,\n\tConsoleSpaceSubjectDataSetFilterJoint,\n\tFilterJointType\n} from '../../../../../services/console/types';\nimport { FilterExpression } from './filter-expression';\nimport { isExpressionFilter, isJointFilter } from './utils';\n\nconst JointRow = styled.div.attrs(() => {\n\treturn {\n\t\t'data-widget': 'console-subject-filter-joint'\n\t};\n})`\n\tdisplay: flex;\n\t&[data-level='0']:last-child {\n\t\tmargin-bottom: calc(var(--margin) / 4);\n\t}\n`;\nconst Joint = styled.div.attrs({\n\t'data-widget': 'console-subject-filter-joint'\n})`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\tjustify-content: center;\n\tfont-size: 0.8em;\n\twidth: 24px;\n\tmargin-left: calc(var(--margin) / 2);\n\tmargin-top: calc(var(--margin) / 4);\n\t&[data-filters-count='1'] {\n\t\t&:before {\n\t\t\tdisplay: none;\n\t\t}\n\t}\n\t&:before {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\tleft: calc(50% - 1px);\n\t\ttop: 16px;\n\t\twidth: 16px;\n\t\theight: calc(100% - 32px);\n\t\tborder: var(--border);\n\t\tborder-width: 2px;\n\t\tborder-right: 0;\n\t\tborder-top-left-radius: 4px;\n\t\tborder-bottom-left-radius: 4px;\n\t\tz-index: 0;\n\t}\n\t> span {\n\t\tdisplay: block;\n\t\tfont-family: var(--console-title-font-family);\n\t\theight: 1.6em;\n\t\twidth: 24px;\n\t\tmin-width: 24px;\n\t\ttext-align: center;\n\t\tz-index: 1;\n\t\tbackground-color: var(--border-color);\n\t\tborder: 1px solid var(--border-color);\n\t\tborder-radius: 0.8em;\n\t\tcursor: pointer;\n\t\tuser-select: none;\n\t\t> span {\n\t\t\tdisplay: inline-block;\n\t\t\ttransform: scale(0.8, 0.8);\n\t\t}\n\t}\n`;\nconst Filters = styled.div.attrs({\n\t'data-widget': 'console-subject-filter-joint-filters'\n})`\n\tflex-grow: 1;\n\tdisplay: flex;\n\tflex-direction: column;\n`;\n\nconst FilterRow = (props: {\n\tfilter: ConsoleSpaceSubjectDataSetFilter;\n\tremoveFilter: (filter: ConsoleSpaceSubjectDataSetFilter) => void;\n\tchildrenFiltersChanged: () => void;\n\tlevel: number;\n}) => {\n\tconst { filter, removeFilter, childrenFiltersChanged, level } = props;\n\n\tif (isJointFilter(filter)) {\n\t\treturn <FilterJoint joint={filter} level={level}\n\t\t                    removeFilter={removeFilter} childrenFiltersChanged={childrenFiltersChanged}/>;\n\t} else if (isExpressionFilter(filter)) {\n\t\treturn <FilterExpression filter={filter} level={level} removeFilter={removeFilter}/>;\n\t} else {\n\t\treturn null;\n\t}\n};\n\nexport const FilterJoint = (props: {\n\tjoint: ConsoleSpaceSubjectDataSetFilterJoint;\n\tremoveFilter: (filter: ConsoleSpaceSubjectDataSetFilter) => void;\n\tchildrenFiltersChanged: () => void;\n\tlevel: number;\n}) => {\n\tconst { joint, removeFilter, childrenFiltersChanged, level } = props;\n\tconst { filters = [] } = joint;\n\n\tconst forceUpdate = useForceUpdate();\n\n\tif (filters.length === 0) {\n\t\treturn null;\n\t}\n\n\tconst onSwitchJointClicked = () => {\n\t\tjoint.jointType = joint.jointType === FilterJointType.AND ? FilterJointType.OR : FilterJointType.AND;\n\t\tforceUpdate();\n\t};\n\tconst removeChildFilter = (filter: ConsoleSpaceSubjectDataSetFilter) => {\n\t\tconst index = filters.indexOf(filter);\n\t\tfilters.splice(index, 1);\n\t\tif (filters.length === 0) {\n\t\t\t// all child filters are removed\n\t\t\t// then remove the joint\n\t\t\tremoveFilter(joint);\n\t\t} else {\n\t\t\tchildrenFiltersChanged();\n\t\t}\n\t};\n\n\treturn <JointRow data-level={level}>\n\t\t<Joint data-filters-count={filters.length}>\n\t\t\t<span onClick={onSwitchJointClicked}>\n\t\t\t\t<span>{joint.jointType === FilterJointType.AND ? 'AND' : 'OR'}</span>\n\t\t\t</span>\n\t\t</Joint>\n\t\t<Filters>\n\t\t\t{filters.map((filter, index) => {\n\t\t\t\treturn <FilterRow key={index} filter={filter}\n\t\t\t\t                  removeFilter={removeChildFilter} childrenFiltersChanged={childrenFiltersChanged}\n\t\t\t\t                  level={level + 1}/>;\n\t\t\t})}\n\t\t</Filters>\n\t</JointRow>;\n};","import { faCompressAlt, faExpandAlt, faPlus } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { Fragment } from 'react';\nimport { useForceUpdate } from '../../../../../common/utils';\nimport {\n\tConsoleSpaceSubject,\n\tConsoleSpaceSubjectDataSetFilter,\n\tConsoleSpaceSubjectDataSetFilterJoint,\n\tFilterJointType\n} from '../../../../../services/console/types';\nimport { LinkButton } from '../../../../component/console/link-button';\nimport { SubjectPanelBody, SubjectPanelBodyWrapper, SubjectPanelHeader } from '../components';\nimport { FilterJoint } from './filter-joint';\nimport { isJointFilter } from './utils';\n\nexport const SubjectFilters = (props: {\n\tsubject: ConsoleSpaceSubject;\n\tcollapsed: boolean;\n\tonCollapsedChanged: (collapsed: boolean) => void;\n}) => {\n\tconst {\n\t\tsubject,\n\t\tcollapsed, onCollapsedChanged\n\t} = props;\n\n\tconst { dataset = {} } = subject;\n\tconst { filters = [ { jointType: FilterJointType.AND, filters: [] } ] } = dataset;\n\n\t// const { defs: { space: spaceDef } } = useSubjectContext();\n\tconst forceUpdate = useForceUpdate();\n\n\tconst onAddFilterClicked = () => {\n\t\tconst filter = {};\n\t\t(filters[0] as ConsoleSpaceSubjectDataSetFilterJoint).filters.push(filter);\n\t\tonCollapsedChanged(false);\n\t\tforceUpdate();\n\t};\n\tconst onRemoveFilter = () => forceUpdate();\n\n\tconst countFilters = (filters: Array<ConsoleSpaceSubjectDataSetFilter>): number => {\n\t\treturn filters.reduce((count: number, filter) => {\n\t\t\tif (isJointFilter(filter)) {\n\t\t\t\tcount += countFilters(filter.filters);\n\t\t\t} else {\n\t\t\t\tcount += 1;\n\t\t\t}\n\t\t\treturn count;\n\t\t}, 0);\n\t};\n\tconst filterCount = countFilters(filters);\n\n\treturn <Fragment>\n\t\t<SubjectPanelHeader>\n\t\t\t<div>\n\t\t\t\t<span>Filters</span>\n\t\t\t\t<span>{filterCount}</span>\n\t\t\t</div>\n\t\t\t<LinkButton onClick={onAddFilterClicked} ignoreHorizontalPadding={true}\n\t\t\t            tooltip='Add Filter' center={true}>\n\t\t\t\t<FontAwesomeIcon icon={faPlus}/>\n\t\t\t</LinkButton>\n\t\t\t<LinkButton onClick={() => onCollapsedChanged(!collapsed)} ignoreHorizontalPadding={true}\n\t\t\t            tooltip={`${collapsed ? 'Expand' : 'Collapse'} Filters Definition`} center={true}>\n\t\t\t\t<FontAwesomeIcon icon={collapsed ? faExpandAlt : faCompressAlt}/>\n\t\t\t</LinkButton>\n\t\t</SubjectPanelHeader>\n\t\t<SubjectPanelBody data-visible={!collapsed}>\n\t\t\t<SubjectPanelBodyWrapper>\n\t\t\t\t<FilterJoint joint={filters[0] as ConsoleSpaceSubjectDataSetFilterJoint}\n\t\t\t\t             removeFilter={onRemoveFilter} childrenFiltersChanged={forceUpdate}\n\t\t\t\t             level={0}/>\n\t\t\t</SubjectPanelBodyWrapper>\n\t\t</SubjectPanelBody>\n\t</Fragment>;\n};","import { faCompressAlt, faExpandAlt, faPlus, faSortAlphaDown, faTimes } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { Fragment } from 'react';\nimport styled from 'styled-components';\nimport { v4 } from 'uuid';\nimport { useForceUpdate } from '../../../../../common/utils';\nimport {\n\tConnectedConsoleSpace,\n\tConsoleSpaceSubject,\n\tConsoleSpaceSubjectDataSetJoin,\n\tConsoleTopic,\n\tConsoleTopicFactor,\n\tTopicJoinType\n} from '../../../../../services/console/types';\nimport { LinkButton } from '../../../../component/console/link-button';\nimport Dropdown, { DropdownOption } from '../../../../component/dropdown';\nimport { SubjectPanelBody, SubjectPanelBodyWrapper, SubjectPanelHeader } from '../components';\nimport { useSubjectContext } from '../context';\nimport { ColumnFactor } from './column-factor';\nimport { ColumnTopic } from './column-topic';\n\nconst JoinRowContainer = styled.div.attrs({\n\t'data-widget': 'console-subject-view-join-row'\n})`\n\tdisplay    : flex;\n\tposition   : relative;\n\tpadding    : 0 calc(var(--margin) / 2);\n\tmargin-top : calc(var(--margin) / 4);\n\t&:last-child {\n\t\tmargin-bottom : calc(var(--margin) / 4);\n\t}\n\t> div[data-widget=dropdown] {\n\t\tfont-size     : 0.8em;\n\t\tmax-width     : 130px;\n\t\tborder-radius : 0;\n\t\tmargin-left   : -1px;\n\t\t> span:first-child,\n\t\t> div:last-child > span {\n\t\t\t> span {\n\t\t\t\toverflow-x    : hidden;\n\t\t\t\twhite-space   : nowrap;\n\t\t\t\ttext-overflow : ellipsis;\n\t\t\t\t> span:last-child {\n\t\t\t\t\tflex-grow : 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\t> svg {\n\t\t\t\tmin-width : 32px;\n\t\t\t}\n\t\t}\n\t}\n\t> button {\n\t\tmin-width                  : 32px;\n\t\tborder                     : var(--border);\n\t\tborder-left-color          : transparent;\n\t\tborder-top-right-radius    : var(--border-radius);\n\t\tborder-bottom-right-radius : var(--border-radius);\n\t\tmargin-left                : -1px;\n\t\t&:hover:before {\n\t\t\tborder-top-left-radius    : 0;\n\t\t\tborder-bottom-left-radius : 0;\n\t\t}\n\t}\n`;\n\nconst JoinTypes = [\n\t{ value: TopicJoinType.INNER, label: 'Complete Match' },\n\t{ value: TopicJoinType.RIGHT, label: 'Right First' },\n\t{ value: TopicJoinType.LEFT, label: 'Left First' }\n];\n\nexport const JoinRow = (props: {\n\tjoin: ConsoleSpaceSubjectDataSetJoin;\n\tremoveJoin: (join: ConsoleSpaceSubjectDataSetJoin) => void;\n}) => {\n\tconst { join, removeJoin } = props;\n\n\tconst forceUpdate = useForceUpdate();\n\n\tconst onTypeChanged = async (option: DropdownOption) => {\n\t\tjoin.type = option.value as TopicJoinType;\n\t\tforceUpdate();\n\t};\n\tconst onJoinRemoveClicked = () => removeJoin(join);\n\n\tif (!join.type) {\n\t\tjoin.type = TopicJoinType.INNER;\n\t}\n\n\treturn <JoinRowContainer>\n\t\t<ColumnTopic column={join} propNames={[ 'topicId', 'factorId' ]}\n\t\t             onTopicChanged={forceUpdate}/>\n\t\t<ColumnFactor column={join} propNames={[ 'topicId', 'factorId' ]}\n\t\t              onFactorChanged={forceUpdate}/>\n\t\t<Dropdown value={join.type || TopicJoinType.INNER} options={JoinTypes}\n\t\t          onChange={onTypeChanged}/>\n\t\t<ColumnTopic column={join} propNames={[ 'secondaryTopicId', 'secondaryFactorId' ]}\n\t\t             onTopicChanged={forceUpdate}/>\n\t\t<ColumnFactor column={join} propNames={[ 'secondaryTopicId', 'secondaryFactorId' ]}\n\t\t              onFactorChanged={forceUpdate}/>\n\t\t<LinkButton onClick={onJoinRemoveClicked} ignoreHorizontalPadding={true}\n\t\t            tooltip={'Remove Join'} center={true}>\n\t\t\t<FontAwesomeIcon icon={faTimes}/>\n\t\t</LinkButton>\n\t</JoinRowContainer>;\n};\n\nconst asLabel = (\n\tjoin: ConsoleSpaceSubjectDataSetJoin,\n\tfactors: { [key in string]: Array<DropdownOption & { topic: ConsoleTopic, factor: ConsoleTopicFactor }> }\n) => {\n\tconst { topicId, factorId, type, secondaryTopicId, secondaryFactorId } = join;\n\tlet topicName = '?', factorName = '?', typeName, secondaryTopicName = '?', secondaryFactorName = '?';\n\tif (topicId) {\n\t\tconst factorsOfTopic = factors[topicId] || [];\n\t\tif (factorsOfTopic.length > 0) {\n\t\t\ttopicName = factorsOfTopic[0].topic.name;\n\t\t} else if (factorId) {\n\t\t\t// eslint-disable-next-line\n\t\t\tconst { factor } = factorsOfTopic.find(({ factor }) => factor.factorId == factorId) || {};\n\t\t\tif (factor) {\n\t\t\t\tfactorName = factor.label || factor.name;\n\t\t\t}\n\t\t}\n\t}\n\ttypeName = type || TopicJoinType.INNER;\n\tif (secondaryTopicId) {\n\t\tconst factorsOfTopic = factors[secondaryTopicId] || [];\n\t\tif (factorsOfTopic.length > 0) {\n\t\t\tsecondaryTopicName = factorsOfTopic[0].topic.name;\n\t\t} else if (factorId) {\n\t\t\t// eslint-disable-next-line\n\t\t\tconst { factor } = factorsOfTopic.find(({ factor }) => factor.factorId == secondaryFactorId) || {};\n\t\t\tif (factor) {\n\t\t\t\tsecondaryFactorName = factor.label || factor.name;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn `${topicName}.${factorName}${typeName}${secondaryTopicName}.${secondaryFactorName}`;\n};\n\nexport const SubjectJoins = (props: {\n\tspace: ConnectedConsoleSpace;\n\tsubject: ConsoleSpaceSubject;\n\tcollapsed: boolean;\n\tonCollapsedChanged: (collapsed: boolean) => void;\n}) => {\n\tconst {\n\t\tsubject,\n\t\tcollapsed, onCollapsedChanged\n\t} = props;\n\n\tconst { dataset = {} } = subject;\n\tconst { joins = [] } = dataset;\n\n\tconst { defs: { factors } } = useSubjectContext();\n\tconst forceUpdate = useForceUpdate();\n\n\tconst onSortClicked = () => {\n\t\tjoins.sort((j1, j2) => asLabel(j1, factors).toLowerCase().localeCompare(asLabel(j2, factors).toLowerCase()));\n\t};\n\tconst onAddJoinClicked = () => {\n\t\tconst join = { type: TopicJoinType.INNER };\n\t\tjoins.push(join);\n\t\tonCollapsedChanged(false);\n\t\tforceUpdate();\n\t};\n\tconst onRemoveJoin = (join: ConsoleSpaceSubjectDataSetJoin) => {\n\t\tconst index = joins.indexOf(join);\n\t\tjoins.splice(index, 1);\n\t\tforceUpdate();\n\t};\n\n\treturn <Fragment>\n\t\t<SubjectPanelHeader>\n\t\t\t<div>\n\t\t\t\t<span>Joins</span>\n\t\t\t\t<span>{joins.length}</span>\n\t\t\t</div>\n\t\t\t<LinkButton onClick={onAddJoinClicked} ignoreHorizontalPadding={true}\n\t\t\t            tooltip='Add Join' center={true}>\n\t\t\t\t<FontAwesomeIcon icon={faPlus}/>\n\t\t\t</LinkButton>\n\t\t\t<LinkButton onClick={onSortClicked} ignoreHorizontalPadding={true}\n\t\t\t            tooltip='Sort' center={true}>\n\t\t\t\t<FontAwesomeIcon icon={faSortAlphaDown}/>\n\t\t\t</LinkButton>\n\t\t\t<LinkButton onClick={() => onCollapsedChanged(!collapsed)} ignoreHorizontalPadding={true}\n\t\t\t            tooltip={`${collapsed ? 'Expand' : 'Collapse'} Joins Definition`} center={true}>\n\t\t\t\t<FontAwesomeIcon icon={collapsed ? faExpandAlt : faCompressAlt}/>\n\t\t\t</LinkButton>\n\t\t</SubjectPanelHeader>\n\t\t<SubjectPanelBody data-visible={!collapsed}>\n\t\t\t<SubjectPanelBodyWrapper>\n\t\t\t\t{joins.map((join) => {\n\t\t\t\t\treturn <JoinRow join={join} key={v4()} removeJoin={onRemoveJoin}/>;\n\t\t\t\t})}\n\t\t\t</SubjectPanelBodyWrapper>\n\t\t</SubjectPanelBody>\n\t</Fragment>;\n};","import { faTimes } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { useState } from 'react';\nimport styled from 'styled-components';\nimport {\n\tConnectedConsoleSpace,\n\tConsoleSpaceSubject,\n\tConsoleSpaceSubjectDataSetFilterJoint,\n\tFilterJointType\n} from '../../../../../services/console/types';\nimport { LinkButton } from '../../../../component/console/link-button';\nimport { SubjectPanelHeader } from '../components';\nimport { useSubjectContext } from '../context';\nimport { SubjectColumns } from './columns';\nimport { SubjectFilters } from './filters';\nimport { SubjectJoins } from './joins';\n\ninterface Collapsed {\n\tfilters: boolean;\n\tcolumns: boolean;\n\tjoins: boolean;\n}\n\nconst DataSetDefinition = styled.div.attrs({\n\t'data-widget': 'console-subject-view-dataset-def'\n})`\n\tdisplay          : flex;\n\tposition         : relative;\n\tflex-direction   : column;\n\twidth            : 60%;\n\tmin-width        : 500px;\n\theight           : 100%;\n\tborder-right     : var(--border);\n\tbox-shadow       : var(--console-hover-shadow);\n\tbackground-color : var(--bg-color);\n\ttransition       : all 300ms ease-in-out;\n\toverflow         : hidden;\n\t&[data-visible=false] {\n\t\topacity        : 0;\n\t\twidth          : 0;\n\t\tborder-right   : 0;\n\t\tmin-width      : 0;\n\t\tpointer-events : none;\n\t}\n\tdiv[data-widget=dropdown] > div:last-child {\n\t\t&::-webkit-scrollbar {\n\t\t\tbackground-color : transparent;\n\t\t\twidth            : 4px;\n\t\t}\n\t\t&::-webkit-scrollbar-track {\n\t\t\tbackground-color : transparent;\n\t\t\tborder-radius    : 2px;\n\t\t}\n\t\t&::-webkit-scrollbar-thumb {\n\t\t\tbackground-color : var(--console-favorite-color);\n\t\t\tborder-radius    : 2px;\n\t\t}\n\t}\n`;\n\nexport const DataSetDef = (props: {\n\tspace: ConnectedConsoleSpace;\n\tsubject: ConsoleSpaceSubject;\n\tvisible: boolean\n\tonVisibleChanged: (visible: boolean) => void;\n}) => {\n\tconst {\n\t\tspace, subject,\n\t\tvisible, onVisibleChanged\n\t} = props;\n\n\tconst { save: saveSubject } = useSubjectContext();\n\tconst [ collapsed, setCollapsed ] = useState<Collapsed>({ filters: false, columns: false, joins: false });\n\tconst onCloseDef = () => {\n\t\tsaveSubject();\n\t\tonVisibleChanged(false);\n\t};\n\tconst changeCollapsed = (key: keyof Collapsed) => (value: boolean) => setCollapsed({ ...collapsed, [key]: value });\n\n\tif (!subject.dataset) {\n\t\tsubject.dataset = {\n\t\t\tfilters: [ { jointType: FilterJointType.AND, filters: [] } ],\n\t\t\tcolumns: [],\n\t\t\tjoins: []\n\t\t};\n\t}\n\tif (!subject.dataset.filters) {\n\t\tsubject.dataset.filters = [ { jointType: FilterJointType.AND, filters: [] } ];\n\t}\n\tif (subject.dataset.filters.length === 0) {\n\t\tsubject.dataset.filters.push({ jointType: FilterJointType.AND, filters: [] });\n\t}\n\tconst topFilter = subject.dataset.filters![0] as ConsoleSpaceSubjectDataSetFilterJoint;\n\tif (!topFilter.jointType) {\n\t\ttopFilter.jointType = FilterJointType.AND;\n\t}\n\tif (!topFilter.filters) {\n\t\ttopFilter.filters = [];\n\t}\n\tif (!subject.dataset.columns) {\n\t\tsubject.dataset.columns = [];\n\t}\n\tif (!subject.dataset.joins) {\n\t\tsubject.dataset.joins = [];\n\t}\n\n\treturn <DataSetDefinition data-visible={visible}>\n\t\t<SubjectPanelHeader>\n\t\t\t<div>{subject.name}</div>\n\t\t\t<LinkButton onClick={onCloseDef} ignoreHorizontalPadding={true} tooltip='Minimize'\n\t\t\t            center={true}>\n\t\t\t\t<FontAwesomeIcon icon={faTimes}/>\n\t\t\t</LinkButton>\n\t\t</SubjectPanelHeader>\n\t\t<SubjectFilters subject={subject} collapsed={collapsed.filters}\n\t\t                onCollapsedChanged={changeCollapsed('filters')}/>\n\t\t<SubjectColumns space={space} subject={subject} collapsed={collapsed.columns}\n\t\t                onCollapsedChanged={changeCollapsed('columns')}/>\n\t\t<SubjectJoins space={space} subject={subject} collapsed={collapsed.joins}\n\t\t              onCollapsedChanged={changeCollapsed('joins')}/>\n\t</DataSetDefinition>;\n};","import { faHighlighter, faPlus, faThumbtack, faTimes } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { useEffect, useRef, useState } from \"react\";\nimport styled from 'styled-components';\nimport { v4 } from 'uuid';\nimport { useForceUpdate } from '../../../../../common/utils';\nimport {\n\tConnectedConsoleSpace,\n\tConsoleSpaceSubject,\n\tConsoleSpaceSubjectChart,\n\tConsoleSpaceSubjectChartType\n} from '../../../../../services/console/types';\nimport { LinkButton } from '../../../../component/console/link-button';\nimport { useSubjectContext } from '../context';\nimport { Chart } from './chart';\nimport { generateChartRect } from './utils';\n\nconst GraphicsContainer = styled.div.attrs({\n\t'data-widget': 'console-subject-view-graphics'\n})`\n\tdisplay: flex;\n\tposition: absolute;\n\tflex-direction: column;\n\ttop: 0;\n\tright: 0;\n\twidth: 100%;\n\theight: 100%;\n\tbackground-color: var(--bg-color);\n\ttransition: width 300ms ease-in-out, opacity 300ms ease-in-out;\n\toverflow: auto;\n\t&[data-visible=false] {\n\t\topacity: 0;\n\t\twidth: 0;\n\t\tpointer-events: none;\n\t}\n`;\nconst Buttons = styled.div.attrs<{ top: number, right: number }>(({ top, right }) => {\n\treturn {\n\t\t'data-widget': 'console-subject-view-graphics-buttons',\n\t\tstyle: { top, right }\n\t};\n})<{ top: number, right: number }>`\n\tdisplay: flex;\n\tposition: fixed;\n\tmargin-top: -1px;\n\tborder-top-left-radius: 15px;\n\tborder-bottom-left-radius: 25px;\n\tbox-shadow: -1px 0 0 0 var(--border-color), 0 1px 0 0 var(--border-color), 0 -1px 0 0 var(--border-color);\n\tpadding: 4px 10px;\n\tbackground-color: var(--bg-color);\n\tz-index: 1;\n\t> button {\n\t\theight: 32px;\n\t\twidth: 32px;\n\t\t&:before {\n\t\t\tborder-radius: 100%;\n\t\t}\n\t\t> svg {\n\t\t\tfont-size: 0.9em;\n\t\t}\n\t}\n`;\nconst NoDef = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tposition: absolute;\n\tleft: 0;\n\theight: 100%;\n\twidth: 100%;\n\tfont-family: var(--console-title-font-family);\n\tfont-size: 1.4em;\n\t> span > span {\n\t\ttext-decoration: underline;\n\t\tcursor: pointer;\n\t}\n`;\n\nexport const Graphics = (props: {\n\tspace: ConnectedConsoleSpace;\n\tsubject: ConsoleSpaceSubject;\n\tvisible: boolean\n\tonVisibleChanged: (visible: boolean) => void;\n\tswitchToDefinition: () => void;\n}) => {\n\tconst { space, subject, visible, onVisibleChanged, switchToDefinition } = props;\n\tconst { dataset = {}, graphics: charts = [] } = subject;\n\tconst { columns = [] } = dataset;\n\n\tconst { save: saveSubject } = useSubjectContext();\n\tconst containerRef = useRef<HTMLDivElement>(null);\n\tconst [ buttonsPosition, setButtonsPosition ] = useState({ top: 0, right: 0 });\n\tconst [ locked, setLocked ] = useState(true);\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\tconst resetButtonsPosition = () => {\n\t\t\tif (!containerRef.current) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst { top, left } = containerRef.current.getBoundingClientRect();\n\t\t\tconst { clientWidth, offsetWidth } = containerRef.current;\n\t\t\tconst right = window.outerWidth - left - offsetWidth + (offsetWidth - clientWidth);\n\t\t\tif (top !== buttonsPosition.top || right !== buttonsPosition.right) {\n\t\t\t\tsetButtonsPosition({ top, right });\n\t\t\t}\n\t\t};\n\t\tresetButtonsPosition();\n\n\t\tif (!containerRef.current) {\n\t\t\treturn;\n\t\t}\n\t\t// @ts-ignore\n\t\tconst resizeObserver = new ResizeObserver(() => {\n\t\t\tif (!containerRef.current) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tresetButtonsPosition();\n\t\t});\n\t\tresizeObserver.observe(containerRef.current);\n\t\treturn () => resizeObserver.disconnect();\n\t});\n\n\tconst onLockClicked = () => setLocked(true);\n\tconst onUnlockClicked = () => setLocked(false);\n\tconst onCreateChartClicked = () => {\n\t\tif (!subject.graphics) {\n\t\t\tsubject.graphics = [];\n\t\t}\n\t\tsubject.graphics.push({\n\t\t\tname: 'Noname',\n\t\t\ttype: ConsoleSpaceSubjectChartType.BAR,\n\t\t\tindicators: [],\n\t\t\tdimensions: [],\n\t\t\trect: generateChartRect(containerRef.current!)\n\t\t});\n\t\tif (locked) {\n\t\t\tsetLocked(false);\n\t\t} else {\n\t\t\tforceUpdate();\n\t\t}\n\t\tsaveSubject();\n\t};\n\tconst onDeleteChart = (chart: ConsoleSpaceSubjectChart) => {\n\t\tconst index = charts.indexOf(chart);\n\t\tif (index !== -1) {\n\t\t\tcharts.splice(index, 1);\n\t\t}\n\t\tforceUpdate();\n\t\tsaveSubject();\n\t};\n\tconst onToDefClicked = async () => switchToDefinition();\n\n\tconst hasColumns = columns.length !== 0;\n\tconst hasCharts = charts.length !== 0;\n\n\treturn <GraphicsContainer data-visible={visible} ref={containerRef}>\n\t\t<Buttons {...buttonsPosition}>\n\t\t\t{hasCharts && !locked\n\t\t\t\t? <LinkButton tooltip='Lock Charts' right={true} offsetX={-3} offsetY={8}\n\t\t\t\t              onClick={onLockClicked}>\n\t\t\t\t\t<FontAwesomeIcon icon={faThumbtack}/>\n\t\t\t\t</LinkButton>\n\t\t\t\t: null}\n\t\t\t{hasCharts && locked\n\t\t\t\t? <LinkButton tooltip='Settings & Layout' right={true} offsetX={-3} offsetY={8}\n\t\t\t\t              onClick={onUnlockClicked}>\n\t\t\t\t\t<FontAwesomeIcon icon={faHighlighter}/>\n\t\t\t\t</LinkButton>\n\t\t\t\t: null}\n\t\t\t{hasColumns\n\t\t\t\t? <LinkButton tooltip='Add Chart' right={true} offsetX={-3} offsetY={8}\n\t\t\t\t              onClick={onCreateChartClicked}>\n\t\t\t\t\t<FontAwesomeIcon icon={faPlus}/>\n\t\t\t\t</LinkButton>\n\t\t\t\t: null}\n\t\t\t<LinkButton tooltip='Minimize' right={true} offsetX={-3} offsetY={8}\n\t\t\t            onClick={() => onVisibleChanged(false)}>\n\t\t\t\t<FontAwesomeIcon icon={faTimes}/>\n\t\t\t</LinkButton>\n\t\t</Buttons>\n\t\t{visible\n\t\t\t? (hasColumns\n\t\t\t\t? (hasCharts\n\t\t\t\t\t? charts.map((chart: ConsoleSpaceSubjectChart) => {\n\t\t\t\t\t\tif (!chart.chartId) {\n\t\t\t\t\t\t\tchart.chartId = v4();\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn <Chart containerRef={containerRef}\n\t\t\t\t\t\t              space={space} subject={subject} chart={chart} locked={locked}\n\t\t\t\t\t\t              onDeleteChart={onDeleteChart}\n\t\t\t\t\t\t              key={chart.chartId}/>;\n\t\t\t\t\t})\n\t\t\t\t\t: <NoDef>\n\t\t\t\t\t\t<span>No chart defined yet, <span onClick={onCreateChartClicked}>create one</span> now?</span>\n\t\t\t\t\t</NoDef>)\n\t\t\t\t: <NoDef>\n\t\t\t\t\t<span>No column defined yet, switch to <span onClick={onToDefClicked}>definition</span>?</span>\n\t\t\t\t</NoDef>)\n\t\t\t: null}\n\t</GraphicsContainer>;\n};","import { faChartBar, faTrashAlt } from '@fortawesome/free-regular-svg-icons';\nimport { faDatabase, faPenAlt, faTable } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { useState } from 'react';\nimport { useParams } from 'react-router-dom';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../../common/utils';\nimport {\n\tConnectedConsoleSpace,\n\tConsoleSpaceGroup,\n\tConsoleSpaceSubject,\n\tFilterJointType\n} from '../../../../services/console/types';\nimport { LinkButton } from '../../../component/console/link-button';\nimport { useDialog } from '../../../context/dialog';\nimport { createDeleteSubjectClickHandler, createRenameClickHandler } from '../dialog';\nimport { useSpaceContext } from '../space-context';\nimport { SubjectContextProvider, useSubjectContext } from './context';\nimport { DataSet } from './dataset';\nimport { DataSetDef } from './dataset-def';\nimport { Graphics } from './graphics';\n\ninterface Visible {\n\tdefinition: boolean;\n\tdataset: boolean;\n\tgraphics: boolean;\n}\n\nconst SubjectViewContainer = styled.div.attrs({\n\t'data-widget': 'console-subject-view'\n})`\n\tdisplay: flex;\n\tposition: relative;\n\twidth: 100%;\n`;\nconst SubjectViewMenu = styled.div`\n\tdisplay: flex;\n\tposition: absolute;\n\ttop: calc(var(--margin) / 2);\n\tleft: calc(var(--margin) / 2);\n\t> button {\n\t\tfont-family: var(--console-title-font-family);\n\t\tcolor: var(--invert-color);\n\t\tbackground-color: var(--console-primary-color);\n\t\twhite-space: nowrap;\n\t\tpadding: 6px calc(var(--margin) / 2);\n\t\tbox-shadow: var(--console-primary-shadow);\n\t\t&:first-child {\n\t\t\tborder-top-left-radius: var(--border-radius);\n\t\t\tborder-bottom-left-radius: var(--border-radius);\n\t\t}\n\t\t&:last-child {\n\t\t\tborder-top-right-radius: var(--border-radius);\n\t\t\tborder-bottom-right-radius: var(--border-radius);\n\t\t}\n\t}\n`;\n\nconst findSubject = (space: ConnectedConsoleSpace, subjectId: string) => {\n\t// eslint-disable-next-line\n\tlet subject = space.subjects.find(s => s.subjectId == subjectId);\n\tif (!subject) {\n\t\treturn space.groups.reduce((found, group) => {\n\t\t\tif (found.subject) {\n\t\t\t\treturn found;\n\t\t\t}\n\t\t\t// eslint-disable-next-line\n\t\t\tconst subject = group.subjects.find(s => s.subjectId == subjectId);\n\t\t\tif (subject) {\n\t\t\t\treturn { subject, group };\n\t\t\t} else {\n\t\t\t\treturn found;\n\t\t\t}\n\t\t}, {} as { group: ConsoleSpaceGroup, subject: ConsoleSpaceSubject });\n\t} else {\n\t\treturn { subject, group: (void 0) };\n\t}\n};\nconst initDataSet = (subject: ConsoleSpaceSubject) => {\n\tlet { dataset } = subject;\n\tif (!dataset) {\n\t\tdataset = { filters: [ { jointType: FilterJointType.AND, filters: [] } ], columns: [], joins: [] };\n\t\tsubject.dataset = dataset;\n\t}\n\tif (!dataset.filters) {\n\t\tdataset.filters = [ { jointType: FilterJointType.AND, filters: [] } ];\n\t} else if (dataset.filters.length === 0) {\n\t\tdataset.filters.push({ jointType: FilterJointType.AND, filters: [] });\n\t}\n\tif (!dataset.columns) {\n\t\tdataset.columns = [];\n\t}\n\tif (!dataset.joins) {\n\t\tdataset.joins = [];\n\t}\n};\n\nexport const SubjectViewContent = (props: {\n\tspace: ConnectedConsoleSpace;\n\tgroup?: ConsoleSpaceGroup;\n\tsubject: ConsoleSpaceSubject;\n}) => {\n\tconst { space, group, subject } = props;\n\n\tconst dialog = useDialog();\n\tconst { closeSubjectIfCan, subjectRenamed } = useSpaceContext();\n\tconst { save: saveSubject } = useSubjectContext();\n\tconst forceUpdate = useForceUpdate();\n\tconst [ visible, setVisible ] = useState<Visible>({ definition: false, dataset: false, graphics: false });\n\n\tinitDataSet(subject);\n\n\tconst onDeleteSubjectClicked = createDeleteSubjectClickHandler({\n\t\tdialog, space, group, subject,\n\t\tonDeleted: async ({ space, group, subject }) => {\n\t\t\tcloseSubjectIfCan({ space, group, subject });\n\t\t}\n\t});\n\tconst onRenameSubjectClicked = createRenameClickHandler({\n\t\tdialog, space, group, subject,\n\t\tasFullName: () => group ? `${space.name} / ${group.name} / ${subject.name}` : `${space.name} / ${subject.name}`,\n\t\trenameObject: (options, newName) => subject.name = newName,\n\t\tonRenamed: async () => {\n\t\t\tsubjectRenamed({ space, group, subject });\n\t\t\tsaveSubject();\n\t\t\tforceUpdate();\n\t\t}\n\t});\n\tconst onVisibleChanged = (key: keyof Visible) => () => setVisible({ ...visible, [key]: !visible[key] });\n\tconst changeVisible = (key: keyof Visible) => (value: boolean) => setVisible({ ...visible, [key]: value });\n\tconst switchToDefinition = () => setVisible({ definition: true, dataset: false, graphics: false });\n\n\treturn <SubjectViewContainer>\n\t\t<SubjectViewMenu>\n\t\t\t<LinkButton onClick={onRenameSubjectClicked} ignoreHorizontalPadding={true} tooltip='Rename'\n\t\t\t            center={true}>\n\t\t\t\t<FontAwesomeIcon icon={faPenAlt}/>\n\t\t\t</LinkButton>\n\t\t\t<LinkButton onClick={onDeleteSubjectClicked} ignoreHorizontalPadding={true} tooltip='Delete Group'\n\t\t\t            center={true}>\n\t\t\t\t<FontAwesomeIcon icon={faTrashAlt}/>\n\t\t\t</LinkButton>\n\t\t\t<LinkButton onClick={onVisibleChanged('definition')} ignoreHorizontalPadding={true}\n\t\t\t            tooltip='Show Dataset Definition'>\n\t\t\t\t<FontAwesomeIcon icon={faDatabase}/>\n\t\t\t</LinkButton>\n\t\t\t<LinkButton onClick={onVisibleChanged('dataset')} ignoreHorizontalPadding={true}\n\t\t\t            tooltip='Show Dataset'>\n\t\t\t\t<FontAwesomeIcon icon={faTable}/>\n\t\t\t</LinkButton>\n\t\t\t<LinkButton onClick={onVisibleChanged('graphics')} ignoreHorizontalPadding={true}\n\t\t\t            tooltip='Show Graphics'>\n\t\t\t\t<FontAwesomeIcon icon={faChartBar}/>\n\t\t\t</LinkButton>\n\t\t</SubjectViewMenu>\n\t\t<DataSetDef space={space} subject={subject}\n\t\t            visible={visible.definition} onVisibleChanged={changeVisible('definition')}/>\n\t\t<DataSet space={space} subject={subject}\n\t\t         visible={visible.dataset} onVisibleChanged={changeVisible('dataset')}\n\t\t         switchToDefinition={switchToDefinition}/>\n\t\t<Graphics space={space} subject={subject}\n\t\t          visible={visible.graphics} onVisibleChanged={changeVisible('graphics')}\n\t\t          switchToDefinition={switchToDefinition}/>\n\t</SubjectViewContainer>;\n};\n\nexport const SubjectView = (props: {\n\tspace: ConnectedConsoleSpace;\n\tvisible: boolean;\n}) => {\n\tconst { space, visible } = props;\n\tif (!visible) {\n\t\treturn null;\n\t}\n\n\t// eslint-disable-next-line\n\tconst { subjectId } = useParams<{ subjectId: string }>();\n\tconst { group, subject } = findSubject(space, subjectId);\n\n\treturn <SubjectContextProvider space={space} group={group} subject={subject}>\n\t\t<SubjectViewContent space={space} group={group} subject={subject}/>\n\t</SubjectContextProvider>;\n};","import React from 'react';\nimport { Redirect, Route, Switch } from 'react-router-dom';\nimport Path, { toConnectedSpace } from '../../../common/path';\nimport { ConnectedConsoleSpace } from '../../../services/console/types';\nimport { AvailableResources } from './available-resources';\nimport { Body } from './components';\nimport { GroupView } from './group-view';\nimport { ListView } from './list-view';\nimport { SubjectView } from './subject-view';\n\nexport const ConnectedSpaceBody = (props: {\n\tspace: ConnectedConsoleSpace\n}) => {\n\tconst { space } = props;\n\n\treturn <Body>\n\t\t<Switch>\n\t\t\t<Route path={Path.CONSOLE_CONNECTED_SPACE_OVERALL}>\n\t\t\t\t<ListView visible={true} space={space}/>\n\t\t\t</Route>\n\t\t\t<Route path={Path.CONSOLE_CONNECTED_SPACE_RESOURCES}>\n\t\t\t\t<AvailableResources visible={true} space={space}/>\n\t\t\t</Route>\n\t\t\t<Route path={Path.CONSOLE_CONNECTED_SPACE_GROUP}>\n\t\t\t\t<GroupView visible={true} space={space}/>\n\t\t\t</Route>\n\t\t\t<Route path={Path.CONSOLE_CONNECTED_SPACE_SUBJECT}>\n\t\t\t\t<SubjectView visible={true} space={space}/>\n\t\t\t</Route>\n\t\t\t<Route path='*'>\n\t\t\t\t<Redirect to={toConnectedSpace(Path.CONSOLE_CONNECTED_SPACE_OVERALL, space.connectId)}/>\n\t\t\t</Route>\n\t\t</Switch>\n\t</Body>;\n};\n","import { IconProp } from '@fortawesome/fontawesome-svg-core';\nimport { faCaretDown } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { ForwardedRef, forwardRef } from 'react';\nimport styled from 'styled-components';\n\nexport const Tabs = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\tpadding: 0 calc(var(--margin) / 2) 0 0;\n\tpadding-top: 8px;\n\theight: 50px;\n`;\nexport const TabContainer = styled.div<{ active: boolean }>`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\tborder: var(--border);\n\tborder-bottom: 0;\n\tborder-color: ${({ active }) => active ? 'var(--border-color)' : 'transparent'};\n\tborder-top-left-radius: calc(var(--border-radius) * 2);\n\tborder-top-right-radius: calc(var(--border-radius) * 2);\n\tbackground-color: ${({ active }) => active ? 'var(--bg-color)' : 'transparent'};\n\tpadding: 6px calc(var(--margin) / 1.5) 5px;\n\theight: 43px;\n\tfont-size: 0.8em;\n\tcursor: pointer;\n\tcolor: ${({ active }) => active ? 'var(--console-primary-color)' : ''};\n\ttransition: all 300ms ease-in-out;\n\t&:hover {\n\t\t> svg:first-child,\n\t\t> span:nth-child(2) {\n\t\t\topacity: 1;\n\t\t}\n\t}\n\t> svg:first-child {\n\t\tmargin-right: calc(var(--margin) / 4);\n\t\topacity: ${({ active }) => active ? 1 : 0.6};\n\t\ttransition: all 300ms ease-in-out;\n\t}\n\t> span:nth-child(2) {\n\t\topacity: ${({ active }) => active ? 1 : 0.6};\n\t\tmargin-top: -1px;\n\t\ttransition: all 300ms ease-in-out;\n\t}\n\t> div:nth-last-child(2),\n\t> div:last-child {\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\tbottom: 0;\n\t\twidth: 8px;\n\t\theight: 8px;\n\t\toverflow: hidden;\n\t\tbackground-color: var(--bg-color);\n\t\tpointer-events: none;\n\t\topacity: ${({ active }) => active ? 1 : 0};\n\t\ttransition: all 300ms ease-in-out;\n\t\t&:before {\n\t\t\tcontent: '';\n\t\t\tdisplay: block;\n\t\t\tposition: absolute;\n\t\t\theight: 16px;\n\t\t\twidth: 16px;\n\t\t\ttop: -8px;\n\t\t\tborder-radius: 100%;\n\t\t\tborder-width: 1px;\n\t\t\tborder-style: solid;\n\t\t\tborder-color: var(--border-color);\n\t\t\tbackground-color: var(--invert-color);\n\t\t}\n\t}\n\t> div:nth-last-child(2) {\n\t\tright: -8px;\n\t\t&:before {\n\t\t\tleft: 0;\n\t\t}\n\t}\n\t> div:last-child {\n\t\tleft: -8px;\n\t\t&:before {\n\t\t\tleft: -8px;\n\t\t}\n\t}\n`;\n\nexport const Tab = forwardRef((props: {\n\tactive: boolean;\n\ticon: IconProp;\n\tlabel: string;\n\tmoreClick?: (event: React.MouseEvent) => void;\n\tmore?: ((props: any) => React.ReactNode) | React.ReactNode;\n\tonClick: () => void;\n}, ref: ForwardedRef<HTMLDivElement>) => {\n\tconst { active, icon, label, moreClick, more, onClick } = props;\n\n\treturn <TabContainer active={active} onClick={onClick} ref={ref}>\n\t\t<FontAwesomeIcon icon={icon}/>\n\t\t<span>{label}</span>\n\t\t{moreClick ? <FontAwesomeIcon icon={faCaretDown} onClick={moreClick}/> : null}\n\t\t{more}\n\t\t<div/>\n\t\t<div/>\n\t</TabContainer>;\n});","import {IconProp} from '@fortawesome/fontawesome-svg-core';\nimport {faCube, faEllipsisH, faTimes} from '@fortawesome/free-solid-svg-icons';\nimport {FontAwesomeIcon} from '@fortawesome/react-fontawesome';\nimport React, {ForwardedRef, forwardRef, useEffect, useRef, useState} from 'react';\nimport {matchPath, useLocation} from 'react-router-dom';\nimport styled from 'styled-components';\nimport Path from '../../../common/path';\nimport {useForceUpdate} from '../../../common/utils';\nimport {ConnectedConsoleSpace, ConsoleSpaceGroup, ConsoleSpaceSubject} from '../../../services/console/types';\nimport {LinkButton} from '../../component/console/link-button';\nimport {hideMenu, Menu, MenuItem, MenuState, MenuStateAlignment, showMenu, useMenu} from './components';\nimport {useSpaceContext} from './space-context';\nimport {TabContainer} from './tabs';\n\ninterface SubjectItem {\n\tgroup?: ConsoleSpaceGroup;\n\tsubject: ConsoleSpaceSubject;\n}\n\nconst offset = {offsetX: 0, offsetY: -1};\n\nconst DropdownTabContainer = styled(TabContainer)`\n\t&:hover {\n\t\t> span:nth-child(3) {\n\t\t\topacity: 1;\n\t\t}\n\t}\n\t> span:nth-child(3) {\n\t\theight: 20px;\n\t\ttext-align: center;\n\t\tline-height: 20px;\n\t\tmargin-left: calc(var(--margin) / 4);\n\t\tpadding: 0 calc(var(--margin) / 3);\n\t\tborder-radius: 10px;\n\t\tcolor: var(--invert-color);\n\t\tbackground-color: ${({ active }) => active ? 'var(--console-primary-color)' : 'var(--console-font-color)'};\n\t\topacity: ${({ active }) => active ? 1 : 0.6};\n\t\ttransform-origin: center center;\n\t\ttransform: scaleX(0.8) scaleY(0.8);\n\t\ttransition: all 300ms ease-in-out;\n\t}\n\t> button {\n\t\tmargin-left: calc(var(--margin) / 4);\n\t\tcolor: ${({ active }) => active ? 'var(--console-primary-color)' : 'var(--console-font-color)'};\n\t\topacity: ${({ active }) => active ? 1 : 0.6};\n\t\ttransition: all 300ms ease-in-out;\n\t}\n`;\nconst DropdownMenuItem = styled(MenuItem)`\n\t&:hover {\n\t\t> button:nth-child(3) {\n\t\t\topacity: 1;\n\t\t\tpointer-events: auto;\n\t\t}\n\t}\n\t> button:nth-child(3) {\n\t\tmargin-left: calc(var(--margin) / 4);\n\t\topacity: 0;\n\t\tpointer-events: none;\n\t}\n`;\n\nexport const DropdownTab = forwardRef((props: {\n\tactive: boolean;\n\ticon: IconProp;\n\tlabel?: string;\n\tonTabClicked: () => void;\n\tonTabCloseClicked: () => void;\n\tshowDropdown: () => void;\n\tdropdownItemsCount: number;\n\tchildren?: ((props: any) => React.ReactNode) | React.ReactNode;\n}, ref: ForwardedRef<HTMLDivElement>) => {\n\tconst {\n\t\tactive,\n\t\ticon, label,\n\t\tonTabClicked, onTabCloseClicked, showDropdown, dropdownItemsCount,\n\t\tchildren\n\t} = props;\n\n\tconst onMoreClicked = (event: React.MouseEvent) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tshowDropdown();\n\t};\n\tconst onCloseClicked = (event: React.MouseEvent) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tonTabCloseClicked();\n\t};\n\n\treturn <DropdownTabContainer active={active} onClick={onTabClicked} ref={ref}>\n\t\t<FontAwesomeIcon icon={icon}/>\n\t\t<span>{label}</span>\n\t\t{children\n\t\t\t? <span>{dropdownItemsCount + 1}</span>\n\t\t\t: null}\n\t\t{children\n\t\t\t? <LinkButton onClick={onMoreClicked} ignoreHorizontalPadding={true}>\n\t\t\t\t<FontAwesomeIcon icon={faEllipsisH}/>\n\t\t\t</LinkButton>\n\t\t\t: null}\n\t\t<LinkButton onClick={onCloseClicked} ignoreHorizontalPadding={true}>\n\t\t\t<FontAwesomeIcon icon={faTimes}/>\n\t\t</LinkButton>\n\t\t{children}\n\t\t<div/>\n\t\t<div/>\n\t</DropdownTabContainer>;\n});\n\nexport const DropdownTabWithData = <T extends ConsoleSpaceGroup | SubjectItem>(props: {\n\tactive: boolean;\n\ttab: {\n\t\ticon: IconProp;\n\t\tlabel: string;\n\t\tonClicked: () => void;\n\t\tonCloseClicked: () => void;\n\t},\n\tdropdown: {\n\t\titems: Array<T>;\n\t\tonClicked: (item: T) => void;\n\t\tonCloseClicked: (item: T) => void;\n\t\tasKey: (item: T) => string;\n\t\tasLabel: (item: T) => string;\n\t}\n}) => {\n\tconst {\n\t\tactive,\n\t\ttab: { icon, label, onClicked: onTabClicked, onCloseClicked: onTabCloseClicked },\n\t\tdropdown: {\n\t\t\titems: dropdownItems,\n\t\t\tonClicked: onItemClicked,\n\t\t\tonCloseClicked: onItemCloseClicked,\n\t\t\tasKey: itemAsKey,\n\t\t\tasLabel: itemAsLabel\n\t\t}\n\t} = props;\n\n\tconst containerRef = useRef<HTMLDivElement>(null);\n\tconst [ menuState, setMenuState ] = useState<MenuState>({\n\t\talign: MenuStateAlignment.RIGHT,\n\t\tleft: 0,\n\t\tright: 0,\n\t\ttop: 0,\n\t\tvisible: false\n\t});\n\tuseMenu({ containerRef, state: menuState, changeState: setMenuState, ...offset });\n\n\tconst onMenuItemClicked = (item: T) => (event: React.MouseEvent) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\thideMenu({ containerRef, changeState: setMenuState, align: menuState.align, ...offset });\n\t\tonItemClicked(item);\n\t};\n\tconst onMenuItemCloseClicked = (item: T) => (event: React.MouseEvent) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tonItemCloseClicked(item);\n\t};\n\n\tconst showDropdown = () => showMenu({\n\t\tcontainerRef,\n\t\tstate: menuState,\n\t\tchangeState: setMenuState,\n\t\t...offset\n\t});\n\n\treturn <DropdownTab active={active} icon={icon} label={label}\n\t                    onTabClicked={onTabClicked} onTabCloseClicked={onTabCloseClicked}\n\t                    showDropdown={showDropdown} dropdownItemsCount={dropdownItems.length}\n\t                    ref={containerRef}>\n\t\t{dropdownItems.length !== 0\n\t\t\t? <Menu {...menuState} itemCount={dropdownItems.length}>\n\t\t\t\t{dropdownItems.map(item => {\n\t\t\t\t\treturn <DropdownMenuItem key={itemAsKey(item)} onClick={onMenuItemClicked(item)}>\n\t\t\t\t\t\t<FontAwesomeIcon icon={icon}/>\n\t\t\t\t\t\t<span>{itemAsLabel(item)}</span>\n\t\t\t\t\t\t<LinkButton onClick={onMenuItemCloseClicked(item)} ignoreHorizontalPadding={true}>\n\t\t\t\t\t\t\t<FontAwesomeIcon icon={faTimes}/>\n\t\t\t\t\t\t</LinkButton>\n\t\t\t\t\t</DropdownMenuItem>;\n\t\t\t\t})}\n\t\t\t</Menu>\n\t\t\t: null}\n\t</DropdownTab>;\n};\n\nexport const GroupTab = (props: { space: ConnectedConsoleSpace }) => {\n\tconst { space } = props;\n\n\tconst location = useLocation();\n\tconst {\n\t\tstore: { activeGroupId },\n\t\tisGroupOpened, openGroupIfCan, closeGroupIfCan,\n\t\taddGroupClosedListener, removeGroupClosedListener,\n\t\taddGroupRenamedListener, removeGroupRenamedListener\n\t} = useSpaceContext();\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\t// group already be removed from active stack, force update is only option here\n\t\taddGroupClosedListener(forceUpdate);\n\t\taddGroupRenamedListener(forceUpdate);\n\t\treturn () => {\n\t\t\tremoveGroupClosedListener(forceUpdate);\n\t\t\tremoveGroupRenamedListener(forceUpdate);\n\t\t};\n\t}, [ addGroupClosedListener, removeGroupClosedListener, addGroupRenamedListener, removeGroupRenamedListener, forceUpdate ]);\n\n\tconst { groups } = space;\n\tlet openedGroups = groups.filter(isGroupOpened).sort((g1, g2) => g1.name.toUpperCase().localeCompare(g2.name.toUpperCase()));\n\t// eslint-disable-next-line\n\tconst activeGroup = openedGroups.length !== 0 ? openedGroups.find(g => g.groupId == activeGroupId)! : null;\n\n\tif (!activeGroup) {\n\t\treturn null;\n\t}\n\n\tconst isGroupsActive = matchPath<{ groupId: string }>(location.pathname, Path.CONSOLE_CONNECTED_SPACE_GROUP);\n\topenedGroups = openedGroups.filter(g => g !== activeGroup);\n\n\tconst onGroupTabClicked = () => openGroupIfCan({ space, group: activeGroup });\n\tconst onGroupTabCloseClicked = () => closeGroupIfCan({ space, group: activeGroup });\n\tconst onGroupOpenClicked = (group: ConsoleSpaceGroup) => openGroupIfCan({ space, group });\n\tconst onGroupCloseClicked = (group: ConsoleSpaceGroup) => closeGroupIfCan({ space, group });\n\tconst asKey = (group: ConsoleSpaceGroup) => group.groupId;\n\tconst asLabel = (group: ConsoleSpaceGroup) => group.name;\n\n\tconst tab = {\n\t\ticon: faCube,\n\t\tlabel: activeGroup.name,\n\t\tonClicked: onGroupTabClicked,\n\t\tonCloseClicked: onGroupTabCloseClicked\n\t};\n\tconst dropdown = {\n\t\titems: openedGroups,\n\t\tonClicked: onGroupOpenClicked,\n\t\tonCloseClicked: onGroupCloseClicked,\n\t\tasKey,\n\t\tasLabel\n\t};\n\n\treturn <DropdownTabWithData active={!!isGroupsActive} tab={tab} dropdown={dropdown}/>;\n};\n\nconst asSubjectLabel = (data: { group?: ConsoleSpaceGroup, subject: ConsoleSpaceSubject }): string => {\n\tconst { group, subject } = data;\n\treturn group ? `${group.name} / ${subject.name}` : subject.name;\n};\n\nconst getAllSubjects = (space: ConnectedConsoleSpace, isSubjectOpened: (subject: ConsoleSpaceSubject) => boolean) => {\n\tconst { groups } = space;\n\treturn [\n\t\t...space.subjects.map(s => ({\n\t\t\tgroup: void 0,\n\t\t\tsubject: s\n\t\t})),\n\t\t...groups.map(g => g.subjects.map(s => ({\n\t\t\tgroup: g,\n\t\t\tsubject: s\n\t\t}))).flat()\n\t].filter(({ subject }) => isSubjectOpened(subject));\n};\nconst sortSubjects = (subjects: Array<SubjectItem>) => {\n\treturn subjects\n\t\t.sort((s1, s2) => {\n\t\t\tswitch (true) {\n\t\t\t\tcase !s1.group && !s2.group:\n\t\t\t\t\treturn s1.subject.name.toUpperCase().localeCompare(s2.subject.name.toUpperCase());\n\t\t\t\tcase !s1.group && s2.group:\n\t\t\t\t\treturn -1;\n\t\t\t\tcase s1.group && !s2.group:\n\t\t\t\t\treturn 1;\n\t\t\t\tcase !!s1.group && !!s2.group:\n\t\t\t\tdefault:\n\t\t\t\t\tconst groupCompare = s1.group!.name.toUpperCase().localeCompare(s2.group!.name.toUpperCase());\n\t\t\t\t\tif (groupCompare === 0) {\n\t\t\t\t\t\treturn s1.subject.name.toUpperCase().localeCompare(s2.subject.name.toUpperCase());\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn groupCompare;\n\t\t\t\t\t}\n\t\t\t}\n\t\t});\n};\n\nexport const SubjectTab = (props: { space: ConnectedConsoleSpace }) => {\n\tconst { space } = props;\n\n\tconst location = useLocation();\n\tconst {\n\t\tstore: {activeSubjectId},\n\t\tisSubjectOpened, openSubjectIfCan, closeSubjectIfCan,\n\t\taddSubjectRenamedListener, removeSubjectRenamedListener,\n\t\taddSubjectClosedListener, removeSubjectClosedListener\n\t} = useSpaceContext();\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\t// subject already be removed from active stack, force update is only option here\n\t\taddSubjectClosedListener(forceUpdate);\n\t\taddSubjectRenamedListener(forceUpdate);\n\t\treturn () => {\n\t\t\tremoveSubjectClosedListener(forceUpdate);\n\t\t\tremoveSubjectRenamedListener(forceUpdate);\n\t\t}\n\t}, [\n\t\taddSubjectClosedListener, removeSubjectClosedListener,\n\t\taddSubjectRenamedListener, removeSubjectRenamedListener,\n\t\tforceUpdate\n\t]);\n\n\t// eslint-disable-next-line\n\tconst allSubjects = getAllSubjects(space, isSubjectOpened);\n\tlet openedSubjects = sortSubjects(allSubjects);\n\t// eslint-disable-next-line\n\tconst activeSubject = openedSubjects.length !== 0 ? openedSubjects.find(s => s.subject.subjectId == activeSubjectId)! : null;\n\n\tif (!activeSubject) {\n\t\treturn null;\n\t}\n\n\tconst isSubjectsActive = matchPath<{ subjectId: string }>(location.pathname, Path.CONSOLE_CONNECTED_SPACE_SUBJECT);\n\topenedSubjects = openedSubjects.filter(s => s !== activeSubject);\n\n\tconst onSubjectTabClicked = () => openSubjectIfCan({ space, ...activeSubject });\n\tconst onSubjectTabCloseClicked = () => closeSubjectIfCan({ space, ...activeSubject });\n\tconst onSubjectOpenClicked = ({ subject, group }: SubjectItem) => openSubjectIfCan({ space, group, subject });\n\tconst onSubjectCloseClicked = ({ subject, group }: SubjectItem) => closeSubjectIfCan({ space, group, subject });\n\tconst asKey = ({ subject }: SubjectItem) => subject.subjectId;\n\tconst asLabel = ({ subject, group }: SubjectItem) => asSubjectLabel({ group, subject });\n\n\tconst tab = {\n\t\ticon: faCube,\n\t\tlabel: asSubjectLabel(activeSubject),\n\t\tonClicked: onSubjectTabClicked,\n\t\tonCloseClicked: onSubjectTabCloseClicked\n\t};\n\tconst dropdown = {\n\t\titems: openedSubjects,\n\t\tonClicked: onSubjectOpenClicked,\n\t\tonCloseClicked: onSubjectCloseClicked,\n\t\tasKey,\n\t\tasLabel\n\t};\n\n\treturn <DropdownTabWithData active={!!isSubjectsActive} tab={tab} dropdown={dropdown}/>;\n};","import { faTrashAlt } from '@fortawesome/free-regular-svg-icons';\nimport { faCaretDown, faCompactDisc, faCube, faGlobe, faPenAlt, faPoll } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport dayjs from 'dayjs';\nimport React, { Fragment, useRef, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport styled from 'styled-components';\nimport Path from '../../../common/path';\nimport { useForceUpdate } from '../../../common/utils';\nimport {\n\tcreateGroup,\n\tcreateSubject,\n\tdeleteConnectedSpace,\n\trenameConnectedSpace\n} from '../../../services/console/space';\nimport { ConnectedConsoleSpace, ConsoleSpaceType } from '../../../services/console/types';\nimport Button, { ButtonType } from '../../component/button';\nimport { useDialog } from '../../context/dialog';\nimport { useConsoleContext } from '../context/console-context';\nimport { hideMenu, Menu, MenuItem, MenuSeparator, MenuState, showMenu, useMenu } from './components';\nimport { createRenameClickHandler } from './dialog';\nimport { useSpaceContext } from './space-context';\n\nconst Title = styled.div.attrs({\n\t'data-widget': 'console-space-title'\n})`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\tfont-family: var(--console-title-font-family);\n\tpadding-right: calc(var(--margin) / 2);\n\tmargin-top: 14px;\n\tmargin-bottom: 6px;\n\theight: 30px;\n\tcursor: pointer;\n\t> svg:first-child {\n\t\tmargin-right: calc(var(--margin) / 5);\n\t\topacity: 0.7;\n\t}\n\t> span {\n\t\tfont-size: 1.2em;\n\t}\n\t> svg:nth-child(3) {\n\t\tmargin-left: calc(var(--margin) / 5);\n\t\twidth: 24px;\n\t\topacity: 0.7;\n\t\ttransition: all 300ms ease-in-out;\n\t\t&[data-menu-shown=true] {\n\t\t\ttransform: rotateX(180deg);\n\t\t}\n\t}\n`;\n\nexport const SpaceHeaderTitle = (props: { space: ConnectedConsoleSpace }) => {\n\tconst { space } = props;\n\n\tconst history = useHistory();\n\tconst dialog = useDialog();\n\tconst { spaces: { deleteSpace: deleteSpaceFromMemory, spaceRenamed } } = useConsoleContext();\n\tconst { openGroupIfCan, openSubjectIfCan } = useSpaceContext();\n\tconst containerRef = useRef<HTMLDivElement>(null);\n\tconst forceUpdate = useForceUpdate();\n\tconst [ menuShown, setMenuShown ] = useState<MenuState>({\n\t\tleft: 0,\n\t\tright: 0,\n\t\ttop: 0,\n\t\tvisible: false\n\t});\n\tuseMenu({ containerRef: containerRef, state: menuShown, changeState: setMenuShown, offsetY: 6 });\n\n\tconst onTitleClicked = () => showMenu({ containerRef, state: menuShown, changeState: setMenuShown, offsetY: 6 });\n\tconst onAddGroupClicked = async () => {\n\t\thideMenu({ containerRef, changeState: setMenuShown, offsetY: 6 });\n\t\tconst newGroup = {\n\t\t\t// fake id\n\t\t\tgroupId: '',\n\t\t\tname: 'Noname',\n\t\t\tsubjects: []\n\t\t};\n\t\tspace.groups.push(newGroup);\n\t\tawait createGroup({ space, group: newGroup });\n\t\topenGroupIfCan({ space, group: newGroup });\n\t};\n\tconst onAddSubjectClicked = async () => {\n\t\thideMenu({ containerRef, changeState: setMenuShown, offsetY: 6 });\n\t\tconst now = dayjs().format('YYYY-MM-DD HH:mm:ss');\n\t\tconst newSubject = {\n\t\t\tsubjectId: '',\n\t\t\tname: 'Noname',\n\t\t\ttopicCount: 0,\n\t\t\tgraphicsCount: 0,\n\t\t\tlastVisitTime: now,\n\t\t\tcreatedAt: now\n\t\t};\n\t\tspace.subjects.push(newSubject);\n\t\tawait createSubject({ space, subject: newSubject });\n\t\topenSubjectIfCan({ space, subject: newSubject });\n\t};\n\tconst onRenameClicked = createRenameClickHandler({\n\t\tdialog, space,\n\t\tasFullName: () => space.name,\n\t\trenameObject: (options, newName) => space.name = newName,\n\t\tonRenamed: () => {\n\t\t\tspaceRenamed(space);\n\t\t\trenameConnectedSpace(space.connectId, space.name);\n\t\t\tforceUpdate();\n\t\t}\n\t});\n\tconst onDeleteClicked = () => {\n\t\tconst onDeleteConfirmClicked = async () => {\n\t\t\ttry {\n\t\t\t\tawait deleteConnectedSpace(space);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.groupCollapsed(`%cError on delete space.`, 'color:rgb(251,71,71)');\n\t\t\t\tconsole.error('Space: ', space);\n\t\t\t\tconsole.error(e);\n\t\t\t\tconsole.groupEnd();\n\t\t\t}\n\t\t\tdialog.hide();\n\t\t\tdeleteSpaceFromMemory(space);\n\t\t\thistory.replace(Path.CONSOLE_HOME);\n\t\t};\n\t\tdialog.show(\n\t\t\t<div data-widget='dialog-console-delete'>\n\t\t\t\t<span>Are you sure to delete space?</span>\n\t\t\t\t<span data-widget='dialog-console-object'>{space.name}</span>\n\t\t\t</div>,\n\t\t\t<Fragment>\n\t\t\t\t<div style={{ flexGrow: 1 }}/>\n\t\t\t\t<Button inkType={ButtonType.PRIMARY} onClick={onDeleteConfirmClicked}>Yes</Button>\n\t\t\t\t<Button inkType={ButtonType.DEFAULT} onClick={dialog.hide}>Cancel</Button>\n\t\t\t</Fragment>\n\t\t);\n\t};\n\n\treturn <Title onClick={onTitleClicked} ref={containerRef}>\n\t\t<FontAwesomeIcon icon={space.type === ConsoleSpaceType.PUBLIC ? faGlobe : faCompactDisc}/>\n\t\t<span>{space.name}</span>\n\t\t<FontAwesomeIcon icon={faCaretDown} data-menu-shown={menuShown.visible}/>\n\t\t<Menu {...menuShown} itemCount={4} separatorCount={1}>\n\t\t\t<MenuItem onClick={onAddGroupClicked}>\n\t\t\t\t<FontAwesomeIcon icon={faCube}/>\n\t\t\t\t<span>Add Group</span>\n\t\t\t</MenuItem>\n\t\t\t<MenuItem onClick={onAddSubjectClicked}>\n\t\t\t\t<FontAwesomeIcon icon={faPoll}/>\n\t\t\t\t<span>Add Subject</span>\n\t\t\t</MenuItem>\n\t\t\t<MenuSeparator/>\n\t\t\t<MenuItem onClick={onRenameClicked}>\n\t\t\t\t<FontAwesomeIcon icon={faPenAlt}/>\n\t\t\t\t<span>Rename</span>\n\t\t\t</MenuItem>\n\t\t\t<MenuItem onClick={onDeleteClicked}>\n\t\t\t\t<FontAwesomeIcon icon={faTrashAlt}/>\n\t\t\t\t<span>Delete Space</span>\n\t\t\t</MenuItem>\n\t\t</Menu>\n\t</Title>;\n};\n","import { faBezierCurve, faServer } from '@fortawesome/free-solid-svg-icons';\nimport React from 'react';\nimport { matchPath, useHistory, useLocation } from 'react-router-dom';\nimport Path, { toConnectedSpace } from '../../../common/path';\nimport { ConnectedConsoleSpace } from '../../../services/console/types';\nimport { Header } from './components';\nimport { GroupTab, SubjectTab } from './space-header-dropdown-tab';\nimport { SpaceHeaderTitle } from './space-header-title';\nimport { Tab, Tabs } from './tabs';\n\nexport const ConnectedSpaceHeader = (props: {\n\tspace: ConnectedConsoleSpace\n}) => {\n\tconst { space } = props;\n\n\tconst location = useLocation();\n\tconst history = useHistory();\n\n\tconst isOverallActive = !!matchPath(location.pathname, Path.CONSOLE_CONNECTED_SPACE_OVERALL);\n\tconst isResourcesActive = !!matchPath(location.pathname, Path.CONSOLE_CONNECTED_SPACE_RESOURCES);\n\n\tconst onOverallClicked = () => history.push(toConnectedSpace(Path.CONSOLE_CONNECTED_SPACE_OVERALL, space.connectId));\n\tconst onResourcesClicked = () => history.push(toConnectedSpace(Path.CONSOLE_CONNECTED_SPACE_RESOURCES, space.connectId));\n\n\treturn <Header>\n\t\t<SpaceHeaderTitle space={space}/>\n\t\t<Tabs>\n\t\t\t<Tab active={isOverallActive} icon={faServer} label='Overall'\n\t\t\t     onClick={onOverallClicked}/>\n\t\t\t<GroupTab space={space}/>\n\t\t\t<SubjectTab space={space}/>\n\t\t\t<Tab active={isResourcesActive} icon={faBezierCurve} label='Available Resources'\n\t\t\t     onClick={onResourcesClicked}/>\n\t\t</Tabs>\n\t</Header>;\n};\n","import React from 'react';\nimport { Redirect, useParams } from 'react-router-dom';\nimport Path from '../../../common/path';\nimport { useConsoleContext } from '../context/console-context';\nimport { Container } from './components';\nimport { ConnectedSpaceBody } from './space-body';\nimport { SpaceContextProvider } from './space-context';\nimport { ConnectedSpaceHeader } from './space-header';\n\nconst ConnectedSpaceContent = () => {\n\tconst { connectId } = useParams<{ connectId: string }>();\n\n\tconst { spaces: { connected: spaces } } = useConsoleContext();\n\n\t// eslint-disable-next-line\n\tconst space = spaces.find(space => space.connectId == connectId)!;\n\n\tif (!space) {\n\t\treturn <Redirect to={Path.CONSOLE_HOME}/>;\n\t}\n\n\treturn <Container>\n\t\t<ConnectedSpaceHeader space={space}/>\n\t\t<ConnectedSpaceBody space={space}/>\n\t</Container>;\n};\n\nexport const ConnectedSpace = () => {\n\treturn <SpaceContextProvider>\n\t\t<ConnectedSpaceContent/>\n\t</SpaceContextProvider>;\n};\n","export default __webpack_public_path__ + \"static/media/console-dashboard-background.e7f7ef12.png\";","import React, { Fragment } from 'react';\nimport { createDashboard } from '../../../services/console/dashboard';\nimport { ConsoleDashboard } from '../../../services/console/types';\nimport Button, { ButtonType } from '../../component/button';\nimport Input from '../../component/input';\nimport { DialogContext } from '../../context/dialog';\n\nexport const createCreateDashboardClickHandler = (options: {\n\tdialog: DialogContext,\n\tonCreated: (dashboard: ConsoleDashboard) => void;\n}) => async (event: React.MouseEvent) => {\n\tconst { dialog, onCreated } = options;\n\n\tlet name = '';\n\tconst onTextChanged = (event: React.ChangeEvent<HTMLInputElement>) => {\n\t\tname = event.target.value;\n\t};\n\tconst showDialog = (content: JSX.Element) => {\n\t\tdialog.show(\n\t\t\tcontent,\n\t\t\t<Fragment>\n\t\t\t\t<div style={{ flexGrow: 1 }}/>\n\t\t\t\t<Button inkType={ButtonType.PRIMARY} onClick={onConfirmClicked}>Yes</Button>\n\t\t\t\t<Button inkType={ButtonType.DEFAULT} onClick={dialog.hide}>Cancel</Button>\n\t\t\t</Fragment>\n\t\t);\n\t};\n\tconst createContent = (error: boolean = false) => {\n\t\treturn <div data-widget='dialog-console-create'>\n\t\t\t<span>New dashboard name:</span>\n\t\t\t<Input onChange={onTextChanged} defaultValue={name} data-error={error}/>\n\t\t\t<span>Name is required.</span>\n\t\t</div>;\n\t};\n\tconst onConfirmClicked = async () => {\n\t\tif (!(name.trim())) {\n\t\t\tshowDialog(createContent(true));\n\t\t\treturn;\n\t\t}\n\t\tconst dashboard = await createDashboard(name.trim());\n\t\tonCreated(dashboard);\n\t\tdialog.hide();\n\t};\n\tshowDialog(createContent());\n};","import React, {Fragment} from 'react';\nimport {ConnectedConsoleSpace, ConsoleSpaceSubject, ConsoleSpaceSubjectChart} from '../../../services/console/types';\nimport Button, {ButtonType} from '../../component/button';\nimport {DialogContext} from '../../context/dialog';\nimport Dropdown, {DropdownOption} from \"../../component/dropdown\";\nimport styled from \"styled-components\";\n\ninterface SpaceOption extends DropdownOption {\n\tspace: ConnectedConsoleSpace\n}\n\ninterface SubjectOption extends DropdownOption {\n\tsubject: ConsoleSpaceSubject;\n}\n\ninterface ChartOption extends DropdownOption {\n\tchart: ConsoleSpaceSubjectChart;\n}\n\nconst AddChartContainer = styled.div`\n\t> div {\n\t\tmargin-bottom: calc(var(--margin) / 4);\n\t}\n`;\n\nconst buildSubjectOptions = (space: ConnectedConsoleSpace) => {\n\treturn space.subjects.map(subject => {\n\t\tif (!subject.graphics || subject.graphics.length === 0) {\n\t\t\treturn null;\n\t\t}\n\t\treturn {value: subject.subjectId, label: subject.name, subject};\n\t}).filter(x => !!x) as Array<SubjectOption>;\n};\n\nconst buildChartOptions = (subject: ConsoleSpaceSubject) => {\n\treturn (subject.graphics || []).map(chart => {\n\t\treturn {value: chart.chartId!, label: chart.name, chart};\n\t});\n};\n\nexport const createAddChartClickHandler = (options: {\n\tdialog: DialogContext,\n\tconnectedSpaces: Array<ConnectedConsoleSpace>;\n\tonSelected: (space: ConnectedConsoleSpace, subject: ConsoleSpaceSubject, chart: ConsoleSpaceSubjectChart) => void;\n}) => async (event: React.MouseEvent) => {\n\tconst {dialog, connectedSpaces, onSelected} = options;\n\n\tlet selectedSpace: ConnectedConsoleSpace;\n\tlet selectedSubject: ConsoleSpaceSubject;\n\tlet selectedChart: ConsoleSpaceSubjectChart;\n\n\tlet subjects: Array<SubjectOption> = [];\n\tlet charts: Array<ChartOption> = [];\n\tconst spaces: Array<SpaceOption> = connectedSpaces.map(connected => {\n\t\t// ignore space which has no subject\n\t\t// or subject has not chart\n\t\tif (!connected.subjects || connected.subjects.length === 0\n\t\t\t|| connected.subjects.every(subject => !subject.graphics || subject.graphics.length === 0)) {\n\t\t\treturn null;\n\t\t}\n\t\treturn {value: connected.connectId, label: connected.name, space: connected};\n\t}).filter(x => !!x) as Array<SpaceOption>;\n\n\tconst onSpaceChanged = async (option: DropdownOption, refresh: boolean = true) => {\n\t\tconst space = (option as SpaceOption).space;\n\t\t// eslint-disable-next-line\n\t\tif (space.connectId != selectedSpaceId) {\n\t\t\tselectedSpace = space;\n\t\t\tselectedSpaceId = space.connectId;\n\t\t\tsubjects = buildSubjectOptions(space);\n\t\t\tawait onSubjectChanged(subjects[0], false);\n\t\t}\n\n\t\trefresh && showDialog(createContent());\n\t};\n\tconst onSubjectChanged = async (option: DropdownOption, refresh: boolean = true) => {\n\t\tconst subject = (option as SubjectOption).subject;\n\t\t// eslint-disable-next-line\n\t\tif (subject.subjectId != selectedSubjectId) {\n\t\t\tselectedSubject = subject;\n\t\t\tselectedSubjectId = subject.subjectId;\n\t\t\tcharts = buildChartOptions(subject);\n\t\t\tawait onChartChanged(charts[0], false);\n\t\t}\n\t\trefresh && showDialog(createContent());\n\t};\n\tconst onChartChanged = async (option: DropdownOption, refresh: boolean = true) => {\n\t\tselectedChart = (option as ChartOption).chart;\n\t\tselectedChartId = selectedChart.chartId!;\n\t\trefresh && showDialog(createContent());\n\t};\n\tlet selectedChartId: string;\n\tlet selectedSubjectId: string;\n\tlet selectedSpaceId: string;\n\n\tconst showDialog = (content: JSX.Element) => {\n\t\tdialog.show(\n\t\t\tcontent,\n\t\t\t<Fragment>\n\t\t\t\t<div style={{flexGrow: 1}}/>\n\t\t\t\t<Button inkType={ButtonType.PRIMARY} onClick={onConfirmClicked}>Yes</Button>\n\t\t\t\t<Button inkType={ButtonType.DEFAULT} onClick={dialog.hide}>Cancel</Button>\n\t\t\t</Fragment>\n\t\t);\n\t};\n\tconst createContent = (error: boolean = false) => {\n\t\treturn <AddChartContainer>\n\t\t\t<div>Pick chart:</div>\n\t\t\t<Dropdown value={selectedSpaceId} options={spaces} onChange={onSpaceChanged}/>\n\t\t\t<Dropdown value={selectedSubjectId} options={subjects} onChange={onSubjectChanged}/>\n\t\t\t<Dropdown value={selectedChartId} options={charts} onChange={onChartChanged}/>\n\t\t</AddChartContainer>;\n\t};\n\tconst onConfirmClicked = async () => {\n\t\tonSelected(selectedSpace, selectedSubject, selectedChart);\n\t\tdialog.hide();\n\t};\n\n\tconst showReminder = () => {\n\t\tdialog.show(\n\t\t\t<div data-widget='dialog-console-switch'>\n\t\t\t\t<span>No chart is ready.</span>\n\t\t\t</div>,\n\t\t\t<Fragment>\n\t\t\t\t<div style={{flexGrow: 1}}/>\n\t\t\t\t<Button inkType={ButtonType.PRIMARY} onClick={dialog.hide}>Close</Button>\n\t\t\t</Fragment>\n\t\t);\n\t};\n\n\tawait (async () => {\n\t\tif (spaces.length === 0) {\n\t\t\tshowReminder();\n\t\t} else {\n\t\t\tawait onSpaceChanged(spaces[0], false);\n\t\t\tif (charts.length === 0) {\n\t\t\t\tshowReminder();\n\t\t\t} else {\n\t\t\t\tshowDialog(createContent());\n\t\t\t}\n\t\t}\n\t})();\n};","import {\n\tfaPenSquare,\n\tfaPoll,\n\tfaSatelliteDish,\n\tfaShare,\n\tfaTachometerAlt,\n\tfaTrashAlt\n} from '@fortawesome/free-solid-svg-icons';\nimport {FontAwesomeIcon} from '@fortawesome/react-fontawesome';\nimport React, {Fragment, useRef, useState} from 'react';\nimport styled from 'styled-components';\nimport {useForceUpdate} from '../../../common/utils';\nimport {\n\tConnectedConsoleSpace,\n\tConsoleDashboard,\n\tConsoleDashboardChart,\n\tConsoleSpaceSubject,\n\tConsoleSpaceSubjectChart\n} from '../../../services/console/types';\nimport {LinkButton} from '../../component/console/link-button';\nimport {useDialog} from '../../context/dialog';\nimport {useConsoleContext} from '../context/console-context';\nimport {createCreateDashboardClickHandler} from './create-dashboard-handler';\nimport {createDeleteDashboardClickHandler} from './delete-dashboard-handler';\nimport {createRenameDashboardClickHandler} from './rename-dashboard-handler';\nimport {createSwitchDashboardClickHandler} from './switch-dashboard-handler';\nimport Button, {ButtonType} from \"../../component/button\";\nimport {createAddChartClickHandler} from \"./add-chart-handler\";\nimport {CHART_ASPECT_RATIO, CHART_HEADER_HEIGHT, INIT_MIN_WIDTH} from \"../connected-space/subject-view/graphics/utils\";\nimport {v4} from \"uuid\";\nimport {Chart} from \"../connected-space/subject-view/graphics/chart\";\nimport {SubjectContextProvider} from \"../connected-space/subject-view/context\";\nimport {saveDashboard} from \"../../../services/console/dashboard\";\n\nconst DashboardContainer = styled.div`\n\tdisplay: flex;\n\tflex-direction: column;\n\twidth: 100%;\n\t&[data-visible=false] {\n\t\tdisplay: none;\n\t}\n`;\nconst DashboardHeader = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\tborder-bottom: var(--border);\n\t> button {\n\t\talign-self: flex-end;\n\t\twidth: 28px;\n\t\theight: 28px;\n\t\tfont-size: 1.2em;\n\t}\n`;\nconst DashboardTitle = styled.div`\n\tfont-size: 3em;\n\tfont-family: var(--console-title-font-family);\n\tflex-grow: 1;\n\tdisplay: flex;\n\t> button {\n\t\tmargin-left: calc(var(--margin) / 2);\n\t\tfont-size: 0.7em;\n\t\tpadding: 0 calc(var(--margin) / 2);\n\t}\n`;\nconst DashboardBody = styled.div`\n\tdisplay: block;\n\tposition: relative;\n\tflex-grow: 1;\n\tbackground-color: var(--bg-color);\n\toverflow: auto;\n\t&::-webkit-scrollbar {\n\t\tbackground-color: transparent;\n\t\theight: 4px;\n\t\twidth: 4px;\n\t}\n\t&::-webkit-scrollbar-track {\n\t\tbackground-color: var(--scrollbar-background-color);\n\t\tborder-radius: 2px;\n\t}\n\t&::-webkit-scrollbar-thumb {\n\t\tbackground-color: var(--console-favorite-color);\n\t\tborder-radius: 2px;\n\t}\n`;\n\nexport const Dashboard = () => {\n\tconst dialog = useDialog();\n\tconst {\n\t\tspaces: {available: spaces, connected: connectedSpaces},\n\t\tdashboards: {\n\t\t\titems: dashboards,\n\t\t\taddDashboard, deleteDashboard\n\t\t}\n\t} = useConsoleContext();\n\tconst containerRef = useRef<HTMLDivElement>(null);\n\tconst [saveHandle, setSaveHandle] = useState<{ handle?: number, dashboard?: ConsoleDashboard }>({});\n\tconst forceUpdate = useForceUpdate();\n\n\tconst onCopyClicked = (url: string) => () => {\n\t\tnavigator.clipboard.writeText(url);\n\t};\n\tconst onShareClicked = (dashboard: ConsoleDashboard) => () => {\n\t\tconst url = `${window.location.href}/share/${dashboard.dashboardId}`;\n\t\tdialog.show(\n\t\t\t<div data-widget='dialog-console-loading'>\n                <span>\n                    <span>Copy following URL and share:</span>\n\t                <br/>\n                    <span data-widget='dialog-console-object'>{url}</span>\n                </span>\n\t\t\t</div>,\n\t\t\t<Fragment>\n\t\t\t\t<div style={{flexGrow: 1}}/>\n\t\t\t\t<Button inkType={ButtonType.PRIMARY} onClick={onCopyClicked(url)}>Copy</Button>\n\t\t\t\t<Button inkType={ButtonType.PRIMARY} onClick={dialog.hide}>Close</Button>\n\t\t\t</Fragment>\n\t\t);\n\t};\n\tconst onRenameClicked = (dashboard: ConsoleDashboard) => createRenameDashboardClickHandler({\n\t\tdashboard,\n\t\tdialog,\n\t\tonRenamed: (dashboard) => forceUpdate()\n\t});\n\tconst onAddChartClicked = (dashboard: ConsoleDashboard) => createAddChartClickHandler({\n\t\tdialog,\n\t\tconnectedSpaces,\n\t\tonSelected: (space: ConnectedConsoleSpace, subject: ConsoleSpaceSubject, chart: ConsoleSpaceSubjectChart) => {\n\t\t\tconsole.log(space, subject, chart);\n\t\t\tif (!dashboard.graphics) {\n\t\t\t\tdashboard.graphics = [];\n\t\t\t}\n\t\t\tdashboard.graphics.push({\n\t\t\t\tspaceId: space.spaceId,\n\t\t\t\tconnectId: space.connectId,\n\t\t\t\tsubjectId: subject.subjectId,\n\t\t\t\tchartId: chart.chartId!,\n\t\t\t\trect: {\n\t\t\t\t\ttop: 0,\n\t\t\t\t\tleft: 0,\n\t\t\t\t\twidth: (chart.rect || {width: INIT_MIN_WIDTH}).width,\n\t\t\t\t\theight: (chart.rect || {height: INIT_MIN_WIDTH * CHART_ASPECT_RATIO + CHART_HEADER_HEIGHT}).height\n\t\t\t\t}\n\t\t\t});\n\t\t\tforceUpdate();\n\t\t}\n\t});\n\tconst onDeleteClicked = (dashboard: ConsoleDashboard) => createDeleteDashboardClickHandler({\n\t\tdashboard,\n\t\tdialog,\n\t\tonDeleted: (dashboard) => {\n\t\t\tdeleteDashboard(dashboard);\n\t\t\tif (dashboards.length >= 1) {\n\t\t\t\tforceUpdate();\n\t\t\t}\n\t\t}\n\t});\n\tconst onCreateClicked = createCreateDashboardClickHandler({\n\t\tdialog,\n\t\tonCreated: (dashboard) => {\n\t\t\tdashboards.forEach(dashboard => dashboard.current = false);\n\t\t\taddDashboard(dashboard);\n\t\t\tforceUpdate();\n\t\t}\n\t});\n\tconst onSwitchClicked = (dashboard: ConsoleDashboard) => createSwitchDashboardClickHandler({\n\t\tdashboard,\n\t\tdashboards,\n\t\tdialog,\n\t\tonSwitched: (dashboard) => {\n\t\t\tdashboards.forEach(d => d.current = d === dashboard);\n\t\t\tforceUpdate();\n\t\t}\n\t});\n\tconst onChartDelete = (dashboard: ConsoleDashboard) => (chart: ConsoleSpaceSubjectChart) => {\n\t\tconst {chartId} = chart;\n\t\t// eslint-disable-next-line\n\t\tconst index = dashboard.graphics.findIndex(chart => chart.chartId == chartId);\n\t\tdashboard.graphics.splice(index, 1);\n\t\tforceUpdate();\n\t};\n\tconst doSaveChart = (dashboard: ConsoleDashboard, chart: ConsoleSpaceSubjectChart) => async (subject: ConsoleSpaceSubject) => {\n\t\tconst {rect, chartId} = chart;\n\t\t// eslint-disable-next-line\n\t\tconst graph = dashboard.graphics.find(chart => chart.chartId == chartId)!;\n\t\tgraph.rect = rect;\n\t\tif (saveHandle.handle) {\n\t\t\t// another dashboard was in saving queue\n\t\t\tclearTimeout(saveHandle.handle);\n\t\t\tif (saveHandle.dashboard !== dashboard) {\n\t\t\t\t// not current, simply save, don't wait\n\t\t\t\tsaveDashboard(saveHandle.dashboard!);\n\t\t\t}\n\t\t}\n\t\tsetSaveHandle({\n\t\t\thandle: setTimeout(async () => {\n\t\t\t\tsetSaveHandle({});\n\t\t\t\tawait saveDashboard(dashboard);\n\t\t\t}, 10000),\n\t\t\tdashboard\n\t\t});\n\t};\n\n\tlet currentDashboard = dashboards.find(dashboard => dashboard.current);\n\tif (!currentDashboard && dashboards.length > 0) {\n\t\t// current not found\n\t\tcurrentDashboard = dashboards[0];\n\t}\n\n\treturn <DashboardContainer data-visible={!!currentDashboard}>\n\t\t<DashboardHeader>\n\t\t\t<DashboardTitle>\n\t\t\t\t<span>{currentDashboard?.name}</span>\n\t\t\t\t{currentDashboard\n\t\t\t\t\t? <LinkButton ignoreHorizontalPadding={true} onClick={onShareClicked(currentDashboard)}>\n\t\t\t\t\t\t<FontAwesomeIcon icon={faShare}/>\n\t\t\t\t\t</LinkButton>\n\t\t\t\t\t: null}\n\t\t\t</DashboardTitle>\n\t\t\t{currentDashboard\n\t\t\t\t? <LinkButton ignoreHorizontalPadding={true} tooltip='Rename this dashboard'\n\t\t\t\t              right={true} offsetX={-4} offsetY={6}\n\t\t\t\t              onClick={onRenameClicked(currentDashboard)}>\n\t\t\t\t\t<FontAwesomeIcon icon={faPenSquare}/>\n\t\t\t\t</LinkButton>\n\t\t\t\t: null}\n\t\t\t{currentDashboard\n\t\t\t\t? <LinkButton ignoreHorizontalPadding={true} tooltip='Add chart'\n\t\t\t\t              right={true} offsetX={-4} offsetY={6}\n\t\t\t\t              onClick={onAddChartClicked(currentDashboard)}>\n\t\t\t\t\t<FontAwesomeIcon icon={faPoll}/>\n\t\t\t\t</LinkButton>\n\t\t\t\t: null}\n\t\t\t{currentDashboard\n\t\t\t\t? <LinkButton ignoreHorizontalPadding={true} tooltip='Delete this dashboard'\n\t\t\t\t              right={true} offsetX={-4} offsetY={6}\n\t\t\t\t              onClick={onDeleteClicked(currentDashboard)}>\n\t\t\t\t\t<FontAwesomeIcon icon={faTrashAlt}/>\n\t\t\t\t</LinkButton>\n\t\t\t\t: null}\n\t\t\t<LinkButton ignoreHorizontalPadding={true} tooltip='Create new dashboard'\n\t\t\t            right={true} offsetX={-4} offsetY={6}\n\t\t\t            onClick={onCreateClicked}>\n\t\t\t\t<FontAwesomeIcon icon={faTachometerAlt}/>\n\t\t\t</LinkButton>\n\t\t\t{dashboards.length > 1 && currentDashboard\n\t\t\t\t? <LinkButton ignoreHorizontalPadding={true} tooltip='Switch to another dashboard'\n\t\t\t\t              right={true} offsetX={-4} offsetY={6}\n\t\t\t\t              onClick={onSwitchClicked(currentDashboard)}>\n\t\t\t\t\t<FontAwesomeIcon icon={faSatelliteDish}/>\n\t\t\t\t</LinkButton>\n\t\t\t\t: null}\n\t\t</DashboardHeader>\n\t\t<DashboardBody ref={containerRef}>\n\t\t\t{currentDashboard\n\t\t\t\t? (currentDashboard.graphics || []).map((chart: ConsoleDashboardChart) => {\n\t\t\t\t\tif (!chart.chartId) {\n\t\t\t\t\t\tchart.chartId = v4();\n\t\t\t\t\t}\n\t\t\t\t\tconst {spaceId, connectId, subjectId, chartId} = chart;\n\t\t\t\t\t// eslint-disable-next-line\n\t\t\t\t\tconst space = spaces.find(space => space.spaceId == spaceId);\n\t\t\t\t\tif (!space) {\n\t\t\t\t\t\treturn (void 0);\n\t\t\t\t\t}\n\t\t\t\t\t// eslint-disable-next-line\n\t\t\t\t\tconst connectedSpace = connectedSpaces.find(space => space.connectId == connectId);\n\t\t\t\t\tif (!connectedSpace) {\n\t\t\t\t\t\treturn (void 0);\n\t\t\t\t\t}\n\t\t\t\t\t// eslint-disable-next-line\n\t\t\t\t\tconst subject = connectedSpace.subjects.find(subject => subject.subjectId == subjectId);\n\t\t\t\t\tif (!subject) {\n\t\t\t\t\t\treturn (void 0);\n\t\t\t\t\t}\n\t\t\t\t\t// eslint-disable-next-line\n\t\t\t\t\tlet subjectChart = (subject.graphics || []).find(c => c.chartId == chartId);\n\t\t\t\t\tif (!subjectChart) {\n\t\t\t\t\t\treturn (void 0);\n\t\t\t\t\t}\n\t\t\t\t\tsubjectChart = {...subjectChart, rect: chart.rect};\n\t\t\t\t\treturn <SubjectContextProvider space={connectedSpace} subject={subject}\n\t\t\t\t\t                               doSave={doSaveChart(currentDashboard!, subjectChart)}>\n\t\t\t\t\t\t<Chart containerRef={containerRef}\n\t\t\t\t\t\t       space={space} subject={subject} chart={subjectChart} locked={false}\n\t\t\t\t\t\t       settings={false}\n\t\t\t\t\t\t       onDeleteChart={onChartDelete(currentDashboard!)}\n\t\t\t\t\t\t       key={chart.chartId}/>\n\t\t\t\t\t</SubjectContextProvider>;\n\t\t\t\t})\n\t\t\t\t: null}\n\t\t</DashboardBody>\n\t</DashboardContainer>;\n};","import React, { Fragment } from 'react';\nimport { renameDashboard } from '../../../services/console/dashboard';\nimport { ConsoleDashboard } from '../../../services/console/types';\nimport Button, { ButtonType } from '../../component/button';\nimport Input from '../../component/input';\nimport { DialogContext } from '../../context/dialog';\n\nexport const createRenameDashboardClickHandler = (options: {\n\tdashboard: ConsoleDashboard;\n\tdialog: DialogContext,\n\tonRenamed: (dashboard: ConsoleDashboard) => void;\n}) => async (event: React.MouseEvent) => {\n\tconst { dashboard, dialog, onRenamed } = options;\n\n\tlet name = '';\n\tconst onTextChanged = (event: React.ChangeEvent<HTMLInputElement>) => {\n\t\tname = event.target.value;\n\t};\n\tconst showDialog = (content: JSX.Element) => {\n\t\tdialog.show(\n\t\t\tcontent,\n\t\t\t<Fragment>\n\t\t\t\t<div style={{ flexGrow: 1 }}/>\n\t\t\t\t<Button inkType={ButtonType.PRIMARY} onClick={onConfirmClicked}>Yes</Button>\n\t\t\t\t<Button inkType={ButtonType.DEFAULT} onClick={dialog.hide}>Cancel</Button>\n\t\t\t</Fragment>\n\t\t);\n\t};\n\tconst createContent = (error: boolean = false) => {\n\t\treturn <div data-widget='dialog-console-rename'>\n\t\t\t<span>Rename <span data-widget='dialog-console-object'>{dashboard.name}</span> to:</span>\n\t\t\t<Input onChange={onTextChanged} defaultValue={name} data-error={error}/>\n\t\t\t<span>Name is required.</span>\n\t\t</div>;\n\t};\n\tconst onConfirmClicked = async () => {\n\t\tif (!(name.trim())) {\n\t\t\tshowDialog(createContent(true));\n\t\t\treturn;\n\t\t}\n\t\tawait renameDashboard(dashboard.dashboardId, name);\n\t\tdashboard.name = name;\n\t\tonRenamed(dashboard);\n\t\tdialog.hide();\n\t};\n\tshowDialog(createContent());\n};","import React, { Fragment } from 'react';\nimport { deleteDashboard } from '../../../services/console/dashboard';\nimport { ConsoleDashboard } from '../../../services/console/types';\nimport Button, { ButtonType } from '../../component/button';\nimport { DialogContext } from '../../context/dialog';\n\nexport const createDeleteDashboardClickHandler = (options: {\n\tdashboard: ConsoleDashboard;\n\tdialog: DialogContext,\n\tonDeleted: (dashboard: ConsoleDashboard) => void;\n}) => async (event: React.MouseEvent) => {\n\tconst { dashboard, dialog, onDeleted } = options;\n\n\tconst showDialog = (content: JSX.Element) => {\n\t\tdialog.show(\n\t\t\tcontent,\n\t\t\t<Fragment>\n\t\t\t\t<div style={{ flexGrow: 1 }}/>\n\t\t\t\t<Button inkType={ButtonType.PRIMARY} onClick={onConfirmClicked}>Yes</Button>\n\t\t\t\t<Button inkType={ButtonType.DEFAULT} onClick={dialog.hide}>Cancel</Button>\n\t\t\t</Fragment>\n\t\t);\n\t};\n\tconst createContent = (error: boolean = false) => {\n\t\treturn <div data-widget='dialog-console-delete'>\n\t\t\t<span>\n\t\t\t\t<span>Are you sure to delete dashboard </span>\n\t\t\t\t<span data-widget='dialog-console-object'>{dashboard.name}</span>\n\t\t\t\t<span>?</span>\n\t\t\t</span>\n\t\t</div>;\n\t};\n\tconst onConfirmClicked = async () => {\n\t\tawait deleteDashboard(dashboard.dashboardId);\n\t\tonDeleted(dashboard);\n\t\tdialog.hide();\n\t};\n\tshowDialog(createContent());\n};","import React, { Fragment } from 'react';\nimport { useForceUpdate } from '../../../common/utils';\nimport { ConsoleDashboard } from '../../../services/console/types';\nimport Button, { ButtonType } from '../../component/button';\nimport Dropdown, { DropdownOption } from '../../component/dropdown';\nimport { DialogContext } from '../../context/dialog';\n\nexport const createSwitchDashboardClickHandler = (options: {\n\tdashboard: ConsoleDashboard,\n\tdashboards: Array<ConsoleDashboard>;\n\tdialog: DialogContext,\n\tonSwitched: (dashboard: ConsoleDashboard) => void;\n}) => async (event: React.MouseEvent) => {\n\tconst { dashboard, dashboards, dialog, onSwitched } = options;\n\n\tlet selected = dashboards[0];\n\tconst candidates = dashboards.filter(d => d !== dashboard)\n\t\t.map(dashboard => {\n\t\t\treturn { value: dashboard.dashboardId, label: dashboard.name };\n\t\t})\n\t\t.sort((a, b) => a.label.toLowerCase().localeCompare(b.label.toLowerCase()));\n\n\tconst showDialog = () => {\n\t\tdialog.show(\n\t\t\t<DialogContent/>,\n\t\t\t<Fragment>\n\t\t\t\t<div style={{ flexGrow: 1 }}/>\n\t\t\t\t<Button inkType={ButtonType.PRIMARY} onClick={onConfirmClicked}>Yes</Button>\n\t\t\t\t<Button inkType={ButtonType.DEFAULT} onClick={dialog.hide}>Cancel</Button>\n\t\t\t</Fragment>\n\t\t);\n\t};\n\tconst DialogContent = () => {\n\t\tconst forceUpdate = useForceUpdate();\n\t\tconst onDashboardChanged = async (option: DropdownOption) => {\n\t\t\tconst dashboardId = option.value as string;\n\t\t\t// eslint-disable-next-line\n\t\t\tselected = dashboards.find(d => d.dashboardId == dashboardId)!;\n\t\t\tforceUpdate();\n\t\t};\n\t\treturn <div data-widget='dialog-console-switch'>\n\t\t\t<span>Switch to:</span>\n\t\t\t<Dropdown options={candidates} value={selected.dashboardId} onChange={onDashboardChanged}/>\n\t\t</div>;\n\t};\n\tconst onConfirmClicked = async () => {\n\t\tonSwitched(selected);\n\t\tdialog.hide();\n\t};\n\tshowDialog();\n};","import React, {useEffect} from \"react\";\nimport styled from 'styled-components';\nimport BackgroundImage from '../../../assets/console-dashboard-background.png';\nimport {useForceUpdate} from '../../../common/utils';\nimport {NarrowPageTitle} from '../../component/console/narrow-page-title';\nimport {PageContainer} from '../../component/console/page-container';\nimport {useDialog} from '../../context/dialog';\nimport {useConsoleContext} from '../context/console-context';\nimport {createCreateDashboardClickHandler} from './create-dashboard-handler';\nimport {Dashboard} from './dashboard';\n\nconst Container = styled(PageContainer)`\n\tflex-grow: 1;\n\tdisplay: flex;\n\tflex-direction: column;\n\tposition: relative;\n\tmargin: calc(var(--margin) / 2) var(--margin) var(--margin);\n`;\nconst DashboardsContainer = styled.div`\n\tdisplay: grid;\n\tgrid-template-columns: 1fr;\n\tgrid-row-gap: var(--margin);\n\tflex-grow: 1;\n`;\nconst Reminder = styled.div`\n\tdisplay: block;\n\tfont-size: 2em;\n\tfont-family: var(--console-title-font-family);\n\topacity: 0;\n\theight: 0;\n\twidth: 100%;\n\ttransition: all 300ms ease-in-out;\n\ttext-align: center;\n\t&[data-visible=true] {\n\t\topacity: 0.5;\n\t\theight: 100px;\n\t}\n\t> span {\n\t\ttext-decoration: underline;\n\t\tcursor: pointer;\n\t}\n`;\n\nexport const Dashboards = () => {\n\tconst dialog = useDialog();\n\tconst {\n\t\tdashboards: {\n\t\t\tinitialized,\n\t\t\titems: dashboards,\n\t\t\taddDashboard,\n\t\t\taddDashboardDeletedListener, removeDashboardDeletedListener\n\t\t}\n\t} = useConsoleContext();\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\tconst onDelete = () => {\n\t\t\tif (dashboards.length === 0) {\n\t\t\t\tforceUpdate();\n\t\t\t}\n\t\t};\n\t\taddDashboardDeletedListener(onDelete);\n\t\treturn () => removeDashboardDeletedListener(onDelete);\n\t});\n\n\tconst onCreateClicked = createCreateDashboardClickHandler({\n\t\tdialog,\n\t\tonCreated: (dashboard) => {\n\t\t\tdashboards.forEach(dashboard => dashboard.current = false);\n\t\t\taddDashboard(dashboard);\n\t\t\tforceUpdate();\n\t\t}\n\t});\n\n\tconst canShow = initialized && dashboards.length !== 0;\n\n\treturn <Container background-image={BackgroundImage}>\n\t\t{canShow\n\t\t\t? <DashboardsContainer>\n\t\t\t\t<Dashboard/>\n\t\t\t</DashboardsContainer>\n\t\t\t: <DashboardsContainer>\n\t\t\t\t<NarrowPageTitle title='Dashboards'/>\n\t\t\t\t<Reminder data-visible={initialized && dashboards.length === 0}>\n\t\t\t\t\tNo dashboard yet, <span onClick={onCreateClicked}>create one</span> now?\n\t\t\t\t</Reminder>\n\t\t\t\t<Reminder data-visible={!initialized}>\n\t\t\t\t\tLoading...\n\t\t\t\t</Reminder>\n\t\t\t</DashboardsContainer>\n\t\t}\n\t</Container>;\n};","import { faCompactDisc, faGlobe, faSolarPanel, faThumbtack } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { useEffect, useRef } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport styled, { useTheme } from 'styled-components';\nimport Path, { isConnectedSpaceOpened, isDashboardOpened, toConnectedSpace, toDashboard } from '../../../common/path';\nimport { notInMe, useForceUpdate } from '../../../common/utils';\nimport {\n\tConnectedConsoleSpace,\n\tConsoleDashboard,\n\tConsoleFavorite,\n\tConsoleFavoriteDashboard,\n\tConsoleFavoriteSpace,\n\tConsoleFavoriteType,\n\tConsoleSpaceType\n} from '../../../services/console/types';\nimport { Theme } from '../../../theme/types';\nimport { useConsoleContext } from '../context/console-context';\n\nconst FavoriteContainer = styled.div.attrs({\n\t'data-widget': 'console-favorite-container'\n})<{\n\titemCount: number,\n\tpinnedLeft: number,\n\tinvoker: { rect: { x: number; y: number; width: number; height: number }, isMenuExpanded: boolean }\n}>`\n\tdisplay: flex;\n\tposition: fixed;\n\tflex-direction: column;\n\tbox-shadow: var(--console-hover-shadow);\n\tborder-radius: calc(var(--border-radius) * 3);\n\tbackground-color: var(--invert-color);\n\topacity: 0;\n\tpointer-events: none;\n\tmin-width: 180px;\n\theight: calc(var(--margin) / 3 * 3 + 20 + 28 * ${({ itemCount }) => itemCount});\n\tpadding: calc(var(--margin) / 3);\n\ttransition: all 300ms ease-in-out;\n\ttransform: scale3d(0, 0, 0);\n\ttransform-origin: left center;\n\tz-index: 6000;\n\ttop: ${({ invoker: { rect: { y, height }, isMenuExpanded } }) => isMenuExpanded ? y + height : y}px;\n\tleft: ${({\n\t\t         theme,\n\t\t         invoker: {\n\t\t\t         rect: { x },\n\t\t\t         isMenuExpanded\n\t\t         }\n\t         }) => isMenuExpanded ? (x + 20) : (theme.consoleMenuWidth - 2)}px;\n\t&[data-visible=true] {\n\t\ttransform: scale3d(1, 1, 1);\n\t\topacity: 1;\n\t\tpointer-events: auto;\n\t}\n\t&[data-pinned=true] {\n\t\ttop: 0;\n\t\tleft: ${({ pinnedLeft }) => pinnedLeft}px;\n\t\twidth: calc(100vw - ${({ pinnedLeft }) => pinnedLeft}px - 15px);\n\t\tborder-radius: 0;\n\t\tbox-shadow: none;\n\t\tborder-bottom: var(--border);\n\t\tpadding: 0;\n\t\ttransition: none;\n\t\tz-index: 4000;\n\t\tflex-direction: row;\n\t\t> div:first-child {\n\t\t\theight: var(--console-favorite-pinned-height);\n\t\t\tpadding: 0 calc(var(--margin) / 3);\n\t\t\tbackground-color: var(--invert-color);\n\t\t\tz-index: 1;\n\t\t\t> div:last-child {\n\t\t\t\tposition: absolute;\n\t\t\t\tright: 0;\n\t\t\t\ttop: 0;\n\t\t\t\theight: var(--console-favorite-pinned-height);\n\t\t\t\twidth: 60px;\n\t\t\t\tpadding: 0 calc(var(--margin) / 3);\n\t\t\t}\n\t\t}\n\t\t> div:last-child {\n\t\t\tflex-direction: row;\n\t\t\tmargin-top: 0;\n\t\t\tmargin-right: 60px;\n\t\t\talign-items: center;\n\t\t\t> div {\n\t\t\t\tmargin-left: calc(var(--margin) / 3);\n\t\t\t\tpadding: 0 calc(var(--margin) / 3);\n\t\t\t\theight: 24px;\n\t\t\t\tmin-height: 24px;\n\t\t\t\tborder: var(--border);\n\t\t\t\tborder-radius: 12px;\n\t\t\t\t&:hover {\n\t\t\t\t\tbackground-color: var(--console-primary-color);\n\t\t\t\t\tborder-color: var(--console-primary-color);\n\t\t\t\t\tcolor: var(--invert-color);\n\t\t\t\t}\n\t\t\t\t&:last-child {\n\t\t\t\t\tmin-width: calc(var(--margin) / 3);\n\t\t\t\t\tbackground-color: transparent;\n\t\t\t\t\tborder: 0;\n\t\t\t\t\tpadding: 0;\n\t\t\t\t\tmargin: 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n`;\nconst FavoriteHeader = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tfont-family: var(--console-title-font-family);\n\t> div:last-child {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tcursor: pointer;\n\t\t&:hover {\n\t\t\tcolor: var(--console-primary-color);\n\t\t}\n\t\t> svg {\n\t\t\tmargin-right: calc(var(--margin) / 5);\n\t\t\tfont-size: 0.8em;\n\t\t}\n\t}\n`;\nconst FavoriteBody = styled.div`\n\tdisplay: flex;\n\tflex-direction: column;\n\tflex-grow: 1;\n\toverflow-y: auto;\n\tmargin-top: calc(var(--margin) / 3);\n\tmax-height: calc(28px * 5);\n\t&::-webkit-scrollbar {\n\t\tbackground-color: transparent;\n\t\theight: 4px;\n\t\twidth: 4px;\n\t}\n\t&::-webkit-scrollbar-track {\n\t\tbackground-color: var(--scrollbar-background-color);\n\t\tborder-radius: 2px;\n\t}\n\t&::-webkit-scrollbar-thumb {\n\t\tbackground-color: var(--console-favorite-color);\n\t\tborder-radius: 2px;\n\t}\n\t> div {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tmin-height: 28px;\n\t\tpadding-right: calc(var(--margin) / 3);\n\t\tfont-size: 0.8em;\n\t\topacity: 0.7;\n\t\tcursor: pointer;\n\t\t&:hover {\n\t\t\tcolor: var(--console-primary-color);\n\t\t}\n\t\t> svg {\n\t\t\tmargin-right: calc(var(--margin) / 5);\n\t\t}\n\t\t> span {\n\t\t\tflex-grow: 1;\n\t\t\toverflow: hidden;\n\t\t\twhite-space: nowrap;\n\t\t\ttext-overflow: ellipsis;\n\t\t}\n\t}\n`;\n\nconst isFavDashboard = (fav: ConsoleFavorite): fav is ConsoleFavoriteDashboard => fav.type === ConsoleFavoriteType.DASHBOARD;\nconst isFavSpace = (fav: ConsoleFavorite): fav is ConsoleFavoriteSpace => fav.type === ConsoleFavoriteType.SPACE;\n\nexport const Favorite = () => {\n\tconst history = useHistory();\n\tconst theme = useTheme() as Theme;\n\tconst {\n\t\tmenu: { menuWidth },\n\t\tfavorites: {\n\t\t\titems, visible, pinned,\n\t\t\tinvoker = {\n\t\t\t\trect: {\n\t\t\t\t\tx: theme.consoleMenuWidth,\n\t\t\t\t\ty: 144,\n\t\t\t\t\twidth: 32,\n\t\t\t\t\theight: 32\n\t\t\t\t},\n\t\t\t\tisMenuExpanded: false\n\t\t\t},\n\t\t\thide, pin, unpin\n\t\t},\n\t\tdashboards: {\n\t\t\titems: dashboards,\n\t\t\taddDashboardDeletedListener, removeDashboardDeletedListener,\n\t\t\taddDashboardRenamedListener, removeDashboardRenamedListener\n\t\t},\n\t\tspaces: {\n\t\t\tconnected: spaces,\n\t\t\taddSpaceDeletedListener, removeSpaceDeletedListener,\n\t\t\taddSpaceRenamedListener, removeSpaceRenamedListener\n\t\t}\n\t} = useConsoleContext();\n\n\tconst containerRef = useRef<HTMLDivElement>(null);\n\tuseEffect(() => {\n\t\tif (!pinned) {\n\t\t\tconst onWindowClick = (event: FocusEvent | MouseEvent) => {\n\t\t\t\tif (notInMe(containerRef.current!, event.target)) {\n\t\t\t\t\thide();\n\t\t\t\t}\n\t\t\t};\n\t\t\twindow.addEventListener('click', onWindowClick, true);\n\t\t\twindow.addEventListener('focus', onWindowClick, true);\n\t\t\treturn () => {\n\t\t\t\twindow.removeEventListener('click', onWindowClick, true);\n\t\t\t\twindow.removeEventListener('focus', onWindowClick, true);\n\t\t\t};\n\t\t}\n\t}, [ pinned, hide ]);\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\taddDashboardDeletedListener(forceUpdate);\n\t\taddDashboardRenamedListener(forceUpdate);\n\t\taddSpaceDeletedListener(forceUpdate);\n\t\taddSpaceRenamedListener(forceUpdate);\n\t\treturn () => {\n\t\t\tremoveDashboardDeletedListener(forceUpdate);\n\t\t\tremoveDashboardRenamedListener(forceUpdate);\n\t\t\tremoveSpaceDeletedListener(forceUpdate);\n\t\t\tremoveSpaceRenamedListener(forceUpdate);\n\t\t};\n\t}, [\n\t\taddDashboardDeletedListener, removeDashboardDeletedListener,\n\t\taddDashboardRenamedListener, removeDashboardRenamedListener,\n\t\taddSpaceDeletedListener, removeSpaceDeletedListener,\n\t\taddSpaceRenamedListener, removeSpaceRenamedListener,\n\t\tforceUpdate\n\t]);\n\n\tconst itemCount = items.length;\n\tconst displayItemCount = Math.min(itemCount, 5);\n\tconst onPinClicked = () => pinned ? unpin() : pin();\n\tconst onSpaceClicked = (space: ConnectedConsoleSpace) => () => {\n\t\tif (isConnectedSpaceOpened(space.connectId)) {\n\t\t\treturn;\n\t\t}\n\n\t\thistory.push(toConnectedSpace(Path.CONSOLE_CONNECTED_SPACE, space.connectId));\n\t};\n\tconst onDashboardClicked = (dashboard: ConsoleDashboard) => () => {\n\t\tif (isDashboardOpened(dashboard.dashboardId)) {\n\t\t\treturn;\n\t\t}\n\t\thistory.push(toDashboard(Path.CONSOLE_DASHBOARD, dashboard.dashboardId));\n\t};\n\n\treturn <FavoriteContainer data-visible={visible} data-pinned={pinned} pinnedLeft={menuWidth}\n\t                          itemCount={displayItemCount}\n\t                          invoker={invoker}\n\t                          ref={containerRef}>\n\t\t<FavoriteHeader>\n\t\t\t<div>Favorite</div>\n\t\t\t<div onClick={onPinClicked}>\n\t\t\t\t<FontAwesomeIcon icon={faThumbtack}/>\n\t\t\t\t<span>{pinned ? 'Float' : 'Pin'}</span>\n\t\t\t</div>\n\t\t</FavoriteHeader>\n\t\t<FavoriteBody>\n\t\t\t{items.map(item => {\n\t\t\t\tif (isFavDashboard(item)) {\n\t\t\t\t\t// eslint-disable-next-line\n\t\t\t\t\tconst dashboard = dashboards.find(dashboard => dashboard.dashboardId == item.dashboardId);\n\t\t\t\t\tif (dashboard) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tname: dashboard.name,\n\t\t\t\t\t\t\titem: <div onClick={onDashboardClicked(dashboard)}\n\t\t\t\t\t\t\t           key={`dashboard-${item.dashboardId}`}>\n\t\t\t\t\t\t\t\t<FontAwesomeIcon icon={faSolarPanel}/>\n\t\t\t\t\t\t\t\t<span>{dashboard.name}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t} else if (isFavSpace(item)) {\n\t\t\t\t\t// eslint-disable-next-line\n\t\t\t\t\tconst space = spaces.find(space => space.connectId == item.connectId);\n\t\t\t\t\tif (space) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tname: space.name,\n\t\t\t\t\t\t\titem: <div onClick={onSpaceClicked(space)}\n\t\t\t\t\t\t\t           key={`space-${item.connectId}`}>\n\t\t\t\t\t\t\t\t<FontAwesomeIcon\n\t\t\t\t\t\t\t\t\ticon={space.type === ConsoleSpaceType.PUBLIC ? faGlobe : faCompactDisc}/>\n\t\t\t\t\t\t\t\t<span>{space.name}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t})\n\t\t\t\t.filter(x => x != null)\n\t\t\t\t.sort((x1, x2) => x1!.name.localeCompare(x2!.name))\n\t\t\t\t.map(x => x!.item)}\n\t\t\t{pinned ? <div/> : null}\n\t\t</FavoriteBody>\n\t</FavoriteContainer>;\n};","export default __webpack_public_path__ + \"static/media/console-home-background.3da66139.png\";","import { faStar } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { useRef } from 'react';\nimport styled from 'styled-components';\nimport { TooltipAlignment, useTooltip } from '../../component/console/context/console-tooltip';\n\nconst FavBtn = styled.div.attrs({\n\t'data-widget': 'console-home-section-card-fav-btn'\n})`\n\tdisplay: flex;\n\twidth: 32px;\n\talign-items: center;\n\tcolor: var(--console-waive-color);\n\t&:hover {\n\t\tcolor: var(--console-primary-color);\n\t}\n\t&[data-favorite=true] {\n\t\tcolor: var(--console-favorite-color);\n\t\t> svg {\n\t\t\topacity: 1;\n\t\t\twidth: 100%;\n\t\t\theight: 16px;\n\t\t\tmargin-left: 0;\n\t\t\tpointer-events: auto;\n\t\t}\n\t}\n\t> svg {\n\t\topacity: 0;\n\t\twidth: 0;\n\t\theight: 0;\n\t\tmargin-left: 32px;\n\t\tpointer-events: none;\n\t\ttransition: all 300ms ease-in-out;\n\t}\n`;\n\nexport const FavoriteButton = (props: {\n\ttoggle: (event: React.MouseEvent) => void;\n\tisFavorite: boolean;\n}) => {\n\tconst { toggle, isFavorite } = props;\n\n\tconst buttonRef = useRef<HTMLDivElement>(null);\n\tconst { mouseEnter, mouseLeave, show, hide } = useTooltip<HTMLDivElement>({\n\t\tshow: true,\n\t\ttooltip: isFavorite ? 'Remove from Favorite' : 'Add into Favorite',\n\t\tref: buttonRef,\n\t\trect: () => ({ align: TooltipAlignment.CENTER })\n\t});\n\tconst onClick = (event: React.MouseEvent) => {\n\t\thide!();\n\t\tshow!(isFavorite ? 'Add into Favorite' : 'Remove from Favorite');\n\t\ttoggle(event);\n\t};\n\n\treturn <FavBtn onMouseEnter={mouseEnter} onMouseLeave={mouseLeave}\n\t               onClick={onClick}\n\t               data-favorite={isFavorite}\n\t               ref={buttonRef}>\n\t\t<FontAwesomeIcon icon={faStar}/>\n\t</FavBtn>;\n};","import styled from 'styled-components';\n\nexport const HomeSectionCard = styled.div.attrs({\n\t'data-widget': 'console-home-section-card'\n})`\n\tdisplay: grid;\n\tposition: relative;\n\tgrid-template-columns: 1fr auto;\n\tgrid-column-gap: calc(var(--margin) / 5);\n\talign-items: stretch;\n\tpadding: calc(var(--margin) / 3) calc(var(--margin) / 5) calc(var(--margin) / 3) calc(var(--margin) / 2);\n\tborder-radius: calc(var(--margin) / 3);\n\tbackground-color: var(--invert-color);\n\tcursor: pointer;\n\ttransition: all 300ms ease-in-out;\n\t&:hover {\n\t\tbox-shadow: var(--console-hover-shadow);\n\t\t> div:first-child > span:first-child {\n\t\t\tcolor: var(--console-primary-color);\n\t\t}\n\t\t> div[data-widget='console-home-section-card-fav-btn'] > svg {\n\t\t\topacity: 1;\n\t\t\twidth: 100%;\n\t\t\theight: 16px;\n\t\t\tmargin-left: 0;\n\t\t\tpointer-events: auto;\n\t\t}\n\t}\n\t> div:first-child {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: auto 1fr;\n\t\talign-items: center;\n\t\t> span {\n\t\t\toverflow: hidden;\n\t\t\twhite-space: nowrap;\n\t\t\ttext-overflow: ellipsis;\n\t\t}\n\t\t> span:first-child {\n\t\t\tfont-size: 0.8em;\n\t\t\tfont-weight: var(--font-demi-bold);\n\t\t\topacity: 0.7;\n\t\t\tgrid-column: span 2;\n\t\t\ttransform: scale(0.9);\n\t\t\ttransform-origin: left;\n\t\t\ttransition: all 300ms ease-in-out;\n\t\t\t> svg {\n\t\t\t\tmargin-right: calc(var(--margin) / 3);\n\t\t\t}\n\t\t}\n\t}\n`;\n","import { faSolarPanel } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport dayjs from 'dayjs';\nimport React from 'react';\nimport { useHistory } from 'react-router-dom';\nimport Path from '../../../common/path';\nimport {\n\tConsoleDashboard,\n\tConsoleFavorite,\n\tConsoleFavoriteDashboard,\n\tConsoleFavoriteType\n} from '../../../services/console/types';\nimport { useConsoleContext } from '../context/console-context';\nimport { FavoriteButton } from './favorite-button';\nimport { HomeSectionCard } from './home-section-card';\n\nconst isFavDashboard = (fav: ConsoleFavorite): fav is ConsoleFavoriteDashboard => fav.type === ConsoleFavoriteType.DASHBOARD;\n\nexport const Dashboard = (props: {\n\tdata: ConsoleDashboard\n}) => {\n\tconst { data: dashboard } = props;\n\n\tconst history = useHistory();\n\tconst {\n\t\tfavorites: {\n\t\t\titems: favorites, remove: removeFromFavorite, add: addIntoFavorite\n\t\t},\n\t\tdashboards: { items: dashboards }\n\t} = useConsoleContext();\n\t// eslint-disable-next-line\n\tconst findInFavorite = () => favorites.find(fav => isFavDashboard(fav) && fav.dashboardId == dashboard.dashboardId);\n\tconst toggleFavorite = () => {\n\t\tconst exists = findInFavorite();\n\t\tif (exists) {\n\t\t\tremoveFromFavorite(exists);\n\t\t} else {\n\t\t\taddIntoFavorite({\n\t\t\t\ttype: ConsoleFavoriteType.DASHBOARD,\n\t\t\t\tdashboardId: dashboard.dashboardId\n\t\t\t} as ConsoleFavoriteDashboard);\n\t\t}\n\t};\n\n\tconst lastVisit = dayjs(dashboard.lastVisitTime).fromNow();\n\tconst isFavorite = !!findInFavorite();\n\tconst onDashboardClicked = () => {\n\t\tdashboards.forEach(d => {\n\t\t\t// eslint-disable-next-line\n\t\t\td.current = d.dashboardId == dashboard.dashboardId;\n\t\t});\n\t\thistory.push(Path.CONSOLE_DASHBOARDS);\n\t};\n\n\treturn <HomeSectionCard onClick={onDashboardClicked}>\n\t\t<div>\n\t\t\t<span>\n\t\t\t\t<FontAwesomeIcon icon={faSolarPanel}/>\n\t\t\t\t<span>{lastVisit}</span>\n\t\t\t</span>\n\t\t\t<span>{dashboard.name}</span>\n\t\t</div>\n\t\t<FavoriteButton toggle={toggleFavorite} isFavorite={isFavorite}/>\n\t</HomeSectionCard>;\n};","import { IconProp } from '@fortawesome/fontawesome-svg-core';\nimport { faCaretDown, faCompressAlt, faExpandAlt } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { useState } from 'react';\nimport styled from 'styled-components';\n\nconst HomeSectionContainer = styled.div.attrs({\n\t'data-widget': 'console-home-section'\n})<{ itemCount: number }>`\n\tdisplay: flex;\n\tposition: relative;\n\tflex-direction: column;\n\tmargin-top: var(--margin);\n\ttransition: all 300ms ease-in-out;\n\t&:not(:nth-child(2)) {\n\t\tmargin-top: calc(var(--margin) / 2);\n\t}\n\t&:last-child {\n\t\tmargin-bottom: var(--margin);\n\t}\n\t&[data-visible=false] {\n\t\t> div[data-widget='console-home-section-header'] {\n\t\t\t> div[data-widget='console-home-section-title'] {\n\t\t\t\t> svg:first-child {\n\t\t\t\t\topacity: 1;\n\t\t\t\t\ttransform: translateY(-50%) rotateZ(-90deg);\n\t\t\t\t}\n\t\t\t}\n\t\t\t> div[data-widget='console-home-section-header-operators'] {\n\t\t\t\topacity: 0;\n\t\t\t\tpointer-events: none;\n\t\t\t}\n\t\t}\n\t\t> div[data-widget='console-home-section-body'] {\n\t\t\tpadding-top: 0;\n\t\t\tpadding-bottom: 0;\n\t\t\theight: 0;\n\t\t}\n\t}\n\t&[data-visible=true][data-can-expand=true] {\n\t\t&[data-expanded=false] {\n\t\t\t> div[data-widget='console-home-section-body'] {\n\t\t\t\theight: calc(var(--margin) / 3 * (2 + ${({ itemCount }) => Math.ceil(itemCount / 3) - 1}) + ${({ itemCount }) => Math.ceil(itemCount / 3) * 64}px + 18px);\n\t\t\t\t> div:not(:nth-child(-n + 6)) {\n\t\t\t\t\topacity: 0;\n\t\t\t\t\tpointer-events: none;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t&[data-expanded=true] {\n\t\t\t> div[data-widget='console-home-section-body'] {\n\t\t\t\theight: calc(var(--margin) / 3 * (2 + ${({ itemCount }) => Math.ceil(itemCount / 3) - 1}) + ${({ itemCount }) => Math.ceil(itemCount / 3) * 64}px + 18px);\n\t\t\t\tpadding-bottom: calc(var(--margin) / 3 + 18px);\n\t\t\t}\n\t\t}\n\t}\n\t> div[data-widget='console-home-section-body'] {\n\t\theight: calc(var(--margin) / 3 * (2 + ${({ itemCount }) => Math.ceil(itemCount / 3) - 1}) + ${({ itemCount }) => Math.ceil(itemCount / 3) * 64}px);\n\t\t> div {\n\t\t\theight: 64px;\n\t\t}\n\t}\n`;\nconst HomeSectionHeader = styled.div.attrs({\n\t'data-widget': 'console-home-section-header'\n})`\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n`;\nconst HomeSectionTitle = styled.div.attrs({\n\t'data-widget': 'console-home-section-title'\n})`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\theight: 3em;\n\tmargin-left: calc(var(--margin) / 3 * -1);\n\tpadding-left: calc(var(--margin) / 3);\n\tpadding-right: var(--margin);\n\tfont-family: var(--console-title-font-family);\n\tfont-size: 1.2em;\n\tfont-weight: var(--font-demi-bold);\n\tcursor: pointer;\n\t&:hover {\n\t\t> svg, > div:last-child {\n\t\t\tcolor: var(--console-primary-color);\n\t\t}\n\t\t> svg:first-child {\n\t\t\tpointer-events: auto;\n\t\t\topacity: 1;\n\t\t}\n\t}\n\t> svg:nth-child(2) {\n\t\tmargin-right: calc(var(--margin) / 3);\n\t}\n\t> svg:first-child {\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\tright: 100%;\n\t\ttop: 50%;\n\t\ttransform: translateY(-50%);\n\t\topacity: 0;\n\t\tuser-select: none;\n\t\ttransition: all 300ms ease-in-out;\n\t}\n`;\nconst HomeSectionHeaderOperators = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n`;\nconst HomeSectionBody = styled.div.attrs({\n\t'data-widget': 'console-home-section-body'\n})`\n\tdisplay: grid;\n\tposition: relative;\n\tgrid-template-columns: repeat(3, minmax(0, 1fr));\n\tgrid-gap: calc(var(--margin) / 3);\n\tbackground-color: var(--console-home-section-body-bg-color);\n\toverflow: hidden;\n\tpadding: calc(var(--margin) / 3);\n\tborder-radius: calc(var(--margin) / 2);\n\ttransition: all 300ms ease-in-out;\n`;\nconst ExpandButton = styled.div`\n\tdisplay: block;\n\tposition: absolute;\n\tbottom: -10px;\n\tleft: calc(50% - 80px);\n\twidth: 160px;\n\theight: 28px;\n\tpadding: 6px calc(var(--margin) / 2);\n\tborder-radius: 14px;\n\tbox-shadow: var(--console-shadow);\n\tfont-size: 0.8em;\n\tbackground-color: var(--invert-color);\n\tcursor: pointer;\n\ttransition: all 300ms ease-in-out;\n\toverflow: hidden;\n\t&:hover {\n\t\tcolor: var(--console-primary-color);\n\t\tbox-shadow: var(--console-hover-shadow);\n\t}\n\t&[data-expanded=true] {\n\t\t> div:first-child {\n\t\t\tleft: 0;\n\t\t}\n\t\t> div:last-child {\n\t\t\tleft: 160px;\n\t\t}\n\t}\n\t&[data-expanded=false] {\n\t\t> div:first-child {\n\t\t\tleft: -160px;\n\t\t}\n\t\t> div:last-child {\n\t\t\tleft: 0;\n\t\t}\n\t}\n\t> div {\n\t\tdisplay: flex;\n\t\tposition: absolute;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\twidth: 160px;\n\t\tleft: 0;\n\t\ttop: 50%;\n\t\ttransform: translateY(-50%);\n\t\ttransition: all 300ms ease-in-out;\n\t\t> svg {\n\t\t\tmargin-right: calc(var(--margin) / 4);\n\t\t}\n\t}\n`;\n\nexport const HomeSection = (props: {\n\ttitle: string;\n\ttitleIcon: IconProp;\n\titemCount: number;\n\ttitleOperators?: ((props: any) => React.ReactNode) | React.ReactNode;\n\tchildren: ((props: any) => React.ReactNode) | React.ReactNode;\n}) => {\n\tconst { title, titleIcon, itemCount, titleOperators, children } = props;\n\n\tconst [ collapsed, setCollapsed ] = useState(false);\n\tconst [ expanded, setExpanded ] = useState(false);\n\n\tconst canExpand = itemCount > 6;\n\tconst displayItemCount = (canExpand && !expanded) ? Math.min(itemCount, 6) : itemCount;\n\n\tconst toggleCollapsed = () => setCollapsed(!collapsed);\n\tconst toggleExpanded = () => setExpanded(!expanded);\n\n\treturn <HomeSectionContainer data-visible={!collapsed}\n\t                             data-can-expand={canExpand} data-expanded={expanded}\n\t                             itemCount={displayItemCount}>\n\t\t<HomeSectionHeader>\n\t\t\t<HomeSectionTitle onClick={toggleCollapsed}>\n\t\t\t\t<FontAwesomeIcon icon={faCaretDown}/>\n\t\t\t\t<FontAwesomeIcon icon={titleIcon}/>\n\t\t\t\t<div>{title}</div>\n\t\t\t</HomeSectionTitle>\n\t\t\t<HomeSectionHeaderOperators>\n\t\t\t\t{titleOperators}\n\t\t\t</HomeSectionHeaderOperators>\n\t\t</HomeSectionHeader>\n\t\t<HomeSectionBody>\n\t\t\t{children}\n\t\t</HomeSectionBody>\n\t\t{\n\t\t\tcanExpand && !collapsed\n\t\t\t\t? <ExpandButton onClick={toggleExpanded} data-expanded={expanded}>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<FontAwesomeIcon icon={faCompressAlt}/>\n\t\t\t\t\t\t<span>View Latest</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<FontAwesomeIcon icon={faExpandAlt}/>\n\t\t\t\t\t\t<span>View All</span>\n\t\t\t\t\t</div>\n\t\t\t\t</ExpandButton>\n\t\t\t\t: null\n\t\t}\n\t</HomeSectionContainer>;\n};","import styled from 'styled-components';\n\nexport const HomeSectionHeaderButton = styled.div.attrs({\n\t'data-widget': 'console-home-section-header-button'\n})`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\tjustify-content: flex-end;\n\tpadding: 6px calc(var(--margin) / 2);\n\tborder-radius: var(--border-radius);\n\tfont-size: 0.8em;\n\topacity: 0.7;\n\tcursor: pointer;\n\ttransition: all 300ms ease-in-out;\n\t&:hover {\n\t\tcolor: var(--console-primary-color);\n\t\tbackground-color: var(--invert-color);\n\t\tbox-shadow: var(--console-hover-shadow);;\n\t}\n\t> svg {\n\t\tmargin-right: calc(var(--margin) / 4);\n\t}\n`;\n","import { faCompactDisc, faGlobe } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport dayjs from 'dayjs';\nimport React from 'react';\nimport { useHistory } from 'react-router-dom';\nimport Path, { toConnectedSpace } from '../../../common/path';\nimport {\n\tConnectedConsoleSpace,\n\tConsoleFavorite,\n\tConsoleFavoriteSpace,\n\tConsoleFavoriteType,\n\tConsoleSpaceType\n} from '../../../services/console/types';\nimport { useConsoleContext } from '../context/console-context';\nimport { FavoriteButton } from './favorite-button';\nimport { HomeSectionCard } from './home-section-card';\n\nconst isFavSpace = (fav: ConsoleFavorite): fav is ConsoleFavoriteSpace => fav.type === ConsoleFavoriteType.SPACE;\n\nexport const Space = (props: {\n\tspace: ConnectedConsoleSpace\n}) => {\n\tconst { space } = props;\n\n\tconst history = useHistory();\n\tconst { favorites: { items: favorites, remove: removeFromFavorite, add: addIntoFavorite } } = useConsoleContext();\n\t// eslint-disable-next-line\n\tconst findInFavorite = () => favorites.find(fav => isFavSpace(fav) && fav.connectId == space.connectId);\n\tconst toggleFavorite = (event: React.MouseEvent) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tconst exists = findInFavorite();\n\t\tif (exists) {\n\t\t\tremoveFromFavorite(exists);\n\t\t} else {\n\t\t\taddIntoFavorite({ type: ConsoleFavoriteType.SPACE, connectId: space.connectId } as ConsoleFavoriteSpace);\n\t\t}\n\t};\n\n\tconst lastVisit = dayjs(space.lastVisitTime).fromNow();\n\tconst isFavorite = !!findInFavorite();\n\tconst onSpaceClicked = () => {\n\t\thistory.push(toConnectedSpace(Path.CONSOLE_CONNECTED_SPACE, space.connectId));\n\t};\n\n\treturn <HomeSectionCard onClick={onSpaceClicked}>\n\t\t<div>\n\t\t\t<span>\n\t\t\t\t<FontAwesomeIcon icon={space.type === ConsoleSpaceType.PUBLIC ? faGlobe : faCompactDisc}/>\n\t\t\t\t<span>{lastVisit}</span>\n\t\t\t</span>\n\t\t\t<span>{space.name}</span>\n\t\t</div>\n\t\t<FavoriteButton toggle={toggleFavorite} isFavorite={isFavorite}/>\n\t</HomeSectionCard>;\n};","import { faPlug, faPoll, faSatellite, faTachometerAlt } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React from 'react';\nimport { useHistory } from 'react-router-dom';\nimport BackgroundImage from '../../../assets/console-home-background.png';\nimport Path from '../../../common/path';\nimport { ConnectedConsoleSpace } from '../../../services/console/types';\nimport { NarrowPageTitle } from '../../component/console/narrow-page-title';\nimport { NarrowContainer } from '../../component/console/page-container';\nimport { useConsoleContext } from '../context/console-context';\nimport { Dashboard } from './dashboard';\nimport { HomeSection } from './home-section';\nimport { HomeSectionHeaderButton } from './home-section-header-button';\nimport { Space } from './space';\n\nexport const Home = () => {\n\tconst history = useHistory();\n\tconst { spaces: { connected }, dashboards: { items: dashboards } } = useConsoleContext();\n\n\tconst spaces: Array<ConnectedConsoleSpace> =\n\t\tconnected.sort((s1, s2) => {\n\t\t\treturn s1.lastVisitTime.localeCompare(s2.lastVisitTime);\n\t\t}).reverse();\n\n\tconst onConnectSpaceClicked = () => history.push(Path.CONSOLE_SPACES);\n\tconst onCreateDashboardClicked = () => history.push(Path.CONSOLE_DASHBOARDS);\n\n\treturn <NarrowContainer background-image={BackgroundImage}>\n\t\t<NarrowPageTitle title='Home'/>\n\t\t<HomeSection title='Connected Spaces' titleIcon={faSatellite}\n\t\t             titleOperators={<HomeSectionHeaderButton onClick={onConnectSpaceClicked}>\n\t\t\t             <FontAwesomeIcon icon={faPlug}/>\n\t\t\t             <span>Connect New Space</span>\n\t\t             </HomeSectionHeaderButton>}\n\t\t             itemCount={spaces.length}>\n\t\t\t{spaces.map(space => {\n\t\t\t\treturn <Space key={`connected-${space.connectId}`} space={space}/>;\n\t\t\t})}\n\t\t</HomeSection>\n\t\t<HomeSection title='Dashboards' titleIcon={faTachometerAlt}\n\t\t             titleOperators={<HomeSectionHeaderButton onClick={onCreateDashboardClicked}>\n\t\t\t             <FontAwesomeIcon icon={faPoll}/>\n\t\t\t             <span>Create New Dashboard</span>\n\t\t             </HomeSectionHeaderButton>}\n\t\t             itemCount={dashboards.length}>\n\t\t\t{dashboards.map(dashboard => {\n\t\t\t\treturn <Dashboard key={`dashboard-${dashboard.dashboardId}`} data={dashboard}/>;\n\t\t\t})}\n\t\t</HomeSection>\n\t</NarrowContainer>;\n};","import { faBell, faComments } from '@fortawesome/free-regular-svg-icons';\nimport {\n\tfaCog,\n\tfaCompactDisc,\n\tfaGlobe,\n\tfaHome,\n\tfaInbox,\n\tfaPlus,\n\tfaStar,\n\tfaTachometerAlt\n} from '@fortawesome/free-solid-svg-icons';\nimport React, { useEffect } from 'react';\nimport { matchPath, useHistory, useLocation } from 'react-router-dom';\nimport styled, { useTheme } from 'styled-components';\nimport Path, { isConnectedSpaceOpened, toConnectedSpace } from '../../../common/path';\nimport { useForceUpdate } from '../../../common/utils';\nimport { ConnectedConsoleSpace, ConsoleSpaceType } from '../../../services/console/types';\nimport { Theme } from '../../../theme/types';\nimport { MenuItem } from '../../component/console/menu/menu-item';\nimport { MenuLogo } from '../../component/console/menu/menu-logo';\nimport { MenuSeparator } from '../../component/console/menu/menu-separator';\nimport { MenuUser } from '../../component/console/menu/menu-user';\nimport { ResizeHandle } from '../../component/console/menu/resize-handle';\nimport { useConsoleContext } from '../context/console-context';\n\nconst MenuContainer = styled.div.attrs({\n\t'data-widget': 'menu-container'\n})<{ width: number }>`\n\tdisplay: flex;\n\tposition: relative;\n\tflex-direction: column;\n\talign-items: flex-start;\n\twidth: ${({ width }) => `${width}px`};\n\tmin-width: var(--console-menu-width);\n\theight: 100vh;\n\ttop: 0;\n\tleft: 0;\n\tborder-right: var(--border);\n\tbackground-color: var(--invert-color);\n\toverflow: hidden;\n`;\nconst FavMenu = styled(MenuItem)`\n\t&[data-active=true] {\n\t\t> div:first-child {\n\t\t\tcolor: var(--console-favorite-color);\n\t\t\tbackground-color: transparent;\n\t\t}\n\t}\n`;\nconst SpaceMenus = styled.div`\n\tdisplay: flex;\n\tflex-direction: column;\n\tmax-height: calc(var(--console-menu-height) * 5);\n\toverflow-y: scroll;\n\toverflow-x: hidden;\n\tdirection: rtl;\n\t&::-webkit-scrollbar {\n\t\tbackground-color: transparent;\n\t\twidth: 4px;\n\t}\n\t&::-webkit-scrollbar-track {\n\t\tbackground-color: transparent;\n\t\tborder-radius: 2px;\n\t}\n\t&::-webkit-scrollbar-thumb {\n\t\tbackground-color: var(--console-favorite-color);\n\t\tborder-radius: 2px;\n\t}\n\t> div {\n\t\tmargin-left: -4px;\n\t}\n`;\nconst SpaceMenu = styled(MenuItem)`\n\tdirection: ltr;\n`;\nconst ConnectMenu = styled(MenuItem)`\n\tcolor: var(--console-waive-color);\n`;\nconst Placeholder = styled.div`\n\tflex-grow: 1;\n`;\n\nexport const ConsoleMenu = () => {\n\tconst history = useHistory();\n\tconst location = useLocation();\n\tconst theme = useTheme();\n\tconst minWidth = (theme as Theme).consoleMenuWidth;\n\tconst maxWidth = (theme as Theme).consoleMenuMaxWidth;\n\tconst {\n\t\tuser,\n\t\tmenu: { menuWidth, setMenuWidth },\n\t\tfavorites,\n\t\tspaces: {\n\t\t\tconnected: spaces,\n\t\t\taddSpaceAddedListener, removeSpaceAddedListener,\n\t\t\taddSpaceDeletedListener, removeSpaceDeletedListener,\n\t\t\taddSpaceRenamedListener, removeSpaceRenamedListener\n\t\t}\n\t} = useConsoleContext();\n\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\taddSpaceAddedListener(forceUpdate);\n\t\taddSpaceDeletedListener(forceUpdate);\n\t\taddSpaceRenamedListener(forceUpdate);\n\t\treturn () => {\n\t\t\tremoveSpaceAddedListener(forceUpdate);\n\t\t\tremoveSpaceDeletedListener(forceUpdate);\n\t\t\tremoveSpaceRenamedListener(forceUpdate);\n\t\t};\n\t}, [ addSpaceAddedListener, removeSpaceAddedListener, addSpaceDeletedListener, removeSpaceDeletedListener, addSpaceRenamedListener, removeSpaceRenamedListener, forceUpdate ]);\n\n\tconst onResize = (newWidth: number) => {\n\t\tsetMenuWidth(Math.min(Math.max(newWidth, minWidth), maxWidth));\n\t};\n\tconst onHomeClicked = () => {\n\t\tif (!matchPath(location.pathname, Path.CONSOLE_HOME)) {\n\t\t\thistory.push(Path.CONSOLE_HOME);\n\t\t}\n\t};\n\tconst onNotificationsClicked = () => {\n\t\tif (!matchPath(location.pathname, Path.CONSOLE_NOTIFICATION)) {\n\t\t\thistory.push(Path.CONSOLE_NOTIFICATION);\n\t\t}\n\t};\n\tconst onInboxClicked = () => {\n\t\tif (!matchPath(location.pathname, Path.CONSOLE_INBOX)) {\n\t\t\thistory.push(Path.CONSOLE_INBOX);\n\t\t}\n\t};\n\tconst onTimelineClicked = () => {\n\t\tif (!matchPath(location.pathname, Path.CONSOLE_TIMELINE)) {\n\t\t\thistory.push(Path.CONSOLE_TIMELINE);\n\t\t}\n\t};\n\tconst onFavoriteClicked = (rect: DOMRect) => {\n\t\tconst { visible } = favorites;\n\t\tif (!visible) {\n\t\t\tfavorites.show(rect, !showMenuItemTooltip);\n\t\t}\n\t};\n\tconst onSpaceClicked = (space: ConnectedConsoleSpace) => () => {\n\t\tif (isConnectedSpaceOpened(space.connectId)) {\n\t\t\treturn;\n\t\t}\n\n\t\thistory.push(toConnectedSpace(Path.CONSOLE_CONNECTED_SPACE, space.connectId));\n\t};\n\tconst onSettingsClicked = () => {\n\t\tif (!matchPath(location.pathname, Path.CONSOLE_SETTINGS)) {\n\t\t\thistory.push(Path.CONSOLE_SETTINGS);\n\t\t}\n\t};\n\tconst onSpaceConnectClicked = () => {\n\t\tif (!matchPath(location.pathname, Path.CONSOLE_SPACES)) {\n\t\t\thistory.push(Path.CONSOLE_SPACES);\n\t\t}\n\t};\n\tconst onDashboardsClicked = () => {\n\t\tif (!matchPath(location.pathname, Path.CONSOLE_DASHBOARDS)) {\n\t\t\thistory.push(Path.CONSOLE_DASHBOARDS);\n\t\t}\n\t};\n\n\tconst showMenuItemTooltip = menuWidth / minWidth <= 1.5;\n\n\treturn <MenuContainer width={menuWidth}>\n\t\t<MenuLogo/>\n\t\t<MenuItem icon={faHome} label='Home' showTooltip={showMenuItemTooltip}\n\t\t          active={!!matchPath(location.pathname, Path.CONSOLE_HOME)}\n\t\t          onClick={onHomeClicked}/>\n\t\t<MenuItem icon={faTachometerAlt} label='Dashboards' showTooltip={showMenuItemTooltip}\n\t\t          active={!!matchPath(location.pathname, Path.CONSOLE_DASHBOARDS)}\n\t\t          onClick={onDashboardsClicked}/>\n\t\t<FavMenu icon={faStar} label='Show Favorites' showTooltip={showMenuItemTooltip}\n\t\t         active={favorites.visible}\n\t\t         onClick={onFavoriteClicked}/>\n\t\t<MenuSeparator width={menuWidth}/>\n\t\t<MenuItem icon={faBell} label='Notifications' iconSize={1.2} showTooltip={showMenuItemTooltip}\n\t\t          active={!!matchPath(location.pathname, Path.CONSOLE_NOTIFICATION)}\n\t\t          onClick={onNotificationsClicked}/>\n\t\t<MenuItem icon={faInbox} label='Inbox' showTooltip={showMenuItemTooltip}\n\t\t          active={!!matchPath(location.pathname, Path.CONSOLE_INBOX)}\n\t\t          onClick={onInboxClicked}/>\n\t\t<MenuItem icon={faComments} iconSize={1.2} label='Show Timeline' showTooltip={showMenuItemTooltip}\n\t\t          active={!!matchPath(location.pathname, Path.CONSOLE_TIMELINE)}\n\t\t          onClick={onTimelineClicked}/>\n\t\t<MenuSeparator width={menuWidth}/>\n\t\t<SpaceMenus>\n\t\t\t{spaces\n\t\t\t\t.sort((s1, s2) => s1.name.localeCompare(s2.name))\n\t\t\t\t.map(space => {\n\t\t\t\t\treturn <SpaceMenu icon={space.type === ConsoleSpaceType.PUBLIC ? faGlobe : faCompactDisc}\n\t\t\t\t\t                  label={space.name}\n\t\t\t\t\t                  showTooltip={showMenuItemTooltip}\n\t\t\t\t\t                  onClick={onSpaceClicked(space)}\n\t\t\t\t\t                  key={`space-${space.connectId}`}/>;\n\t\t\t\t})}\n\t\t</SpaceMenus>\n\t\t<ConnectMenu icon={faPlus} iconSize={0.8} label='Connect New Space' showTooltip={showMenuItemTooltip}\n\t\t             onClick={onSpaceConnectClicked}/>\n\t\t<Placeholder/>\n\t\t<MenuSeparator width={menuWidth}/>\n\t\t<MenuItem icon={faCog} iconSize={1.2} label='Settings' showTooltip={showMenuItemTooltip}\n\t\t          active={!!matchPath(location.pathname, Path.CONSOLE_SETTINGS)}\n\t\t          onClick={onSettingsClicked}/>\n\t\t<MenuUser user={user}/>\n\t\t<ResizeHandle width={menuWidth} onResize={onResize}/>\n\t</MenuContainer>;\n};","export default __webpack_public_path__ + \"static/media/console-inbox-background.ee7d889d.png\";","import styled from 'styled-components';\n\nexport const SeeAll = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tmargin: 50px 0;\n\topacity: 0;\n\tuser-select: none;\n\tpointer-events: none;\n\ttransition: all 300ms ease-in-out;\n\t&[data-visible=true] {\n\t\topacity: 0.7;\n\t}\n`;\n","// use gpu\nimport dayjs from 'dayjs';\nimport React from 'react';\nimport styled, { keyframes } from 'styled-components';\nimport { SeeAll } from './see-all';\n\nconst ReadAnimation = keyframes`\n\t0% {\n\t\tfilter: blur(0);\n\t\topacity: 1;\n\t\ttransform: translateZ(0) scaleY(100%);\n\t\ttransform-origin: top;\n\t}\n\t99% {\n\t\tfilter: blur(100px);\n\t\tmargin-top: 0;\n\t\topacity: 0;\n\t\ttransform: translateZ(0) scaleY(0);\n\t\ttransform-origin: top;\n\t}\n\t100% {\n\t\tdisplay: none;\n\t}\n`;\n\nexport const MessageItemContainer = styled.div.attrs({\n\t'data-widget': 'console-messages-item'\n})`\n\tdisplay: flex;\n\tposition: relative;\n\tflex-direction: column;\n\tborder-radius: calc(var(--border-radius));\n\tmargin-top: var(--margin);\n\tbox-shadow: var(--console-shadow);\n\ttransition: all 300ms ease-in-out;\n\t&[data-read=true] {\n\t\tanimation: ${ReadAnimation} 1s ease-in-out forwards;\n\t}\n\t&:hover {\n\t\tbox-shadow: var(--console-hover-shadow);\n\t\tdiv[data-widget='console-messages-item-operators'] {\n\t\t\topacity: 1;\n\t\t\tpointer-events: auto;\n\t\t}\n\t}\n`;\n\nexport const MessageItemHeader = styled.div`\n\tborder-bottom: var(--border);\n\tmargin-bottom: -1px;\n\tz-index: 1;\n\tdisplay: grid;\n\tgrid-template-columns: 1fr auto auto;\n\tgrid-column-gap: calc(var(--margin) / 2);\n\talign-items: center;\n\tpadding: calc(var(--margin) / 3) calc(var(--margin) / 2) calc(var(--margin) / 4);\n\tbackground-color: var(--console-message-header-bg-color);\n\toverflow: hidden;\n`;\nexport const MessageItemSender = styled.div`\n\tjustify-self: center;\n\talign-self: center;\n`;\nexport const MessageItemSubject = styled.div`\n\tfont-size: 1.4em;\n\tline-height: 1.8em;\n\tfont-weight: var(--font-bold);\n\topacity: 0.9;\n\twhite-space: nowrap;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\tcursor: pointer;\n\t&:hover {\n\t\tcolor: var(--console-primary-color);\n\t}\n`;\nexport const MessageItemOperators = styled.div.attrs({\n\t'data-widget': 'console-messages-item-operators'\n})`\n\topacity: 0;\n\tpointer-events: none;\n\ttransition: all 300ms ease-in-out;\n`;\nconst MessageItemBody = styled.div`\n\tdisplay: grid;\n\tgrid-template-columns: 1fr auto;\n\tgrid-column-gap: calc(var(--margin) / 2);\n\tpadding: 20px calc(var(--margin) / 2);\n`;\nconst MessageItemBodyContent = styled.div`\n\tdisplay: flex;\n\tflex-direction: column;\n\tline-height: 20px;\n\tword-break: break-word;\n`;\nconst MessageItemBodyImage = styled.div`\n`;\nconst MessageItemCreateAt = styled.div`\n\tgrid-row: span 2;\n\tfont-size: 0.8em;\n\topacity: 0.4;\n\talign-self: start;\n\tfont-weight: var(--font-bold);\n`;\nexport const ItemBody = (props: {\n\tbody: string;\n\tcreateDate: string;\n\timage?: string;\n\tclassName?: string;\n}) => {\n\tconst { body, createDate, image, className, ...rest } = props;\n\n\treturn <MessageItemBody className={className} {...rest}>\n\t\t<MessageItemBodyContent>\n\t\t\t{(body || '').split('\\n').map((line, index) => <span key={index}>{line}</span>)}\n\t\t</MessageItemBodyContent>\n\t\t<MessageItemCreateAt>{dayjs(createDate).format('MMM D [at] H:mm')}</MessageItemCreateAt>\n\t\t<MessageItemBodyImage>{image}</MessageItemBodyImage>\n\t</MessageItemBody>;\n};\n\nconst ItemListContainer = styled.div`\n\tdisplay: flex;\n\tposition: relative;\n\tflex-direction: column;\n\tflex-grow: 1;\n`;\n\nexport const ItemList = (props: {\n\tdata: Array<any>;\n\tallLoaded: boolean;\n\tvisible: boolean;\n\tnoData: string;\n\tchildren: ((props: any) => React.ReactNode) | React.ReactNode;\n}) => {\n\tconst { data, allLoaded, visible, noData, children } = props;\n\n\tif (!visible) {\n\t\treturn null;\n\t}\n\n\treturn <ItemListContainer>\n\t\t{children}\n\t\t<SeeAll data-visible={allLoaded}>\n\t\t\t{data.length === 0 ? noData : ' You\\'ve seen it all.'}\n\t\t</SeeAll>\n\t</ItemListContainer>;\n};","export enum ActiveTab {\n\tREAD = 'read',\n\tUNREAD = 'unread'\n}\n\nexport interface State {\n\tactive: ActiveTab;\n\treadInitialized: boolean;\n\tunreadInitialized: boolean;\n}\n","import { faCheckCircle } from '@fortawesome/free-regular-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React from 'react';\nimport styled from 'styled-components';\nimport { CarvedButton } from '../../../component/console/carved-button';\nimport { HorizontalLoading } from '../../../component/console/horizontal-loading';\nimport { LinkButton } from '../../../component/console/link-button';\nimport { ActiveTab, State } from './types';\n\nconst TabsContainer = styled.div.attrs({\n\t'data-widget': 'console-messages-tabs'\n})`\n\tdisplay: flex;\n\tmargin-top: var(--margin);\n\tmargin-left: calc(var(--margin) / 2 * -1);\n`;\nconst Tab = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\t&[data-active=true] {\n\t\t> button {\n\t\t\tcolor: var(--console-primary-color);\n\t\t}\n\t}\n\t&[data-active=false] {\n\t\t> button {\n\t\t\tcolor: var(--console-waive-color);\n\t\t}\n\t}\n\t> button {\n\t\tfont-size: 1.2em;\n\t\tfont-weight: var(--font-bold);\n\t}\n`;\nconst TabPlaceholder = styled(HorizontalLoading)`\n\tflex-grow: 1;\n`;\n\nexport const Tabs = (props: {\n\tstate: State;\n\tonUnreadClicked: () => void;\n\tonReadClicked: () => void;\n\tonClearClicked: () => void;\n}) => {\n\tconst { state, onUnreadClicked, onReadClicked, onClearClicked } = props;\n\n\treturn <TabsContainer>\n\t\t<Tab data-active={state.active === ActiveTab.UNREAD}>\n\t\t\t<LinkButton onClick={onUnreadClicked}>Unread</LinkButton>\n\t\t</Tab>\n\t\t<Tab data-active={state.active === ActiveTab.READ}>\n\t\t\t<LinkButton onClick={onReadClicked}>Previous</LinkButton>\n\t\t</Tab>\n\t\t<TabPlaceholder\n\t\t\tvisible={!(state.active === ActiveTab.UNREAD ? state.unreadInitialized : state.readInitialized)}/>\n\t\t<CarvedButton data-visible={state.active === ActiveTab.UNREAD} onClick={onClearClicked}>\n\t\t\t<FontAwesomeIcon icon={faCheckCircle}/>\n\t\t\t<span>Clear All</span>\n\t\t</CarvedButton>\n\t</TabsContainer>;\n};","import { faCheck } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { useRef } from 'react';\nimport styled from 'styled-components';\nimport { TooltipAlignment, useTooltip } from '../../../component/console/context/console-tooltip';\nimport { createLinkButtonBackgroundAnimation } from '../../../component/console/link-button';\n\nconst Read = styled.div`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\tjustify-content: center;\n\twidth: 24px;\n\theight: 24px;\n\tcolor: var(--console-primary-color);\n\tborder-radius: var(--border-radius);\n\tcursor: pointer;\n\ttransition: all 300ms ease-in-out;\n\t${createLinkButtonBackgroundAnimation({ opacity: 0.4 })}\n`;\n\nexport const ReadButton = (props: {\n\treadable: boolean;\n\tonRead: () => void;\n\treadOne: () => void;\n\ttooltip: string;\n}) => {\n\tconst { readable, onRead, readOne, tooltip } = props;\n\n\tconst readRef = useRef<HTMLDivElement>(null);\n\tconst { mouseEnter, mouseLeave } = useTooltip({\n\t\tshow: true,\n\t\ttooltip,\n\t\trect: () => ({ align: TooltipAlignment.CENTER, offsetY: 10 }),\n\t\tref: readRef\n\t});\n\tconst onReadClicked = async () => {\n\t\tonRead();\n\t\tsetTimeout(() => readOne(), 1000);\n\t};\n\n\tif (!readable) {\n\t\treturn null;\n\t}\n\n\treturn <Read ref={readRef}\n\t             onMouseEnter={mouseEnter} onMouseLeave={mouseLeave}\n\t             onClick={onReadClicked}>\n\t\t<FontAwesomeIcon icon={faCheck}/>\n\t</Read>;\n};","import React, { useState } from 'react';\nimport styled from 'styled-components';\nimport { ConsoleMail } from '../../../../services/console/types';\nimport { UserAvatar } from '../../../component/console/user-avatar';\nimport { useConsoleContext } from '../../context/console-context';\nimport {\n\tItemBody,\n\tMessageItemContainer,\n\tMessageItemHeader,\n\tMessageItemOperators,\n\tMessageItemSender,\n\tMessageItemSubject\n} from '../common/item';\nimport { ReadButton } from '../common/read-button';\n\nconst Body = styled(ItemBody)`\n    background-color: var(--console-mail-color);\n`;\n\nexport const MailItem = (props: { data: ConsoleMail, readable: boolean }) => {\n\tconst { data, readable } = props;\n\tconst { subject, sender, body, image, createDate } = data;\n\n\tconst context = useConsoleContext();\n\tconst [ read, setRead ] = useState(false);\n\n\treturn <MessageItemContainer data-read={read}>\n\t\t<MessageItemHeader>\n\t\t\t<MessageItemSubject>{subject}</MessageItemSubject>\n\t\t\t<MessageItemOperators>\n\t\t\t\t<ReadButton readable={readable} tooltip='Set as Read'\n\t\t\t\t            onRead={() => setRead(true)}\n\t\t\t\t            readOne={() => context.mails.readOne(data)}/>\n\t\t\t</MessageItemOperators>\n\t\t\t<MessageItemSender>\n\t\t\t\t<UserAvatar name={sender} showTooltip={true}/>\n\t\t\t</MessageItemSender>\n\t\t</MessageItemHeader>\n\t\t<Body body={body} createDate={createDate} image={image}/>\n\t</MessageItemContainer>;\n};","import React, { useEffect, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport BackgroundImage from '../../../../assets/console-inbox-background.png';\nimport Path from '../../../../common/path';\nimport { ConsoleMail } from '../../../../services/console/types';\nimport { NarrowPageTitle } from '../../../component/console/narrow-page-title';\nimport { NarrowContainer } from '../../../component/console/page-container';\nimport { useConsoleContext } from '../../context/console-context';\nimport { ItemList } from '../common/item';\nimport { Tabs } from '../common/tabs';\nimport { ActiveTab, State } from '../common/types';\nimport { MailItem } from './mail-item';\n\nexport const Inbox = () => {\n\tconst history = useHistory();\n\tconst context = useConsoleContext();\n\tconst [ state, setState ] = useState<State>({\n\t\tactive: ActiveTab.UNREAD,\n\t\treadInitialized: false,\n\t\tunreadInitialized: false\n\t});\n\t// load data only when state change\n\tuseEffect(() => {\n\t\t(async () => {\n\t\t\tif (state.active === ActiveTab.UNREAD && !state.unreadInitialized) {\n\t\t\t\tawait context.mails.fetchUnread();\n\t\t\t\tsetState({ ...state, unreadInitialized: true });\n\t\t\t} else if (state.active === ActiveTab.READ && !state.readInitialized) {\n\t\t\t\tawait context.mails.fetchRead();\n\t\t\t\tsetState({ ...state, readInitialized: true });\n\t\t\t}\n\t\t})();\n\t\t// eslint-disable-next-line\n\t}, [ state ]);\n\n\tconst onSettingsClicked = () => history.push(Path.CONSOLE_SETTINGS_INBOX);\n\tconst onTabClicked = (activeTab: ActiveTab) => () => {\n\t\tif (activeTab !== state.active) {\n\t\t\tsetState({ ...state, active: activeTab });\n\t\t}\n\t};\n\n\treturn <NarrowContainer background-image={BackgroundImage}>\n\t\t<NarrowPageTitle title='Inbox' onSettingsClicked={onSettingsClicked}/>\n\t\t<Tabs state={state}\n\t\t      onUnreadClicked={onTabClicked(ActiveTab.UNREAD)} onReadClicked={onTabClicked(ActiveTab.READ)}\n\t\t      onClearClicked={context.mails.readAll}/>\n\t\t<ItemList data={context.mails.unread}\n\t\t          allLoaded={context.mails.allUnreadLoaded}\n\t\t          visible={state.active === ActiveTab.UNREAD}\n\t\t          noData='No mails.'>\n\t\t\t{context.mails.unread.map((item: ConsoleMail, index: number) => {\n\t\t\t\treturn <MailItem data={item} readable={true} key={`${item.createDate}-${index}`}/>;\n\t\t\t})}\n\t\t</ItemList>\n\t\t<ItemList data={context.mails.read} allLoaded={context.mails.allReadLoaded}\n\t\t          visible={state.active === ActiveTab.READ}\n\t\t          noData='No mails.'>\n\t\t\t{context.mails.read.map((item: ConsoleMail, index: number) => {\n\t\t\t\treturn <MailItem data={item} readable={false} key={`${item.createDate}-${index}`}/>;\n\t\t\t})}\n\t\t</ItemList>\n\t</NarrowContainer>;\n};","export default __webpack_public_path__ + \"static/media/console-notifications-background.d5531846.png\";","import React, { useState } from 'react';\nimport styled from 'styled-components';\nimport { ConsoleNotification, ConsoleNotificationCategory } from '../../../../services/console/types';\nimport { UserAvatar } from '../../../component/console/user-avatar';\nimport { useConsoleContext } from '../../context/console-context';\nimport {\n\tItemBody,\n\tMessageItemContainer,\n\tMessageItemHeader,\n\tMessageItemOperators,\n\tMessageItemSender,\n\tMessageItemSubject\n} from '../common/item';\nimport { ReadButton } from '../common/read-button';\n\nconst Header = styled(MessageItemHeader)`\n    grid-template-rows: auto 1fr;\n    grid-row-gap: calc(var(--margin) / 4);\n`;\nconst Operators = styled(MessageItemOperators)`\n\tgrid-row: span 2;\n`;\nconst Sender = styled(MessageItemSender)`\n\tgrid-row: span 2;\n`;\nconst Category = styled.div`\n\tfont-size: 0.8em;\n\tline-height: 1em;\n\topacity: 0.3;\n\tfont-weight: var(--font-bold);\n`;\nconst Body = styled(ItemBody)<{ 'color-type'?: number }>`\n    background-color: ${({ 'color-type': colorType }) => colorType ? `var(--console-notification-color-${colorType})` : 'unset'};\n`;\n\nconst CategoryLabel: { [key in ConsoleNotificationCategory]: string } = {\n\tCHART_TYPE_PUSHED: 'New Chart Type Go Live',\n\n\tSPACE_PUSHED: 'New Space Go Live',\n\tTOPIC_PUSHED: 'New Topic Go Live',\n\tFACTOR_PUSHED: 'New Factor Go Live',\n\n\tREPORT_PUSHED: 'New Report Go Live',\n\n\tGROUP_JOINED: 'Group Joined',\n\tGROUP_LEFT: 'Group Left',\n\n\tSPACE_JOINED: 'Space Joined',\n\tSPACE_LEFT: 'Space Left',\n\n\tSUBSCRIBE_REPORT_CHANGED: 'Subscribed Report Definition Changed',\n\tSUBSCRIBE_REPORT_DELETED: 'Subscribed Report Deleted'\n};\nconst CategoryColor = (category: ConsoleNotificationCategory) => {\n\tswitch (category) {\n\t\tcase ConsoleNotificationCategory.CHART_TYPE_PUSHED:\n\t\t\treturn 1;\n\t\tcase ConsoleNotificationCategory.SPACE_PUSHED:\n\t\tcase ConsoleNotificationCategory.TOPIC_PUSHED:\n\t\tcase ConsoleNotificationCategory.FACTOR_PUSHED:\n\t\t\treturn 2;\n\t\tcase ConsoleNotificationCategory.REPORT_PUSHED:\n\t\t\treturn 3;\n\t\tcase ConsoleNotificationCategory.GROUP_JOINED:\n\t\tcase ConsoleNotificationCategory.GROUP_LEFT:\n\t\tcase ConsoleNotificationCategory.SPACE_JOINED:\n\t\tcase ConsoleNotificationCategory.SPACE_LEFT:\n\t\t\treturn 4;\n\t\tcase ConsoleNotificationCategory.SUBSCRIBE_REPORT_CHANGED:\n\t\tcase ConsoleNotificationCategory.SUBSCRIBE_REPORT_DELETED:\n\t\tdefault:\n\t\t\treturn void 0;\n\t}\n};\n\nexport const NotificationItem = (props: { data: ConsoleNotification, readable: boolean }) => {\n\tconst { data, readable } = props;\n\tconst { subject, category, sender, body, image, createDate } = data;\n\n\tconst context = useConsoleContext();\n\tconst [ read, setRead ] = useState(false);\n\n\treturn <MessageItemContainer data-read={read}>\n\t\t<Header>\n\t\t\t<Category>{CategoryLabel[category]}</Category>\n\t\t\t<Operators>\n\t\t\t\t<ReadButton readable={readable} tooltip='Clear Notification'\n\t\t\t\t            onRead={() => setRead(true)}\n\t\t\t\t            readOne={() => context.notifications.readOne(data)}/>\n\t\t\t</Operators>\n\t\t\t<Sender>\n\t\t\t\t<UserAvatar name={sender} showTooltip={true}/>\n\t\t\t</Sender>\n\t\t\t<MessageItemSubject>{subject}</MessageItemSubject>\n\t\t</Header>\n\t\t<Body body={body} createDate={createDate} image={image} color-type={CategoryColor(category)}/>\n\t</MessageItemContainer>;\n};","import { faBell, faTimes } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport dayjs from 'dayjs';\nimport * as React from 'react';\nimport { useEffect, useState } from 'react';\nimport styled, { keyframes } from 'styled-components';\nimport { ConsoleMail, ConsoleNotification } from '../../services/console/types';\nimport { createLinkButtonBackgroundAnimation } from '../component/console/link-button';\nimport { UserAvatar } from '../component/console/user-avatar';\nimport { useConsoleContext } from './context/console-context';\nimport { ConsoleNotificationEvent } from './context/console-nofitications';\n\nenum MessageType {\n\tNOTIFICATION, MAIL\n}\n\nenum StateVisible {\n\tTRUE = 'true',\n\tFALSE = 'false',\n\tCLOSE = 'close'\n}\n\ninterface State {\n\tvisible: StateVisible;\n\ttype?: MessageType;\n\tcontent?: ConsoleNotification | ConsoleMail;\n}\n\n// use gpu\nconst Show = keyframes`\n\t0%, 100% {\n\t\tright: -500px;\n\t\topacity: 0;\n\t\ttransform: translateZ(0);\n\t}\n\t5%, 90% {\n\t\tfilter: blur(0);\n\t\tright: 64px;\n\t\topacity: 1;\n\t\ttransform: translateZ(0);\n\t}\n\t99% {\n\t\tfilter: blur(40px);\n\t\tright: 64px;\n\t\topacity: 0;\n\t\ttransform: translateZ(0);\n\t}\n`;\nconst Container = styled.div.attrs({\n\t'data-widget': 'console-messenger'\n})`\n\tdisplay: block;\n\tposition: fixed;\n\tz-index: 1000;\n\tbottom: calc(var(--margin) / 2);\n\tright: -500px;\n\t&[data-show=true] {\n\t\tanimation: ${Show} 8s ease-in-out forwards;\n\t}\n\t&[data-show=close] {\n\t\tbottom: -200px;\n\t\ttransition: all 300ms ease-in-out;\n\t\tright: 64px;\n\t}\n`;\nconst Content = styled.div`\n\tdisplay: grid;\n\tposition: relative;\n\tgrid-template-columns: auto 1fr auto auto;\n\tgrid-template-rows: auto 1fr;\n\talign-items: center;\n\tpadding: calc(var(--margin) * 0.25) calc(var(--margin) * 0.5) calc(var(--margin) * 0.25) calc(var(--margin) * 0.75);\n\tborder-radius: var(--border-radius);\n\tbackground-color: var(--console-primary-color);\n\tcolor: var(--invert-color);\n\tcursor: pointer;\n\t> svg {\n\t\tgrid-row: span 2;\n\t\talign-self: center;\n\t\tfont-size: 1.4em;\n\t\tmargin-right: calc(var(--margin) * 0.75);\n\t}\n\t> div:nth-child(2) {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\theight: 22px;\n\t\t> div:first-child {\n\t\t\ttransform: scale(0.7);\n\t\t\ttransform-origin: left center;\n\t\t}\n\t\t> span {\n\t\t\tfont-size: 0.8em;\n\t\t\tfont-weight: var(--font-bold);\n\t\t}\n\t}\n\t> div:nth-child(3) {\n\t\tfont-size: 0.8em;\n\t\tfont-weight: var(--font-bold);\n\t\topacity: 0.7;\n\t}\n\t> div:nth-child(4) {\n\t\tdisplay: flex;\n\t\tposition: relative;\n\t\tfont-size: 0.8em;\n\t\topacity: 0.7;\n\t\twidth: calc(var(--margin) / 2);\n\t\theight: calc(var(--margin) / 2);\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tmargin-left: calc(var(--margin) / 2);\n\t\t${createLinkButtonBackgroundAnimation({ opacity: 0.4 })}\n\t}\n\t> div:last-child {\n\t\tgrid-column: span 3;\n\t\theight: 1.8em;\n\t    line-height: 2em;\n\t    white-space: nowrap;\n\t    overflow: hidden;\n\t    text-overflow: ellipsis;\n\t    width: 300px;\n\t}\n`;\n\nexport const Messenger = () => {\n\tconst context = useConsoleContext();\n\tconst [ schedule, setSchedule ] = useState<number | null>(null);\n\tconst [ state, setState ] = useState<State>({ visible: StateVisible.FALSE });\n\tconst scheduleHide = () => {\n\t\tif (schedule) {\n\t\t\tclearTimeout(schedule);\n\t\t}\n\t\tsetSchedule(setTimeout(() => setState({ visible: StateVisible.FALSE }), 8000));\n\t};\n\tuseEffect(() => {\n\t\tconst onNotificationReceived = (notification: ConsoleMail) => {\n\t\t\tsetState({ visible: StateVisible.TRUE, type: MessageType.NOTIFICATION, content: notification });\n\t\t\tscheduleHide();\n\t\t};\n\t\tcontext.notifications.on(ConsoleNotificationEvent.LATEST_RECEIVED, onNotificationReceived);\n\n\t\treturn () => {\n\t\t\tcontext.notifications.off(ConsoleNotificationEvent.LATEST_RECEIVED, onNotificationReceived);\n\t\t};\n\t});\n\tconst onCloseClicked = () => {\n\t\tif (schedule) {\n\t\t\tclearTimeout(schedule);\n\t\t}\n\t\tsetSchedule(null);\n\t\tsetState({ visible: StateVisible.CLOSE });\n\t};\n\n\treturn <Container data-show={state.visible}>\n\t\t<Content>\n\t\t\t<FontAwesomeIcon icon={faBell}/>\n\t\t\t<div>\n\t\t\t\t<UserAvatar name={state.content?.sender || ''}/>\n\t\t\t\t<span>{state.content?.sender}</span>\n\t\t\t</div>\n\t\t\t<div>{dayjs(state.content?.createDate).format('MMM D [at] H:mm')}</div>\n\t\t\t<div onClick={onCloseClicked}><FontAwesomeIcon icon={faTimes}/></div>\n\t\t\t<div>{state.content?.subject}</div>\n\t\t</Content>\n\t</Container>;\n};","import React, { useEffect, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport BackgroundImage from '../../../../assets/console-notifications-background.png';\nimport Path from '../../../../common/path';\nimport { NarrowPageTitle } from '../../../component/console/narrow-page-title';\nimport { NarrowContainer } from '../../../component/console/page-container';\nimport { useConsoleContext } from '../../context/console-context';\nimport { ItemList } from '../common/item';\nimport { Tabs } from '../common/tabs';\nimport { ActiveTab, State } from '../common/types';\nimport { NotificationItem } from './notification-item';\n\nexport const Notification = () => {\n\tconst history = useHistory();\n\tconst context = useConsoleContext();\n\tconst [ state, setState ] = useState<State>({\n\t\tactive: ActiveTab.UNREAD,\n\t\treadInitialized: false,\n\t\tunreadInitialized: false\n\t});\n\t// load data only when state change\n\tuseEffect(() => {\n\t\t(async () => {\n\t\t\tif (state.active === ActiveTab.UNREAD && !state.unreadInitialized) {\n\t\t\t\tawait context.notifications.fetchUnread();\n\t\t\t\tsetState({ ...state, unreadInitialized: true });\n\t\t\t} else if (state.active === ActiveTab.READ && !state.readInitialized) {\n\t\t\t\tawait context.notifications.fetchRead();\n\t\t\t\tsetState({ ...state, readInitialized: true });\n\t\t\t}\n\t\t})();\n\t\t// eslint-disable-next-line\n\t}, [ state ]);\n\n\tconst onSettingsClicked = () => history.push(Path.CONSOLE_SETTINGS_NOTIFICATION);\n\tconst onTabClicked = (activeTab: ActiveTab) => () => {\n\t\tif (activeTab !== state.active) {\n\t\t\tsetState({ ...state, active: activeTab });\n\t\t}\n\t};\n\n\treturn <NarrowContainer background-image={BackgroundImage}>\n\t\t<NarrowPageTitle title='Notifications' onSettingsClicked={onSettingsClicked}/>\n\t\t<Tabs state={state}\n\t\t      onUnreadClicked={onTabClicked(ActiveTab.UNREAD)} onReadClicked={onTabClicked(ActiveTab.READ)}\n\t\t      onClearClicked={context.mails.readAll}/>\n\t\t<ItemList data={context.notifications.unread}\n\t\t          allLoaded={context.notifications.allUnreadLoaded}\n\t\t          visible={state.active === ActiveTab.UNREAD}\n\t\t          noData='No notifications.'>\n\t\t\t{context.notifications.unread.map((item: any, index: number) => {\n\t\t\t\treturn <NotificationItem data={item} readable={true} key={`${item.createDate}-${index}`}/>;\n\t\t\t})}\n\t\t</ItemList>\n\t\t<ItemList data={context.notifications.read}\n\t\t          allLoaded={context.notifications.allReadLoaded}\n\t\t          visible={state.active === ActiveTab.READ}\n\t\t          noData='No notifications.'>\n\t\t\t{context.notifications.read.map((item: any, index: number) => {\n\t\t\t\treturn <NotificationItem data={item} readable={false} key={`${item.createDate}-${index}`}/>;\n\t\t\t})}\n\t\t</ItemList>\n\t</NarrowContainer>;\n};","export default __webpack_public_path__ + \"static/media/console-settings-background.dde8800a.png\";","import styled from 'styled-components';\n\nexport const SectionTitle = styled.div`\n\tfont-family: var(--console-title-font-family);\n\tfont-size: 1.5em;\n\tmargin-top: var(--margin);\n`;\nexport const ItemContainer = styled.div.attrs({\n\t'data-widget': 'console-settings-item'\n})`\n\tdisplay: flex;\n\tflex-direction: column;\n\tmargin-top: calc(var(--margin) / 2);\n\t&:hover {\n\t\t> div[data-widget='console-settings-item-title'] {\n\t\t\t:before {\n\t\t\t\topacity: 0.5;\n\t\t\t}\n\t\t}\n\t}\n`;\nexport const ItemTitle = styled.div.attrs({\n\t'data-widget': 'console-settings-item-title'\n})`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\tfont-family: var(--console-title-font-family);\n\tfont-size: 1.5em;\n\t&:before {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\ttop: 50%;\n\t\tleft: -16px;\n\t\twidth: 8px;\n\t\theight: 10px;\n\t\ttransform: translateY(-50%);\n\t\tbackground-color: var(--console-primary-color);\n\t\tborder-top-right-radius: 50%;\n\t\tborder-bottom-right-radius: 50%;\n\t\topacity: 0;\n\t\tpointer-events: none;\n\t\ttransition: all 300ms ease-in-out;\n\t}\n`;\nexport const DropdownItemBody = styled.div`\n\tdisplay: grid;\n\tgrid-template-columns: auto auto 1fr;\n\talign-items: center;\n\tmargin-top: calc(var(--margin) / 2);\n\tpadding-bottom: calc(var(--margin) / 3);\n\tborder-bottom: var(--border);\n\t> span:first-child {\n\t\tmargin-right: calc(var(--margin) / 3);\n\t}\n\t> div[data-widget=dropdown] {\n\t\tcolor: var(--console-font-color);\n\t\twidth: 200px;\n\t}\n`;\n\n","import React, { Fragment, useState } from \"react\";\nimport Dropdown, { DropdownOption } from '../../component/dropdown';\nimport { Frequency, FrequencyOptions } from '../context/console-settings';\nimport { DropdownItemBody, ItemContainer, ItemTitle } from './components';\n\nexport const AutoSave = () => {\n\tconst [ frequency, setFrequency ] = useState<Frequency>(Frequency.MIN_5);\n\tconst onFrequencyChanged = async (option: DropdownOption) => {\n\t\tsetFrequency(option.value as Frequency);\n\t};\n\n\treturn <Fragment>\n\t\t<ItemContainer>\n\t\t\t<ItemTitle>Auto Save</ItemTitle>\n\t\t\t<DropdownItemBody>\n\t\t\t\t<span>Every</span>\n\t\t\t\t<Dropdown options={FrequencyOptions} onChange={onFrequencyChanged} value={frequency}/>\n\t\t\t</DropdownItemBody>\n\t\t</ItemContainer>\n\t</Fragment>;\n};","import React, { Fragment } from \"react\";\nimport Dropdown, { DropdownOption } from '../../component/dropdown';\nimport { useConsoleContext } from '../context/console-context';\nimport { Frequency, FrequencyOptions } from '../context/console-settings';\nimport { DropdownItemBody, ItemContainer, ItemTitle } from './components';\n\nexport const MailSettings = () => {\n\tconst { settings: { mailFrequency, mailFrequencyChanged } } = useConsoleContext();\n\tconst onFrequencyChanged = async (option: DropdownOption) => {\n\t\tmailFrequencyChanged(option.value as Frequency);\n\t};\n\n\treturn <Fragment>\n\t\t<ItemContainer>\n\t\t\t<ItemTitle>Mail Check Frequency</ItemTitle>\n\t\t\t<DropdownItemBody>\n\t\t\t\t<span>Every</span>\n\t\t\t\t<Dropdown options={FrequencyOptions} onChange={onFrequencyChanged} value={mailFrequency}/>\n\t\t\t</DropdownItemBody>\n\t\t</ItemContainer>\n\t</Fragment>;\n};","import { faCheck } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { Fragment } from \"react\";\nimport styled from \"styled-components\";\nimport { ConsoleNotificationCategory } from '../../../services/console/types';\nimport Dropdown, { DropdownOption } from '../../component/dropdown';\nimport { useConsoleContext } from '../context/console-context';\nimport { Frequency, FrequencyOptions } from '../context/console-settings';\nimport { DropdownItemBody, ItemContainer, ItemTitle } from './components';\n\nconst NotificationTypeList = styled.div`\n\tdisplay: flex;\n\tflex-direction: column;\n\tmargin-top: calc(var(--margin) / 2);\n\t> div {\n\t\tdisplay: flex;\n\t\theight: 48px;\n\t\tborder-bottom: var(--border);\n\t\t&:first-child {\n\t\t\tfont-family: var(--console-title-font-family);\n\t\t\tfont-weight: var(--font-demi-bold);\n\t\t\tborder-width: calc(var(--border-width) * 2);\n\t\t}\n\t\t> div:first-child {\n\t\t\tdisplay: flex;\n\t\t\tflex-grow: 1;\n\t\t\talign-items: center;\n\t\t}\n\t\t> div:last-child {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\twidth: 180px;\n\t\t\t&[data-checked=true] {\n\t\t\t\t> svg {\n\t\t\t\t\topacity: 1;\n\t\t\t\t\tcolor: var(--console-primary-color);\n\t\t\t\t}\n\t\t\t}\n\t\t\t> svg {\n\t\t\t\tmargin-left: calc(var(--margin) / 3);\n\t\t\t\tfont-size: 1.4em;\n\t\t\t\topacity: 0.6;\n\t\t\t\tcursor: pointer;\n\t\t\t\ttransition: all 300ms ease-in-out;\n\t\t\t}\n\t\t}\n\t}\n`;\n\nconst Notifications = [\n\t{ type: ConsoleNotificationCategory.CHART_TYPE_PUSHED, label: 'New chart type published.' },\n\n\t{ type: ConsoleNotificationCategory.SPACE_PUSHED, label: 'New space published.' },\n\t{ type: ConsoleNotificationCategory.TOPIC_PUSHED, label: 'New topic published' },\n\t{ type: ConsoleNotificationCategory.FACTOR_PUSHED, label: 'New factor published.' },\n\n\t{ type: ConsoleNotificationCategory.REPORT_PUSHED, label: 'New report published.' },\n\n\t{ type: ConsoleNotificationCategory.GROUP_JOINED, label: 'Someone joined your group.' },\n\t{ type: ConsoleNotificationCategory.GROUP_LEFT, label: 'Someone left your group.' },\n\n\t{ type: ConsoleNotificationCategory.SPACE_JOINED, label: 'Someone connected space.' },\n\t{ type: ConsoleNotificationCategory.SPACE_LEFT, label: 'Someone disconnected space.' },\n\n\t{ type: ConsoleNotificationCategory.SUBSCRIBE_REPORT_CHANGED, label: 'Subscribed report changed.' },\n\t{ type: ConsoleNotificationCategory.SUBSCRIBE_REPORT_DELETED, label: 'Subscribed report deleted.' }\n];\n\nexport const NotificationSettings = () => {\n\tconst {\n\t\tsettings: {\n\t\t\tnotificationFrequency, notificationSubscriptionCategories,\n\t\t\tnotificationFrequencyChanged, notificationCategorySubscriptionAdded, notificationCategorySubscriptionRemoved\n\t\t}\n\t} = useConsoleContext();\n\tconst onToggleNotificationSubscribeClicked = (category: ConsoleNotificationCategory) => () => {\n\t\tif (notificationSubscriptionCategories.includes(category)) {\n\t\t\tnotificationCategorySubscriptionRemoved(category);\n\t\t} else {\n\t\t\tnotificationCategorySubscriptionAdded(category);\n\t\t}\n\t};\n\tconst onFrequencyChanged = async (option: DropdownOption) => {\n\t\tnotificationFrequencyChanged(option.value as Frequency);\n\t};\n\n\treturn <Fragment>\n\t\t<ItemContainer>\n\t\t\t<ItemTitle>Subscribed Notifications</ItemTitle>\n\t\t\t<NotificationTypeList>\n\t\t\t\t<div>\n\t\t\t\t\t<div>Notification Type</div>\n\t\t\t\t\t<div>Subscribe?</div>\n\t\t\t\t</div>\n\t\t\t\t{Notifications.map(notification => {\n\t\t\t\t\tconst checked = notificationSubscriptionCategories.some(n => n === notification.type);\n\t\t\t\t\treturn <div key={notification.type}>\n\t\t\t\t\t\t<div>{notification.label}</div>\n\t\t\t\t\t\t<div data-checked={checked}>\n\t\t\t\t\t\t\t<FontAwesomeIcon icon={faCheck}\n\t\t\t\t\t\t\t                 onClick={onToggleNotificationSubscribeClicked(notification.type)}/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>;\n\t\t\t\t})}\n\t\t\t</NotificationTypeList>\n\t\t</ItemContainer>\n\t\t<ItemContainer>\n\t\t\t<ItemTitle>Notification Check Frequency</ItemTitle>\n\t\t\t<DropdownItemBody>\n\t\t\t\t<span>Every</span>\n\t\t\t\t<Dropdown options={FrequencyOptions} onChange={onFrequencyChanged} value={notificationFrequency}/>\n\t\t\t</DropdownItemBody>\n\t\t</ItemContainer>\n\t</Fragment>;\n};","import React from \"react\";\nimport styled from 'styled-components';\nimport BackgroundImage from '../../../assets/console-settings-background.png';\nimport { NarrowPageTitle } from '../../component/console/narrow-page-title';\nimport { NarrowContainer } from '../../component/console/page-container';\nimport { AutoSave } from './auto-save';\nimport { MailSettings } from './mail-settings';\nimport { NotificationSettings } from './notification-settings';\n\nconst Bottom = styled.div`\n\tmargin-bottom: 100px;\n`;\n\nexport const SettingsPanel = () => {\n\treturn <NarrowContainer background-image={BackgroundImage}>\n\t\t<NarrowPageTitle title='Settings'/>\n\t\t<NotificationSettings/>\n\t\t<MailSettings/>\n\t\t<AutoSave/>\n\t\t<Bottom/>\n\t</NarrowContainer>;\n};","export default __webpack_public_path__ + \"static/media/console-timeline-background.f4292043.png\";","import React from \"react\";\nimport BackgroundImage from '../../../assets/console-timeline-background.png';\nimport { NarrowPageTitle } from '../../component/console/narrow-page-title';\nimport { NarrowContainer } from '../../component/console/page-container';\n\nexport const Timeline = () => {\n\treturn <NarrowContainer background-image={BackgroundImage}>\n\t\t<NarrowPageTitle title='Timeline'/>\n\t\t<div style={{ marginTop: 50, fontSize: '2em', opacity: 0.5 }}>\n\t\t\tComing soon...\n\t\t</div>\n\t</NarrowContainer>;\n};","import React from 'react';\nimport { Redirect, Route, Switch } from 'react-router-dom';\nimport styled from 'styled-components';\nimport Path from '../../common/path';\nimport { AvailableSpaces } from './available-spaces';\nimport { ConnectedSpace } from './connected-space';\nimport { ConsoleContextProvider } from './context/console-context';\nimport { Dashboards } from './dashboard';\nimport { Favorite } from './favorite';\nimport { Home } from './home';\nimport { ConsoleMenu } from './menu';\nimport { Inbox } from './message/inbox';\nimport { Notification } from './message/notification';\nimport { Messenger } from './messenger';\nimport { SettingsPanel as Settings } from './settings';\nimport { Timeline } from './timeline';\n\nconst Container = styled.div.attrs({\n\t'data-widget': 'console-container'\n})`\n\tdisplay: flex;\n\tcolor: var(--console-font-color);\n\t--toggle-negative-slider-color: var(--border-color);\n\t--toggle-positive-bg-color: var(--console-primary-color);\n\t--toggle-negative-bg-color: transparent;\n\t--toggle-positive-border-color: var(--console-primary-color);\n\t--toggle-negative-border-color: var(--border-color);\n\t> main {\n\t\tflex-grow: 1;\n\t\tdisplay: flex;\n\t\theight: 100vh;\n\t\toverflow-y: scroll;\n\t}\n\t> div[data-widget='console-favorite-container'][data-pinned=true] + main {\n\t\tmargin-top: var(--console-favorite-pinned-height);\n\t\theight: calc(100vh - var(--console-favorite-pinned-height));\n\t}\n`;\n\nconst ConsoleIndex = () => {\n\treturn <ConsoleContextProvider>\n\t\t<Container>\n\t\t\t<ConsoleMenu/>\n\t\t\t<Favorite/>\n\t\t\t<main>\n\t\t\t\t<Switch>\n\t\t\t\t\t<Route path={Path.CONSOLE_HOME}><Home/></Route>\n\t\t\t\t\t<Route path={Path.CONSOLE_CONNECTED_SPACE}><ConnectedSpace/></Route>\n\t\t\t\t\t<Route path={Path.CONSOLE_DASHBOARDS}><Dashboards/></Route>\n\t\t\t\t\t<Route path={Path.CONSOLE_SPACES}><AvailableSpaces/></Route>\n\t\t\t\t\t<Route path={Path.CONSOLE_INBOX}><Inbox/></Route>\n\t\t\t\t\t<Route path={Path.CONSOLE_NOTIFICATION}><Notification/></Route>\n\t\t\t\t\t<Route path={Path.CONSOLE_SETTINGS}><Settings/></Route>\n\t\t\t\t\t<Route path={Path.CONSOLE_TIMELINE}><Timeline/></Route>\n\t\t\t\t\t<Route path='*'><Redirect to={Path.CONSOLE_HOME}/></Route>\n\t\t\t\t</Switch>\n\t\t\t</main>\n\t\t\t<Messenger/>\n\t\t</Container>\n\t</ConsoleContextProvider>;\n};\n\nexport default ConsoleIndex;"],"sourceRoot":""}