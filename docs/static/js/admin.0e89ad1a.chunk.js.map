{"version":3,"sources":["pages/admin/context/admin-context.tsx","pages/admin/menu/index.tsx","services/admin/pipeline-types.ts","services/admin/types.ts","pages/admin/pipeline/pipeline-context.tsx","services/admin/topic.ts","pages/admin/pipeline/styles.ts","pages/admin/pipeline/pipeline-canvas-topic.tsx","pages/admin/pipeline/pipeline-canvas.tsx","services/admin/pipeline.ts","pages/admin/pipeline/editor/pipeline-edit-context.tsx","pages/admin/pipeline/editor/components/auto-select-input.tsx","pages/admin/pipeline/editor/components/auto-switch-input.tsx","pages/admin/pipeline/editor/components/dropdown-button.tsx","pages/admin/pipeline/editor/pipeline-unit-action-context.tsx","pages/admin/pipeline/editor/components/action-input.tsx","pages/admin/pipeline/editor/components/horizontal-options.tsx","pages/admin/pipeline/editor/unit-actions/action-body.tsx","pages/admin/pipeline/editor/unit-actions/alarm.tsx","pages/admin/pipeline/editor/components/item-finder.tsx","pages/admin/pipeline/editor/components/utils.ts","pages/admin/pipeline/editor/components/topic-finder.tsx","pages/admin/pipeline/editor/components/condition-operator-select.tsx","pages/admin/pipeline/editor/unit-actions/arithmetic-select.tsx","pages/admin/pipeline/editor/components/factor-finder.tsx","pages/admin/pipeline/editor/components/facter-value-finder.tsx","pages/admin/pipeline/editor/utils.ts","pages/admin/pipeline/editor/unit-actions/plain-condition-row.tsx","pages/admin/pipeline/editor/unit-actions/composite-condition-row.tsx","pages/admin/pipeline/editor/unit-actions/topic-row-matcher.tsx","pages/admin/pipeline/editor/components/topic-factor-finder.tsx","pages/admin/pipeline/editor/pipeline-unit-action-mapping-context.tsx","pages/admin/pipeline/editor/unit-actions/topic-mapper.tsx","pages/admin/pipeline/editor/pipeline-unit-condition-context.tsx","pages/admin/pipeline/editor/unit-actions/write-topic-merge-row.tsx","pages/admin/pipeline/editor/pipeline-unit-actions.tsx","pages/admin/pipeline/editor/unit-actions/write-topic-insert-row.tsx","pages/admin/pipeline/editor/unit-actions/write-factor.tsx","pages/admin/pipeline/editor/unit-actions/read-topic-find-row.tsx","pages/admin/pipeline/editor/unit-actions/read-topic-find-factor.tsx","pages/admin/pipeline/editor/unit-actions/read-topic-exists.tsx","pages/admin/pipeline/editor/unit-actions/write-to-memory.tsx","pages/admin/pipeline/editor/unit-condition/plain-condition-row.tsx","pages/admin/pipeline/editor/unit-condition/composite-condition-row.tsx","pages/admin/pipeline/editor/unit-condition/condition-matcher.tsx","pages/admin/pipeline/editor/pipeline-unit-condition.tsx","pages/admin/pipeline/editor/unit-actions/action-lead.tsx","pages/admin/pipeline/editor/unit-actions/action-select.tsx","pages/admin/pipeline/editor/pipeline-unit.tsx","pages/admin/pipeline/editor/pipeline-stage.tsx","pages/admin/pipeline/editor/pipeline-trigger.tsx","pages/admin/pipeline/editor/pipeline-editor.tsx","pages/admin/pipeline/editor/index.tsx","pages/admin/pipeline/pipeline-editor.tsx","pages/admin/pipeline/pipelines-builder.ts","pages/admin/pipeline/pipeline-body.tsx","pages/admin/pipeline/pipeline-header.tsx","pages/admin/pipeline/components.tsx","pages/admin/pipeline/pipeline-navigator-node-label.tsx","pages/admin/pipeline/pipeline-nagivator-factor.tsx","pages/admin/pipeline/pipeline-navigator-topic.tsx","pages/admin/pipeline/pipeline-navigator.tsx","pages/admin/pipeline/index.tsx","assets/report-background.png","services/admin/report.ts","pages/admin/component/edit-panel.tsx","pages/admin/component/edit-panel-buttons.tsx","pages/admin/utils.ts","pages/admin/component/single-search.tsx","pages/admin/component/search-and-edit-panel.tsx","pages/admin/report/index.tsx","assets/space-background.png","services/admin/space.ts","services/admin/user.ts","pages/admin/component/prop-items-picker.tsx","pages/admin/component/group-picker.tsx","pages/admin/component/prop-input.tsx","pages/admin/component/prop-input-lines.tsx","pages/admin/component/prop-label.tsx","pages/admin/component/topic-picker.tsx","pages/admin/space/index.tsx","pages/admin/task/index.tsx","assets/topic-background.png","pages/admin/component/prop-dropdown.tsx","services/admin/topic-import.ts","pages/admin/topic/factor-table-constants.ts","pages/admin/topic/factor-table-body.ts","pages/admin/topic/factor-row.tsx","pages/admin/topic/factor-table.ts","pages/admin/topic/factor-table-footer.ts","pages/admin/topic/factor-table-header.ts","pages/admin/topic/factors-table-buttons.tsx","pages/admin/topic/factors.tsx","pages/admin/topic/index.tsx","assets/user-background.png","pages/admin/user/index.tsx","assets/user-group-background.png","pages/admin/component/space-picker.tsx","pages/admin/component/user-picker.tsx","pages/admin/user-group/index.tsx","pages/admin/home/index.tsx","pages/admin/index.tsx"],"names":["Context","React","createContext","displayName","AdminContextProvider","props","children","menu","useConsoleMenu","useState","name","findAccount","context","user","Provider","value","NoArithmetic","DatePartArithmetic","NumericArithmetic","AggregateArithmetic","SomeValueType","ConditionOperator","CompositeMode","SystemActionType","ReadTopicActionType","WriteTopicActionType","UnitActionAlarmSeverity","PipelineTriggerType","MenuContainer","styled","div","attrs","width","Placeholder","AdminMenu","history","useHistory","location","useLocation","theme","useTheme","minWidth","consoleMenuWidth","maxWidth","consoleMenuMaxWidth","useContext","menuWidth","setMenuWidth","onMenuClicked","path","matchPath","pathname","push","showMenuItemTooltip","title","icon","faHome","label","iconSize","showTooltip","active","Path","ADMIN_HOME","onClick","faTags","ADMIN_TOPICS","faImages","ADMIN_REPORTS","faGlobe","ADMIN_SPACES","faWaveSquare","ADMIN_PIPELINE","faUsersCog","ADMIN_USER_GROUPS","faUserCog","ADMIN_USERS","faTasks","ADMIN_TASKS","onResize","newWidth","Math","min","max","FactorType","TopicType","PipelineEvent","DemoTopics","topicId","code","type","DISTINCT","raw","factorCount","reportCount","groupCount","spaceCount","factors","factorId","SEQUENCE","TEXT","DATETIME","NUMBER","BOOLEAN","description","ENUM","RAW","TIME","RATIO","listTopics","options","a","isMockService","pageNumber","pageSize","Promise","resolve","setTimeout","data","itemCount","length","pageCount","fetch","getServiceHost","search","method","headers","body","JSON","stringify","response","json","result","listTopicsForPipeline","console","log","completed","DemoPipelineOfPolicy","consume","INSERT","stages","units","do","WRITE_FACTOR","FACTOR","produce","INSERT_OR_MERGE","arithmetic","YEAR_OF","WEEK_OF","MONTH_OF","fetchPipeline","listTopicsForSpace","filter","x","toUpperCase","includes","fetchTopic","find","topic","id","saveTopic","PipelineContextProvider","emitter","EventEmitter","setMaxListeners","topics","menuVisible","canvasVisible","topicsLoadCompleted","store","addTopicsChangedListener","listener","on","TOPICS_CHANGED","removeTopicsChangedListener","off","changeFlow","flow","emit","FLOW_CHANGED","addFlowChangedListener","removeFlowChangedListener","changeMenuVisible","visible","MENU_VISIBLE","addMenuVisibilityListener","removeMenuVisibilityListener","changeCanvasVisible","CANVAS_VISIBLE","addCanvasVisibilityListener","removeCanvasVisibilityListener","changeSelectedTopic","selectedTopic","selectedPipeline","TOPIC_SELECTION_CHANGED","addTopicSelectionChangedListener","removeTopicSelectionChangedListener","changeSelectedPipeline","pipeline","PIPELINE_SELECTION_CHANGED","addPipelineSelectionChangedListener","removePipelineSelectionChangedListener","collapseAllTopics","COLLAPSE_ALL_TOPICS","addCollapseAllTopicsListener","removeCollapseAllTopicsListener","changeTopicFilter","filterText","TOPIC_FILTER_TEXT_CHANGED","toLowerCase","addTopicFilterChangedListener","removeTopicFilterChangedListener","functions","useEffect","sort","b","localeCompare","usePipelineContext","TopicTypeStyles","AGGREGATE","NOT_DEFINED","Topic","Object","keys","map","topicType","join","Corner","TopicTypeIcon","MorePipelines","count","direction","style","display","MoreSourceTopicCount","MoreTargetTopicCount","Selection","ToNextTopicLine","TopicTypeTooltip","PipelineCanvasTopic","toMe","fromMe","previous","next","current","forceUpdate","useForceUpdate","moreSourceTopicCount","moreTargetTopicCount","Set","targetTopicIds","targetTopicId","flat","data-current","data-topic-type","data-widget-type","faCodeBranch","data-visible","PipelinesCanvasContainer","PipelineCanvas","nodes","node","key","v4","savePipeline","doSave","origin","PipelineEditContextProvider","saved","throttle","state","save","dayjs","format","clearTimeout","firePipelineContentChange","groupCollapsed","error","groupEnd","usePipelineEditContext","AnInput","Input","AutoSelectInput","placeholder","onChange","onFocus","onBlur","nameRef","useRef","event","target","select","onKeyUp","blur","ref","InputContainer","height","backgroundColor","paddingHorizontal","inputFontSize","PrefixLabel","span","DisplayLabel","AutoSwitchInput","prefixLabel","styles","editing","setEditing","data-editing","data-role","PipelineUnitActionEvent","Dropdown","top","left","atTop","opacity","pointerEvents","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","DropdownMenu","DropdownButton","menus","containerRef","expanded","setExpanded","useCollapseFixedThing","inkType","data-menu-at-top","data-menu-visible","preventDefault","stopPropagation","rect","getBoundingClientRect","window","innerHeight","faCaretDown","data-ink-type","doOnClick","PipelineUnitActionContextProvider","firePropertyChange","addPropertyChangeListener","removePropertyChangeListener","usePipelineUnitActionContext","ActionInput","Options","HorizontalOptions","toLabel","onSelect","data-expanded","tabIndex","option","newOption","faTimes","faEdit","ActionBody2Columns","ActionBodyItemLabel","AlarmContainer","asDisplaySeverity","severity","split","word","substr","FinderContainer","TypeChar","bottom","transformOrigin","ItemFinder","typeChar","item","asLabel","filterItems","inputRef","dropdownRef","searchInputRef","dropdownRect","setDropdownRect","searchText","setSearchText","filteredItems","setFilteredItems","filterTimeout","setFilterTimeout","expand","focus","onNameChanged","filtered","onExpandClick","onItemClicked","readOnly","data-count","parts","part","filterByText","all","text","segments","pos","reduce","segment","index","len","filterTopic","trim","filterFactor","factor","isCompositeCondition","condition","mode","isPlainCondition","computeConditionLines","child","computeConditionCount","isFactorValue","isMemoryValue","IN_MEMORY","TopicFinder","holder","currentTopicId","ConditionOperatorSelectContainer","right","asDisplayOperator","operator","EMPTY","NOT_EMPTY","EQUALS","NOT_EQUALS","LESS","LESS_EQUALS","MORE","MORE_EQUALS","IN","NOT_IN","OperatorButton","ConditionOperatorSelect","onScroll","addEventListener","removeEventListener","onOperatorClicked","ArithmeticSelectContainer","aggregate","minHeight","DropdownRowHeight","ClearButton","asDisplayArithmetic","WEEKDAY","ABSOLUTE_VALUE","LOGARITHM","PERCENTAGE","COUNT","SUM","AVG","MEDIAN","MAX","MIN","NO_FUNC","ArithmeticTypes","enum","ArithmeticButton","ArithmeticSelect","onArithmeticClicked","arithmetics","values","candidateType","FactorFinder","currentFactorId","Container","asDisplayValueType","source","FacterValueFinder","onTopicChange","onFactorChange","onVariableChange","onArithmeticChange","valueType","sourceTopicId","sourceTopic","candidate","unitActionTypeAsDisplay","createStage","uuid","createAlarmUnit","createAlarmAction","ALARM","MEDIUM","OperatorLabels","ArithmeticLabels","LeftAsFactorContainer","OperatorAndRightContainer","buildLabel","Statement","FILTER_CHANGED","PlainConditionRow","grandParentCondition","grandParent","parentCondition","parent","topContainerRef","fillCondition","onFilterChange","faCompressAlt","faExpandAlt","indexInParent","findIndex","indexInGrand","splice","FILTER_OUTDENT","faLongArrowAltLeft","newParent","AND","OR","FILTER_INDENT","faLongArrowAltRight","FILTER_REMOVED","faTrashAlt","Title","NoChild","ChildConditionsNode","maxHeight","transform","ChildConditions","level","lines","removable","plain","CompositeConditionRow","data-removable","faChevronDown","FACTOR_CHANGED","FILTER_ADDED","faPlus","ToggleLine","ToggleButton","FilterContent","FilterLabel","TopicRowMatcher","TOPIC_CHANGED","by","linesCount","filtersCount","faCompressArrowsAlt","faExpandArrowsAlt","PipelineUnitActionMappingEvent","TopicFactorFinder","PipelineUnitActionMappingContextProvider","MAPPING_CHANGED","usePipelineUnitActionMappingContext","PipelineUnitConditionEvent","Body","MappingRuleContent","MappingRuleContainer","MappingRule","FactorContainer","AddButton","buildFactorValueLabel","mapping","from","to","FROM_CHANGED","TO_CHANGED","RuleNode","rule","onRemove","onFromChanged","TopicMapper","onRuleRemove","onSortAlphaDown","r1","r2","onSortAlphaUp","ruleCount","canSort","data-can-sort","faSortAlphaDown","faSortAlphaUp","WriteTopicMergeRow","write","action","UnitActionNodes","INSERT_ROW","MERGE_ROW","INSERT_OR_MERGE_ROW","VARIABLE_CHANGED","ARITHMETIC_CHANGED","READ_ROW","read","targetName","READ_FACTOR","EXISTS","COPY_TO_MEMORY","alarm","message","PipelineUnitConditionContextProvider","usePipelineUnitConditionContext","RightAsInMemoryContainer","ConditionMatcher","unit","UnitCondition","UnitSectionLabel","PipelineUnitCondition","conditional","setConditional","conditionExpanded","setConditionExpanded","withCondition","conditionLabel","data-conditional","data-condition-expanded","AL","ActionLead","faMinus","ActionSelectContainer","ActionTypes","OnActionTypeChanged","keep","default","ActionTypeButton","ActionSelect","onTypeChanged","onActionTypeClicked","actionDefault","forEach","UnitContainer","ToggleExpandButton","WaiveObjectButton","UnitActions","UnitActionContainer","UnitButtons","UnitActionNode","deleteAction","dialog","useDialog","onActionDeleteConfirmClicked","hide","onClearSettingsConfirmClicked","UnitNode","show","data-widget","buildDialogButtons","onConfirm","flexGrow","ButtonType","PRIMARY","DEFAULT","PipelineUnit","stage","appendUnit","prependUnit","deleteUnit","onDeleteAction","exists","onUnitDeleteConfirmClicked","onClearActionsConfirmClicked","faPencilRuler","faMicrochip","DANGER","faEraser","StageContainer","StageTitle","StageBody","StageFooter","StageEditor","appendStage","prependStage","deleteStage","bodyRef","onAppendUnit","onPrependUnit","unshift","onStageDeleteConfirmClicked","onClearUnitsConfirmClicked","onDeleteUnit","faProjectDiagram","Trigger","TriggerTypeOptions","MERGE","DELETE","PipelineTrigger","availableTypes","newType","PipelineEditor","outbound","onAppendStage","onPrependStage","onDeleteStage","EditorContainer","EditorTitle","PipelineSwitcher","EditorBody","PipelineButton","pipelines","innerWidth","data-can-expand","faCheck","Editor","inboundCount","outboundCount","selectNextPipeline","toNext","isOutbound","newPipeline","arrangedPipeline","NoTopicSelected","computePipelines","arranged","starts","ends","allTopics","findPipelines","getNextTopicId","votedPipeline","get","use","buildPipelines","toCurrent","computePipelinesTo","reverse","fromCurrent","computePipelinesFrom","WaitData","getOrCreateFromMap","array","set","arrangeFlow","sourceMap","Map","targetMap","isWriteTopicAction","startsFrom","endsTo","PipelineBody","ordered","setOrdered","setArranged","onFlowChanged","topicMap","Header","Slice","Buttons","Button","pressed","data-pressed","ignoreHorizontalPadding","CanvasToggleButton","MenuToggleButton","faBars","PipelineHeader","render","asDirection","fromTopic","buildSelectedTopicSlice","Icon","color","TopicIcon","consoleRawTopicColor","consoleRatioTopicColor","consoleDistinctTopicColor","consoleAggregateTopicColor","consoleTimeTopicColor","consoleUndefinedTopicColor","getTopicColor","FactorIcon","LightColors24","char","charCodeAt","Label","PipelineNavigatorNodeLabel","indexOf","content","mid","FactorsContainer","FactorNode","NavigatorFactors","visibleFactors","displayFactors","TopicContainer","TopicContent","NavigatorTopic","showDialog","hideDialog","factorsVisible","setFactorsVisible","setActive","setFilterText","pickedTopic","onCollapseAllTopics","onFilterTextChange","onShowPipelineClicked","topicVisible","data-topic-id","data-factors-visible","faChevronRight","tooltip","offsetX","Navigator","position","consoleSpaceHeaderHeight","Search","Spin","keyframes","LoadingInCenterDiv","LoadingInCenter","faCircleNotch","LoadingInBottomDiv","LoadingInBottom","SearchInTitle","onSearch","setOnSearch","searchThrottle","setSearchThrottle","data-on-search","faSearch","PipelineNavigator","setWidth","linkTopic","setLinkTopic","onVisibleChanged","onTopicLink","topicNode","querySelector","scrollIntoView","behavior","block","data-link-topic","rotate","faLink","alignment","ResizeHandleAlignment","RIGHT","Pipeline","listReports","EditPanelEvent","EditContainer","Image","background","backgroundImage","backgroundPosition","EditPanelContextProvider","changeBackgroundPosition","BACKGROUND_POSITION_CHANGED","addBackgroundPositionChangeListener","removeBackgroundPositionChangeListener","useEditPanelContext","EditImage","setBackgroundPosition","EditArea","EditPanel","EditPanelButtons","createBlankDataPage","Main","Operators","SearchOperator","List","NoData","Bottom","SingleSearchItemCard","SingleSearch","searchPlaceholder","createButtonLabel","onCreate","onSearched","listData","renderItem","getKeyOfItem","searchRef","beforeSearch","setBeforeSearch","loading","setLoading","queried","setState","searchPage","clear","collapseSearchText","searched","onSearchKeyPressed","data-can-create","data-on-before-search","onKeyPress","Saved","InformMessage","entityLabel","entityImage","originEntity","entity","createEntity","saveEntity","isEntityOnCreate","onClosed","renderEditContent","dataChanged","setDataChanged","dataSaving","setDataSaving","dataSaved","setDataSaved","onConfirmClicked","kind","data-change-kind","SearchAndEditPanel","fetchEntityAndCodes","fetchEntityList","renderEntityInList","getKeyOfEntity","editEntity","setEditEntity","onEdit","queriedEntity","Explanation","Reports","ReportBackground","report","reportId","center","topicCount","faUsers","listSpaces","spaceId","connectionCount","listSpacesForUserGroup","fetchSpace","space","groupIds","groups","userGroupId","topic_response","topic_list","group_response","group_list","saveSpace","listUserGroups","userCount","listUsers","userId","listUserGroupsForUser","fetchUser","saveUser","fetchUserGroup","group","userIds","spaceIds","users","spaces","user_response","user_list","space_response","space_list","saveUserGroup","listUsersForUserGroup","listUserGroupsForSpace","PropItemsPickerContainer","Items","SelectedItemInItemPicker","CandidateItemInItemPicker","ItemPicker","selectedItems","renderSelectedItem","renderCandidateItem","fetchItems","inSearch","setInSearch","searchItems","setSearchItems","searchHandle","setSearchHandle","dropdownContent","faSpinner","spin","data-in-search","handle","items","faBan","PropItemPicker","codes","initPropArray","addItemToProp","removeItemFromProp","isItemPicked","addItemToCodes","removeItemFromCodes","getNameOfItem","getMinorNameOfItem","listItems","onDataChanged","onSpaceRemove","sortItem","g1","g2","fetchSpacesBySearch","checked","onSpaceAdd","initGroupArray","addGroupToHolder","removeGroupFromHolder","groupId","isGroupSelected","addGroupToCodes","removeGroupFromCodes","getGroupId","getGroupName","getGroupDescription","GroupPicker","listGroups","PropInput","PropInputLines","textarea","PropLabel","initTopicArray","topicIds","addTopicToSpace","removeTopicFromSpace","isTopicSelected","addTopicToCodes","removeTopicFromCodes","getTopicId","getTopicName","getTopicDescription","TopicPicker","Spaces","setCodes","queriedSpace","onPropChange","prop","SpaceBackground","fake","faChartBar","Tasks","marginTop","fontSize","PropDropdown","asFactors","Array","isArray","Error","columnMap","columns","row","isNaN","Number","parseFromCsv","reject","parseCSV","comment","skipEmptyLines","skipLinesWithError","skipLinesWithEmptyValues","autoParse","autoParseDate","err","e","parseFromJson","parse","FACTOR_TABLE_TYPE_COLUMN_WIDTH","FACTOR_BUTTONS_WIDTH","FactorTableBody","FactorCell","FactorNameCell","FactorLabelCell","FactorTypeCell","FactorDescCell","FactorButtons","IncorrectFactorType","FactorTypeOptions","OBJECT","ARRAY","findParentFactor","factorIndex","f","FactorRow","onFactorPropChange","onFactorTypeChange","factorType","pass","typeOptions","prepareFactorPainting","passTypeCheck","isValid","namePlaceholder","data-valid","endsWith","data-max","faLevelDownAlt","rotation","FactorTable","FACTOR_TABLE_BODY_MAX_HEIGHT","FACTOR_TABLE_HEADER_HEIGHT","FactorTableFooter","FactorTableHeader","FactorsTableButtons","Factors","notImpl","useNotImplemented","setMax","buttonLabel","input","document","createElement","multiple","accept","onchange","files","file","onFileSelected","click","faUpload","TopicTypeOptions","onTypeChange","Topics","queriedTopic","TopicBackground","faList","ItemCard","Users","queriedUser","UserBackground","nickName","initSpaceArray","addSpaceToGroup","removeSpaceFromGroup","isSpaceSelected","addSpaceToCodes","removeSpaceFromCodes","getSpaceId","getSpaceName","getSpaceDescription","SpacePicker","initUserArray","addUserToGroup","removeUserFromGroup","isUserSelected","addUserToCodes","removeUserFromCodes","getUserId","getUserName","getUserNickName","UserPicker","UserGroups","queriedGroup","UserGroupBackground","userGroup","onChartDelete","chart","onChartSave","subject","TopX","subjectId","chartId","chartName","dimensionName","ConsoleTopicFactorType","topicRelations","ConsoleSpaceSubjectChartType","BAR","indicators","aggregator","ConsoleSpaceSubjectChartIndicatorAggregator","NONE","alias","dimensions","graphicsCount","lastVisitTime","createdAt","dataset","filters","joins","graphics","connectedSpace","connectId","ConsoleSpaceType","PRIVATE","subjects","createDef","locked","relative","settings","onDeleteChart","Home","AdminIndex"],"mappings":"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","file":"static/js/admin.0e89ad1a.chunk.js","sourcesContent":["import React, { useState } from 'react';\nimport { findAccount } from '../../../services/account/account-session';\nimport { ConsoleMenuUsable, useConsoleMenu } from '../../component/console/context/console-menu';\nimport { ConsoleTooltipContextProvider } from '../../component/console/context/console-tooltip';\nimport { ConsoleUser } from '../../component/console/types';\n\nexport interface AdminContext {\n\tmenu: ConsoleMenuUsable;\n\tuser: ConsoleUser;\n}\n\nconst Context = React.createContext<AdminContext>({} as AdminContext);\nContext.displayName = 'AdminContext';\n\nexport const AdminContextProvider = (props: { children?: ((props: any) => React.ReactNode) | React.ReactNode }) => {\n\tconst { children } = props;\n\n\tconst menu = useConsoleMenu();\n\tconst [ currentUser ] = useState<ConsoleUser>(() => {\n\t\treturn {\n\t\t\tname: findAccount()?.name || 'Walter Kovacs'\n\t\t};\n\t});\n\n\tconst context = {\n\t\tmenu,\n\t\tuser: currentUser\n\t};\n\n\treturn <Context.Provider value={context}>\n\t\t<ConsoleTooltipContextProvider>\n\t\t\t{children}\n\t\t</ConsoleTooltipContextProvider>\n\t</Context.Provider>;\n};\n\nexport const useAdminContext = () => {\n\treturn React.useContext(Context);\n};\n","import {\n\tfaGlobe,\n\tfaHome,\n\tfaImages,\n\tfaTags,\n\tfaTasks,\n\tfaUserCog,\n\tfaUsersCog,\n\tfaWaveSquare\n} from '@fortawesome/free-solid-svg-icons';\nimport React from 'react';\nimport { matchPath, useHistory, useLocation } from 'react-router-dom';\nimport styled, { useTheme } from 'styled-components';\nimport Path from '../../../common/path';\nimport { Theme } from '../../../theme/types';\nimport { MenuItem } from '../../component/console/menu/menu-item';\nimport { MenuLogo } from '../../component/console/menu/menu-logo';\nimport { MenuSeparator } from '../../component/console/menu/menu-separator';\nimport { MenuUser } from '../../component/console/menu/menu-user';\nimport { ResizeHandle } from '../../component/console/menu/resize-handle';\nimport { useAdminContext } from '../context/admin-context';\n\nconst MenuContainer = styled.div.attrs({\n\t'data-widget': 'menu-container'\n})<{ width: number }>`\n\tdisplay          : flex;\n\tposition         : relative;\n\tflex-direction   : column;\n\talign-items      : flex-start;\n\twidth            : ${({ width }) => `${width}px`};\n\tmin-width        : var(--console-menu-width);\n\theight           : 100vh;\n\ttop              : 0;\n\tleft             : 0;\n\tborder-right     : var(--border);\n\tbackground-color : var(--invert-color);\n\toverflow         : hidden;\n\t// TODO hide tasks button\n\t> div:nth-child(10) {\n\t\tdisplay : none;\n\t}\n`;\nconst Placeholder = styled.div`\n\tflex-grow : 1;\n`;\n\nexport const AdminMenu = () => {\n\tconst history = useHistory();\n\tconst location = useLocation();\n\tconst theme = useTheme();\n\tconst minWidth = (theme as Theme).consoleMenuWidth;\n\tconst maxWidth = (theme as Theme).consoleMenuMaxWidth;\n\tconst {\n\t\tuser,\n\t\tmenu: { menuWidth, setMenuWidth }\n\t} = useAdminContext();\n\n\tconst onResize = (newWidth: number) => {\n\t\tsetMenuWidth(Math.min(Math.max(newWidth, minWidth), maxWidth));\n\t};\n\tconst onMenuClicked = (path: string) => () => {\n\t\tif (!matchPath(location.pathname, path)) {\n\t\t\thistory.push(path);\n\t\t}\n\t};\n\n\tconst showMenuItemTooltip = menuWidth / minWidth <= 1.5;\n\n\treturn <MenuContainer width={menuWidth}>\n\t\t<MenuLogo title='Watchmen Admin'/>\n\t\t<MenuItem icon={faHome} label='Home' iconSize={1.2} showTooltip={showMenuItemTooltip}\n\t\t          active={!!matchPath(location.pathname, Path.ADMIN_HOME)}\n\t\t          onClick={onMenuClicked(Path.ADMIN_HOME)}/>\n\t\t<MenuItem icon={faTags} label='Topics' iconSize={1.2} showTooltip={showMenuItemTooltip}\n\t\t          active={!!matchPath(location.pathname, Path.ADMIN_TOPICS)}\n\t\t          onClick={onMenuClicked(Path.ADMIN_TOPICS)}/>\n\t\t<MenuItem icon={faImages} label='Reports' iconSize={1.2} showTooltip={showMenuItemTooltip}\n\t\t          active={!!matchPath(location.pathname, Path.ADMIN_REPORTS)}\n\t\t          onClick={onMenuClicked(Path.ADMIN_REPORTS)}/>\n\t\t<MenuItem icon={faGlobe} label='Spaces' iconSize={1.2} showTooltip={showMenuItemTooltip}\n\t\t          active={!!matchPath(location.pathname, Path.ADMIN_SPACES)}\n\t\t          onClick={onMenuClicked(Path.ADMIN_SPACES)}/>\n\t\t<MenuItem icon={faWaveSquare} label='Pipelines' iconSize={1.2} showTooltip={showMenuItemTooltip}\n\t\t          active={!!matchPath(location.pathname, Path.ADMIN_PIPELINE)}\n\t\t          onClick={onMenuClicked(Path.ADMIN_PIPELINE)}/>\n\t\t<MenuSeparator width={menuWidth}/>\n\t\t<MenuItem icon={faUsersCog} label='User Groups' iconSize={1.2} showTooltip={showMenuItemTooltip}\n\t\t          active={!!matchPath(location.pathname, Path.ADMIN_USER_GROUPS)}\n\t\t          onClick={onMenuClicked(Path.ADMIN_USER_GROUPS)}/>\n\t\t<MenuItem icon={faUserCog} label='Users' iconSize={1.2} showTooltip={showMenuItemTooltip}\n\t\t          active={!!matchPath(location.pathname, Path.ADMIN_USERS)}\n\t\t          onClick={onMenuClicked(Path.ADMIN_USERS)}/>\n\t\t<MenuSeparator width={menuWidth}/>\n\t\t<MenuItem icon={faTasks} label='Tasks' iconSize={1.2} showTooltip={showMenuItemTooltip}\n\t\t          active={!!matchPath(location.pathname, Path.ADMIN_TASKS)}\n\t\t          onClick={onMenuClicked(Path.ADMIN_TASKS)}/>\n\t\t<Placeholder/>\n\t\t<MenuSeparator width={menuWidth}/>\n\t\t<MenuUser user={user}/>\n\t\t<ResizeHandle width={menuWidth} onResize={onResize}/>\n\t</MenuContainer>;\n};","export interface TopicHolder {\n\ttopicId?: string;\n}\n\nexport interface FactorHolder extends TopicHolder {\n\tfactorId?: string;\n}\n\n// value used in unit actions\nexport enum NoArithmetic {\n\tNO_FUNC = 'no-func',\n}\n\nexport enum DatePartArithmetic {\n\tYEAR_OF = 'year-of',\n\tMONTH_OF = 'month-of',\n\tWEEK_OF = 'week-of',\n\tWEEKDAY = 'weekday',\n}\n\nexport enum NumericArithmetic {\n\tPERCENTAGE = 'percentage',\n\tABSOLUTE_VALUE = 'abs',\n\tLOGARITHM = 'log',\n}\n\nexport enum AggregateArithmetic {\n\tCOUNT = 'count',\n\tSUM = 'sum',\n\tAVG = 'avg',\n\tMAX = 'max',\n\tMIN = 'min',\n\tMEDIAN = 'med'\n}\n\nexport type SimpleFuncArithmetic = NoArithmetic | DatePartArithmetic | NumericArithmetic | AggregateArithmetic;\n\nexport enum SomeValueType {\n\tIN_MEMORY = 'in-memory',\n\tFACTOR = 'factor',\n}\n\nexport interface SomeValue {\n\ttype?: SomeValueType;\n}\n\nexport interface SimpleFuncValue extends SomeValue {\n\tarithmetic: SimpleFuncArithmetic;\n}\n\nexport interface InMemoryValue extends SimpleFuncValue {\n\ttype: SomeValueType.IN_MEMORY;\n\tname: string;\n}\n\nexport interface FactorValue extends TopicHolder, FactorHolder, SimpleFuncValue {\n\ttype: SomeValueType.FACTOR;\n}\n\nexport interface FactorValueHolder {\n\tvalue: SomeValue;\n}\n\nexport interface Condition {\n}\n\nexport enum ConditionOperator {\n\tEMPTY = 'empty',\n\tNOT_EMPTY = 'not-empty',\n\tEQUALS = 'equals',\n\tNOT_EQUALS = 'not-equals',\n\tLESS = 'less',\n\tLESS_EQUALS = 'less-equals',\n\tMORE = 'more',\n\tMORE_EQUALS = 'more-equals',\n\tIN = 'in',\n\tNOT_IN = 'not-in',\n}\n\nexport interface PlainCondition extends Condition {\n\tleft: SimpleFuncValue;\n\toperator: ConditionOperator;\n\tright: SimpleFuncValue;\n}\n\nexport enum CompositeMode {\n\tAND = 'and',\n\tOR = 'or',\n}\n\nexport interface CompositeCondition extends Condition {\n\tmode: CompositeMode;\n\tchildren: Array<Condition>;\n}\n\n// find row by\nexport interface FindBy {\n\tby: CompositeCondition;\n}\n\nexport interface MappingFactor {\n\tfrom: SimpleFuncValue;\n\tto: SimpleFuncValue;\n}\n\n// mapping row to row\nexport interface MappingRow {\n\tmapping: Array<MappingFactor>;\n}\n\n// unit actions\nexport enum SystemActionType {\n\tALARM = 'alarm',\n\tCOPY_TO_MEMORY = 'copy-to-memory',\n}\n\nexport enum ReadTopicActionType {\n\tREAD_ROW = 'read-row',\n\tREAD_FACTOR = 'read-factor',\n\tEXISTS = 'exists',\n}\n\nexport enum WriteTopicActionType {\n\tMERGE_ROW = 'merge-row',\n\tINSERT_ROW = 'insert-row',\n\tINSERT_OR_MERGE_ROW = 'insert-or-merge-row',\n\tWRITE_FACTOR = 'write-factor',\n}\n\nexport type UnitActionType = WriteTopicActionType | ReadTopicActionType | SystemActionType;\n\nexport interface UnitAction {\n\ttype: UnitActionType;\n}\n\nexport interface MemoryWriter extends UnitAction {\n\ttargetName: string;\n}\n\nexport interface UnitActionWriteTopic extends TopicHolder, UnitAction {\n\ttype: WriteTopicActionType;\n}\n\nexport interface UnitActionInsertRow extends UnitActionWriteTopic, MappingRow {\n\ttype: WriteTopicActionType.INSERT_ROW;\n}\n\nexport interface UnitActionMergeRow extends UnitActionWriteTopic, MappingRow, FindBy {\n\ttype: WriteTopicActionType.MERGE_ROW | WriteTopicActionType.INSERT_OR_MERGE_ROW;\n}\n\nexport interface UnitActionWriteFactor extends FactorHolder, FactorValueHolder, UnitActionWriteTopic, FindBy {\n\ttype: WriteTopicActionType.WRITE_FACTOR;\n}\n\nexport interface UnitActionReadRow extends TopicHolder, MemoryWriter, FindBy {\n\ttype: ReadTopicActionType.READ_ROW;\n}\n\nexport interface UnitActionReadFactor extends TopicHolder, FactorHolder, MemoryWriter, FindBy {\n\ttype: ReadTopicActionType.READ_FACTOR;\n}\n\nexport interface UnitActionExists extends TopicHolder, MemoryWriter, FindBy {\n\ttype: ReadTopicActionType.EXISTS;\n}\n\nexport enum UnitActionAlarmSeverity {\n\tLOW = 'low',\n\tMEDIUM = 'medium',\n\tHIGH = 'high',\n\tCRITICAL = 'critical',\n}\n\nexport interface UnitActionAlarm extends UnitAction {\n\ttype: SystemActionType.ALARM;\n\tseverity: UnitActionAlarmSeverity;\n\tmessage?: string;\n}\n\nexport interface UnitActionCopyToMemory extends FactorValueHolder, MemoryWriter {\n\ttype: SystemActionType.COPY_TO_MEMORY;\n}\n\nexport interface ProcessUnit {\n\ton?: CompositeCondition;\n\tdo: Array<UnitAction>;\n}\n\nexport interface Stage {\n\tname?: string;\n\tunits: Array<ProcessUnit>;\n}\n\nexport enum PipelineTriggerType {\n\tINSERT = 'insert',\n\tMERGE = 'merge',\n\t// insert or merge\n\tINSERT_OR_MERGE = 'insert-or-merge',\n\tDELETE = 'delete',\n}\n\nexport interface Pipeline {\n\tpipelineId?: string;\n\ttopicId: string;\n\tname?: string;\n\ttype: PipelineTriggerType;\n\tstages: Array<Stage>;\n}\n\nexport interface PipelineFlow {\n\ttopicId: string;\n\tconsume: Array<Pipeline>;\n\tproduce: Array<Pipeline>;\n}\n","export interface DataPage<T> {\n\tdata: Array<T>;\n\titemCount: number;\n\tpageNumber: number;\n\tpageSize: number;\n\tpageCount: number;\n}\n\nexport interface QueriedTopic {\n\ttopicId: string;\n\tcode: string;\n\tname: string;\n\tdescription?: string;\n\traw: boolean;\n\tfactorCount: number;\n\treportCount: number;\n\tgroupCount: number;\n\tspaceCount: number;\n}\n\nexport interface QueriedReport {\n\treportId: string;\n\tname: string;\n\tdescription?: string;\n\tpredefined: boolean;\n\ttopicCount: number;\n\tgroupCount: number;\n\tspaceCount: number;\n}\n\nexport interface QueriedSpace {\n\tspaceId: string;\n\tname: string;\n\tdescription?: string;\n\ttopicCount: number;\n\treportCount: number;\n\tgroupCount: number;\n\tconnectionCount: number;\n}\n\nexport interface QueriedUserGroup {\n\tuserGroupId: string;\n\tname: string;\n\tdescription?: string;\n\tuserCount: number;\n\tspaceCount: number;\n\ttopicCount: number;\n\treportCount: number;\n}\n\nexport interface QueriedUser {\n\tuserId: string;\n\tname: string;\n\tspaceCount: number;\n\ttopicCount: number;\n\treportCount: number;\n}\n\nexport enum FactorType {\n\tSEQUENCE = \"sequence\",\n\tNUMBER = \"number\",\n\tTEXT = \"text\",\n\tDATETIME = \"datetime\",\n\tBOOLEAN = \"boolean\",\n\tENUM = \"enum\",\n\tOBJECT = \"object\",\n\tARRAY = \"array\",\n}\n\nexport interface QueriedFactorForPipeline {\n\tfactorId: string;\n\tname: string;\n\tlabel: string;\n\tdescription?: string;\n\ttype: FactorType;\n}\n\nexport enum TopicType {\n\tRAW = \"raw\",\n\tDISTINCT = \"distinct\",\n\tAGGREGATE = \"aggregate\",\n\tTIME = \"time\",\n\tRATIO = \"ratio\",\n\tNOT_DEFINED = \"not-defined\",\n}\n\nexport interface QueriedTopicForPipeline {\n\ttopicId: string;\n\tcode: string;\n\tname: string;\n\ttype: TopicType;\n\tfactors: Array<QueriedFactorForPipeline>;\n}\n\nexport interface GroupsHolder {\n\tgroupIds?: Array<string>;\n}\n\nexport interface User extends GroupsHolder {\n\tuserId?: string;\n\tname?: string;\n\tnickName?: string;\n}\n\nexport interface QueriedUserGroupForGroupsHolder {\n\tuserGroupId: string;\n\tname: string;\n\tdescription?: string;\n}\n\nexport interface UserGroup {\n\tuserGroupId?: string;\n\tname?: string;\n\tdescription?: string;\n\tuserIds?: Array<string>;\n\tspaceIds?: Array<string>;\n}\n\nexport interface QueriedUserForUserGroup {\n\tuserId: string;\n\tname: string;\n\tnickName?: string;\n}\n\nexport interface QueriedSpaceForUserGroup {\n\tspaceId: string;\n\tname: string;\n\tdescription?: string;\n}\n\nexport interface Space extends GroupsHolder {\n\tspaceId?: string;\n\tname?: string;\n\tdescription?: string;\n\ttopicIds?: Array<string>;\n}\n\nexport interface QueriedTopicForSpace {\n\ttopicId: string;\n\tname: string;\n\tdescription?: string;\n}\n\nexport interface Report {\n\treportId: string;\n\tname: string;\n\tdescription?: string;\n}\n\nexport interface Factor {\n\tfactorId?: string;\n\tname?: string;\n\tlabel?: string;\n\tdescription?: string;\n\ttype: FactorType;\n}\n\nexport interface Topic {\n\ttopicId?: string;\n\tcode?: string;\n\tname?: string;\n\tdescription?: string;\n\ttype: TopicType;\n\tfactors: Array<Factor>;\n}\n","import { EventEmitter } from 'events';\nimport React, { useEffect, useState } from 'react';\nimport { PipelineFlow } from '../../../services/admin/pipeline-types';\nimport { listTopicsForPipeline } from '../../../services/admin/topic';\nimport { QueriedTopicForPipeline } from '../../../services/admin/types';\nimport { ArrangedPipeline } from './types';\n\nexport enum PipelineEvent {\n\tTOPICS_CHANGED = 'topics-changed',\n\n\tFLOW_CHANGED = 'flow-changed',\n\n\tMENU_VISIBLE = 'menu-visible',\n\tCANVAS_VISIBLE = 'canvas-visible',\n\tTOPIC_SELECTION_CHANGED = 'topic-selection-changed',\n\tPIPELINE_SELECTION_CHANGED = 'pipeline-selection-changed',\n\n\tCOLLAPSE_ALL_TOPICS = 'collapse-all-topics',\n\tTOPIC_FILTER_TEXT_CHANGED = 'topic-filter-text-changed'\n}\n\nexport type TopicsChangeListener = () => void;\nexport type FlowChangeListener = (topic: QueriedTopicForPipeline, flow: PipelineFlow) => void;\nexport type MenuVisibilityListener = (visible: boolean) => void;\nexport type CanvasVisibilityListener = (visible: boolean) => void;\nexport type TopicSelectionChangeListener = (topic?: QueriedTopicForPipeline) => void;\nexport type PipelineSelectionChangeListener = (pipeline?: ArrangedPipeline) => void;\nexport type CollapseAllTopicsListener = () => void;\nexport type TopicFilterChangedListener = (filterText: string) => void;\n\nexport interface PipelineContextStore {\n\ttopics: Array<QueriedTopicForPipeline>;\n\n\tflow?: PipelineFlow;\n\ttopic?: QueriedTopicForPipeline;\n\n\tmenuVisible: boolean;\n\tcanvasVisible: boolean;\n\ttopicsLoadCompleted: boolean;\n\n\tselectedTopic?: QueriedTopicForPipeline;\n\tselectedPipeline?: ArrangedPipeline;\n}\n\nexport interface PipelineContextUsable {\n\taddTopicsChangedListener: (listener: TopicsChangeListener) => void;\n\tremoveTopicsChangedListener: (listener: TopicsChangeListener) => void;\n\n\tchangeFlow: (topic: QueriedTopicForPipeline, pipeline: PipelineFlow) => void;\n\taddFlowChangedListener: (listener: FlowChangeListener) => void;\n\tremoveFlowChangedListener: (listener: FlowChangeListener) => void;\n\n\tchangeMenuVisible: (visible: boolean) => void;\n\taddMenuVisibilityListener: (listener: MenuVisibilityListener) => void;\n\tremoveMenuVisibilityListener: (listener: MenuVisibilityListener) => void;\n\n\tchangeCanvasVisible: (visible: boolean) => void;\n\taddCanvasVisibilityListener: (listener: CanvasVisibilityListener) => void;\n\tremoveCanvasVisibilityListener: (listener: CanvasVisibilityListener) => void;\n\n\tchangeSelectedTopic: (topic?: QueriedTopicForPipeline) => void;\n\taddTopicSelectionChangedListener: (listener: TopicSelectionChangeListener) => void;\n\tremoveTopicSelectionChangedListener: (listener: TopicSelectionChangeListener) => void;\n\n\tchangeSelectedPipeline: (pipeline?: ArrangedPipeline) => void;\n\taddPipelineSelectionChangedListener: (listener: PipelineSelectionChangeListener) => void;\n\tremovePipelineSelectionChangedListener: (listener: PipelineSelectionChangeListener) => void;\n\n\tcollapseAllTopics: () => void;\n\taddCollapseAllTopicsListener: (listener: CollapseAllTopicsListener) => void;\n\tremoveCollapseAllTopicsListener: (listener: CollapseAllTopicsListener) => void;\n\n\tchangeTopicFilter: (filterText: string) => void;\n\taddTopicFilterChangedListener: (listener: TopicFilterChangedListener) => void;\n\tremoveTopicFilterChangedListener: (listener: TopicFilterChangedListener) => void;\n}\n\nexport interface PipelineContext extends PipelineContextUsable {\n\tstore: PipelineContextStore;\n}\n\nconst Context = React.createContext<PipelineContext>({} as PipelineContext);\nContext.displayName = 'PipelineContext';\n\nexport const PipelineContextProvider = (props: {\n\tchildren?: ((props: any) => React.ReactNode) | React.ReactNode;\n}) => {\n\tconst { children } = props;\n\n\tconst [ emitter ] = useState<EventEmitter>(() => {\n\t\tconst emitter = new EventEmitter();\n\t\temitter.setMaxListeners(1000);\n\t\treturn emitter;\n\t});\n\tconst [ store ] = useState<PipelineContextStore>({\n\t\ttopics: [],\n\t\tmenuVisible: true,\n\t\tcanvasVisible: true,\n\t\ttopicsLoadCompleted: false\n\t});\n\tconst [ functions ] = useState({\n\t\taddTopicsChangedListener: (listener: TopicsChangeListener) => emitter.on(PipelineEvent.TOPICS_CHANGED, listener),\n\t\tremoveTopicsChangedListener: (listener: TopicsChangeListener) => emitter.off(PipelineEvent.TOPICS_CHANGED, listener),\n\n\t\tchangeFlow: (topic: QueriedTopicForPipeline, flow: PipelineFlow) => {\n\t\t\temitter.emit(PipelineEvent.FLOW_CHANGED, store.topic = topic, store.flow = flow);\n\t\t},\n\t\taddFlowChangedListener: (listener: FlowChangeListener) => emitter.on(PipelineEvent.FLOW_CHANGED, listener),\n\t\tremoveFlowChangedListener: (listener: FlowChangeListener) => emitter.off(PipelineEvent.FLOW_CHANGED, listener),\n\n\t\tchangeMenuVisible: (visible: boolean) => emitter.emit(PipelineEvent.MENU_VISIBLE, store.menuVisible = visible),\n\t\taddMenuVisibilityListener: (listener: MenuVisibilityListener) => emitter.on(PipelineEvent.MENU_VISIBLE, listener),\n\t\tremoveMenuVisibilityListener: (listener: MenuVisibilityListener) => emitter.off(PipelineEvent.MENU_VISIBLE, listener),\n\n\t\tchangeCanvasVisible: (visible: boolean) => emitter.emit(PipelineEvent.CANVAS_VISIBLE, store.canvasVisible = visible),\n\t\taddCanvasVisibilityListener: (listener: CanvasVisibilityListener) => emitter.on(PipelineEvent.CANVAS_VISIBLE, listener),\n\t\tremoveCanvasVisibilityListener: (listener: CanvasVisibilityListener) => emitter.off(PipelineEvent.CANVAS_VISIBLE, listener),\n\n\t\tchangeSelectedTopic: (topic?: QueriedTopicForPipeline) => {\n\t\t\tstore.selectedTopic = topic;\n\t\t\tdelete store.selectedPipeline;\n\t\t\temitter.emit(PipelineEvent.TOPIC_SELECTION_CHANGED, topic);\n\t\t},\n\t\taddTopicSelectionChangedListener: (listener: TopicSelectionChangeListener) => emitter.on(PipelineEvent.TOPIC_SELECTION_CHANGED, listener),\n\t\tremoveTopicSelectionChangedListener: (listener: TopicSelectionChangeListener) => emitter.off(PipelineEvent.TOPIC_SELECTION_CHANGED, listener),\n\n\t\tchangeSelectedPipeline: (pipeline?: ArrangedPipeline) => {\n\t\t\tstore.selectedPipeline = pipeline;\n\t\t\temitter.emit(PipelineEvent.PIPELINE_SELECTION_CHANGED, pipeline);\n\t\t},\n\t\taddPipelineSelectionChangedListener: (listener: PipelineSelectionChangeListener) => emitter.on(PipelineEvent.PIPELINE_SELECTION_CHANGED, listener),\n\t\tremovePipelineSelectionChangedListener: (listener: PipelineSelectionChangeListener) => emitter.off(PipelineEvent.PIPELINE_SELECTION_CHANGED, listener),\n\n\t\tcollapseAllTopics: () => emitter.emit(PipelineEvent.COLLAPSE_ALL_TOPICS),\n\t\taddCollapseAllTopicsListener: (listener: CollapseAllTopicsListener) => emitter.on(PipelineEvent.COLLAPSE_ALL_TOPICS, listener),\n\t\tremoveCollapseAllTopicsListener: (listener: CollapseAllTopicsListener) => emitter.off(PipelineEvent.COLLAPSE_ALL_TOPICS, listener),\n\n\t\tchangeTopicFilter: (filterText: string) => emitter.emit(PipelineEvent.TOPIC_FILTER_TEXT_CHANGED, filterText.toLowerCase()),\n\t\taddTopicFilterChangedListener: (listener: TopicFilterChangedListener) => emitter.on(PipelineEvent.TOPIC_FILTER_TEXT_CHANGED, listener),\n\t\tremoveTopicFilterChangedListener: (listener: TopicFilterChangedListener) => emitter.off(PipelineEvent.TOPIC_FILTER_TEXT_CHANGED, listener)\n\t});\n\n\tuseEffect(() => {\n\t\t(async () => {\n\t\t\tlet pageNumber = 1;\n\t\t\twhile (true) {\n\t\t\t\tconst { data, completed } = await listTopicsForPipeline(pageNumber);\n\t\t\t\tstore.topics = [ ...store.topics, ...data ]\n\t\t\t\t\t.sort((a, b) => {\n\t\t\t\t\t\treturn a.name.toUpperCase().localeCompare(b.name.toUpperCase());\n\t\t\t\t\t});\n\t\t\t\tstore.topicsLoadCompleted = completed;\n\t\t\t\temitter.emit(PipelineEvent.TOPICS_CHANGED);\n\t\t\t\tif (completed) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tpageNumber++;\n\t\t\t}\n\t\t})();\n\t}, [ store, emitter ]);\n\n\treturn <Context.Provider value={{ store, ...functions }}>{children}</Context.Provider>;\n};\n\nexport const usePipelineContext = () => {\n\treturn React.useContext(Context);\n};\n","import { getServiceHost, isMockService } from \"../service_utils\";\nimport {\n\tDatePartArithmetic,\n\tPipelineFlow,\n\tPipelineTriggerType,\n\tSomeValueType,\n\tWriteTopicActionType,\n} from \"./pipeline-types\";\nimport {\n\tDataPage,\n\tFactorType,\n\tQueriedTopic,\n\tQueriedTopicForPipeline,\n\tQueriedTopicForSpace,\n\tTopic,\n\tTopicType,\n} from \"./types\";\n\nconst DemoTopics = [\n\t{\n\t\ttopicId: \"1\",\n\t\tcode: \"quotation\",\n\t\tname: \"Quotation\",\n\t\ttype: TopicType.DISTINCT,\n\t\traw: false,\n\t\tfactorCount: 6,\n\t\treportCount: 5,\n\t\tgroupCount: 3,\n\t\tspaceCount: 2,\n\t\tfactors: [\n\t\t\t{\n\t\t\t\tfactorId: \"101\",\n\t\t\t\tname: \"quotationId\",\n\t\t\t\tlabel: \"Quotation Sequence\",\n\t\t\t\ttype: FactorType.SEQUENCE,\n\t\t\t},\n\t\t\t{ factorId: \"102\", name: \"quoteNo\", label: \"Quotation No.\", type: FactorType.TEXT },\n\t\t\t{\n\t\t\t\tfactorId: \"103\",\n\t\t\t\tname: \"quoteDate\",\n\t\t\t\tlabel: \"Quotation Create Date\",\n\t\t\t\ttype: FactorType.DATETIME,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfactorId: \"104\",\n\t\t\t\tname: \"policyHolderId\",\n\t\t\t\tlabel: \"Policy Holder Id\",\n\t\t\t\ttype: FactorType.SEQUENCE,\n\t\t\t},\n\t\t\t{ factorId: \"105\", name: \"premium\", label: \"Premium\", type: FactorType.NUMBER },\n\t\t\t{ factorId: \"106\", name: \"issued\", label: \"Issued\", type: FactorType.BOOLEAN },\n\t\t],\n\t},\n\t{\n\t\ttopicId: \"2\",\n\t\tcode: \"policy\",\n\t\tname: \"Policy\",\n\t\ttype: TopicType.DISTINCT,\n\t\traw: false,\n\t\tfactorCount: 7,\n\t\treportCount: 4,\n\t\tgroupCount: 3,\n\t\tspaceCount: 2,\n\t\tfactors: [\n\t\t\t{ factorId: \"201\", name: \"policyId\", label: \"Policy Sequence\", type: FactorType.SEQUENCE },\n\t\t\t{ factorId: \"202\", name: \"quotationNo\", label: \"Quotation No.\", type: FactorType.TEXT },\n\t\t\t{\n\t\t\t\tfactorId: \"203\",\n\t\t\t\tname: \"quoteDate\",\n\t\t\t\tlabel: \"Quotation Create Date\",\n\t\t\t\ttype: FactorType.DATETIME,\n\t\t\t},\n\t\t\t{ factorId: \"204\", name: \"policyNo\", label: \"Policy No.\", type: FactorType.TEXT },\n\t\t\t{ factorId: \"205\", name: \"issueDate\", label: \"Policy Issue Date\", type: FactorType.DATETIME },\n\t\t\t{\n\t\t\t\tfactorId: \"206\",\n\t\t\t\tname: \"policyHolderId\",\n\t\t\t\tlabel: \"Policy Holder Id\",\n\t\t\t\ttype: FactorType.SEQUENCE,\n\t\t\t},\n\t\t\t{ factorId: \"207\", name: \"premium\", label: \"Premium\", type: FactorType.NUMBER },\n\t\t],\n\t},\n\t{\n\t\ttopicId: \"3\",\n\t\tcode: \"participant\",\n\t\tname: \"Participant\",\n\t\ttype: TopicType.DISTINCT,\n\t\tdescription: \"Participant of quotation or policy, including policy holder, insureds, etc.\",\n\t\traw: false,\n\t\tfactorCount: 6,\n\t\treportCount: 2,\n\t\tgroupCount: 3,\n\t\tspaceCount: 2,\n\t\tfactors: [\n\t\t\t{\n\t\t\t\tfactorId: \"301\",\n\t\t\t\tname: \"participantId\",\n\t\t\t\tlabel: \"Participant Sequence\",\n\t\t\t\ttype: FactorType.SEQUENCE,\n\t\t\t},\n\t\t\t{ factorId: \"302\", name: \"firstName\", label: \"First Name\", type: FactorType.TEXT },\n\t\t\t{ factorId: \"303\", name: \"lastName\", label: \"Last Name\", type: FactorType.TEXT },\n\t\t\t{ factorId: \"304\", name: \"fullName\", label: \"Full Name\", type: FactorType.TEXT },\n\t\t\t{ factorId: \"305\", name: \"dateOfBirth\", label: \"Birth Date\", type: FactorType.DATETIME },\n\t\t\t{ factorId: \"306\", name: \"gender\", label: \"Gender\", type: FactorType.ENUM },\n\t\t\t{ factorId: \"307\", name: \"city\", label: \"City\", type: FactorType.ENUM },\n\t\t],\n\t},\n\t{\n\t\ttopicId: \"4\",\n\t\tcode: \"raw-quotation\",\n\t\tname: \"Raw Quotation\",\n\t\ttype: TopicType.RAW,\n\t\traw: true,\n\t\tfactorCount: 10,\n\t\treportCount: 0,\n\t\tgroupCount: 0,\n\t\tspaceCount: 0,\n\t\tfactors: [\n\t\t\t{ factorId: \"401\", name: \"quotationId\", label: \"Quotation Sequence\", type: FactorType.SEQUENCE },\n\t\t\t{ factorId: \"402\", name: \"quotationNo\", label: \"Quotation No.\", type: FactorType.TEXT },\n\t\t\t{ factorId: \"403\", name: \"quoteDate\", label: \"Quotation Create Date\", type: FactorType.DATETIME },\n\t\t\t{ factorId: \"404\", name: \"policyNo\", label: \"Policy No.\", type: FactorType.TEXT },\n\t\t\t{ factorId: \"405\", name: \"issueDate\", label: \"Issue Date\", type: FactorType.DATETIME },\n\t\t\t{ factorId: \"406\", name: \"holderId\", label: \"Holder Id\", type: FactorType.SEQUENCE },\n\t\t\t{ factorId: \"407\", name: \"holderFirstName\", label: \"Holder First Name\", type: FactorType.TEXT },\n\t\t\t{ factorId: \"408\", name: \"holderLastName\", label: \"Holder Last Name\", type: FactorType.TEXT },\n\t\t\t{\n\t\t\t\tfactorId: \"410\",\n\t\t\t\tname: \"holderDateOfBirth\",\n\t\t\t\tlabel: \"Policy Holder Birth Date\",\n\t\t\t\ttype: FactorType.DATETIME,\n\t\t\t},\n\t\t\t{ factorId: \"411\", name: \"holderGender\", label: \"Holder Gender\", type: FactorType.ENUM },\n\t\t\t{ factorId: \"412\", name: \"holderCity\", label: \"Holder City\", type: FactorType.ENUM },\n\t\t\t{ factorId: \"413\", name: \"premium\", label: \"Premium\", type: FactorType.NUMBER },\n\t\t],\n\t},\n\t{\n\t\ttopicId: \"5\",\n\t\tcode: \"weekly-policy-premium\",\n\t\tname: \"Weekly Policy Premium\",\n\t\ttype: TopicType.TIME,\n\t\traw: false,\n\t\tfactorCount: 3,\n\t\treportCount: 0,\n\t\tgroupCount: 0,\n\t\tspaceCount: 0,\n\t\tfactors: [\n\t\t\t{ factorId: \"501\", name: \"year\", label: \"Year\", type: FactorType.NUMBER },\n\t\t\t{ factorId: \"502\", name: \"week\", label: \"Week\", type: FactorType.NUMBER },\n\t\t\t{ factorId: \"503\", name: \"premium\", label: \"Premium Sum\", type: FactorType.NUMBER },\n\t\t],\n\t},\n\t{\n\t\ttopicId: \"6\",\n\t\tcode: \"monthly-policy-premium\",\n\t\tname: \"Monthly Policy Premium\",\n\t\ttype: TopicType.TIME,\n\t\traw: false,\n\t\tfactorCount: 3,\n\t\treportCount: 0,\n\t\tgroupCount: 0,\n\t\tspaceCount: 0,\n\t\tfactors: [\n\t\t\t{ factorId: \"601\", name: \"year\", label: \"Year\", type: FactorType.NUMBER },\n\t\t\t{ factorId: \"602\", name: \"month\", label: \"Month\", type: FactorType.NUMBER },\n\t\t\t{ factorId: \"603\", name: \"premium\", label: \"Premium Sum\", type: FactorType.NUMBER },\n\t\t],\n\t},\n\t{\n\t\ttopicId: \"7\",\n\t\tcode: \"raw-endorsement\",\n\t\tname: \"Raw Endorsement\",\n\t\ttype: TopicType.RAW,\n\t\traw: true,\n\t\tfactorCount: 10,\n\t\treportCount: 0,\n\t\tgroupCount: 0,\n\t\tspaceCount: 0,\n\t\tfactors: [\n\t\t\t{ factorId: \"701\", name: \"endorsementId\", label: \"Endorsement Sequence\", type: FactorType.SEQUENCE },\n\t\t\t{ factorId: \"702\", name: \"endorsementNo\", label: \"Endorsement No.\", type: FactorType.TEXT },\n\t\t\t{ factorId: \"703\", name: \"endorsementDate\", label: \"Endorsement Create Date\", type: FactorType.DATETIME },\n\t\t\t{ factorId: \"704\", name: \"policyNo\", label: \"Policy No.\", type: FactorType.TEXT },\n\t\t\t{ factorId: \"705\", name: \"effectiveDate\", label: \"Effective Date\", type: FactorType.DATETIME },\n\t\t\t{ factorId: \"706\", name: \"premium\", label: \"Premium\", type: FactorType.NUMBER },\n\t\t],\n\t},\n\t{\n\t\ttopicId: \"8\",\n\t\tcode: \"weekly-policy-premium-increment\",\n\t\tname: \"Weekly Policy Premium Increment\",\n\t\ttype: TopicType.RATIO,\n\t\traw: false,\n\t\tfactorCount: 3,\n\t\treportCount: 0,\n\t\tgroupCount: 0,\n\t\tspaceCount: 0,\n\t\tfactors: [\n\t\t\t{ factorId: \"801\", name: \"year\", label: \"Year\", type: FactorType.NUMBER },\n\t\t\t{ factorId: \"802\", name: \"week\", label: \"Week\", type: FactorType.NUMBER },\n\t\t\t{ factorId: \"803\", name: \"incrementRatio\", label: \"Increment Ratio\", type: FactorType.NUMBER },\n\t\t],\n\t},\n];\n\nexport const listTopics = async (options: {\n\tsearch: string;\n\tpageNumber?: number;\n\tpageSize?: number;\n}): Promise<DataPage<QueriedTopic>> => {\n\tif (isMockService()) {\n\t\t// call api\n\t\tconst { pageNumber = 1, pageSize = 9 } = options;\n\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tresolve({\n\t\t\t\t\tdata: DemoTopics,\n\t\t\t\t\titemCount: DemoTopics.length,\n\t\t\t\t\tpageNumber,\n\t\t\t\t\tpageSize,\n\t\t\t\t\tpageCount: 3,\n\t\t\t\t});\n\t\t\t}, 3000);\n\t\t});\n\n\t\t// const token: string = Storage.findToken();\n\t\t// const account = Storage.findAccount();\n\t} else {\n\t\t// console.log(mock_flag);\n\t\tconst response = await fetch(`${getServiceHost()}topic/name?query_name=${options.search}`, {\n\t\t\tmethod: \"POST\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// authorization: token,\n\t\t\t},\n\t\t\tbody: JSON.stringify({ pageNumber: options.pageNumber, pageSize: options.pageSize }),\n\t\t});\n\n\t\tconst result = await response.json();\n\n\t\treturn result;\n\t}\n};\n\nexport const listTopicsForPipeline = async (\n\tpageNumber: number,\n\tpageSize: number = 100\n): Promise<{ data: Array<QueriedTopicForPipeline>; completed: boolean }> => {\n\tconsole.log(isMockService());\n\tif (isMockService()) {\n\t\t// call api\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(\n\t\t\t\t() =>\n\t\t\t\t\tresolve({\n\t\t\t\t\t\tdata: DemoTopics,\n\t\t\t\t\t\tcompleted: true,\n\t\t\t\t\t}),\n\t\t\t\t1000\n\t\t\t);\n\t\t});\n\n\t\t// const token: string = Storage.findToken();\n\t\t// const account = Storage.findAccount();\n\t} else {\n\t\t// console.log(mock_flag);\n\t\tconst response = await fetch(`${getServiceHost()}topic/all`, {\n\t\t\tmethod: \"POST\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// authorization: token,\n\t\t\t},\n\t\t\tbody: JSON.stringify({ pageNumber: pageNumber, pageSize: pageSize }),\n\t\t});\n\n\t\tconst result = await response.json();\n\t\tlet completed = false;\n\t\tif (result.itemCount < result.pageSize) {\n\t\t\tcompleted = true;\n\t\t}\n\n\t\treturn { data: result.data, completed: completed };\n\t}\n\n\t// first 1 100  return data_list items 150\n};\n\nconst DemoPipelineOfPolicy = {\n\ttopicId: \"2\",\n\tconsume: [\n\t\t{\n\t\t\ttopicId: \"4\",\n\t\t\ttype: PipelineTriggerType.INSERT,\n\t\t\tstages: [\n\t\t\t\t{\n\t\t\t\t\tunits: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdo: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttype: WriteTopicActionType.WRITE_FACTOR,\n\t\t\t\t\t\t\t\t\ttopicId: \"2\",\n\t\t\t\t\t\t\t\t\tfactorId: \"201\",\n\t\t\t\t\t\t\t\t\tvalue: { type: SomeValueType.FACTOR, topicId: \"4\", factorId: \"401\" },\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\ttopicId: \"7\",\n\t\t\ttype: PipelineTriggerType.INSERT,\n\t\t\tstages: [\n\t\t\t\t{\n\t\t\t\t\tunits: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdo: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttype: WriteTopicActionType.WRITE_FACTOR,\n\t\t\t\t\t\t\t\t\ttopicId: \"2\",\n\t\t\t\t\t\t\t\t\tfactorId: \"201\",\n\t\t\t\t\t\t\t\t\tvalue: { type: SomeValueType.FACTOR, topicId: \"4\", factorId: \"401\" },\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t],\n\tproduce: [\n\t\t{\n\t\t\ttopicId: \"2\",\n\t\t\ttype: PipelineTriggerType.INSERT_OR_MERGE,\n\t\t\tstages: [\n\t\t\t\t{\n\t\t\t\t\tunits: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdo: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttype: WriteTopicActionType.WRITE_FACTOR,\n\t\t\t\t\t\t\t\t\ttopicId: \"5\",\n\t\t\t\t\t\t\t\t\tfactorId: \"501\",\n\t\t\t\t\t\t\t\t\tvalue: {\n\t\t\t\t\t\t\t\t\t\ttype: SomeValueType.FACTOR,\n\t\t\t\t\t\t\t\t\t\ttopicId: \"2\",\n\t\t\t\t\t\t\t\t\t\tfactorId: \"205\",\n\t\t\t\t\t\t\t\t\t\tarithmetic: DatePartArithmetic.YEAR_OF,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttype: WriteTopicActionType.WRITE_FACTOR,\n\t\t\t\t\t\t\t\t\ttopicId: \"5\",\n\t\t\t\t\t\t\t\t\tfactorId: \"502\",\n\t\t\t\t\t\t\t\t\tvalue: {\n\t\t\t\t\t\t\t\t\t\ttype: SomeValueType.FACTOR,\n\t\t\t\t\t\t\t\t\t\ttopicId: \"2\",\n\t\t\t\t\t\t\t\t\t\tfactorId: \"205\",\n\t\t\t\t\t\t\t\t\t\tarithmetic: DatePartArithmetic.WEEK_OF,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttype: WriteTopicActionType.WRITE_FACTOR,\n\t\t\t\t\t\t\t\t\ttopicId: \"5\",\n\t\t\t\t\t\t\t\t\tfactorId: \"503\",\n\t\t\t\t\t\t\t\t\tvalue: {\n\t\t\t\t\t\t\t\t\t\ttype: SomeValueType.FACTOR,\n\t\t\t\t\t\t\t\t\t\ttopicId: \"2\",\n\t\t\t\t\t\t\t\t\t\tfactorId: \"207\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdo: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttype: WriteTopicActionType.WRITE_FACTOR,\n\t\t\t\t\t\t\t\t\ttopicId: \"6\",\n\t\t\t\t\t\t\t\t\tfactorId: \"601\",\n\t\t\t\t\t\t\t\t\tvalue: {\n\t\t\t\t\t\t\t\t\t\ttype: SomeValueType.FACTOR,\n\t\t\t\t\t\t\t\t\t\ttopicId: \"2\",\n\t\t\t\t\t\t\t\t\t\tfactorId: \"205\",\n\t\t\t\t\t\t\t\t\t\tarithmetic: DatePartArithmetic.YEAR_OF,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttype: WriteTopicActionType.WRITE_FACTOR,\n\t\t\t\t\t\t\t\t\ttopicId: \"6\",\n\t\t\t\t\t\t\t\t\tfactorId: \"602\",\n\t\t\t\t\t\t\t\t\tvalue: {\n\t\t\t\t\t\t\t\t\t\ttype: SomeValueType.FACTOR,\n\t\t\t\t\t\t\t\t\t\ttopicId: \"2\",\n\t\t\t\t\t\t\t\t\t\tfactorId: \"205\",\n\t\t\t\t\t\t\t\t\t\tarithmetic: DatePartArithmetic.MONTH_OF,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttype: WriteTopicActionType.WRITE_FACTOR,\n\t\t\t\t\t\t\t\t\ttopicId: \"6\",\n\t\t\t\t\t\t\t\t\tfactorId: \"603\",\n\t\t\t\t\t\t\t\t\tvalue: {\n\t\t\t\t\t\t\t\t\t\ttype: SomeValueType.FACTOR,\n\t\t\t\t\t\t\t\t\t\ttopicId: \"2\",\n\t\t\t\t\t\t\t\t\t\tfactorId: \"207\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\ttopicId: \"5\",\n\t\t\ttype: PipelineTriggerType.INSERT_OR_MERGE,\n\t\t\tstages: [\n\t\t\t\t{\n\t\t\t\t\tunits: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdo: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttype: WriteTopicActionType.WRITE_FACTOR,\n\t\t\t\t\t\t\t\t\ttopicId: \"8\",\n\t\t\t\t\t\t\t\t\tfactorId: \"801\",\n\t\t\t\t\t\t\t\t\tvalue: {\n\t\t\t\t\t\t\t\t\t\ttype: SomeValueType.FACTOR,\n\t\t\t\t\t\t\t\t\t\ttopicId: \"5\",\n\t\t\t\t\t\t\t\t\t\tfactorId: \"501\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t],\n};\n\nexport const fetchPipeline = async (topicId: string): Promise<PipelineFlow> => {\n\tif (isMockService()) {\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (topicId === \"2\") {\n\t\t\t\t\tresolve(DemoPipelineOfPolicy);\n\t\t\t\t} else {\n\t\t\t\t\tresolve({ topicId, consume: [], produce: [] });\n\t\t\t\t}\n\t\t\t}, 1000);\n\t\t});\n\n\t\t// const token: string = Storage.findToken();\n\t\t// const account = Storage.findAccount();\n\t} else {\n\t\t// console.log(mock_flag);\n\t\tconst response = await fetch(`${getServiceHost()}pipeline?topic_id=${topicId}`, {\n\t\t\tmethod: \"GET\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// authorization: token,\n\t\t\t},\n\t\t});\n\n\t\treturn await response.json();\n\t}\n};\n\nexport const listTopicsForSpace = async (search: string): Promise<Array<QueriedTopicForSpace>> => {\n\tif (isMockService()) {\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tresolve(\n\t\t\t\t\t[\n\t\t\t\t\t\t{ topicId: \"1\", name: \"Quotation\" },\n\t\t\t\t\t\t{ topicId: \"2\", name: \"Policy\" },\n\t\t\t\t\t\t{ topicId: \"3\", name: \"Participant\" },\n\t\t\t\t\t].filter((x) => x.name.toUpperCase().includes(search.toUpperCase()))\n\t\t\t\t);\n\t\t\t}, 500);\n\t\t});\n\n\t\t// const token: string = Storage.findToken();\n\t\t// const account = Storage.findAccount();\n\t} else {\n\t\t// console.log(mock_flag);\n\t\tconst response = await fetch(`${getServiceHost()}query/topic/space?query_name=${search}`, {\n\t\t\tmethod: \"GET\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// authorization: token,\n\t\t\t},\n\t\t});\n\n\t\treturn await response.json();\n\t}\n};\n\nexport const fetchTopic = async (topicId: string): Promise<{ topic: Topic }> => {\n\tconsole.log(isMockService());\n\tif (isMockService()) {\n\t\tlet topic: Topic;\n\t\tswitch (true) {\n\t\t\tcase [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\"].includes(`${topicId}`):\n\t\t\t\tconst { topicId: id, code, name, type, description, factors } = DemoTopics.find(\n\t\t\t\t\t(topic) => topic.topicId === topicId\n\t\t\t\t)!;\n\t\t\t\ttopic = { topicId: id, code, name, type, description, factors };\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\ttopic = { type: TopicType.DISTINCT, factors: [] };\n\t\t}\n\t\treturn { topic };\n\n\t\t// const token: string = Storage.findToken();\n\t\t// const account = Storage.findAccount();\n\t} else {\n\t\t// console.log(mock_flag);\n\t\tconst response = await fetch(`${getServiceHost()}topic?topic_id=${topicId}`, {\n\t\t\tmethod: \"GET\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// authorization: token,\n\t\t\t},\n\t\t});\n\n\t\tlet topic = await response.json();\n\t\treturn { topic: topic };\n\t}\n};\n\nexport const saveTopic = async (topic: Topic): Promise<void> => {\n\tif (topic.topicId) {\n\t\tconst response = await fetch(`${getServiceHost()}update/topic?topic_id=${topic.topicId}`, {\n\t\t\tmethod: \"POST\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// authorization: token,\n\t\t\t},\n\t\t\tbody: JSON.stringify(topic),\n\t\t});\n\n\t\t// const result = await\n\t\treturn await response.json();\n\t} else {\n\t\tif (isMockService()) {\n\t\t\t// call api\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\ttopic.topicId = \"10000\";\n\t\t\t\tsetTimeout(() => resolve(), 500);\n\t\t\t});\n\n\t\t\t// const token: string = Storage.findToken();\n\t\t\t// const account = Storage.findAccount();\n\t\t} else {\n\t\t\t// console.log(mock_flag);\n\t\t\tconst response = await fetch(`${getServiceHost()}topic`, {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders: {\n\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\t// authorization: token,\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify(topic),\n\t\t\t});\n\n\t\t\t// const result = await\n\t\t\treturn await response.json();\n\t\t}\n\t}\n};\n","import { TopicType } from '../../../services/admin/types';\n\nconst TopicTypeStyles: { [key in TopicType]: string } = {\n\t[TopicType.RAW]: '--console-raw-topic-color',\n\t[TopicType.DISTINCT]: '--console-distinct-topic-color',\n\t[TopicType.AGGREGATE]: '--console-aggregate-topic-color',\n\t[TopicType.TIME]: '--console-time-topic-color',\n\t[TopicType.RATIO]: '--console-ratio-topic-color',\n\t[TopicType.NOT_DEFINED]: '--console-undefined-topic-color'\n};\n\nexport const buildPipelineCanvasTopicStyles = () => {\n\treturn Object.keys(TopicTypeStyles).map(topicType => {\n\t\tconst type = topicType as TopicType;\n\t\treturn `&[data-topic-type=${type}] {\n\t\t\tborder-color: var(${TopicTypeStyles[type]});\n\t\t\t> div[data-widget-type='corner'] {\n\t\t\t\tbackground-color: var(${TopicTypeStyles[type]});\n\t\t\t}\n\t\t}`;\n\t}).join('\\n');\n};\n\n// export const buildEditorTitleStyles = () => {\n// \treturn Object.keys(TopicTypeStyles).map(topicType => {\n// \t\tconst type = topicType as TopicType;\n// \t\treturn `&[data-topic-type=${type}] {\n// \t\t\tborder-bottom-color: var(${TopicTypeStyles[type]});\n// \t\t}`;\n// \t}).join('\\n');\n// };\n// export const buildEditorTitleStylesForIO = () => {\n// \treturn Object.keys(TopicTypeStyles).map(topicType => {\n// \t\tconst type = topicType as TopicType;\n// \t\treturn `&[data-topic-type=${type}] > span {\n// \t\t\tbackground-color: var(${TopicTypeStyles[type]});\n// \t\t}`;\n// \t}).join('\\n');\n// };","import { faCodeBranch } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { useEffect } from 'react';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../common/utils';\nimport { QueriedTopicForPipeline, TopicType } from '../../../services/admin/types';\nimport { usePipelineContext } from './pipeline-context';\nimport { buildPipelineCanvasTopicStyles } from './styles';\nimport { ArrangedPipeline } from './types';\n\nconst Topic = styled.div.attrs({\n\t'data-widget': 'pipeline-topic'\n})`\n\tdisplay: flex;\n\tposition: relative;\n\tborder-width: 2px;\n\tborder-color: var(--border-color);\n\tborder-style: solid;\n\tborder-radius: var(--border-radius);\n\tmin-height: 64px;\n\twidth: 300px;\n\talign-items: center;\n\tjustify-content: center;\n\tfont-family: var(--console-title-font-family);\n\tpadding: 6px calc(var(--margin) / 2);\n\tcursor: pointer;\n\t&:last-child {\n\t\tmargin-bottom: var(--margin);\n\t}\n\t${buildPipelineCanvasTopicStyles()}\n`;\nconst Corner = styled.div`\n\tdisplay: flex;\n\tposition: absolute;\n\talign-items: center;\n\tfont-weight: var(--font-bold);\n\tfont-size: 0.8em;\n\tcolor: var(--invert-color);\n\tbackground-color: var(--border-color);\n\tpadding: 0 calc(var(--margin) / 3);\n\ttransform: scale(0.8);\n\ttext-transform: uppercase;\n`;\nconst TopicTypeIcon = styled(Corner).attrs({\n\t'data-widget': 'pipeline-topic-type'\n})`\n\ttop: 0;\n\tleft: 0;\n\tborder-bottom-right-radius: var(--border-radius);\n\ttransform-origin: top left;\n\tpadding-bottom: 2px;\n\tpadding-left: calc(var(--margin) / 3 - 2px);\n`;\nconst MorePipelines = styled(Corner)\n\t.attrs<{ count: number, direction: 'source' | 'target' }>(\n\t\t({ count, direction }) => {\n\t\t\treturn {\n\t\t\t\t'data-widget': `pipeline-topic-more-${direction}-pipelines-count`,\n\t\t\t\tstyle: {\n\t\t\t\t\tdisplay: count === 0 ? 'none' : 'flex'\n\t\t\t\t}\n\t\t\t};\n\t\t})<{ count: number, direction: 'source' | 'target' }>`\n\tright: 0;\n\tmin-width: 35%;\n\t> svg {\n\t\tmargin-right: calc(var(--margin) / 4);\n\t\tmargin-top: 1px;\n\t}\n`;\nconst MoreSourceTopicCount = styled(MorePipelines)`\n\ttop: 0;\n\tborder-bottom-left-radius: var(--border-radius);\n\ttransform-origin: top right;\n\tpadding-bottom: 2px;\n\tpadding-right: calc(var(--margin) / 3 - 2px);\n`;\nconst MoreTargetTopicCount = styled(MorePipelines)`\n\tbottom: 0;\n\tborder-top-left-radius: var(--border-radius);\n\ttransform-origin: bottom right;\n\tpadding-top: 2px;\n\tpadding-right: calc(var(--margin) / 3 - 2px);\n\t> svg {\n\t\ttransform: rotateX(180deg);\n\t}\n`;\nconst Selection = styled.div`\n\tdisplay: block;\n\tposition: absolute;\n\tborder-width: 2px;\n\tborder-color: var(--console-favorite-color);\n\tborder-style: dashed;\n\tborder-radius: var(--border-radius);\n\ttop: -12px;\n\tleft: -12px;\n\twidth: calc(100% + 24px);\n\theight: calc(100% + 24px);\n\tz-index: -1;\n\tbackground-color: transparent;\n\topacity: 0;\n\tpointer-events: none;\n\ttransition: opacity 300ms ease-in-out;\n\t&[data-visible=true] {\n\t\topacity: 1;\n\t}\n`;\nconst ToNextTopicLine = styled.div.attrs({\n\t'data-widget': 'pipeline-topic-next-line'\n})`\n\tdisplay: block;\n\tposition: absolute;\n\ttop: calc(100% + 2px);\n\tleft: calc(50% - 1px);\n\twidth: 2px;\n\theight: calc(var(--margin) * 1.5);\n\tbackground-color: var(--border-color);\n\t&:before,\n\t&:after {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\tleft: -5px;\n\t\tborder-bottom: 0;\n\t\tborder-top: 6px solid var(--border-color);\n\t\tborder-left: 6px solid transparent;\n\t\tborder-right: 6px solid transparent;\n\t}\n\t&:before {\n\t\tbottom: -1px;\n\t\tz-index: -2;\n\t}\n\t&:after {\n\t\tbottom: 2px;\n\t\tborder-top-color: var(--bg-color);\n\t\tz-index: -1;\n\t}\n`;\n\nconst TopicTypeTooltip: { [key in TopicType]: string } = {\n\t[TopicType.RAW]: 'Raw',\n\t[TopicType.TIME]: 'Time Aggregate',\n\t[TopicType.AGGREGATE]: 'Aggregate',\n\t[TopicType.DISTINCT]: 'Distinct',\n\t[TopicType.RATIO]: 'Ratio',\n\t[TopicType.NOT_DEFINED]: 'Not Defined'\n};\n\nexport const PipelineCanvasTopic = (props: {\n\ttopic: QueriedTopicForPipeline;\n\ttoMe?: Array<ArrangedPipeline>;\n\tfromMe?: Array<ArrangedPipeline>;\n\ttoNext?: ArrangedPipeline;\n\tprevious?: QueriedTopicForPipeline;\n\tnext?: QueriedTopicForPipeline;\n\tcurrent?: boolean;\n}) => {\n\tconst { topic, toMe = [], fromMe = [], previous, next, current = false } = props;\n\n\tconst {\n\t\tstore: { selectedTopic },\n\t\tchangeSelectedTopic,\n\t\taddTopicSelectionChangedListener, removeTopicSelectionChangedListener\n\t} = usePipelineContext();\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\taddTopicSelectionChangedListener(forceUpdate);\n\t\treturn () => removeTopicSelectionChangedListener(forceUpdate);\n\t});\n\n\tconst onTopicClicked = () => {\n\t\tif (selectedTopic === topic) {\n\t\t\treturn;\n\t\t}\n\t\tchangeSelectedTopic(topic);\n\t};\n\n\t// eslint-disable-next-line\n\tconst moreSourceTopicCount = toMe.filter(pipeline => pipeline.topicId != previous?.topicId).length;\n\t// eslint-disable-next-line\n\tconst moreTargetTopicCount = [ ...new Set(fromMe.map(pipeline => pipeline.targetTopicIds.filter(targetTopicId => targetTopicId != next?.topicId)).flat()) ].length;\n\n\treturn <Topic data-current={current} data-topic-type={topic.type || TopicType.NOT_DEFINED} onClick={onTopicClicked}>\n\t\t<TopicTypeIcon data-widget-type='corner'>{TopicTypeTooltip[topic.type || TopicType.NOT_DEFINED]}</TopicTypeIcon>\n\t\t<MoreSourceTopicCount count={moreSourceTopicCount} direction='source' data-widget-type='corner'>\n\t\t\t<FontAwesomeIcon icon={faCodeBranch}/>\n\t\t\t{moreSourceTopicCount} More In\n\t\t</MoreSourceTopicCount>\n\t\t<MoreTargetTopicCount count={moreTargetTopicCount} direction='target' data-widget-type='corner'>\n\t\t\t<FontAwesomeIcon icon={faCodeBranch}/>\n\t\t\t{moreTargetTopicCount} More Out\n\t\t</MoreTargetTopicCount>\n\t\t<Selection data-visible={selectedTopic === topic}/>\n\t\t<div>{topic.name}</div>\n\t\t{next ? <ToNextTopicLine/> : null}\n\t</Topic>;\n};","import React, { useEffect } from 'react';\nimport styled from 'styled-components';\nimport { v4 } from 'uuid';\nimport { useForceUpdate } from '../../../common/utils';\nimport { QueriedTopicForPipeline } from '../../../services/admin/types';\nimport { PipelineCanvasTopic } from './pipeline-canvas-topic';\nimport { usePipelineContext } from './pipeline-context';\nimport { PipelinesTopicNode } from './types';\n\nconst PipelinesCanvasContainer = styled.div.attrs({\n\t'data-widget': 'pipeline-canvas'\n})`\n\tdisplay: grid;\n\tposition: relative;\n\tpadding: var(--margin);\n\tborder-right: var(--border);\n\tgrid-template-columns: 1fr;\n\tgrid-row-gap: calc(var(--margin) * 1.5);\n\talign-content: start;\n\toverflow-x: hidden;\n\toverflow-y: auto;\n\tmin-width: 365px;\n\tmax-width: 365px;\n\topacity: 1;\n\tleft: 0;\n\ttransition: left 300ms ease-in-out, opacity 300ms ease-in-out;\n\t&[data-visible=false] {\n\t\tposition: absolute;\n\t\tleft: -365px;\n\t\topacity: 0;\n\t}\n\t&::-webkit-scrollbar {\n\t\tbackground-color: transparent;\n\t\twidth: 4px;\n\t}\n\t&::-webkit-scrollbar-track {\n\t\tbackground-color: transparent;\n\t\tborder-radius: 2px;\n\t}\n\t&::-webkit-scrollbar-thumb {\n\t\tbackground-color: var(--console-favorite-color);\n\t\tborder-radius: 2px;\n\t}\n`;\n\nexport const PipelineCanvas = (props: {\n\ttopic?: QueriedTopicForPipeline;\n\tnodes: Array<PipelinesTopicNode>;\n\tvisible: boolean;\n}) => {\n\tconst { topic, nodes, visible } = props;\n\n\tconst {\n\t\tstore: { canvasVisible },\n\t\taddCanvasVisibilityListener,\n\t\tremoveCanvasVisibilityListener\n\t} = usePipelineContext();\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\taddCanvasVisibilityListener(forceUpdate);\n\t\treturn () => removeCanvasVisibilityListener(forceUpdate);\n\t});\n\n\tif (!visible || !topic) {\n\t\treturn null;\n\t}\n\n\treturn <PipelinesCanvasContainer data-visible={canvasVisible}>\n\t\t{nodes.map(node => {\n\t\t\treturn <PipelineCanvasTopic {...node} key={v4()}/>;\n\t\t})}\n\t</PipelinesCanvasContainer>;\n};","import { getServiceHost, isMockService } from \"../service_utils\";\nimport { Pipeline } from \"./pipeline-types\";\n\nexport const savePipeline = async (pipeline: Pipeline): Promise<void> => {\n\tif (isMockService()) {\n\t\tconsole.log(\"save {}\", pipeline);\n\t} else {\n\t\tconst response = await fetch(`${getServiceHost()}pipeline`, {\n\t\t\tmethod: \"POST\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// authorization: token,\n\t\t\t},\n\t\t\tbody: JSON.stringify(pipeline),\n\t\t});\n\n\t\t// const result = await\n\t\treturn await response.json();\n\t}\n};\n","import dayjs from 'dayjs';\nimport React, { useEffect, useState } from 'react';\nimport { savePipeline } from '../../../../services/admin/pipeline';\nimport { usePipelineContext } from '../pipeline-context';\nimport { ArrangedPipeline } from '../types';\n\ninterface State {\n\tpipeline?: ArrangedPipeline;\n\tsaved: boolean;\n\tthrottle: number | null;\n}\n\nexport interface PipelineEditContext {\n\tfirePipelineContentChange: () => void;\n}\n\nconst Context = React.createContext<PipelineEditContext>({} as PipelineEditContext);\nContext.displayName = 'PipelineEditContext';\n\nconst doSave = async (pipeline: ArrangedPipeline) => {\n\tpipeline.origin.name = pipeline.name;\n\tpipeline.origin.stages = pipeline.stages;\n\tpipeline.origin.type = pipeline.type;\n\tawait savePipeline(pipeline.origin);\n};\n\nexport const PipelineEditContextProvider = (props: {\n\tpipeline?: ArrangedPipeline;\n\tchildren?: ((props: any) => React.ReactNode) | React.ReactNode;\n}) => {\n\tconst { pipeline, children } = props;\n\n\tconst { addPipelineSelectionChangedListener, removePipelineSelectionChangedListener } = usePipelineContext();\n\tconst [ state ] = useState<State>({ pipeline, saved: true, throttle: null });\n\tuseEffect(() => {\n\t\tconst save = (pipeline?: ArrangedPipeline) => {\n\t\t\tif (pipeline?.origin === state.pipeline?.origin) {\n\t\t\t\t// new selection is same as me, do nothing\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// pipeline changed, which means editing of previous pipeline is finished\n\t\t\tif (state.pipeline?.origin && !state.saved) {\n\t\t\t\t// previous pipeline existed and changed and not saved\n\t\t\t\t// don't wait, continue process\n\t\t\t\tconsole.log(`Detect pipeline selection change at %c[${dayjs().format('YYYY/MM/DD HH:mm:ss.SSS')}]%c, do save immediately.`, 'color:rgb(251,71,71)', '');\n\t\t\t\tdoSave(state.pipeline);\n\t\t\t}\n\t\t\t// switch to new selection\n\t\t\tstate.pipeline = pipeline;\n\t\t\tstate.saved = true;\n\t\t\tif (state.throttle) {\n\t\t\t\tclearTimeout(state.throttle);\n\t\t\t\tstate.throttle = null;\n\t\t\t}\n\t\t};\n\t\taddPipelineSelectionChangedListener(save);\n\t\treturn () => removePipelineSelectionChangedListener(save);\n\t});\n\n\t// will not trigger any repaint\n\tconst onPipelineContentChange = () => {\n\t\tif (!pipeline) {\n\t\t\treturn;\n\t\t}\n\n\t\tstate.saved = false;\n\t\tif (state.throttle) {\n\t\t\tclearTimeout(state.throttle);\n\t\t}\n\n\t\tconsole.log(`Detect pipeline change from editor at %c[${dayjs().format('YYYY/MM/DD HH:mm:ss.SSS')}]%c, will save changes after 10 seconds.`, 'color:rgb(251,71,71)', '');\n\t\t// save after 30 seconds\n\t\tstate.throttle = setTimeout(async () => {\n\t\t\tstate.throttle = null;\n\t\t\ttry {\n\t\t\t\tawait doSave(pipeline);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.groupCollapsed(`%cError on save pipeline.`, 'color:rgb(251,71,71)');\n\t\t\t\tconsole.error('Pipeline: ', pipeline);\n\t\t\t\tconsole.error(e);\n\t\t\t\tconsole.groupEnd();\n\t\t\t}\n\t\t}, 10000);\n\t};\n\n\treturn <Context.Provider\n\t\tvalue={{ firePipelineContentChange: onPipelineContentChange }}>{children}</Context.Provider>;\n};\n\nexport const usePipelineEditContext = () => {\n\treturn React.useContext(Context);\n};\n","import React, { useRef } from 'react';\nimport styled from 'styled-components';\nimport Input from '../../../../component/input';\n\nconst AnInput = styled(Input)`\n\theight: 24px;\n\tline-height: 24px;\n\tpadding-top: 0;\n\tpadding-bottom: 0;\n\tcolor: var(--console-font-color);\n\ttext-overflow: ellipsis;\n`;\n\nexport const AutoSelectInput = (props: {\n\tvalue?: string;\n\tplaceholder?: string;\n\tonChange: (value: string) => void;\n\tonFocus?: () => void;\n\tonBlur?: () => void;\n}) => {\n\tconst { value = '', placeholder, onChange, onFocus, onBlur } = props;\n\n\tconst nameRef = useRef<HTMLInputElement>(null);\n\tconst onInputChange = (event: React.ChangeEvent<HTMLInputElement>) => onChange(event.target.value);\n\tconst onInputFocus = () => {\n\t\tnameRef.current!.select();\n\t\tonFocus && onFocus();\n\t};\n\tconst onInputBlur = () => onBlur && onBlur();\n\tconst onInputKeyUp = (event: React.KeyboardEvent<HTMLInputElement>) => {\n\t\tif (event.key === 'Enter') {\n\t\t\tnameRef.current!.blur();\n\t\t}\n\t};\n\n\treturn <AnInput value={value} placeholder={placeholder}\n\t                onChange={onInputChange}\n\t                onFocus={onInputFocus} onBlur={onInputBlur}\n\t                onKeyUp={onInputKeyUp}\n\t                ref={nameRef}/>;\n};","import React, { useState } from 'react';\nimport styled from 'styled-components';\nimport { AutoSelectInput } from './auto-select-input';\n\nexport interface AutoSwitchInputStyles {\n\theight?: number | string;\n\tpaddingHorizontal?: number | string;\n\tbackgroundColor?: string;\n\tinputFontSize?: number | string;\n}\n\nconst InputContainer = styled.div<AutoSwitchInputStyles>`\n\tdisplay: grid;\n\tgrid-template-columns: auto 1fr;\n\talign-items: center;\n\theight: ${({ height }) => typeof (height || 24) ? `${height || 24}px` : height};\n\tline-height: ${({ height }) => typeof (height || 24) ? `${height || 24}px` : height};\n\tfont-family: var(--console-title-font-family);\n\tborder-radius: var(--border-radius);\n\tbackground-color: ${({ backgroundColor }) => backgroundColor || 'var(--bg-color)'};\n\tpadding: 0 ${({ paddingHorizontal }) => paddingHorizontal || 'calc(var(--margin) / 4)'};\n\toverflow: hidden;\n\t&:hover,\n\t&[data-editing=true] {\n\t\tflex-grow: 1;\n\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t\tbackground-color: var(--console-primary-color);\n\t\tpadding-right: 0;\n\t\t> span[data-role='prefix-label'] {\n\t\t\tcolor: var(--invert-color);\n\t\t}\n\t\t> span[data-role='display-label'] {\n\t\t\tdisplay: none;\n\t\t}\n\t\t> input {\n\t\t\tdisplay: block;\n\t\t}\n\t}\n\t> input {\n\t\tdisplay: none;\n\t\twidth: 100%;\n\t\tfont-family: var(--console-title-font-family);\n\t\tfont-size: ${({ inputFontSize }) => typeof inputFontSize === 'number' ? `${inputFontSize}px` : inputFontSize};\n\t\tbackground-color: var(--bg-color);\n\t\tborder: 0;\n\t\tborder-radius: 0;\n\t\ttransition: none;\n\t}\n`;\nconst PrefixLabel = styled.span`\n\tpadding-right: calc(var(--margin) / 4);\n`;\n// a label on display\nconst DisplayLabel = styled.span`\n\tpadding-left: var(--input-indent);\n\twhite-space: nowrap;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n`;\n\nexport const AutoSwitchInput = (props: {\n\tprefixLabel: string;\n\tvalue?: string;\n\tplaceholder?: string;\n\tonChange: (value: string) => void;\n\tstyles?: AutoSwitchInputStyles;\n}) => {\n\tconst { prefixLabel, value, placeholder, onChange, styles } = props;\n\n\tconst [ editing, setEditing ] = useState<boolean>(false);\n\n\tconst onInputFocus = () => setEditing(true);\n\tconst onInputBlur = () => setEditing(false);\n\n\treturn <InputContainer data-editing={editing} {...styles}>\n\t\t<PrefixLabel data-role='prefix-label'>{prefixLabel}</PrefixLabel>\n\t\t<DisplayLabel data-role='display-label'>{value || placeholder}</DisplayLabel>\n\t\t<AutoSelectInput value={value} placeholder={placeholder}\n\t\t                 onChange={onChange}\n\t\t                 onFocus={onInputFocus} onBlur={onInputBlur}/>\n\t</InputContainer>;\n};","import { IconProp } from '@fortawesome/fontawesome-svg-core';\nimport { faCaretDown } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { useRef, useState } from 'react';\nimport styled from 'styled-components';\nimport { useCollapseFixedThing } from '../../../../../common/utils';\nimport { ButtonType } from '../../../../component/button';\nimport { ObjectButton } from '../../../../component/object-button';\n\ninterface DropdownState {\n\tvisible: boolean;\n\ttop: number;\n\tleft: number;\n\tminWidth: number;\n\tatTop: boolean\n}\n\nconst Dropdown = styled.div.attrs<DropdownState>(({ visible, top, left, minWidth, atTop }) => {\n\treturn {\n\t\t'data-at-top': atTop,\n\t\tstyle: {\n\t\t\topacity: visible ? 1 : 0,\n\t\t\tpointerEvents: visible ? 'auto' : 'none',\n\t\t\tminWidth,\n\t\t\ttop,\n\t\t\tleft,\n\t\t\tborderTopLeftRadius: atTop ? 'var(--border-radius)' : 0,\n\t\t\tborderTopRightRadius: atTop ? 'var(--border-radius)' : 0,\n\t\t\tborderBottomLeftRadius: atTop ? 0 : 'var(--border-radius)',\n\t\t\tborderBottomRightRadius: atTop ? 0 : 'var(--border-radius)'\n\t\t}\n\t};\n})<DropdownState>`\n\tdisplay: flex;\n\tflex-direction: column;\n\tposition: fixed;\n\toverflow-x: hidden;\n\tborder-radius: 0;\n\ttransition: opacity 300ms ease-in-out;\n\t> button {\n\t\tborder-radius: 0;\n\t}\n\t&[data-ink-type=primary] {\n\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t}\n\t&[data-ink-type=danger] {\n\t\tbox-shadow: var(--console-danger-hover-shadow);\n\t}\n`;\nconst DropdownMenu = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\tpadding: 6px calc(var(--margin) / 2);\n\theight: 24px;\n\tfont-size: 0.9em;\n\tfont-variant: petite-caps;\n\tfont-weight: var(--font-bold);\n\twhite-space: nowrap;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\t&:hover {\n\t\tfilter: brightness(140%);\n\t}\n\t&[data-ink-type=primary] {\n\t\tbackground-color: var(--console-primary-color);\n\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t}\n\t&[data-ink-type=danger] {\n\t\tbackground-color: var(--console-danger-color);\n\t\tbox-shadow: var(--console-danger-hover-shadow);\n\t}\n\t&[data-ink-type=waive] {\n\t\tcolor: var(--console-font-color);\n\t\tbackground-color: var(--bg-color);\n\t\tborder: var(--border);\n\t\topacity: 0.8;\n\t}\n\t> svg:first-child {\n\t\tfont-size: 0.8em;\n\t\tmargin-right: calc(var(--margin) / 5);\n\t}\n`;\n\nexport const DropdownButton = (props: {\n\ticon: IconProp;\n\tlabel: string;\n\ttype: ButtonType;\n\tonClick: () => void;\n\tmenus: Array<{ icon: IconProp, label: string, onClick: () => void }>;\n}) => {\n\tconst { icon, label, type, onClick, menus } = props;\n\n\tconst containerRef = useRef<HTMLButtonElement>(null);\n\tconst [ expanded, setExpanded ] = useState({ visible: false, left: 0, top: 0, minWidth: 0, atTop: false });\n\tuseCollapseFixedThing(containerRef, () => setExpanded({ ...expanded, visible: false }));\n\n\tconst onExpandClicked = (event: React.MouseEvent<HTMLSpanElement>) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tconst rect = containerRef.current!.getBoundingClientRect();\n\t\tif (rect.top + rect.height + menus.length * 24 > window.innerHeight) {\n\t\t\tsetExpanded({\n\t\t\t\tvisible: true,\n\t\t\t\ttop: rect.top - menus.length * 24,\n\t\t\t\tleft: rect.left,\n\t\t\t\tminWidth: rect.width,\n\t\t\t\tatTop: true\n\t\t\t});\n\t\t} else {\n\t\t\tsetExpanded({\n\t\t\t\tvisible: true,\n\t\t\t\ttop: rect.top + rect.height,\n\t\t\t\tleft: rect.left,\n\t\t\t\tminWidth: rect.width,\n\t\t\t\tatTop: false\n\t\t\t});\n\t\t}\n\t};\n\tconst onMenuClicked = (doOnClick: () => void) => (event: React.MouseEvent<HTMLDivElement>) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tsetExpanded({ ...expanded, visible: false });\n\t\tdoOnClick();\n\t};\n\n\treturn <ObjectButton inkType={type} onClick={onClick} ref={containerRef}\n\t                     data-menu-at-top={expanded.atTop}\n\t                     data-menu-visible={expanded.visible}>\n\t\t<FontAwesomeIcon icon={icon}/>\n\t\t<span>{label}</span>\n\t\t<span data-role='more-buttons' onClick={onExpandClicked}>\n\t\t\t<FontAwesomeIcon icon={faCaretDown}/>\n\t\t</span>\n\t\t<Dropdown {...expanded} data-ink-type={type}>\n\t\t\t{menus.map(({ icon, label, onClick }) => {\n\t\t\t\treturn <DropdownMenu data-ink-type={type} key={label} onClick={onMenuClicked(onClick)}>\n\t\t\t\t\t<FontAwesomeIcon icon={icon}/>\n\t\t\t\t\t<span>{label}</span>\n\t\t\t\t</DropdownMenu>;\n\t\t\t})}\n\t\t</Dropdown>\n\t</ObjectButton>;\n};","import { EventEmitter } from 'events';\nimport React, { useState } from 'react';\nimport { usePipelineEditContext } from './pipeline-edit-context';\n\nexport enum PipelineUnitActionEvent {\n\tTOPIC_CHANGED = 'topic-changed',\n\tFACTOR_CHANGED = 'factor-changed',\n\tVARIABLE_CHANGED = 'variable-changed',\n\tARITHMETIC_CHANGED = 'arithmetic-changed',\n\tMAPPING_CHANGED = 'mapping-changed',\n\tFILTER_ADDED = 'filter-added',\n\tFILTER_REMOVED = 'filter-removed',\n\tFILTER_CHANGED = 'filter-changed',\n\tFILTER_INDENT = 'filter-indent',\n\tFILTER_OUTDENT = 'filter-outdent'\n}\n\nexport type PropertyChangeListener = () => void;\n\nexport interface PipelineUnitActionContextUsable {\n\tfirePropertyChange: (event: PipelineUnitActionEvent) => void;\n\taddPropertyChangeListener: (event: PipelineUnitActionEvent, listener: PropertyChangeListener) => void;\n\tremovePropertyChangeListener: (event: PipelineUnitActionEvent, listener: PropertyChangeListener) => void;\n}\n\nexport interface PipelineUnitActionContext extends PipelineUnitActionContextUsable {\n}\n\nconst Context = React.createContext<PipelineUnitActionContext>({} as PipelineUnitActionContext);\nContext.displayName = 'PipelineUnitActionContext';\n\nexport const PipelineUnitActionContextProvider = (props: {\n\tchildren?: ((props: any) => React.ReactNode) | React.ReactNode;\n}) => {\n\tconst { children } = props;\n\n\tconst { firePipelineContentChange } = usePipelineEditContext();\n\tconst [ emitter ] = useState<EventEmitter>(() => {\n\t\tconst emitter = new EventEmitter();\n\t\temitter.setMaxListeners(1000);\n\t\treturn emitter;\n\t});\n\n\treturn <Context.Provider value={{\n\t\tfirePropertyChange: (event) => {\n\t\t\temitter.emit(event);\n\t\t\tfirePipelineContentChange();\n\t\t},\n\t\taddPropertyChangeListener: (event: PipelineUnitActionEvent, listener) => emitter.on(event, listener),\n\t\tremovePropertyChangeListener: (event: PipelineUnitActionEvent, listener) => emitter.off(event, listener)\n\t}}>{children}</Context.Provider>;\n};\n\nexport const usePipelineUnitActionContext = () => {\n\treturn React.useContext(Context);\n};\n","import styled from 'styled-components';\nimport Input from '../../../../component/input';\n\nexport const ActionInput = styled(Input)`\n\theight: 22px;\n\tpadding-top: 0;\n\tpadding-bottom: 0;\n\tfont-size: 0.8em;\n\tcolor: var(--console-font-color);\n\tborder: 0;\n\tbox-shadow: 0 0 0 1px var(--border-color);\n\t&:hover,\n\t&:focus {\n\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t}\n\t&::placeholder {\n\t\tcolor: var(--console-waive-color);\n\t}\n`;\n","import { faEdit } from '@fortawesome/free-regular-svg-icons';\nimport { faTimes } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { useState } from 'react';\nimport styled from 'styled-components';\nimport { v4 } from 'uuid';\n\nconst Options = styled.div`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: stretch;\n\tjustify-self: start;\n\tbackground-color: var(--pipeline-bg-color);\n\theight: 22px;\n\tborder-radius: 11px;\n\toutline: none;\n\tappearance: none;\n\toverflow: hidden;\n\tcursor: pointer;\n\tbox-shadow: 0 0 0 1px var(--border-color);\n\ttransition: all 300ms ease-in-out;\n\t&:hover {\n\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t}\n\t&[data-expanded=true] {\n\t\t> div:first-child {\n\t\t\tpadding-right: calc(var(--margin) / 2);\n\t\t}\n\t\t> div:not(:first-child):not(:last-child) {\n\t\t\tpadding: 0 calc(var(--margin) / 2);\n\t\t}\n\t\t> div:not(:first-child):not(:last-child) {\n\t\t\twidth: unset;\n\t\t\tbackground-color: var(--bg-color);\n\t\t\toverflow: unset;\n\t\t}\n\t\t> div:last-child,\n\t\t> div:not(:first-child):not(:last-child) {\n\t\t\t&:hover {\n\t\t\t\tcolor: var(--invert-color);\n\t\t\t\tbackground-color: var(--console-favorite-color);\n\t\t\t}\n\t\t}\n\t\t> div:not(:first-child) {\n\t\t\t&:before {\n\t\t\t\tcontent: '';\n\t\t\t\tdisplay: block;\n\t\t\t\tposition: absolute;\n\t\t\t\ttop: 20%;\n\t\t\t\tleft: 0;\n\t\t\t\twidth: 1px;\n\t\t\t\theight: 60%;\n\t\t\t\tbackground-color: var(--console-primary-color);\n\t\t\t\tborder-radius: 1px;\n\t\t\t\topacity: 0.5;\n\t\t\t\ttransform: translateX(-50%);\n\t\t\t}\n\t\t}\n\t\t> div:last-child {\n\t\t\tpadding-right: calc(var(--margin) / 2);\n\t\t\tbackground-color: var(--bg-color);\n\t\t}\n\t}\n\t> div:first-child {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tpadding-left: calc(var(--margin) / 2);\n\t\tborder-top-left-radius: 12px;\n\t\tborder-bottom-left-radius: 12px;\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t}\n\t> div:not(:first-child):not(:last-child) {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tposition: relative;\n\t\ttext-align: center;\n\t\tpadding: 0;\n\t\twidth: 0;\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttransition: all 300ms ease-in-out;\n\t}\n\t> div:last-child {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tposition: relative;\n\t\tpadding: 0 calc(var(--margin) / 3);\n\t}\n`;\n\nexport const HorizontalOptions = <Option extends any>(props: {\n\tlabel: string;\n\toptions: Array<Option>;\n\ttoLabel: (option: Option) => string;\n\tonSelect: (option: Option) => void;\n}) => {\n\tconst { label, options, toLabel, onSelect } = props;\n\n\tconst [ expanded, setExpanded ] = useState(false);\n\n\tconst onExpandClick = () => {\n\t\tif (!expanded) {\n\t\t\tsetExpanded(true);\n\t\t}\n\t};\n\tconst collapse = () => setExpanded(false);\n\tconst onOptionChange = (newOption: Option) => (event: React.MouseEvent<HTMLDivElement>) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tonSelect(newOption);\n\t\tsetExpanded(false);\n\t};\n\tconst onCaretClicked = (event: React.MouseEvent<HTMLDivElement>) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tsetExpanded(!expanded);\n\t};\n\n\treturn <Options data-expanded={expanded} onClick={onExpandClick} tabIndex={0} onBlur={collapse}>\n\t\t<div>{label}</div>\n\t\t{options.map(option => {\n\t\t\treturn <div key={v4()} onClick={onOptionChange(option)}>\n\t\t\t\t{toLabel(option)}\n\t\t\t</div>;\n\t\t})}\n\t\t<div onClick={onCaretClicked}><FontAwesomeIcon icon={expanded ? faTimes : faEdit}/></div>\n\t</Options>;\n};","import styled from 'styled-components';\n\nexport const ActionBody2Columns = styled.div.attrs({\n\t'data-widget': 'stage-unit-action-body'\n})`\n\tdisplay: grid;\n\tgrid-template-columns: calc(120px - var(--margin) / 2) calc(100% - 120px);\n\tgrid-auto-rows: minmax(32px, auto);\n\tgrid-column-gap: calc(var(--margin) / 2);\n\talign-items: center;\n\t> div:nth-child(2n + 1) {\n\t\ttext-align: right;\n\t\talign-self: start;\n\t\theight: 32px;\n\t\tline-height: 32px;\n\t}\n`;\n\nexport const ActionBodyItemLabel = styled.div.attrs({\n\t'data-widget': 'stage-unit-action-item-label'\n})`\n\tfont-variant: petite-caps;\n`;","import React from 'react';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../../../common/utils';\nimport { UnitAction, UnitActionAlarm, UnitActionAlarmSeverity } from '../../../../../services/admin/pipeline-types';\nimport { ActionInput } from '../components/action-input';\nimport { HorizontalOptions } from '../components/horizontal-options';\nimport { PipelineUnitActionEvent, usePipelineUnitActionContext } from '../pipeline-unit-action-context';\nimport { ActionBody2Columns, ActionBodyItemLabel } from './action-body';\n\nconst AlarmContainer = styled(ActionBody2Columns)`\n\t> div:nth-child(2) {\n\t\tfont-variant: petite-caps;\n\t\tfont-weight: var(--font-demi-bold);\n\t}\n`;\nconst asDisplaySeverity = (severity: UnitActionAlarmSeverity): string => {\n\treturn severity.split('-').map(word => {\n\t\tif ([ 'or', 'and', 'to', 'from' ].includes(word)) {\n\t\t\treturn word;\n\t\t} else {\n\t\t\treturn word.substr(0, 1).toUpperCase() + word.substr(1);\n\t\t}\n\t}).join(' ');\n};\n\nexport const Alarm = (props: { action: UnitAction }) => {\n\tconst { action } = props;\n\tconst alarm = action as UnitActionAlarm;\n\tconst { severity, message = '' } = alarm;\n\n\tconst { firePropertyChange } = usePipelineUnitActionContext();\n\tconst forceUpdate = useForceUpdate();\n\tconst onSeverityChanged = (severity: UnitActionAlarmSeverity) => {\n\t\talarm.severity = severity;\n\t\tfirePropertyChange(PipelineUnitActionEvent.VARIABLE_CHANGED);\n\t\tforceUpdate();\n\t};\n\tconst onMessageChanged = (event: React.ChangeEvent<HTMLInputElement>) => {\n\t\talarm.message = event.target.value;\n\t\tfirePropertyChange(PipelineUnitActionEvent.VARIABLE_CHANGED);\n\t\tforceUpdate();\n\t};\n\n\treturn <AlarmContainer>\n\t\t<ActionBodyItemLabel>Severity:</ActionBodyItemLabel>\n\t\t<HorizontalOptions label={asDisplaySeverity(severity)}\n\t\t                   options={Object.values(UnitActionAlarmSeverity).filter(candidate => candidate !== severity)}\n\t\t                   toLabel={(severity) => asDisplaySeverity(severity)}\n\t\t                   onSelect={onSeverityChanged}/>\n\t\t<ActionBodyItemLabel>Message:</ActionBodyItemLabel>\n\t\t<ActionInput value={message} onChange={onMessageChanged}/>\n\t</AlarmContainer>;\n};","import React, { useRef, useState } from 'react';\nimport styled from 'styled-components';\nimport { v4 } from 'uuid';\nimport { useCollapseFixedThing } from '../../../../../common/utils';\nimport { ActionInput } from './action-input';\n\ninterface DropdownRect {\n\ttop?: number;\n\tbottom?: number;\n\tleft: number;\n\twidth: number;\n\tatTop: boolean;\n}\n\nconst FinderContainer = styled.div`\n\tdisplay: flex;\n\tposition: relative;\n\tborder-radius: var(--border-radius);\n\tbox-shadow: 0 0 0 1px var(--border-color);\n\ttransition: all 300ms ease-in-out;\n\talign-items: center;\n\toverflow: hidden;\n\t&:hover {\n\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t}\n\t> input {\n\t\tflex-grow: 1;\n\t\theight: 22px;\n\t\tborder: 0;\n\t\twidth: 0;\n\t\tcursor: pointer;\n\t\ttext-overflow: ellipsis;\n\t\t&:hover,\n\t\t&:focus {\n\t\t\tborder-color: transparent;\n\t\t\tbox-shadow: none;\n\t\t}\n\t}\n`;\nconst TypeChar = styled.div`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\talign-self: stretch;\n\tjustify-content: center;\n\tbackground-color: var(--pipeline-bg-color);\n\tfont-variant: petite-caps;\n\tfont-weight: var(--font-demi-bold);\n\tborder-right: var(--border);\n\tpadding: 0 calc(var(--margin) / 5);\n\tz-index: 1;\n\tcursor: pointer;\n\t&[data-visible=false] {\n\t\tdisplay: none;\n\t}\n\t&[data-visible=true] {\n\t\t+ input {\n\t\t\tborder-top-left-radius: 0;\n\t\t\tborder-bottom-left-radius: 0;\n\t\t\tborder-left-color: transparent;\n\t\t}\n\t}\n`;\nconst Dropdown = styled.div.attrs<DropdownRect>(({ top, bottom, left, width, atTop }) => {\n\treturn {\n\t\tstyle: {\n\t\t\ttop: atTop ? 'unset' : top,\n\t\t\tbottom: atTop ? `calc(100vh - ${bottom}px)` : 'unset',\n\t\t\tleft,\n\t\t\tminWidth: Math.max(width, 200),\n\t\t\ttransformOrigin: atTop ? 'bottom' : 'top'\n\t\t}\n\t};\n})<DropdownRect>`\n\tdisplay: flex;\n\tposition: fixed;\n\tflex-direction: column;\n\tz-index: 1000;\n\tmax-height: 200px;\n\ttransform: scaleY(0);\n\ttransition: transform 300ms ease-in-out;\n\tpointer-events: none;\n\tbackground-color: var(--bg-color);\n\tborder-radius: var(--border-radius);\n\tbox-shadow: var(--console-primary-hover-shadow);\n\toverflow-x: hidden;\n\t&::-webkit-scrollbar {\n\t\tbackground-color: transparent;\n\t\twidth: 4px;\n\t}\n\t&::-webkit-scrollbar-track {\n\t\tbackground-color: transparent;\n\t\tborder-radius: 2px;\n\t}\n\t&::-webkit-scrollbar-thumb {\n\t\tbackground-color: var(--console-favorite-color);\n\t\tborder-radius: 2px;\n\t}\n\t&[data-expanded=true] {\n\t\ttransform: scaleY(1);\n\t\tpointer-events: auto;\n\t}\n\t> input {\n\t\tmin-height: 28px;\n\t\tposition: sticky;\n\t\ttop: 0;\n\t\tborder-bottom-left-radius: 0;\n\t\tborder-bottom-right-radius: 0;\n\t\tbackground-color: var(--bg-color);\n\t\tborder-color: transparent;\n\t\tborder-bottom: var(--border);\n\t\t&:hover,\n\t\t&:focus {\n\t\t\tborder-bottom-color: var(--border-color);\n\t\t\tbox-shadow: none;\n\t\t}\n\t}\n\t> div {\n\t\tmin-height: 28px;\n\t\theight: 28px;\n\t\tline-height: 28px;\n\t\tpadding: 0 var(--input-indent);\n\t\tbackground-color: var(--pipeline-bg-color);\n\t\t&[data-visible=false] {\n\t\t\tdisplay: none;\n\t\t}\n\t\t&:not(:nth-child(2)) {\n\t\t\tcursor: pointer;\n\t\t\twhite-space: nowrap;\n\t\t\toverflow: hidden;\n\t\t\ttext-overflow: ellipsis;\n\t\t\t&:hover {\n\t\t\t\tcolor: var(--invert-color);\n\t\t\t\tbackground-color: var(--console-primary-color);\n\t\t\t}\n\t\t\t> span:nth-child(2n) {\n\t\t\t\tfont-weight: 800;\n\t\t\t\tfont-variant: petite-caps;\n\t\t\t}\n\t\t}\n\t}\n`;\n\nexport const ItemFinder = <I extends any>(props: {\n\t// single character\n\ttypeChar?: string;\n\titem?: I\n\tasLabel: (item?: I) => string;\n\tfilterItems: (searchText: string) => Array<{ item: I, parts: Array<string> }>;\n\tonSelect: (item: I) => void;\n}) => {\n\tconst { typeChar, item, asLabel, filterItems, onSelect } = props;\n\n\tconst name = asLabel(item);\n\n\tconst containerRef = useRef<HTMLDivElement>(null);\n\tconst inputRef = useRef<HTMLInputElement>(null);\n\tconst dropdownRef = useRef<HTMLDivElement>(null);\n\tconst searchInputRef = useRef<HTMLInputElement>(null);\n\tconst [ expanded, setExpanded ] = useState(false);\n\tconst [ dropdownRect, setDropdownRect ] = useState<DropdownRect>({ left: 0, width: 0, atTop: false });\n\tconst [ searchText, setSearchText ] = useState<string>('');\n\tconst [ filteredItems, setFilteredItems ] = useState<Array<{ item: I, parts: Array<string> }>>(filterItems(''));\n\tconst [ filterTimeout, setFilterTimeout ] = useState<number | null>(null);\n\tuseCollapseFixedThing(containerRef, () => setExpanded(false));\n\n\tconst expand = (count: number) => {\n\t\tif (!expanded) {\n\t\t\tconst rect = containerRef.current!.getBoundingClientRect();\n\t\t\tconst top = rect.top + rect.height + 2;\n\t\t\tconst bottom = top + 28 * (count + 1);\n\t\t\tif (bottom > window.innerHeight) {\n\t\t\t\tsetDropdownRect({ bottom: rect.top - 2, left: rect.left, width: rect.width, atTop: true });\n\t\t\t} else {\n\t\t\t\tsetDropdownRect({ top, left: rect.left, width: rect.width, atTop: false });\n\t\t\t}\n\t\t\tsetExpanded(true);\n\t\t\tsearchInputRef.current!.focus();\n\t\t\tsearchInputRef.current!.select();\n\t\t}\n\t};\n\tconst onNameChanged = (event: React.ChangeEvent<HTMLInputElement>) => {\n\t\tconst value = event.target.value;\n\t\tif (filterTimeout) {\n\t\t\tclearTimeout(filterTimeout);\n\t\t}\n\n\t\tsetSearchText(value);\n\t\tsetFilterTimeout(setTimeout(() => {\n\t\t\tconst filtered = filterItems(value);\n\t\t\tsetFilterTimeout(null);\n\t\t\tsetFilteredItems(filtered);\n\t\t\texpand(filtered.length);\n\t\t}, 200));\n\t};\n\tconst onExpandClick = () => expand(filteredItems.length);\n\tconst onItemClicked = (item: I) => () => {\n\t\tonSelect(item);\n\t\tsetExpanded(false);\n\t\t// const searchText = asLabel(item);\n\t\t// setSearchText(searchText);\n\t\t// setFilteredItems(filterItems(searchText));\n\t};\n\n\treturn <FinderContainer ref={containerRef}>\n\t\t<TypeChar data-visible={!!typeChar} onClick={onExpandClick}>\n\t\t\t<span>{typeChar}</span>\n\t\t</TypeChar>\n\t\t<ActionInput value={name} onChange={onNameChanged}\n\t\t             onClick={onExpandClick} readOnly={true}\n\t\t             ref={inputRef}/>\n\t\t<Dropdown ref={dropdownRef} data-expanded={expanded} {...dropdownRect}\n\t\t          data-count={filteredItems.length + 1}>\n\t\t\t<ActionInput value={searchText} onChange={onNameChanged} ref={searchInputRef}/>\n\t\t\t<div data-visible={filteredItems.length === 0}>\n\t\t\t\t{!searchText ? 'Key in please...' : 'No matched.'}\n\t\t\t</div>\n\t\t\t{filteredItems.map(({ item, parts }) => {\n\t\t\t\treturn <div key={v4()} onClick={onItemClicked(item)}>\n\t\t\t\t\t{parts.map(part => <span key={v4()}>{part}</span>)}\n\t\t\t\t</div>;\n\t\t\t})}\n\t\t</Dropdown>\n\t</FinderContainer>;\n};","import {\n\tCompositeCondition,\n\tCondition,\n\tFactorValue,\n\tInMemoryValue,\n\tPlainCondition,\n\tSomeValue,\n\tSomeValueType\n} from '../../../../../services/admin/pipeline-types';\nimport { QueriedFactorForPipeline, QueriedTopicForPipeline } from '../../../../../services/admin/types';\nimport { FilteredFactor, FilteredTopic } from './types';\n\nconst filterByText = <X extends any, Y extends any>(all: Array<Y>, text: string, asLabel: (x: Y) => string): Array<X> => {\n\treturn all.map(item => {\n\t\tconst label = asLabel(item);\n\t\tconst segments = label.toUpperCase().split(text);\n\t\tif (segments.length === 1) {\n\t\t\treturn null;\n\t\t} else {\n\t\t\tconst length = text.length;\n\t\t\tconst count = segments.length;\n\t\t\tlet pos = 0;\n\t\t\treturn {\n\t\t\t\titem,\n\t\t\t\tname: label.toUpperCase(),\n\t\t\t\tparts: segments.reduce((all, segment, index) => {\n\t\t\t\t\tconst len = segment.length;\n\t\t\t\t\tall.push(label.substr(pos, len));\n\t\t\t\t\tpos += len;\n\t\t\t\t\tif (index !== count - 1) {\n\t\t\t\t\t\tall.push(label.substr(pos, length));\n\t\t\t\t\t\tpos += length;\n\t\t\t\t\t}\n\t\t\t\t\treturn all;\n\t\t\t\t}, [] as Array<string>)\n\t\t\t};\n\t\t}\n\t})\n\t\t.filter(x => x)\n\t\t.sort((a, b) => {\n\t\t\tif (!a || !b) {\n\t\t\t\treturn -1;\n\t\t\t} else {\n\t\t\t\treturn a.name.localeCompare(b.name);\n\t\t\t}\n\t\t}) as Array<X>;\n};\n\nexport const filterTopic = (topics: Array<QueriedTopicForPipeline>, text: string): Array<FilteredTopic> => {\n\ttext = text.trim();\n\tif (!text) {\n\t\treturn topics.map(topic => ({ item: topic, parts: [ topic.name || '' ] }));\n\t} else {\n\t\treturn filterByText(topics, text.toUpperCase(), (topic: QueriedTopicForPipeline) => (topic.name || ''));\n\t}\n};\n\nexport const filterFactor = (factors: Array<QueriedFactorForPipeline>, text: string): Array<FilteredFactor> => {\n\ttext = text.trim();\n\tif (!text) {\n\t\treturn factors\n\t\t\t.map(factor => {\n\t\t\t\treturn {\n\t\t\t\t\titem: factor,\n\t\t\t\t\tparts: [ factor.label || '' ]\n\t\t\t\t};\n\t\t\t})\n\t\t\t// filter factors which has no label\n\t\t\t.filter(x => x.parts[0])\n\t\t\t.sort((a, b) => {\n\t\t\t\treturn a.parts[0].localeCompare(b.parts[0]);\n\t\t\t});\n\t} else {\n\t\treturn filterByText(factors, text.toUpperCase(), (factor: QueriedFactorForPipeline) => (factor.label || ''));\n\t}\n};\n\nexport const isCompositeCondition = (condition: Condition): condition is CompositeCondition => !!(condition as any).mode;\nexport const isPlainCondition = (condition: Condition): condition is PlainCondition => !isCompositeCondition(condition);\nexport const computeConditionLines = (condition: CompositeCondition): number => {\n\tif (condition.children.length === 0) {\n\t\t// me and no child line\n\t\treturn 2;\n\t}\n\treturn condition.children.reduce((count: number, child) => {\n\t\tif (isPlainCondition(child)) {\n\t\t\tcount += 1;\n\t\t} else if (isCompositeCondition(child)) {\n\t\t\tcount += computeConditionLines(child);\n\t\t}\n\t\treturn count;\n\t}, 1);\n};\n/**\n * only plain conditions are counted\n */\nexport const computeConditionCount = (condition: CompositeCondition): number => {\n\treturn condition.children.reduce((count: number, child) => {\n\t\tif (isPlainCondition(child)) {\n\t\t\tcount += 1;\n\t\t} else if (isCompositeCondition(child)) {\n\t\t\tcount += computeConditionCount(child);\n\t\t}\n\t\treturn count;\n\t}, 0);\n};\n\nexport const isFactorValue = (value: SomeValue): value is FactorValue => value.type === SomeValueType.FACTOR;\nexport const isMemoryValue = (value: SomeValue): value is InMemoryValue => value.type === SomeValueType.IN_MEMORY;","import React from 'react';\nimport { useForceUpdate } from '../../../../../common/utils';\nimport { TopicHolder } from '../../../../../services/admin/pipeline-types';\nimport { QueriedTopicForPipeline } from '../../../../../services/admin/types';\nimport { usePipelineContext } from '../../pipeline-context';\nimport { ItemFinder } from './item-finder';\nimport { filterTopic } from './utils';\n\nexport const TopicFinder = (props: {\n\tholder: TopicHolder;\n\tonChange: () => void;\n}) => {\n\tconst { holder, onChange } = props;\n\tconst { topicId: currentTopicId } = holder;\n\n\tconst { store: { topics } } = usePipelineContext();\n\tconst forceUpdate = useForceUpdate();\n\n\t// eslint-disable-next-line\n\tconst topic = currentTopicId ? topics.find(topic => topic.topicId == currentTopicId) : (void 0);\n\n\tconst asLabel = (topic?: QueriedTopicForPipeline) => topic ? topic.name : '';\n\tconst filterItems = (searchText: string) => filterTopic(topics, searchText);\n\tconst onSelect = (topic: QueriedTopicForPipeline) => {\n\t\tholder.topicId = topic.topicId;\n\t\tonChange();\n\t\tforceUpdate();\n\t};\n\n\treturn <ItemFinder typeChar='Topic' item={topic} asLabel={asLabel} filterItems={filterItems} onSelect={onSelect}/>;\n};","import { faEdit } from '@fortawesome/free-regular-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { useEffect, useRef, useState } from 'react';\nimport styled from 'styled-components';\nimport { ConditionOperator, PlainCondition } from '../../../../../services/admin/pipeline-types';\n\ninterface DropdownRect {\n\ttop: number;\n\tleft?: number;\n\tright?: number;\n\twidth: number;\n\tatTop: boolean;\n}\n\nconst DropdownHeight = 28 * 5 + 4;\n\nconst ConditionOperatorSelectContainer = styled.div`\n\tdisplay          : flex;\n\tposition         : relative;\n\talign-items      : center;\n\tjustify-self     : flex-start;\n\tborder-radius    : var(--border-radius);\n\tbackground-color : var(--pipeline-bg-color);\n\tbox-shadow       : 0 0 0 1px var(--border-color);\n\theight           : 22px;\n\toutline          : none;\n\tappearance       : none;\n\twhite-space      : nowrap;\n\tcursor           : pointer;\n\ttransition       : all 300ms ease-in-out;\n\t&[data-expanded=true],\n\t&:hover {\n\t\tbox-shadow : var(--console-primary-hover-shadow);\n\t}\n\t> div:first-child {\n\t\tposition                  : relative;\n\t\tpadding-left              : calc(var(--margin) / 2);\n\t\tfont-variant              : petite-caps;\n\t\tfont-weight               : var(--font-demi-bold);\n\t\tborder-top-left-radius    : 12px;\n\t\tborder-bottom-left-radius : 12px;\n\t}\n\t> div:last-child {\n\t\tposition : relative;\n\t\tpadding  : 0 calc(var(--margin) / 3);\n\t}\n`;\nconst Dropdown = styled.div.attrs<DropdownRect>(({ top, left, right, width, atTop }) => {\n\treturn {\n\t\tstyle: {\n\t\t\ttop,\n\t\t\tleft,\n\t\t\tright: typeof right === 'number' ? `calc(100vw - ${right}px)` : 'unset',\n\t\t\tminWidth: Math.max(width, 200),\n\t\t\ttransformOrigin: atTop ? 'bottom' : 'top'\n\t\t}\n\t};\n})<DropdownRect>`\n\tdisplay          : flex;\n\tposition         : fixed;\n\tflex-direction   : column;\n\tz-index          : 1000;\n\theight           : ${DropdownHeight}px;\n\ttransform        : scaleY(0);\n\ttransition       : transform 300ms ease-in-out;\n\tpointer-events   : none;\n\tbackground-color : var(--bg-color);\n\tborder-radius    : 12px;\n\tbox-shadow       : var(--console-primary-hover-shadow);\n\t&[data-expanded=true] {\n\t\ttransform      : scaleY(1);\n\t\tpointer-events : auto;\n\t\t&:before {\n\t\t\tcontent          : '';\n\t\t\tdisplay          : block;\n\t\t\tposition         : absolute;\n\t\t\ttop              : 0;\n\t\t\tleft             : 0;\n\t\t\twidth            : 100%;\n\t\t\theight           : 100%;\n\t\t\tborder-radius    : 12px;\n\t\t\tbackground-color : var(--pipeline-bg-color);\n\t\t\tz-index          : -1;\n\t\t}\n\t}\n\t> div {\n\t\tmin-height : 28px;\n\t\tpadding    : 0 calc(var(--margin) / 2);\n\t}\n\t> div[data-role='operators'] {\n\t\tdisplay          : flex;\n\t\tflex-wrap        : wrap;\n\t\tgrid-column-gap  : calc(var(--margin) / 4);\n\t\tgrid-row-gap     : calc(var(--margin) / 8);\n\t\tbackground-color : var(--bg-color);\n\t\tpadding          : 0 calc(var(--margin) / 2);\n\t\tcursor           : default;\n\t\t&:first-child {\n\t\t\tborder-top-left-radius  : 12px;\n\t\t\tborder-top-right-radius : 12px;\n\t\t\tpadding-top             : calc(var(--margin) / 8);\n\t\t\tpadding-bottom          : calc(var(--margin) / 8);\n\t\t}\n\t\t&:last-child {\n\t\t\tborder-bottom-left-radius  : 12px;\n\t\t\tborder-bottom-right-radius : 12px;\n\t\t\tpadding-bottom             : calc(var(--margin) / 8);\n\t\t}\n\t\t> div {\n\t\t\tdisplay       : flex;\n\t\t\talign-items   : center;\n\t\t\theight        : 24px;\n\t\t\tline-height   : 22px;\n\t\t\tborder-radius : 12px;\n\t\t\tborder        : var(--border);\n\t\t\tpadding       : 0 calc(var(--margin) / 2);\n\t\t\ttransition    : all 300ms ease-in-out;\n\t\t\tcursor        : pointer;\n\t\t\t&:hover,\n\t\t\t&[data-current=true] {\n\t\t\t\tborder-color     : var(--console-favorite-color);\n\t\t\t\tcolor            : var(--invert-color);\n\t\t\t\tbackground-color : var(--console-favorite-color);\n\t\t\t}\n\t\t\t&[data-current=true] {\n\t\t\t\tcursor : default;\n\t\t\t}\n\t\t}\n\t}\n`;\n\nconst asDisplayOperator = (operator: ConditionOperator): string => {\n\tswitch (operator) {\n\t\tcase ConditionOperator.EMPTY:\n\t\t\treturn 'Is Empty';\n\t\tcase ConditionOperator.NOT_EMPTY:\n\t\t\treturn 'Is Not Empty';\n\t\t// date part\n\t\tcase ConditionOperator.EQUALS:\n\t\t\treturn 'Equals';\n\t\tcase ConditionOperator.NOT_EQUALS:\n\t\t\treturn 'Not Equals';\n\t\tcase ConditionOperator.LESS:\n\t\t\treturn 'Less Than';\n\t\tcase ConditionOperator.LESS_EQUALS:\n\t\t\treturn 'Less Than or Equals';\n\t\tcase ConditionOperator.MORE:\n\t\t\treturn 'Greater Than';\n\t\tcase ConditionOperator.MORE_EQUALS:\n\t\t\treturn 'Greater Than or Equals';\n\t\tcase ConditionOperator.IN:\n\t\t\treturn 'In';\n\t\tcase ConditionOperator.NOT_IN:\n\t\t\treturn 'Not In';\n\t}\n};\n\nconst OperatorButton = (props: {\n\toperator: ConditionOperator;\n\tcurrent: ConditionOperator;\n\tonClick: (type: ConditionOperator) => void;\n}) => {\n\tconst { operator, current, onClick } = props;\n\n\treturn <div data-current={current === operator} onClick={() => onClick(operator)}>\n\t\t{asDisplayOperator(operator)}\n\t</div>;\n};\n\nexport const ConditionOperatorSelect = (props: {\n\tcondition: PlainCondition;\n\tright?: boolean;\n\tonChange: () => void;\n}) => {\n\tconst { condition, right = false, onChange } = props;\n\n\tconst containerRef = useRef<HTMLDivElement>(null);\n\tconst dropdownRef = useRef<HTMLDivElement>(null);\n\tconst [ expanded, setExpanded ] = useState(false);\n\tconst [ dropdownRect, setDropdownRect ] = useState<DropdownRect>({ top: 0, left: 0, width: 0, atTop: false });\n\tuseEffect(() => {\n\t\tconst onScroll = () => setExpanded(false);\n\t\twindow.addEventListener('scroll', onScroll, true);\n\t\treturn () => window.removeEventListener('scroll', onScroll, true);\n\t});\n\n\tconst collapse = () => setExpanded(false);\n\tconst onExpandClick = () => {\n\t\tif (!expanded) {\n\t\t\tconst rect = containerRef.current!.getBoundingClientRect();\n\t\t\tconst top = rect.top + rect.height + 2;\n\t\t\tconst bottom = top + DropdownHeight;\n\t\t\tif (bottom > window.innerHeight) {\n\t\t\t\tsetDropdownRect({\n\t\t\t\t\ttop: rect.top - DropdownHeight - 2,\n\t\t\t\t\tleft: right ? (void 0) : rect.left,\n\t\t\t\t\tright: right ? rect.right : (void 0),\n\t\t\t\t\twidth: rect.width,\n\t\t\t\t\tatTop: true\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tsetDropdownRect({\n\t\t\t\t\ttop,\n\t\t\t\t\tleft: right ? (void 0) : rect.left,\n\t\t\t\t\tright: right ? rect.right : (void 0),\n\t\t\t\t\twidth: rect.width,\n\t\t\t\t\tatTop: false\n\t\t\t\t});\n\t\t\t}\n\t\t\tsetExpanded(true);\n\t\t}\n\t};\n\tconst onOperatorClicked = (operator: ConditionOperator) => {\n\t\tif (operator === condition.operator) {\n\t\t\treturn;\n\t\t}\n\t\tcondition.operator = operator;\n\t\tonChange();\n\t\tsetExpanded(false);\n\t};\n\tconst onCaretClicked = (event: React.MouseEvent<HTMLDivElement>) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tsetExpanded(!expanded);\n\t};\n\n\treturn <ConditionOperatorSelectContainer data-expanded={expanded} tabIndex={0} ref={containerRef}\n\t                                         onClick={onExpandClick} onBlur={collapse}>\n\t\t<div>{asDisplayOperator(condition.operator)}</div>\n\t\t<Dropdown ref={dropdownRef} data-expanded={expanded} {...dropdownRect}>\n\t\t\t<div data-role='operators'>\n\t\t\t\t<OperatorButton current={condition.operator} operator={ConditionOperator.EMPTY}\n\t\t\t\t                onClick={onOperatorClicked}/>\n\t\t\t\t<OperatorButton current={condition.operator} operator={ConditionOperator.NOT_EMPTY}\n\t\t\t\t                onClick={onOperatorClicked}/>\n\t\t\t</div>\n\t\t\t<div data-role='operators'>\n\t\t\t\t<OperatorButton current={condition.operator} operator={ConditionOperator.EQUALS}\n\t\t\t\t                onClick={onOperatorClicked}/>\n\t\t\t\t<OperatorButton current={condition.operator} operator={ConditionOperator.NOT_EQUALS}\n\t\t\t\t                onClick={onOperatorClicked}/>\n\t\t\t</div>\n\t\t\t<div data-role='operators'>\n\t\t\t\t<OperatorButton current={condition.operator} operator={ConditionOperator.LESS}\n\t\t\t\t                onClick={onOperatorClicked}/>\n\t\t\t\t<OperatorButton current={condition.operator} operator={ConditionOperator.LESS_EQUALS}\n\t\t\t\t                onClick={onOperatorClicked}/>\n\t\t\t</div>\n\t\t\t<div data-role='operators'>\n\t\t\t\t<OperatorButton current={condition.operator} operator={ConditionOperator.MORE}\n\t\t\t\t                onClick={onOperatorClicked}/>\n\t\t\t\t<OperatorButton current={condition.operator} operator={ConditionOperator.MORE_EQUALS}\n\t\t\t\t                onClick={onOperatorClicked}/>\n\t\t\t</div>\n\t\t\t<div data-role='operators'>\n\t\t\t\t<OperatorButton current={condition.operator} operator={ConditionOperator.IN}\n\t\t\t\t                onClick={onOperatorClicked}/>\n\t\t\t\t<OperatorButton current={condition.operator} operator={ConditionOperator.NOT_IN}\n\t\t\t\t                onClick={onOperatorClicked}/>\n\t\t\t</div>\n\t\t</Dropdown>\n\t\t<div onClick={onCaretClicked}><FontAwesomeIcon icon={faEdit}/></div>\n\t</ConditionOperatorSelectContainer>;\n};","import { faEdit } from '@fortawesome/free-regular-svg-icons';\nimport { faTimes } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { Fragment, useEffect, useRef, useState } from 'react';\nimport styled from 'styled-components';\nimport {\n\tAggregateArithmetic,\n\tDatePartArithmetic,\n\tNoArithmetic,\n\tNumericArithmetic,\n\tSimpleFuncArithmetic,\n\tSimpleFuncValue\n} from '../../../../../services/admin/pipeline-types';\n\ninterface DropdownRect {\n\ttop: number;\n\tleft?: number;\n\tright?: number;\n\twidth: number;\n\tatTop: boolean;\n\taggregate: boolean;\n}\n\nconst DropdownRowHeight = 28;\nconst DropdownHeight = DropdownRowHeight * 7 + 8 * 3;\nconst NoAggregateDropdownHeight = DropdownRowHeight * 5 + 8 * 3;\n\nconst ArithmeticSelectContainer = styled.div`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\tjustify-self: flex-start;\n\tborder-radius: var(--border-radius);\n\tbackground-color: var(--pipeline-bg-color);\n\tbox-shadow: 0 0 0 1px var(--border-color);\n\theight: 22px;\n\toutline: none;\n\tappearance: none;\n\twhite-space: nowrap;\n\tcursor: pointer;\n\ttransition: all 300ms ease-in-out;\n\t&[data-expanded=true],\n\t&:hover {\n\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t}\n\t> div:first-child {\n\t\tposition: relative;\n\t\tpadding-left: calc(var(--margin) / 2);\n\t\tfont-variant: petite-caps;\n\t\tfont-weight: var(--font-demi-bold);\n\t\tborder-top-left-radius: 12px;\n\t\tborder-top-right-radius: 12px;\n\t}\n\t> div:last-child {\n\t\tposition: relative;\n\t\tpadding: 0 calc(var(--margin) / 3);\n\t}\n`;\nconst Dropdown = styled.div\n\t.attrs<DropdownRect>(\n\t\t({ top, left, right, width, atTop, aggregate }) => {\n\t\t\treturn {\n\t\t\t\tstyle: {\n\t\t\t\t\ttop,\n\t\t\t\t\tleft,\n\t\t\t\t\tright: typeof right === 'number' ? `calc(100vw - ${right}px)` : 'unset',\n\t\t\t\t\tminWidth: Math.max(width, 200),\n\t\t\t\t\tminHeight: aggregate ? `${DropdownHeight}px` : `${NoAggregateDropdownHeight}px`,\n\t\t\t\t\ttransformOrigin: atTop ? 'bottom' : 'top'\n\t\t\t\t}\n\t\t\t};\n\t\t})<DropdownRect>`\n\tdisplay: flex;\n\tposition: fixed;\n\tflex-direction: column;\n\tz-index: 1000;\n\ttransform: scaleY(0);\n\ttransition: transform 300ms ease-in-out;\n\tpointer-events: none;\n\tbackground-color: var(--bg-color);\n\tborder-radius: 12px;\n\tbox-shadow: var(--console-primary-hover-shadow);\n\t&[data-expanded=true] {\n\t\ttransform: scaleY(1);\n\t\tpointer-events: auto;\n\t\t&:before {\n\t\t\tcontent: '';\n\t\t\tdisplay: block;\n\t\t\tposition: absolute;\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t\tborder-radius: 12px;\n\t\t\tbackground-color: var(--pipeline-bg-color);\n\t\t\tz-index: -1;\n\t\t}\n\t}\n\t> div {\n\t\tmin-height: ${DropdownRowHeight}px;\n\t\tpadding: 0 calc(var(--margin) / 2);\n\t}\n\t> div[data-role='action-category'] {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tcursor: default;\n\t\t&:not(:last-child) {\n\t\t\tfont-weight: var(--font-bold);\n\t\t}\n\t\t&:last-child {\n\t\t\tbackground-color: var(--bg-color);\n\t\t\tjustify-content: flex-end;\n\t\t\tpadding-top: 8px;\n\t\t\tpadding-bottom: 8px;\n\t\t\tborder-bottom-left-radius: 12px;\n\t\t\tborder-bottom-right-radius: 12px;\n\t\t}\n\t}\n\t> div[data-role='actions'] {\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t\tgrid-column-gap: calc(var(--margin) / 4);\n\t\tgrid-row-gap: calc(var(--margin) / 8);\n\t\tbackground-color: var(--bg-color);\n\t\tpadding: calc(var(--margin) / 8) calc(var(--margin) / 2);\n\t\tcursor: default;\n\t\t> div {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\theight: 24px;\n\t\t\tline-height: 22px;\n\t\t\tborder-radius: 12px;\n\t\t\tborder: var(--border);\n\t\t\tpadding: 0 calc(var(--margin) / 4);\n\t\t\ttransition: all 300ms ease-in-out;\n\t\t\tcursor: pointer;\n\t\t\t&:hover,\n\t\t\t&[data-current=true] {\n\t\t\t\tborder-color: var(--console-favorite-color);\n\t\t\t\tcolor: var(--invert-color);\n\t\t\t\tbackground-color: var(--console-favorite-color);\n\t\t\t}\n\t\t\t&[data-current=true] {\n\t\t\t\tcursor: default;\n\t\t\t}\n\t\t}\n\t}\n`;\nconst ClearButton = styled.div`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\theight: 24px;\n\tline-height: 22px;\n\tborder-radius: 12px;\n\tborder: var(--border);\n\tpadding: 0 calc(var(--margin) / 2);\n\tcursor: pointer;\n\t> svg {\n\t\tmargin-right: calc(var(--margin) / 4);\n\t}\n\t&:hover,\n\t&[data-current=true] {\n\t\tborder-color: var(--console-favorite-color);\n\t\tcolor: var(--invert-color);\n\t\tbackground-color: var(--console-favorite-color);\n\t}\n\t&[data-current=true] {\n\t\tcursor: default;\n\t}\n`;\n\nconst asDisplayArithmetic = (arithmetic: SimpleFuncArithmetic): string => {\n\tswitch (arithmetic) {\n\t\t// date part\n\t\tcase DatePartArithmetic.YEAR_OF:\n\t\t\treturn 'Year';\n\t\tcase DatePartArithmetic.MONTH_OF:\n\t\t\treturn 'Month';\n\t\tcase DatePartArithmetic.WEEK_OF:\n\t\t\treturn 'Week of Year';\n\t\tcase DatePartArithmetic.WEEKDAY:\n\t\t\treturn 'Weekday';\n\t\t// numeric\n\t\tcase NumericArithmetic.ABSOLUTE_VALUE:\n\t\t\treturn 'Abs';\n\t\tcase NumericArithmetic.LOGARITHM:\n\t\t\treturn 'Log';\n\t\tcase NumericArithmetic.PERCENTAGE:\n\t\t\treturn '%';\n\t\t// aggregate\n\t\tcase AggregateArithmetic.COUNT:\n\t\t\treturn 'Count';\n\t\tcase AggregateArithmetic.SUM:\n\t\t\treturn 'Sum';\n\t\tcase AggregateArithmetic.AVG:\n\t\t\treturn 'Avg';\n\t\tcase AggregateArithmetic.MEDIAN:\n\t\t\treturn 'Median';\n\t\tcase AggregateArithmetic.MAX:\n\t\t\treturn 'Max';\n\t\tcase AggregateArithmetic.MIN:\n\t\t\treturn 'Min';\n\t\t// no func\n\t\tcase NoArithmetic.NO_FUNC:\n\t\tdefault:\n\t\t\treturn 'No Func';\n\t}\n};\n\nconst ArithmeticTypes = [\n\t{ label: 'Datetime Transform', enum: DatePartArithmetic },\n\t{ label: 'Numeric Compute', enum: NumericArithmetic },\n\t{ label: 'Aggregate', enum: AggregateArithmetic }\n];\n\nconst ArithmeticButton = (props: {\n\tarithmetic: SimpleFuncArithmetic;\n\tcurrent: SimpleFuncArithmetic;\n\tonClick: (type: SimpleFuncArithmetic) => void;\n}) => {\n\tconst { arithmetic, current, onClick } = props;\n\n\treturn <div data-current={current === arithmetic} onClick={() => onClick(arithmetic)}>\n\t\t{asDisplayArithmetic(arithmetic)}\n\t</div>;\n};\n\nexport const ArithmeticSelect = (props: {\n\tvalue: SimpleFuncValue;\n\tright?: boolean;\n\taggregate: boolean;\n\tonChange: () => void;\n}) => {\n\tconst { value, right = false, aggregate, onChange } = props;\n\n\tconst containerRef = useRef<HTMLDivElement>(null);\n\tconst dropdownRef = useRef<HTMLDivElement>(null);\n\tconst [ expanded, setExpanded ] = useState(false);\n\tconst [ dropdownRect, setDropdownRect ] = useState<DropdownRect>({\n\t\ttop: 0,\n\t\tleft: 0,\n\t\twidth: 0,\n\t\tatTop: false,\n\t\taggregate\n\t});\n\tuseEffect(() => {\n\t\tconst onScroll = () => setExpanded(false);\n\t\twindow.addEventListener('scroll', onScroll, true);\n\t\treturn () => window.removeEventListener('scroll', onScroll, true);\n\t});\n\n\tconst collapse = () => setExpanded(false);\n\tconst onExpandClick = () => {\n\t\tif (!expanded) {\n\t\t\tconst rect = containerRef.current!.getBoundingClientRect();\n\t\t\tconst top = rect.top + rect.height + 2;\n\t\t\tconst bottom = top + DropdownHeight;\n\t\t\tif (bottom > window.innerHeight) {\n\t\t\t\tsetDropdownRect({\n\t\t\t\t\ttop: rect.top - DropdownHeight - 2,\n\t\t\t\t\tleft: right ? (void 0) : rect.left,\n\t\t\t\t\tright: right ? rect.right : (void 0),\n\t\t\t\t\twidth: rect.width,\n\t\t\t\t\tatTop: true,\n\t\t\t\t\taggregate\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tsetDropdownRect({\n\t\t\t\t\ttop,\n\t\t\t\t\tleft: right ? (void 0) : rect.left,\n\t\t\t\t\tright: right ? rect.right : (void 0),\n\t\t\t\t\twidth: rect.width,\n\t\t\t\t\tatTop: false,\n\t\t\t\t\taggregate\n\t\t\t\t});\n\t\t\t}\n\t\t\tsetExpanded(true);\n\t\t}\n\t};\n\tconst onArithmeticClicked = (arithmetic: SimpleFuncArithmetic) => {\n\t\tif (arithmetic === value.arithmetic) {\n\t\t\treturn;\n\t\t}\n\t\tvalue.arithmetic = arithmetic;\n\t\tonChange();\n\t\tsetExpanded(false);\n\t};\n\tconst onClearFuncClicked = () => {\n\t\tif (!value.arithmetic || value.arithmetic === NoArithmetic.NO_FUNC) {\n\t\t\treturn;\n\t\t}\n\t\tvalue.arithmetic = NoArithmetic.NO_FUNC;\n\t\tonChange();\n\t\tsetExpanded(false);\n\t};\n\tconst onCaretClicked = (event: React.MouseEvent<HTMLDivElement>) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tsetExpanded(!expanded);\n\t};\n\n\tconst arithmetics = aggregate ? ArithmeticTypes : ArithmeticTypes.filter(arithmetic => arithmetic.label !== 'Aggregate');\n\n\treturn <ArithmeticSelectContainer data-expanded={expanded} tabIndex={0} ref={containerRef}\n\t                                  onClick={onExpandClick} onBlur={collapse}>\n\t\t<div>{asDisplayArithmetic(value.arithmetic)}</div>\n\t\t<Dropdown ref={dropdownRef} data-expanded={expanded} {...dropdownRect}>\n\t\t\t{arithmetics.map(item => {\n\t\t\t\treturn <Fragment key={item.label}>\n\t\t\t\t\t<div data-role='action-category'>{item.label}</div>\n\t\t\t\t\t<div data-role='actions'>\n\t\t\t\t\t\t{Object.values(item.enum).map(candidateType => {\n\t\t\t\t\t\t\treturn <ArithmeticButton current={value.arithmetic} arithmetic={candidateType}\n\t\t\t\t\t\t\t                         key={candidateType}\n\t\t\t\t\t\t\t                         onClick={onArithmeticClicked}/>;\n\t\t\t\t\t\t})}\n\t\t\t\t\t</div>\n\t\t\t\t</Fragment>;\n\t\t\t})}\n\t\t\t<div data-role='action-category'>\n\t\t\t\t<ClearButton data-current={!value.arithmetic || value.arithmetic === NoArithmetic.NO_FUNC}\n\t\t\t\t             onClick={onClearFuncClicked}>\n\t\t\t\t\t<FontAwesomeIcon icon={faTimes}/>\n\t\t\t\t\t<span>No Func</span>\n\t\t\t\t</ClearButton>\n\t\t\t</div>\n\t\t</Dropdown>\n\t\t<div onClick={onCaretClicked}><FontAwesomeIcon icon={faEdit}/></div>\n\t</ArithmeticSelectContainer>;\n};","import React from 'react';\nimport { useForceUpdate } from '../../../../../common/utils';\nimport { FactorHolder } from '../../../../../services/admin/pipeline-types';\nimport { QueriedFactorForPipeline } from '../../../../../services/admin/types';\nimport { usePipelineContext } from '../../pipeline-context';\nimport { ItemFinder } from './item-finder';\nimport { filterFactor } from './utils';\n\nexport const FactorFinder = (props: { holder: FactorHolder, onChange: () => void }) => {\n\tconst { holder, onChange } = props;\n\tconst { topicId: currentTopicId, factorId: currentFactorId } = holder;\n\n\tconst { store: { topics } } = usePipelineContext();\n\tconst forceUpdate = useForceUpdate();\n\n\t// eslint-disable-next-line\n\tconst topic = currentTopicId ? topics.find(topic => topic.topicId == currentTopicId) : (void 0);\n\t// eslint-disable-next-line\n\tconst factor = currentFactorId ? (topic?.factors.find(factor => factor.factorId == currentFactorId)) : (void 0);\n\n\tconst asLabel = (factor?: QueriedFactorForPipeline) => factor ? (factor.label || '') : '';\n\tconst filterItems = (searchText: string) => filterFactor(topic?.factors || [], searchText);\n\tconst onSelect = (factor: QueriedFactorForPipeline) => {\n\t\tholder.factorId = factor.factorId;\n\t\tonChange();\n\t\tforceUpdate();\n\t};\n\n\treturn <ItemFinder typeChar='Factor' item={factor} asLabel={asLabel} filterItems={filterItems}\n\t                   onSelect={onSelect}/>;\n};","import React from 'react';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../../../common/utils';\nimport { SomeValue, SomeValueType } from '../../../../../services/admin/pipeline-types';\nimport { QueriedTopicForPipeline } from '../../../../../services/admin/types';\nimport { usePipelineContext } from '../../pipeline-context';\nimport { ArithmeticSelect } from '../unit-actions/arithmetic-select';\nimport { ActionInput } from './action-input';\nimport { FactorFinder } from './factor-finder';\nimport { HorizontalOptions } from './horizontal-options';\nimport { isFactorValue, isMemoryValue } from './utils';\n\nconst Container = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\t> div:first-child {\n\t\tfont-variant: petite-caps;\n\t\tfont-weight: var(--font-demi-bold);\n\t\tborder-radius: var(--border-radius) 0 0 var(--border-radius);\n\t\t&[data-expanded=true] {\n\t\t\t> div:last-child {\n\t\t\t\tpadding-right: calc(var(--margin) / 3);\n\t\t\t}\n\t\t}\n\t}\n\t> div:nth-child(2) {\n\t\tflex-grow: 1;\n\t\tborder-radius: 0;\n\t\tbox-shadow: 0 1px 0 0 var(--border-color), 0 -1px 0 0 var(--border-color), 1px 0 0 0 var(--border-color);\n\t\t&:hover {\n\t\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t\t}\n\t\t> input {\n\t\t\tborder-radius: 0;\n\t\t}\n\t}\n\t> input {\n\t\tflex-grow: 1;\n\t\theight: 22px;\n\t\tborder: 0;\n\t\tborder-radius: 0;\n\t\tbox-shadow: 0 1px 0 0 var(--border-color), 0 -1px 0 0 var(--border-color), 1px 0 0 0 var(--border-color);\n\t}\n\t> div:last-child {\n\t\tborder-radius: 0 var(--border-radius) var(--border-radius) 0;\n\t\tbox-shadow: 0 1px 0 0 var(--border-color), 0 -1px 0 0 var(--border-color), 1px 0 0 0 var(--border-color);\n\t\t&:hover {\n\t\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t\t}\n\t}\n`;\n\nconst asDisplayValueType = (type: SomeValueType, source?: QueriedTopicForPipeline): string => {\n\tswitch (type) {\n\t\tcase SomeValueType.IN_MEMORY:\n\t\t\treturn 'Memory Context';\n\t\tcase SomeValueType.FACTOR:\n\t\tdefault:\n\t\t\treturn source ? `Topic: ${source.name}` : 'Source Topic';\n\t}\n};\n\nexport const FacterValueFinder = (props: {\n\tholder: SomeValue;\n\tonTopicChange: () => void;\n\tonFactorChange: () => void;\n\tonVariableChange: () => void;\n\tonArithmeticChange: () => void;\n\taggregate: boolean;\n}) => {\n\tconst {\n\t\tholder: value,\n\t\tonTopicChange, onFactorChange, onVariableChange, onArithmeticChange,\n\t\taggregate\n\t} = props;\n\tconst { type: valueType = SomeValueType.FACTOR } = value;\n\n\tconst { store: { selectedPipeline, topics } } = usePipelineContext();\n\tconst forceUpdate = useForceUpdate();\n\n\tconst { topicId: sourceTopicId } = selectedPipeline!;\n\t// eslint-disable-next-line\n\tconst sourceTopic = topics.find(topic => topic.topicId == sourceTopicId);\n\tif (isFactorValue(value) && !value.topicId) {\n\t\tvalue.topicId = sourceTopicId;\n\t}\n\n\tconst onValueTypeChanged = (valueType: SomeValueType) => {\n\t\tvalue.type = valueType;\n\t\tif (isFactorValue(value)) {\n\t\t\tvalue.topicId = sourceTopicId;\n\t\t}\n\t\tonTopicChange();\n\t\tforceUpdate();\n\t};\n\tconst onInMemoryVariableNameChanged = (event: React.ChangeEvent<HTMLInputElement>) => {\n\t\tconst name = event.target.value;\n\t\tif (isMemoryValue(value)) {\n\t\t\tvalue.name = name;\n\t\t\tonVariableChange();\n\t\t}\n\t\tforceUpdate();\n\t};\n\n\treturn <Container>\n\t\t<HorizontalOptions label={asDisplayValueType(valueType, sourceTopic)}\n\t\t                   options={Object.values(SomeValueType).filter(candidate => candidate !== valueType)}\n\t\t                   toLabel={(valueType) => asDisplayValueType(valueType, sourceTopic)}\n\t\t                   onSelect={onValueTypeChanged}/>\n\t\t{\n\t\t\tisFactorValue(value)\n\t\t\t\t? <FactorFinder holder={value} onChange={onFactorChange}/>\n\t\t\t\t: null\n\t\t}\n\t\t{\n\t\t\tisMemoryValue(value)\n\t\t\t\t? <ActionInput value={value.name || ''} onChange={onInMemoryVariableNameChanged}\n\t\t\t\t               placeholder='Variable name...'/>\n\t\t\t\t: null\n\t\t}\n\t\t{\n\t\t\tisFactorValue(value) || isMemoryValue(value)\n\t\t\t\t? <ArithmeticSelect aggregate={aggregate} value={value} right={true} onChange={onArithmeticChange}/>\n\t\t\t\t: null\n\t\t}\n\t</Container>;\n};","import { v4 } from 'uuid';\nimport {\n\tAggregateArithmetic,\n\tConditionOperator,\n\tDatePartArithmetic,\n\tNoArithmetic,\n\tNumericArithmetic,\n\tSimpleFuncArithmetic,\n\tSystemActionType,\n\tUnitActionAlarmSeverity,\n\tUnitActionType\n} from '../../../../services/admin/pipeline-types';\nimport { ArrangedProcessUnit, ArrangedStage, ArrangedUnitAction } from '../types';\n\nexport const unitActionTypeAsDisplay = (type: UnitActionType): string => {\n\treturn type.split('-').map(word => {\n\t\tif ([ 'or', 'and', 'to', 'from' ].includes(word)) {\n\t\t\treturn word;\n\t\t} else {\n\t\t\treturn word.substr(0, 1).toUpperCase() + word.substr(1);\n\t\t}\n\t}).join(' ');\n};\n\nexport const createStage = (): ArrangedStage => {\n\treturn {\n\t\tuuid: v4(),\n\t\tname: '',\n\t\tunits: [ createAlarmUnit() ]\n\t};\n};\n\nexport const createAlarmUnit = (): ArrangedProcessUnit => {\n\treturn {\n\t\tuuid: v4(),\n\t\tdo: [ createAlarmAction() ]\n\t};\n};\n\nexport const createAlarmAction = (): ArrangedUnitAction => {\n\treturn {\n\t\tuuid: v4(),\n\t\ttype: SystemActionType.ALARM,\n\t\tseverity: UnitActionAlarmSeverity.MEDIUM\n\t} as ArrangedUnitAction;\n};\n\nconst OperatorLabels: { [key in ConditionOperator]: string } = {\n\t[ConditionOperator.EMPTY]: 'Is Empty',\n\t[ConditionOperator.NOT_EMPTY]: 'Is Not Empty',\n\t[ConditionOperator.EQUALS]: '=',\n\t[ConditionOperator.NOT_EQUALS]: '',\n\t[ConditionOperator.LESS]: '<',\n\t[ConditionOperator.LESS_EQUALS]: '',\n\t[ConditionOperator.MORE]: '>',\n\t[ConditionOperator.MORE_EQUALS]: '',\n\t[ConditionOperator.IN]: 'In',\n\t[ConditionOperator.NOT_IN]: 'Not In'\n};\nexport const asDisplayOperator = (operator: ConditionOperator): string => OperatorLabels[operator];\nconst ArithmeticLabels: { [key in SimpleFuncArithmetic]: string } = {\n\t[NoArithmetic.NO_FUNC]: '',\n\t[DatePartArithmetic.YEAR_OF]: 'Year',\n\t[DatePartArithmetic.MONTH_OF]: 'Month',\n\t[DatePartArithmetic.WEEK_OF]: 'WeekOfYear',\n\t[DatePartArithmetic.WEEKDAY]: 'Weekday',\n\t[NumericArithmetic.PERCENTAGE]: 'Percentage',\n\t[NumericArithmetic.ABSOLUTE_VALUE]: 'Abs',\n\t[NumericArithmetic.LOGARITHM]: 'Log',\n\t[AggregateArithmetic.SUM]: 'Summary',\n\t[AggregateArithmetic.AVG]: 'Average',\n\t[AggregateArithmetic.COUNT]: 'Count',\n\t[AggregateArithmetic.MEDIAN]: 'Median',\n\t[AggregateArithmetic.MAX]: 'Maximum',\n\t[AggregateArithmetic.MIN]: 'Minimum'\n};\nexport const asDisplayArithmetic = (arithmetic: SimpleFuncArithmetic): string => ArithmeticLabels[arithmetic];\n","import { faTrashAlt } from '@fortawesome/free-regular-svg-icons';\nimport { faCompressAlt, faExpandAlt, faLongArrowAltLeft, faLongArrowAltRight } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { useEffect, useRef, useState } from 'react';\nimport styled from 'styled-components';\nimport { useCollapseFixedThing, useForceUpdate } from '../../../../../common/utils';\nimport {\n\tCompositeCondition,\n\tCompositeMode,\n\tFactorValue,\n\tNoArithmetic,\n\tPlainCondition,\n\tSomeValueType\n} from '../../../../../services/admin/pipeline-types';\nimport { QueriedTopicForPipeline } from '../../../../../services/admin/types';\nimport { usePipelineContext } from '../../pipeline-context';\nimport { ConditionOperatorSelect } from '../components/condition-operator-select';\nimport { FacterValueFinder } from '../components/facter-value-finder';\nimport { FactorFinder } from '../components/factor-finder';\nimport { isFactorValue, isMemoryValue } from '../components/utils';\nimport { PipelineUnitActionEvent, usePipelineUnitActionContext } from '../pipeline-unit-action-context';\nimport { asDisplayArithmetic, asDisplayOperator } from '../utils';\n\ninterface DropdownRect {\n\ttop: number;\n\tleft: number;\n\twidth: number;\n\tatTop: boolean;\n}\n\nconst Container = styled.div.attrs({\n\t'data-widget': 'plain-condition'\n})`\n\tdisplay: flex;\n\talign-items: center;\n\tposition: relative;\n\theight: 32px;\n\t&:before,\n\t&:after {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\tbackground-color: var(--border-color);\n\t}\n\t&:before {\n\t\ttop: 16px;\n\t\tleft: calc(var(--margin) / -2);\n\t\twidth: calc(var(--margin) / 2 - 4px);\n\t\theight: 1px;\n\t}\n\t&:after {\n\t\ttop: 0;\n\t\tleft: calc(var(--margin) / -2);\n\t\twidth: 1px;\n\t\theight: 16px;\n\t}\n\t&:not(:last-child):after {\n\t\theight: 100%;\n\t}\n`;\nconst DisplayLabel = styled.div`\n\tdisplay: flex;\n\tposition: relative;\n\tjustify-self: flex-start;\n\tborder-radius: 12px;\n\tbackground-color: transparent;\n\theight: 22px;\n\tline-height: 22px;\n\toutline: none;\n\tappearance: none;\n\twhite-space: nowrap;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\tcursor: pointer;\n\ttransition: all 300ms ease-in-out;\n\t&[data-expanded=true],\n\t&:hover {\n\t\tbackground-color: var(--pipeline-bg-color);\n\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t\t> div:first-child {\n\t\t\tpadding-left: calc(var(--margin) / 2);\n\t\t}\n\t\t> div:not(:first-child) {\n\t\t\topacity: 1;\n\t\t\tpointer-events: auto;\n\t\t}\n\t}\n\t&[data-expanded=true] > div:nth-child(2) > svg {\n\t\ttransform: rotateZ(180deg);\n\t}\n\t> div:first-child {\n\t\tflex-grow: 1;\n\t\tposition: relative;\n\t\tfont-weight: var(--font-bold);\n\t\tfont-variant: petite-caps;\n\t\tborder-top-left-radius: 12px;\n\t\tborder-bottom-left-radius: 12px;\n\t\ttransition: all 300ms ease-in-out;\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t}\n\t> div:not(:first-child) {\n\t\tposition: relative;\n\t\tpadding: 0 calc(var(--margin) / 3);\n\t\topacity: 0;\n\t\tpointer-events: none;\n\t\ttransition: all 300ms ease-in-out;\n\t\t> svg {\n\t\t\tfont-size: 0.8em;\n\t\t\ttransition: all 300ms ease-in-out;\n\t\t}\n\t\t&:not(:nth-child(2)):before {\n\t\t\tcontent: '';\n\t\t\tdisplay: block;\n\t\t\tposition: absolute;\n\t\t\tleft: 0;\n\t\t\ttop: 20%;\n\t\t\twidth: 1px;\n\t\t\theight: 60%;\n\t\t\tbackground-color: var(--border-color);\n\t\t}\n\t}\n`;\nconst DropdownHeight = 120;\nconst Dropdown = styled.div.attrs<DropdownRect>(({ top, left, width, atTop }) => {\n\treturn {\n\t\tstyle: {\n\t\t\ttop, left, minWidth: Math.max(width, 600),\n\t\t\ttransformOrigin: atTop ? 'bottom' : 'top'\n\t\t}\n\t};\n})<DropdownRect>`\n\tdisplay: flex;\n\tposition: fixed;\n\tflex-direction: column;\n\tz-index: 1000;\n\theight: ${DropdownHeight}px;\n\tpadding: 0 calc(var(--margin) / 2);\n\ttransform: scaleY(0);\n\ttransition: transform 300ms ease-in-out;\n\tpointer-events: none;\n\tbackground-color: var(--bg-color);\n\tborder-radius: calc(var(--border-radius) * 3);\n\tbox-shadow: var(--console-primary-hover-shadow);\n\t&[data-expanded=true] {\n\t\ttransform: none;\n\t\tpointer-events: auto;\n\t}\n\t> div {\n\t\theight: 28px;\n\t\t&:first-child {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\theight: 32px;\n\t\t\tbackground-color: var(--pipeline-bg-color);\n\t\t\tmargin: 0 calc(var(--margin) / -2) 2px;\n\t\t\tpadding: 0 calc(var(--margin) / 2);\n\t\t\tfont-weight: var(--font-bold);\n\t\t}\n\t\t&:last-child {\n\t\t\tmargin-bottom: 2px;\n\t\t}\n\t}\n`;\nconst LeftAsFactorContainer = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\t> div:first-child {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\theight: 22px;\n\t\tpadding: 0 calc(var(--margin) / 2);\n\t\tfont-variant: petite-caps;\n\t\tfont-weight: var(--font-demi-bold);\n\t\tbackground-color: var(--pipeline-bg-color);\n\t\tbox-shadow: 0 0 0 1px var(--border-color);\n\t\tborder-top-left-radius: var(--border-radius);\n\t\tborder-bottom-left-radius: var(--border-radius);\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t}\n\t> div:nth-child(2) {\n\t\tflex-grow: 1;\n\t\tborder-top-left-radius: 0;\n\t\tborder-bottom-left-radius: 0;\n\t\tbox-shadow: 0 1px 0 0 var(--border-color), 0 -1px 0 0 var(--border-color), 1px 0 0 0 var(--border-color);\n\t\t&:hover {\n\t\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t\t}\n\t\t> input {\n\t\t\tborder-top-left-radius: 0;\n\t\t\tborder-bottom-left-radius: 0;\n\t\t}\n\t}\n`;\nconst OperatorAndRightContainer = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n`;\n\nconst buildLabel = (options: {\n\ttopic?: QueriedTopicForPipeline;\n\tcondition: PlainCondition;\n\ttopics: Array<QueriedTopicForPipeline>;\n}) => {\n\tconst { topic, condition, topics } = options;\n\n\tlet label = '';\n\tif (topic) {\n\t\tconst left = condition.left as FactorValue;\n\t\t// eslint-disable-next-line\n\t\tif (left.topicId != topic.topicId) {\n\t\t\t// topic changed\n\t\t\tleft.topicId = topic.topicId;\n\t\t\tdelete left.factorId;\n\t\t}\n\t\tlabel += `${topic.name}.`;\n\t\tif (left.factorId) {\n\t\t\t// eslint-disable-next-line\n\t\t\tconst factor = topic.factors.find(factor => factor.factorId == left.factorId);\n\t\t\tlabel += factor ? factor.label : '?';\n\t\t} else {\n\t\t\tlabel += '?';\n\t\t}\n\t}\n\tlabel += ` ${asDisplayOperator(condition.operator)} `;\n\n\tlet right = '';\n\tif (isFactorValue(condition.right)) {\n\t\tconst topicId = condition.right.topicId;\n\t\t// eslint-disable-next-line\n\t\tconst topic = topicId ? topics.find(topic => topic.topicId == topicId) : null;\n\t\tif (topic) {\n\t\t\tright += `${topic.name}.`;\n\t\t\tconst factorId = condition.right.factorId;\n\t\t\t// eslint-disable-next-line\n\t\t\tconst factor = factorId ? topic.factors.find(factor => factor.factorId == factorId) : null;\n\t\t\tif (factor) {\n\t\t\t\tright += factor.label;\n\t\t\t} else {\n\t\t\t\tright += '?';\n\t\t\t}\n\t\t} else {\n\t\t\tright += '?.?';\n\t\t}\n\t} else if (isMemoryValue(condition.right)) {\n\t\tright += `Memory Context.${condition.right.name || '?'}`;\n\t}\n\n\tconst arithmetic = asDisplayArithmetic(condition.right.arithmetic);\n\tif (arithmetic) {\n\t\tright = `${arithmetic}(${right})`;\n\t}\n\n\treturn label + right;\n};\n\nconst Statement = (props: {\n\ttopic?: QueriedTopicForPipeline;\n\tcondition: PlainCondition;\n}) => {\n\tconst { topic, condition } = props;\n\n\tconst { store: { topics } } = usePipelineContext();\n\tconst { addPropertyChangeListener, removePropertyChangeListener } = usePipelineUnitActionContext();\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\taddPropertyChangeListener(PipelineUnitActionEvent.FILTER_CHANGED, forceUpdate);\n\t\treturn () => removePropertyChangeListener(PipelineUnitActionEvent.FILTER_CHANGED, forceUpdate);\n\t});\n\n\treturn <div>{buildLabel({ topic, condition, topics })}</div>;\n};\n\nconst fillCondition = (options: {\n\tcondition: PlainCondition;\n\ttopic?: QueriedTopicForPipeline,\n\tselectedTopic?: QueriedTopicForPipeline\n}) => {\n\tconst { condition, topic, selectedTopic } = options;\n\n\tif (!condition.left) {\n\t\tcondition.left = { arithmetic: NoArithmetic.NO_FUNC };\n\t\tif (topic) {\n\t\t\tcondition.left.type = SomeValueType.FACTOR;\n\t\t\t(condition.left as FactorValue).topicId = topic.topicId;\n\t\t} else {\n\t\t\tcondition.left.type = SomeValueType.IN_MEMORY;\n\t\t}\n\t}\n\tif (!condition.right) {\n\t\t// right part comes from memory or pipeline source target\n\t\tcondition.right = {\n\t\t\ttype: SomeValueType.FACTOR,\n\t\t\ttopicId: selectedTopic?.topicId,\n\t\t\tarithmetic: NoArithmetic.NO_FUNC\n\t\t} as FactorValue;\n\t}\n};\n\nexport const PlainConditionRow = (props: {\n\tleft?: QueriedTopicForPipeline;\n\tgrandParent?: CompositeCondition;\n\tparent: CompositeCondition;\n\tcondition: PlainCondition;\n}) => {\n\tconst { left: topic, grandParent: grandParentCondition, parent: parentCondition, condition } = props;\n\n\tconst { store: { selectedTopic } } = usePipelineContext();\n\tconst { firePropertyChange } = usePipelineUnitActionContext();\n\n\tconst topContainerRef = useRef<HTMLDivElement>(null);\n\tconst containerRef = useRef<HTMLDivElement>(null);\n\tconst dropdownRef = useRef<HTMLDivElement>(null);\n\tconst [ expanded, setExpanded ] = useState(false);\n\tconst [ dropdownRect, setDropdownRect ] = useState<DropdownRect>({ top: 0, left: 0, width: 0, atTop: false });\n\tuseCollapseFixedThing(topContainerRef, () => setExpanded(false));\n\n\tfillCondition({ condition, topic, selectedTopic });\n\n\tconst onExpandClick = () => {\n\t\tif (!expanded) {\n\t\t\tconst rect = containerRef.current!.getBoundingClientRect();\n\t\t\tconst top = rect.top + rect.height + 2;\n\t\t\tconst bottom = top + DropdownHeight;\n\t\t\tif (bottom > window.innerHeight) {\n\t\t\t\tsetDropdownRect({\n\t\t\t\t\ttop: rect.top - DropdownHeight - 2,\n\t\t\t\t\tleft: rect.left,\n\t\t\t\t\twidth: rect.width,\n\t\t\t\t\tatTop: true\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tsetDropdownRect({ top, left: rect.left, width: rect.width, atTop: false });\n\t\t\t}\n\t\t\tsetExpanded(true);\n\t\t}\n\t};\n\tconst onOutdentClicked = (event: React.MouseEvent<HTMLDivElement>) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tif (!grandParentCondition || !parentCondition) {\n\t\t\treturn;\n\t\t}\n\t\tconst indexInParent = parentCondition.children.findIndex(child => child === condition);\n\t\tconst indexInGrand = grandParentCondition.children.findIndex(child => child === parentCondition);\n\t\t// remove from parent\n\t\tparentCondition.children.splice(indexInParent, 1);\n\t\t// add into grand, after parent\n\t\tgrandParentCondition.children.splice(indexInGrand + 1, 0, condition);\n\t\tfirePropertyChange(PipelineUnitActionEvent.FILTER_OUTDENT);\n\t};\n\tconst onIndentClicked = (event: React.MouseEvent<HTMLDivElement>) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tconst newParent: CompositeCondition = { mode: CompositeMode.AND, children: [ condition ] };\n\t\tconst mode = parentCondition.mode;\n\t\tif (mode === CompositeMode.AND) {\n\t\t\tnewParent.mode = CompositeMode.OR;\n\t\t}\n\t\tconst index = parentCondition.children.findIndex(child => child === condition);\n\t\tparentCondition.children.splice(index, 1, newParent);\n\t\tfirePropertyChange(PipelineUnitActionEvent.FILTER_INDENT);\n\t};\n\tconst onRemoveClicked = (event: React.MouseEvent<HTMLDivElement>) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tif (!parentCondition) {\n\t\t\treturn;\n\t\t}\n\t\tconst index = parentCondition.children.findIndex(child => child === condition);\n\t\tparentCondition.children.splice(index, 1);\n\t\tfirePropertyChange(PipelineUnitActionEvent.FILTER_REMOVED);\n\t};\n\tconst onFilterChange = () => firePropertyChange(PipelineUnitActionEvent.FILTER_CHANGED);\n\n\treturn <Container ref={topContainerRef}>\n\t\t<DisplayLabel ref={containerRef} tabIndex={0} data-expanded={expanded}\n\t\t              onClick={onExpandClick}>\n\t\t\t<Statement topic={topic} condition={condition}/>\n\t\t\t<div><FontAwesomeIcon icon={expanded ? faCompressAlt : faExpandAlt}/></div>\n\t\t\t{!!grandParentCondition ?\n\t\t\t\t<div onClick={onOutdentClicked}><FontAwesomeIcon icon={faLongArrowAltLeft}/></div> : null}\n\t\t\t<div onClick={onIndentClicked}><FontAwesomeIcon icon={faLongArrowAltRight}/></div>\n\t\t\t<div onClick={onRemoveClicked}><FontAwesomeIcon icon={faTrashAlt}/></div>\n\t\t</DisplayLabel>\n\t\t<Dropdown ref={dropdownRef} data-expanded={expanded} {...dropdownRect}>\n\t\t\t<div>Expression Setting</div>\n\t\t\t{isFactorValue(condition.left)\n\t\t\t\t? <LeftAsFactorContainer>\n\t\t\t\t\t<div>Topic: {topic?.name}</div>\n\t\t\t\t\t<FactorFinder holder={condition.left} onChange={onFilterChange}/>\n\t\t\t\t</LeftAsFactorContainer>\n\t\t\t\t: null}\n\t\t\t<OperatorAndRightContainer>\n\t\t\t\t<ConditionOperatorSelect condition={condition} onChange={onFilterChange}/>\n\t\t\t</OperatorAndRightContainer>\n\t\t\t<FacterValueFinder holder={condition.right}\n\t\t\t                   onTopicChange={onFilterChange} onFactorChange={onFilterChange}\n\t\t\t                   onVariableChange={onFilterChange}\n\t\t\t                   onArithmeticChange={onFilterChange}\n\t\t\t                   aggregate={false}/>\n\t\t</Dropdown>\n\t</Container>;\n};\n\n","import { faTrashAlt } from '@fortawesome/free-regular-svg-icons';\nimport { faChevronDown, faLongArrowAltLeft, faLongArrowAltRight, faPlus } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { useState } from 'react';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../../../common/utils';\nimport {\n\tCompositeCondition,\n\tCompositeMode,\n\tConditionOperator,\n\tPlainCondition\n} from '../../../../../services/admin/pipeline-types';\nimport { QueriedTopicForPipeline } from '../../../../../services/admin/types';\nimport { HorizontalOptions } from '../components/horizontal-options';\nimport { computeConditionLines, isCompositeCondition } from '../components/utils';\nimport { PipelineUnitActionEvent, usePipelineUnitActionContext } from '../pipeline-unit-action-context';\nimport { PlainConditionRow } from './plain-condition-row';\n\nconst Container = styled.div.attrs({\n\t'data-widget': 'composite-condition'\n})`\n\tdisplay: flex;\n\tposition: relative;\n\tflex-direction: column;\n\t&[data-removable=true] {\n\t\t&:before,\n\t\t&:after {\n\t\t\tcontent: '';\n\t\t\tdisplay: block;\n\t\t\tposition: absolute;\n\t\t\tbackground-color: var(--border-color);\n\t\t}\n\t\t&:before {\n\t\t\ttop: 16px;\n\t\t\tleft: calc(var(--margin) / -2);\n\t\t\twidth: calc(var(--margin) / 2 - 4px);\n\t\t\theight: 1px;\n\t\t}\n\t\t&:after {\n\t\t\ttop: 0;\n\t\t\tleft: calc(var(--margin) / -2);\n\t\t\twidth: 1px;\n\t\t\theight: 16px;\n\t\t}\n\t\t&:not(:last-child):after {\n\t\t\theight: 100%;\n\t\t}\n\t}\n`;\nconst Title = styled.div.attrs({\n\t'data-widget': 'composite-condition-title'\n})`\n\tdisplay: grid;\n\tgrid-template-columns: auto auto auto 1fr;\n\theight: 32px;\n\tmin-height: 32px;\n\talign-items: center;\n\ttransition: all 300ms ease-in-out;\n\t&:hover {\n\t\t> div:nth-child(3) {\n\t\t\tborder-top-right-radius: 0;\n\t\t\tborder-bottom-right-radius: 0;\n\t\t}\n\t\t> div:nth-child(4) {\n\t\t\topacity: 1;\n\t\t\tpointer-events: auto;\n\t\t}\n\t}\n\t&[data-expanded=false] {\n\t\t> div:first-child > svg {\n\t\t\ttransform: rotateZ(-90deg);\n\t\t}\n\t\t+ div {\n\t\t\tmin-height: 0;\n\t\t\theight: 0;\n\t\t}\n\t}\n\t> div:first-child {\n\t\tdisplay: flex;\n\t\twidth: var(--margin);\n\t\tjustify-content: center;\n\t\tcursor: pointer;\n\t\t> svg {\n\t\t\topacity: 0.7;\n\t\t\ttransition: all 300ms ease-in-out;\n\t\t}\n\t}\n\t> div:nth-child(2) {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\theight: 22px;\n\t\tfont-variant: petite-caps;\n\t\tfont-weight: var(--font-demi-bold);\n\t\tborder-top-left-radius: 11px;\n\t\tborder-bottom-left-radius: 11px;\n\t\tpadding: 0 calc(var(--margin) / 3);\n\t\tbackground-color: var(--pipeline-bg-color);\n\t\tbox-shadow: 0 1px 0 0 var(--border-color), 0 -1px 0 0 var(--border-color), -1px 0 0 0 var(--border-color);\n\t}\n\t> div:nth-child(3) {\n\t\tfont-variant: petite-caps;\n\t\tfont-weight: var(--font-demi-bold);\n\t\ttext-transform: capitalize;\n\t\tborder-top-left-radius: 0;\n\t\tborder-bottom-left-radius: 0;\n\t}\n\t> div:nth-child(4) {\n\t\tdisplay: flex;\n\t\tjustify-self: start;\n\t\tcursor: pointer;\n\t\tborder-top-right-radius: 11px;\n\t\tborder-bottom-right-radius: 11px;\n\t\tbackground-color: var(--pipeline-bg-color);\n\t\topacity: 0;\n\t\tpointer-events: none;\n\t\ttransition: all 300ms ease-in-out;\n\t\t> div {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tjustify-content: center;\n\t\t\theight: 22px;\n\t\t\tbox-shadow: 0 1px 0 0 var(--border-color), 0 -1px 0 0 var(--border-color), 1px 0 0 0 var(--border-color);\n\t\t\tpadding: 0 calc(var(--margin) / 3);\n\t\t\tfont-size: 0.8em;\n\t\t\ttransition: all 300ms ease-in-out;\n\t\t\t&:hover {\n\t\t\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t\t\t\tpointer-events: auto;\n\t\t\t}\n\t\t\t&:last-child {\n\t\t\t\tborder-top-right-radius: 11px;\n\t\t\t\tborder-bottom-right-radius: 11px;\n\t\t\t}\n\t\t}\n\t}\n`;\nconst NoChild = styled.div.attrs({\n\t'data-widget': 'composite-condition-no-child'\n})`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\tpadding: 0 var(--margin);\n\tmin-height: 32px;\n\theight: 32px;\n\toverflow: hidden;\n\ttransition: all 300ms ease-in-out;\n\t&:before,\n\t&:after {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\tbackground-color: var(--border-color);\n\t}\n\t&:before {\n\t\ttop: 16px;\n\t\tleft: calc(var(--margin) / 2);\n\t\twidth: calc(var(--margin) / 2 - 4px);\n\t\theight: 1px;\n\t}\n\t&:after {\n\t\ttop: 0;\n\t\tleft: calc(var(--margin) / 2);\n\t\twidth: 1px;\n\t\theight: 16px;\n\t}\n`;\nconst ChildConditionsNode = styled.div.attrs<{ count: number, visible: boolean }>(\n\t({ count, visible }) => {\n\t\treturn {\n\t\t\t'data-widget': 'composite-condition-children',\n\t\t\tstyle: {\n\t\t\t\tmaxHeight: visible ? count * 32 : 0,\n\t\t\t\ttransform: visible ? 'none' : 'rotateX(90deg)'\n\t\t\t}\n\t\t};\n\t})<{ count: number, visible: boolean }>`\n\tdisplay: flex;\n\tflex-direction: column;\n\tpadding-left: var(--margin);\n\ttransform-origin: top;\n\ttransition: all 300ms ease-in-out;\n`;\n\nconst ChildConditions = (props: {\n\tleft?: QueriedTopicForPipeline;\n\tparent?: CompositeCondition;\n\tcondition: CompositeCondition;\n\tvisible: boolean;\n\tlevel: number;\n}) => {\n\tconst { left: topic, parent: parentCondition, condition, visible, level } = props;\n\n\tconst lines = computeConditionLines(condition) - 1;\n\n\treturn <ChildConditionsNode visible={visible} count={lines}>\n\t\t{condition.children.map((child, index) => {\n\t\t\tif (isCompositeCondition(child)) {\n\t\t\t\treturn <CompositeConditionRow left={topic}\n\t\t\t\t                              grandParent={parentCondition} parent={condition} condition={child}\n\t\t\t\t                              removable={true} level={level}\n\t\t\t\t                              key={index}/>;\n\t\t\t} else {\n\t\t\t\tconst plain = child as PlainCondition;\n\t\t\t\treturn <PlainConditionRow left={topic}\n\t\t\t\t                          grandParent={parentCondition} parent={condition} condition={plain}\n\t\t\t\t                          key={index}/>;\n\t\t\t}\n\t\t})}\n\t</ChildConditionsNode>;\n};\n\nexport const CompositeConditionRow = (props: {\n\tleft?: QueriedTopicForPipeline;\n\tgrandParent?: CompositeCondition;\n\tparent?: CompositeCondition;\n\tcondition: CompositeCondition;\n\tremovable: boolean;\n\tlevel: number;\n}) => {\n\tconst {\n\t\tleft: topic,\n\t\tgrandParent: grandParentCondition,\n\t\tparent: parentCondition,\n\t\tcondition,\n\t\tremovable,\n\t\tlevel\n\t} = props;\n\n\tconst { firePropertyChange } = usePipelineUnitActionContext();\n\tconst [ expanded, setExpanded ] = useState(true);\n\tconst forceUpdate = useForceUpdate();\n\n\tconst label = condition.mode;\n\tconst onToggleExpandedClicked = () => setExpanded(!expanded);\n\tconst onSelect = (mode: CompositeMode) => {\n\t\tcondition.mode = mode;\n\t\tfirePropertyChange(PipelineUnitActionEvent.FACTOR_CHANGED);\n\t\tforceUpdate();\n\t};\n\tconst onAddSubFilterClicked = () => {\n\t\tcondition.children.push({ operator: ConditionOperator.EQUALS });\n\t\texpanded ? forceUpdate() : setExpanded(true);\n\t\tfirePropertyChange(PipelineUnitActionEvent.FILTER_ADDED);\n\t};\n\tconst onOutdentClicked = () => {\n\t\tif (!grandParentCondition || !parentCondition) {\n\t\t\treturn;\n\t\t}\n\t\tconst indexInParent = parentCondition.children.findIndex(child => child === condition);\n\t\tconst indexInGrand = grandParentCondition.children.findIndex(child => child === parentCondition);\n\t\t// remove from parent\n\t\tparentCondition.children.splice(indexInParent, 1);\n\t\t// add into grand, after parent\n\t\tgrandParentCondition.children.splice(indexInGrand + 1, 0, condition);\n\t\tfirePropertyChange(PipelineUnitActionEvent.FILTER_OUTDENT);\n\t};\n\tconst onIndentClicked = (event: React.MouseEvent<HTMLDivElement>) => {\n\t\tif (!parentCondition) {\n\t\t\treturn;\n\t\t}\n\t\tconst newParent: CompositeCondition = { mode: CompositeMode.AND, children: [ condition ] };\n\t\tconst mode = parentCondition.mode;\n\t\tif (mode === CompositeMode.AND) {\n\t\t\tnewParent.mode = CompositeMode.OR;\n\t\t}\n\t\tconst index = parentCondition.children.findIndex(child => child === condition);\n\t\tparentCondition.children.splice(index, 1, newParent);\n\t\tfirePropertyChange(PipelineUnitActionEvent.FILTER_INDENT);\n\t};\n\tconst onRemoveClicked = () => {\n\t\tif (!parentCondition) {\n\t\t\treturn;\n\t\t}\n\t\tconst index = parentCondition.children.findIndex(child => child === condition);\n\t\tparentCondition.children.splice(index, 1);\n\t\tfirePropertyChange(PipelineUnitActionEvent.FILTER_REMOVED);\n\t};\n\n\treturn <Container data-expanded={expanded} data-removable={removable}>\n\t\t<Title data-expanded={expanded}>\n\t\t\t<div onClick={onToggleExpandedClicked}><FontAwesomeIcon icon={faChevronDown}/></div>\n\t\t\t<div>Lv{level}</div>\n\t\t\t<HorizontalOptions label={label}\n\t\t\t                   options={[ CompositeMode.AND, CompositeMode.OR ].filter(x => x !== condition.mode)}\n\t\t\t                   toLabel={(mode: CompositeMode) => mode}\n\t\t\t                   onSelect={onSelect}/>\n\t\t\t<div>\n\t\t\t\t<div onClick={onAddSubFilterClicked}>\n\t\t\t\t\t<FontAwesomeIcon icon={faPlus}/>\n\t\t\t\t</div>\n\t\t\t\t{!!grandParentCondition\n\t\t\t\t\t? <div onClick={onOutdentClicked}>\n\t\t\t\t\t\t<FontAwesomeIcon icon={faLongArrowAltLeft}/>\n\t\t\t\t\t</div>\n\t\t\t\t\t: null}\n\t\t\t\t{removable\n\t\t\t\t\t? <div onClick={onIndentClicked}>\n\t\t\t\t\t\t<FontAwesomeIcon icon={faLongArrowAltRight}/>\n\t\t\t\t\t</div>\n\t\t\t\t\t: null}\n\t\t\t\t{removable\n\t\t\t\t\t? <div onClick={onRemoveClicked}>\n\t\t\t\t\t\t<FontAwesomeIcon icon={faTrashAlt}/>\n\t\t\t\t\t</div>\n\t\t\t\t\t: null}\n\t\t\t</div>\n\t\t</Title>\n\t\t{condition.children.length === 0\n\t\t\t? <NoChild>No Child Defined.</NoChild>\n\t\t\t: <ChildConditions left={topic} parent={parentCondition} condition={condition} visible={expanded}\n\t\t\t                   level={level + 1}/>}\n\t</Container>;\n};\n","import { faCompressArrowsAlt, faExpandArrowsAlt } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { useEffect, useState } from 'react';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../../../common/utils';\nimport { CompositeMode, FindBy, TopicHolder } from '../../../../../services/admin/pipeline-types';\nimport { QueriedTopicForPipeline } from '../../../../../services/admin/types';\nimport { usePipelineContext } from '../../pipeline-context';\nimport { computeConditionCount, computeConditionLines } from '../components/utils';\nimport { PipelineUnitActionEvent, usePipelineUnitActionContext } from '../pipeline-unit-action-context';\nimport { CompositeConditionRow } from './composite-condition-row';\n\nconst Container = styled.div`\n\tdisplay: flex;\n\tflex-direction: column;\n`;\nconst ToggleLine = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\theight: 32px;\n`;\nconst ToggleButton = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-self: start;\n\theight: 22px;\n\tborder-radius: 11px;\n\tbackground-color: var(--pipeline-bg-color);\n\tcursor: pointer;\n\tbox-shadow: 0 0 0 1px var(--border-color);\n\ttransition: all 300ms ease-in-out;\n\t&:hover {\n\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t}\n\t&[data-expanded=true] > svg {\n\t\ttransform: rotateZ(180deg);\n\t}\n\t> span {\n\t\tpadding-left: calc(var(--margin) / 2);\n\t\tfont-variant: petite-caps;\n\t\tfont-weight: var(--font-demi-bold);\n\t}\n\t> svg:nth-child(2) {\n\t\tfont-size: 0.9em;\n\t\tmargin: 0 calc(var(--margin) / 3);\n\t\ttransition: all 300ms ease-in-out;\n\t}\n`;\nconst FilterContent = styled.div.attrs<{ lines: number, expanded: boolean }>(\n\t({ lines, expanded }) => {\n\t\treturn {\n\t\t\tstyle: {\n\t\t\t\tmaxHeight: expanded ? lines * 32 : 0,\n\t\t\t\ttransform: expanded ? 'none' : 'rotateX(90deg)'\n\t\t\t}\n\t\t};\n\t})<{ lines: number, expanded: boolean }>`\n\tdisplay: flex;\n\tflex-direction: column;\n\tflex-grow: 1;\n\ttransform-origin: top;\n\ttransition: all 300ms ease-in-out;\n\t&::-webkit-scrollbar {\n\t\tbackground-color: transparent;\n\t\twidth: 4px;\n\t}\n\t&::-webkit-scrollbar-track {\n\t\tbackground-color: transparent;\n\t\tborder-radius: 2px;\n\t}\n\t&::-webkit-scrollbar-thumb {\n\t\tbackground-color: var(--console-favorite-color);\n\t\tborder-radius: 2px;\n\t}\n`;\n\nconst FilterLabel = (props: { topic?: QueriedTopicForPipeline, count: number }) => {\n\tconst { topic, count } = props;\n\n\tif (topic) {\n\t\tif (count === 0) {\n\t\t\treturn <span>No Filter Defined</span>;\n\t\t} else if (count === 1) {\n\t\t\treturn <span>1 Filter</span>;\n\t\t} else {\n\t\t\treturn <span>{count} Filters</span>;\n\t\t}\n\t} else {\n\t\treturn <span>Pick Topic First</span>;\n\t}\n};\n\nexport const TopicRowMatcher = (props: {\n\tholder: TopicHolder & FindBy,\n}) => {\n\tconst { holder } = props;\n\n\tconst { store: { topics } } = usePipelineContext();\n\tconst { addPropertyChangeListener, removePropertyChangeListener } = usePipelineUnitActionContext();\n\tconst [ expanded, setExpanded ] = useState(false);\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\taddPropertyChangeListener(PipelineUnitActionEvent.TOPIC_CHANGED, forceUpdate);\n\t\taddPropertyChangeListener(PipelineUnitActionEvent.FILTER_ADDED, forceUpdate);\n\t\taddPropertyChangeListener(PipelineUnitActionEvent.FILTER_REMOVED, forceUpdate);\n\t\taddPropertyChangeListener(PipelineUnitActionEvent.FILTER_INDENT, forceUpdate);\n\t\taddPropertyChangeListener(PipelineUnitActionEvent.FILTER_OUTDENT, forceUpdate);\n\t\treturn () => {\n\t\t\tremovePropertyChangeListener(PipelineUnitActionEvent.TOPIC_CHANGED, forceUpdate);\n\t\t\tremovePropertyChangeListener(PipelineUnitActionEvent.FILTER_ADDED, forceUpdate);\n\t\t\tremovePropertyChangeListener(PipelineUnitActionEvent.FILTER_REMOVED, forceUpdate);\n\t\t\tremovePropertyChangeListener(PipelineUnitActionEvent.FILTER_INDENT, forceUpdate);\n\t\t\tremovePropertyChangeListener(PipelineUnitActionEvent.FILTER_OUTDENT, forceUpdate);\n\t\t};\n\t});\n\n\t// eslint-disable-next-line\n\tconst topic = topics.find(topic => topic.topicId == holder.topicId);\n\n\tconst onToggleFilterSettingsClicked = () => {\n\t\tif (topic) {\n\t\t\tsetExpanded(!expanded);\n\t\t}\n\t};\n\n\tif (!holder.by) {\n\t\tholder.by = { mode: CompositeMode.AND, children: [] };\n\t}\n\n\tconst linesCount = computeConditionLines(holder.by);\n\tconst filtersCount = computeConditionCount(holder.by);\n\n\treturn <Container>\n\t\t<ToggleLine>\n\t\t\t<ToggleButton data-expanded={expanded} onClick={onToggleFilterSettingsClicked}>\n\t\t\t\t<FilterLabel topic={topic} count={filtersCount}/>\n\t\t\t\t<FontAwesomeIcon icon={expanded ? faCompressArrowsAlt : faExpandArrowsAlt}/>\n\t\t\t</ToggleButton>\n\t\t</ToggleLine>\n\t\t{topic\n\t\t\t? <FilterContent lines={linesCount} expanded={expanded}>\n\t\t\t\t<CompositeConditionRow left={topic} condition={holder.by} removable={false} level={1}/>\n\t\t\t</FilterContent>\n\t\t\t: null}\n\t</Container>;\n};","import React from 'react';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../../../common/utils';\nimport { FactorHolder, TopicHolder } from '../../../../../services/admin/pipeline-types';\nimport { QueriedFactorForPipeline, QueriedTopicForPipeline } from '../../../../../services/admin/types';\nimport { usePipelineContext } from '../../pipeline-context';\nimport { ItemFinder } from './item-finder';\nimport { filterFactor, filterTopic } from './utils';\n\nconst Container = styled.div`\n\tdisplay: flex;\n\t> div {\n\t\twidth: 50%;\n\t}\n\t> div:first-child {\n\t\twidth: calc(50% + 1px);\n\t\tborder-bottom-right-radius: 0;\n\t\tborder-top-right-radius: 0;\n\t\t> input {\n\t\t\tborder-radius: 0;\n\t\t}\n\t}\n\t> div:last-child {\n\t\tborder-bottom-left-radius: 0;\n\t\tborder-top-left-radius: 0;\n\t\tbox-shadow: 0 1px 0 0 var(--border-color), 0 -1px 0 0 var(--border-color), 1px 0 0 0 var(--border-color);\n\t\t&:hover {\n\t\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t\t}\n\t}\n`;\n\nexport const TopicFactorFinder = (props: {\n\tholder: TopicHolder & FactorHolder;\n\tonTopicChange: () => void;\n\tonFactorChange: () => void;\n}) => {\n\tconst { holder, onTopicChange, onFactorChange } = props;\n\n\tconst { topicId: currentTopicId, factorId: currentFactorId } = holder;\n\n\tconst { store: { topics } } = usePipelineContext();\n\tconst forceUpdate = useForceUpdate();\n\n\t// eslint-disable-next-line\n\tconst topic = currentTopicId ? topics.find(topic => topic.topicId == currentTopicId) : (void 0);\n\t// eslint-disable-next-line\n\tconst factor = currentFactorId ? (topic?.factors.find(factor => factor.factorId == currentFactorId)) : (void 0);\n\n\tconst asTopicLabel = (topic?: QueriedTopicForPipeline) => topic ? topic.name : '';\n\tconst filterTopics = (searchText: string) => filterTopic(topics, searchText);\n\tconst onTopicSelect = (topic: QueriedTopicForPipeline) => {\n\t\t// eslint-disable-next-line\n\t\tif (holder.topicId == topic.topicId) {\n\t\t\treturn;\n\t\t}\n\t\tholder.topicId = topic.topicId;\n\t\tonTopicChange();\n\t\tdelete holder.factorId;\n\t\tonFactorChange();\n\t\tforceUpdate();\n\t};\n\n\tconst asFactorLabel = (factor?: QueriedFactorForPipeline) => factor ? factor.label : '';\n\tconst filterFactors = (searchText: string) => filterFactor(topic?.factors || [], searchText);\n\tconst onFactorSelect = (factor: QueriedFactorForPipeline) => {\n\t\tholder.factorId = factor.factorId;\n\t\tonFactorChange();\n\t\tforceUpdate();\n\t};\n\n\treturn <Container>\n\t\t<ItemFinder typeChar='Topic' item={topic} asLabel={asTopicLabel} filterItems={filterTopics}\n\t\t            onSelect={onTopicSelect}/>\n\t\t<ItemFinder typeChar='Factor' item={factor} asLabel={asFactorLabel} filterItems={filterFactors}\n\t\t            onSelect={onFactorSelect}/>\n\t</Container>;\n\n};","import { EventEmitter } from 'events';\nimport React, { useState } from 'react';\nimport { PipelineUnitActionEvent, usePipelineUnitActionContext } from './pipeline-unit-action-context';\n\nexport enum PipelineUnitActionMappingEvent {\n\tFROM_CHANGED = 'from-changed',\n\tTO_CHANGED = 'to-changed'\n}\n\nexport type PropertyChangeListener = () => void;\n\nexport interface PipelineUnitActionMappingContextUsable {\n\tfirePropertyChange: (event: PipelineUnitActionMappingEvent) => void;\n\taddPropertyChangeListener: (event: PipelineUnitActionMappingEvent, listener: PropertyChangeListener) => void;\n\tremovePropertyChangeListener: (event: PipelineUnitActionMappingEvent, listener: PropertyChangeListener) => void;\n}\n\nexport interface PipelineUnitActionMappingContext extends PipelineUnitActionMappingContextUsable {\n}\n\nconst Context = React.createContext<PipelineUnitActionMappingContext>({} as PipelineUnitActionMappingContext);\nContext.displayName = 'PipelineUnitActionMappingContext';\n\nexport const PipelineUnitActionMappingContextProvider = (props: {\n\tchildren?: ((props: any) => React.ReactNode) | React.ReactNode;\n}) => {\n\tconst { children } = props;\n\n\tconst { firePropertyChange } = usePipelineUnitActionContext();\n\tconst [ emitter ] = useState<EventEmitter>(() => {\n\t\tconst emitter = new EventEmitter();\n\t\temitter.setMaxListeners(1000);\n\t\treturn emitter;\n\t});\n\n\treturn <Context.Provider value={{\n\t\tfirePropertyChange: (event) => {\n\t\t\temitter.emit(event);\n\t\t\tfirePropertyChange(PipelineUnitActionEvent.MAPPING_CHANGED);\n\t\t},\n\t\taddPropertyChangeListener: (event, listener) => emitter.on(event, listener),\n\t\tremovePropertyChangeListener: (event, listener) => emitter.off(event, listener)\n\t}}>{children}</Context.Provider>;\n};\n\nexport const usePipelineUnitActionMappingContext = () => {\n\treturn React.useContext(Context);\n};\n","import { faTrashAlt } from '@fortawesome/free-regular-svg-icons';\nimport {\n\tfaCompressAlt,\n\tfaCompressArrowsAlt,\n\tfaExpandAlt,\n\tfaExpandArrowsAlt,\n\tfaPlus,\n\tfaSortAlphaDown,\n\tfaSortAlphaUp\n} from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { useEffect, useRef, useState } from 'react';\nimport styled from 'styled-components';\nimport { useCollapseFixedThing, useForceUpdate } from '../../../../../common/utils';\nimport {\n\tFactorValue,\n\tMappingFactor,\n\tMappingRow,\n\tNoArithmetic,\n\tSomeValueType,\n\tTopicHolder\n} from '../../../../../services/admin/pipeline-types';\nimport { QueriedTopicForPipeline } from '../../../../../services/admin/types';\nimport { usePipelineContext } from '../../pipeline-context';\nimport { FacterValueFinder } from '../components/facter-value-finder';\nimport { FactorFinder } from '../components/factor-finder';\nimport { isFactorValue, isMemoryValue } from '../components/utils';\nimport { PipelineUnitActionEvent, usePipelineUnitActionContext } from '../pipeline-unit-action-context';\nimport {\n\tPipelineUnitActionMappingContextProvider,\n\tPipelineUnitActionMappingEvent,\n\tusePipelineUnitActionMappingContext\n} from '../pipeline-unit-action-mapping-context';\nimport { asDisplayArithmetic } from '../utils';\n\ninterface DropdownRect {\n\ttop: number;\n\tleft: number;\n\twidth: number;\n\tatTop: boolean;\n}\n\nconst Container = styled.div`\n\tdisplay: flex;\n\tflex-direction: column;\n`;\nconst ToggleLine = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\theight: 32px;\n`;\nconst ToggleButton = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-self: start;\n\theight: 22px;\n\tcursor: pointer;\n\ttransition: all 300ms ease-in-out;\n\t&[data-expanded=true] > span > svg {\n\t\ttransform: rotateZ(180deg);\n\t}\n\t&[data-can-sort=false] {\n\t\t> span {\n\t\t\tborder-top-right-radius: 11px;\n\t\t\tborder-bottom-right-radius: 11px;\n\t\t}\n\t\t> div:nth-last-child(-n + 2) {\n\t\t\topacity: 0;\n\t\t\tpointer-events: none;\n\t\t}\n\t}\n\t> span {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\theight: 22px;\n\t\tfont-variant: petite-caps;\n\t\tfont-weight: var(--font-demi-bold);\n\t\tpadding: 0 calc(var(--margin) / 3) 0 calc(var(--margin) / 2);\n\t\tborder-top-left-radius: 11px;\n\t\tborder-bottom-left-radius: 11px;\n\t\tbackground-color: var(--pipeline-bg-color);\n\t\tbox-shadow: 0 0 0 1px var(--border-color);\n\t\t&:hover {\n\t\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t\t}\n\t\t> svg {\n\t\t\tfont-size: 0.9em;\n\t\t\tmargin-left: calc(var(--margin) / 3);\n\t\t\ttransition: all 300ms ease-in-out;\n\t\t}\n\t}\n\t> div:nth-last-child(-n + 2) {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\theight: 22px;\n\t\tposition: relative;\n\t\tbackground-color: var(--pipeline-bg-color);\n\t\tbox-shadow: 1px 0 0 0 var(--border-color), 0 1px 0 0 var(--border-color), 0 -1px 0 0 var(--border-color);\n\t\topacity: 1;\n\t\tpointer-events: auto;\n\t\ttransition: all 300ms ease-in-out;\n\t\t&:hover {\n\t\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t\t}\n\t}\n\t> div:nth-last-child(2) {\n\t\tpadding: 0 calc(var(--margin) / 3);\n\t}\n\t> div:last-child {\n\t\tborder-top-right-radius: 11px;\n\t\tborder-bottom-right-radius: 11px;\n\t\tpadding: 0 calc(var(--margin) / 3);\n\t}\n\t//&:hover {\n\t//\tbox-shadow: var(--console-primary-hover-shadow);\n\t//}\n\t//&[data-expanded=true] > svg {\n\t//\ttransform: rotateZ(180deg);\n\t//}\n\t//> span {\n\t//\tpadding-left: calc(var(--margin) / 2);\n\t//\tfont-variant: petite-caps;\n\t//\tfont-weight: var(--font-demi-bold);\n\t//}\n\t//> svg:nth-child(2) {\n\t//\tfont-size: 0.9em;\n\t//\tmargin: 0 calc(var(--margin) / 3);\n\t//\ttransition: all 300ms ease-in-out;\n\t//}\n`;\nconst Body = styled.div.attrs<{ lines: number, expanded: boolean }>(\n\t({ lines, expanded }) => {\n\t\treturn {\n\t\t\tstyle: {\n\t\t\t\tmaxHeight: expanded ? Math.min((lines + 1) * 32, 352) : 0,\n\t\t\t\ttransform: expanded ? 'none' : 'rotateX(90deg)'\n\t\t\t}\n\t\t};\n\t})<{ lines: number, expanded: boolean }>`\n\tdisplay: flex;\n\tflex-direction: column;\n\tflex-grow: 1;\n\ttransform-origin: top;\n\ttransition: all 300ms ease-in-out;\n`;\nconst MappingRuleContent = styled.div.attrs<{ lines: number }>(({ lines }) => {\n\treturn {\n\t\t'data-scrolling': lines > 10\n\t};\n})<{ lines: number }>`\n\tdisplay: grid;\n\tposition: relative;\n\tgrid-template-columns: 32px calc(100% - 32px);\n\tgrid-auto-rows: 32px;\n\tflex-grow: 1;\n\tmax-height: 320px;\n\toverflow-y: auto;\n\t//padding: 10px 0;\n\t//margin: 10px 0;\n\t&::-webkit-scrollbar {\n\t\tbackground-color: transparent;\n\t\twidth: 4px;\n\t}\n\t&::-webkit-scrollbar-track {\n\t\tbackground-color: transparent;\n\t\tborder-radius: 2px;\n\t}\n\t&::-webkit-scrollbar-thumb {\n\t\tbackground-color: var(--console-favorite-color);\n\t\tborder-radius: 2px;\n\t}\n\t> div:nth-child(2n + 1) {\n\t\tposition: relative;\n\t\theight: 32px;\n\t\t&:before, &:after {\n\t\t\tcontent: '';\n\t\t\tdisplay: block;\n\t\t\tposition: absolute;\n\t\t\tleft: calc(var(--margin) / 2);\n\t\t\tbackground-color: var(--border-color);\n\t\t}\n\t\t&:before {\n\t\t\ttop: 0;\n\t\t\twidth: 1px;\n\t\t\theight: 100%;\n\t\t}\n\t\t&:after {\n\t\t\ttop: calc(var(--margin) / 2);\n\t\t\twidth: 10px;\n\t\t\theight: 1px;\n\t\t}\n\t}\n`;\nconst MappingRuleContainer = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-self: stretch;\n\theight: 32px;\n`;\nconst MappingRule = styled.div`\n\tdisplay: flex;\n\tposition: relative;\n\talign-self: center;\n\tjustify-self: start;\n\tborder-radius: 12px;\n\tbackground-color: transparent;\n\theight: 22px;\n\tline-height: 22px;\n\toutline: none;\n\tappearance: none;\n\twhite-space: nowrap;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\tcursor: pointer;\n\ttransition: all 300ms ease-in-out;\n\t&[data-expanded=true],\n\t&:hover {\n\t\tbackground-color: var(--pipeline-bg-color);\n\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t\t> div:first-child {\n\t\t\tpadding-left: calc(var(--margin) / 2);\n\t\t}\n\t\t> div:not(:first-child) {\n\t\t\topacity: 1;\n\t\t\tpointer-events: auto;\n\t\t}\n\t}\n\t&[data-expanded=true] > div:nth-child(2) > svg {\n\t\ttransform: rotateZ(180deg);\n\t}\n\t> div:first-child {\n\t\tposition: relative;\n\t\tfont-weight: var(--font-bold);\n\t\tfont-variant: petite-caps;\n\t\tborder-top-left-radius: 12px;\n\t\tborder-bottom-left-radius: 12px;\n\t\ttransition: all 300ms ease-in-out;\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t}\n\t> div:not(:first-child) {\n\t\tposition: relative;\n\t\tpadding: 0 calc(var(--margin) / 3);\n\t\topacity: 0;\n\t\tpointer-events: none;\n\t\ttransition: all 300ms ease-in-out;\n\t\t> svg {\n\t\t\tfont-size: 0.8em;\n\t\t\ttransition: all 300ms ease-in-out;\n\t\t}\n\t\t&:not(:nth-child(2)):before {\n\t\t\tcontent: '';\n\t\t\tdisplay: block;\n\t\t\tposition: absolute;\n\t\t\tleft: 0;\n\t\t\ttop: 20%;\n\t\t\twidth: 1px;\n\t\t\theight: 60%;\n\t\t\tbackground-color: var(--border-color);\n\t\t}\n\t}\n`;\nconst DropdownHeight = 120;\nconst Dropdown = styled.div.attrs<DropdownRect>(({ top, left, width, atTop }) => {\n\treturn {\n\t\tstyle: {\n\t\t\ttop, left, minWidth: Math.max(width, 600),\n\t\t\ttransformOrigin: atTop ? 'bottom' : 'top'\n\t\t}\n\t};\n})<DropdownRect>`\n\tdisplay: flex;\n\tposition: fixed;\n\tflex-direction: column;\n\tz-index: 1000;\n\theight: ${DropdownHeight}px;\n\tpadding: 0 calc(var(--margin) / 2);\n\ttransform: scaleY(0);\n\ttransition: transform 300ms ease-in-out;\n\tpointer-events: none;\n\tbackground-color: var(--bg-color);\n\tborder-radius: calc(var(--border-radius) * 3);\n\tbox-shadow: var(--console-primary-hover-shadow);\n\t&[data-expanded=true] {\n\t\ttransform: none;\n\t\tpointer-events: auto;\n\t}\n\t> div {\n\t\theight: 28px;\n\t\t&:first-child {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\theight: 32px;\n\t\t\tbackground-color: var(--pipeline-bg-color);\n\t\t\tmargin: 0 calc(var(--margin) / -2) 2px;\n\t\t\tpadding: 0 calc(var(--margin) / 2);\n\t\t\tfont-weight: var(--font-bold);\n\t\t}\n\t\t&:last-child {\n\t\t\tmargin-bottom: 2px;\n\t\t}\n\t}\n`;\nconst FactorContainer = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\t> div:first-child {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\theight: 22px;\n\t\tpadding: 0 calc(var(--margin) / 2);\n\t\tfont-variant: petite-caps;\n\t\tfont-weight: var(--font-demi-bold);\n\t\tbackground-color: var(--pipeline-bg-color);\n\t\tbox-shadow: 0 0 0 1px var(--border-color);\n\t\tborder-top-left-radius: var(--border-radius);\n\t\tborder-bottom-left-radius: var(--border-radius);\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t}\n\t> div:nth-child(2) {\n\t\tflex-grow: 1;\n\t\tborder-top-left-radius: 0;\n\t\tborder-bottom-left-radius: 0;\n\t\tbox-shadow: 0 1px 0 0 var(--border-color), 0 -1px 0 0 var(--border-color), 1px 0 0 0 var(--border-color);\n\t\t&:hover {\n\t\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t\t}\n\t\t> input {\n\t\t\tborder-top-left-radius: 0;\n\t\t\tborder-bottom-left-radius: 0;\n\t\t}\n\t}\n`;\nconst OperatorAndRightContainer = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n`;\nconst AddButton = styled.div`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\talign-self: flex-start;\n\theight: 22px;\n\tfont-variant: petite-caps;\n\tfont-weight: var(--font-demi-bold);\n\tmargin: 5px 0 5px 32px;\n\tborder-radius: 11px;\n\tcursor: pointer;\n\ttransition: all 300ms ease-in-out;\n\t&:before, &:after {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\tleft: calc(var(--margin) / -2);\n\t\tbackground-color: var(--border-color);\n\t}\n\t&:before {\n\t\ttop: -5px;\n\t\twidth: 1px;\n\t\theight: calc(50% + 5px);\n\t}\n\t&:after {\n\t\ttop: calc(var(--margin) / 2 - 5px);\n\t\twidth: 10px;\n\t\theight: 1px;\n\t}\n\t&[data-can-sort=false] {\n\t\t> span {\n\t\t\tborder-top-right-radius: 11px;\n\t\t\tborder-bottom-right-radius: 11px;\n\t\t}\n\t\t> div:nth-last-child(-n + 2) {\n\t\t\topacity: 0;\n\t\t\tpointer-events: none;\n\t\t}\n\t}\n\t> span {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\theight: 22px;\n\t\tpadding: 0 calc(var(--margin) / 3) 0 calc(var(--margin) / 2);\n\t\tborder-top-left-radius: 11px;\n\t\tborder-bottom-left-radius: 11px;\n\t\tbackground-color: var(--pipeline-bg-color);\n\t\tbox-shadow: 0 0 0 1px var(--border-color);\n\t\t&:hover {\n\t\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t\t}\n\t\t> svg {\n\t\t\tfont-size: 0.8em;\n\t\t\tmargin-left: calc(var(--margin) / 3);\n\t\t}\n\t}\n\t> div:nth-last-child(-n + 2) {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\theight: 22px;\n\t\tposition: relative;\n\t\tbackground-color: var(--pipeline-bg-color);\n\t\tbox-shadow: 1px 0 0 0 var(--border-color), 0 1px 0 0 var(--border-color), 0 -1px 0 0 var(--border-color);\n\t\topacity: 1;\n\t\tpointer-events: auto;\n\t\ttransition: all 300ms ease-in-out;\n\t\t&:hover {\n\t\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t\t}\n\t}\n\t> div:nth-last-child(2) {\n\t\tpadding: 0 calc(var(--margin) / 3);\n\t}\n\t> div:last-child {\n\t\tborder-top-right-radius: 11px;\n\t\tborder-bottom-right-radius: 11px;\n\t\tpadding: 0 calc(var(--margin) / 3);\n\t}\n`;\n\nconst buildFactorValueLabel = (value: FactorValue, topics: Array<QueriedTopicForPipeline>): string => {\n\tlet label = '';\n\tconst topicId = value.topicId;\n\t// eslint-disable-next-line\n\tconst topic = topicId ? topics.find(topic => topic.topicId == topicId) : null;\n\tif (topic) {\n\t\tlabel += `${topic.name}.`;\n\t\tconst factorId = value.factorId;\n\t\t// eslint-disable-next-line\n\t\tconst factor = factorId ? topic.factors.find(factor => factor.factorId == factorId) : null;\n\t\tif (factor) {\n\t\t\tlabel += factor.label;\n\t\t} else {\n\t\t\tlabel += '?';\n\t\t}\n\t} else {\n\t\tlabel += '?.?';\n\t}\n\treturn label;\n};\nconst buildLabel = (options: {\n\tmapping: MappingFactor;\n\ttopics: Array<QueriedTopicForPipeline>;\n}) => {\n\tconst { mapping, topics } = options;\n\n\tlet left = '';\n\tif (isFactorValue(mapping.from)) {\n\t\tleft = buildFactorValueLabel(mapping.from, topics);\n\t} else if (isMemoryValue(mapping.from)) {\n\t\tleft = `Memory Context.${mapping.from.name || '?'}`;\n\t}\n\tconst arithmetic = asDisplayArithmetic(mapping.from.arithmetic);\n\tif (arithmetic) {\n\t\tleft = `${arithmetic}(${left})`;\n\t}\n\n\tlet right = '';\n\tif (isFactorValue(mapping.to)) {\n\t\tright = buildFactorValueLabel(mapping.to, topics);\n\t} else {\n\t\tright += `?.?`;\n\t}\n\n\treturn `${left}  ${right}`;\n};\n\nconst FilterLabel = (props: {\n\ttopic?: QueriedTopicForPipeline;\n\tcount: number;\n\tchildren?: ((props: any) => React.ReactNode) | React.ReactNode;\n}) => {\n\tconst { topic, count, children } = props;\n\n\tif (topic) {\n\t\tif (count === 0) {\n\t\t\treturn <span><span>No Mapping Defined</span>{children}</span>;\n\t\t} else if (count === 1) {\n\t\t\treturn <span><span>1 Mapping Rule</span>{children}</span>;\n\t\t} else {\n\t\t\treturn <span><span>{count} Mapping Rules</span>{children}</span>;\n\t\t}\n\t} else {\n\t\treturn <span><span>Pick Topic First</span>{children}</span>;\n\t}\n};\n\nconst Statement = (props: {\n\tmapping: MappingFactor\n}) => {\n\tconst { mapping } = props;\n\n\tconst { store: { topics } } = usePipelineContext();\n\tconst { addPropertyChangeListener, removePropertyChangeListener } = usePipelineUnitActionMappingContext();\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\taddPropertyChangeListener(PipelineUnitActionMappingEvent.FROM_CHANGED, forceUpdate);\n\t\taddPropertyChangeListener(PipelineUnitActionMappingEvent.TO_CHANGED, forceUpdate);\n\t\treturn () => {\n\t\t\tremovePropertyChangeListener(PipelineUnitActionMappingEvent.FROM_CHANGED, forceUpdate);\n\t\t\tremovePropertyChangeListener(PipelineUnitActionMappingEvent.TO_CHANGED, forceUpdate);\n\t\t};\n\t});\n\n\treturn <div>{buildLabel({ mapping, topics })}</div>;\n};\n\nconst RuleNode = (props: {\n\tholder: MappingRow;\n\trule: MappingFactor;\n\tonRemove: (rule: MappingFactor) => void;\n}) => {\n\tconst { rule, onRemove } = props;\n\n\tconst { store: { topics } } = usePipelineContext();\n\tconst { firePropertyChange } = usePipelineUnitActionMappingContext();\n\tconst topContainerRef = useRef<HTMLDivElement>(null);\n\tconst containerRef = useRef<HTMLDivElement>(null);\n\tconst dropdownRef = useRef<HTMLDivElement>(null);\n\tconst [ expanded, setExpanded ] = useState(false);\n\tconst [ dropdownRect, setDropdownRect ] = useState<DropdownRect>({ top: 0, left: 0, width: 0, atTop: false });\n\tuseCollapseFixedThing(topContainerRef, () => setExpanded(false));\n\n\tconst onExpandClick = () => {\n\t\tif (!expanded) {\n\t\t\tconst rect = containerRef.current!.getBoundingClientRect();\n\t\t\tconst top = rect.top + rect.height + 2;\n\t\t\tconst bottom = top + DropdownHeight;\n\t\t\tif (bottom > window.innerHeight) {\n\t\t\t\tsetDropdownRect({\n\t\t\t\t\ttop: rect.top - DropdownHeight - 2,\n\t\t\t\t\tleft: rect.left,\n\t\t\t\t\twidth: rect.width,\n\t\t\t\t\tatTop: true\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tsetDropdownRect({ top, left: rect.left, width: rect.width, atTop: false });\n\t\t\t}\n\t\t\tsetExpanded(true);\n\t\t}\n\t};\n\tconst onRemoveMappingRuleClicked = (event: React.MouseEvent<HTMLDivElement>) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tonRemove(rule);\n\t};\n\tconst onFromChanged = () => firePropertyChange(PipelineUnitActionMappingEvent.FROM_CHANGED);\n\tconst onToChanged = () => firePropertyChange(PipelineUnitActionMappingEvent.TO_CHANGED);\n\n\t// eslint-disable-next-line\n\tconst topic = topics.find(topic => topic.topicId == (rule.to as FactorValue).topicId);\n\n\treturn <MappingRuleContainer ref={topContainerRef}>\n\t\t<MappingRule ref={containerRef} tabIndex={0} data-expanded={expanded}\n\t\t             onClick={onExpandClick}>\n\t\t\t<Statement mapping={rule}/>\n\t\t\t<div><FontAwesomeIcon icon={expanded ? faCompressAlt : faExpandAlt}/></div>\n\t\t\t<div onClick={onRemoveMappingRuleClicked}><FontAwesomeIcon icon={faTrashAlt}/></div>\n\t\t</MappingRule>\n\t\t<Dropdown ref={dropdownRef} data-expanded={expanded} {...dropdownRect}>\n\t\t\t<div>Mapping Setting</div>\n\t\t\t<FacterValueFinder holder={rule.from}\n\t\t\t                   onTopicChange={onFromChanged} onFactorChange={onFromChanged}\n\t\t\t                   onVariableChange={onFromChanged}\n\t\t\t                   onArithmeticChange={onFromChanged}\n\t\t\t                   aggregate={false}/>\n\t\t\t<OperatorAndRightContainer></OperatorAndRightContainer>\n\t\t\t<FactorContainer>\n\t\t\t\t<div>Topic: {topic?.name}</div>\n\t\t\t\t<FactorFinder holder={rule.to as FactorValue} onChange={onToChanged}/>\n\t\t\t</FactorContainer>\n\t\t</Dropdown>\n\t</MappingRuleContainer>;\n};\n\nexport const TopicMapper = (props: {\n\tholder: TopicHolder & MappingRow\n}) => {\n\tconst { holder } = props;\n\n\tconst { store: { topics, selectedPipeline } } = usePipelineContext();\n\tconst {\n\t\tfirePropertyChange,\n\t\taddPropertyChangeListener,\n\t\tremovePropertyChangeListener\n\t} = usePipelineUnitActionContext();\n\tconst [ expanded, setExpanded ] = useState(false);\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\taddPropertyChangeListener(PipelineUnitActionEvent.TOPIC_CHANGED, forceUpdate);\n\t\treturn () => {\n\t\t\tremovePropertyChangeListener(PipelineUnitActionEvent.TOPIC_CHANGED, forceUpdate);\n\t\t};\n\t});\n\n\t// eslint-disable-next-line\n\tconst topic = topics.find(topic => topic.topicId == holder.topicId);\n\n\tconst onToggleFilterSettingsClicked = () => {\n\t\tif (topic) {\n\t\t\tsetExpanded(!expanded);\n\t\t}\n\t};\n\tconst onRuleRemove = (rule: MappingFactor) => {\n\t\tconst index = holder.mapping.findIndex(child => child === rule);\n\t\tholder.mapping.splice(index, 1);\n\t\tfirePropertyChange(PipelineUnitActionEvent.MAPPING_CHANGED);\n\t\tforceUpdate();\n\t};\n\tconst onAppendMappingRuleClicked = () => {\n\t\tif (!holder.mapping) {\n\t\t\tholder.mapping = [];\n\t\t}\n\t\tholder.mapping.push({\n\t\t\tfrom: {\n\t\t\t\ttype: SomeValueType.FACTOR,\n\t\t\t\ttopicId: selectedPipeline?.topicId,\n\t\t\t\tarithmetic: NoArithmetic.NO_FUNC\n\t\t\t} as FactorValue,\n\t\t\tto: { type: SomeValueType.FACTOR, topicId: topic?.topicId, arithmetic: NoArithmetic.NO_FUNC } as FactorValue\n\t\t});\n\t\tfirePropertyChange(PipelineUnitActionEvent.MAPPING_CHANGED);\n\t\tforceUpdate();\n\t};\n\tconst onSortAlphaDown = (event: React.MouseEvent<HTMLDivElement>) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tholder.mapping.sort((r1, r2) => {\n\t\t\treturn buildLabel({ mapping: r1, topics }).localeCompare(buildLabel({ mapping: r2, topics }));\n\t\t});\n\t\tfirePropertyChange(PipelineUnitActionEvent.MAPPING_CHANGED);\n\t\tforceUpdate();\n\t};\n\tconst onSortAlphaUp = (event: React.MouseEvent<HTMLDivElement>) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tholder.mapping.sort((r1, r2) => {\n\t\t\treturn buildLabel({ mapping: r2, topics }).localeCompare(buildLabel({ mapping: r1, topics }));\n\t\t});\n\t\tfirePropertyChange(PipelineUnitActionEvent.MAPPING_CHANGED);\n\t\tforceUpdate();\n\t};\n\n\tif (!holder.mapping) {\n\t\tholder.mapping = [];\n\t}\n\n\tconst ruleCount = holder.mapping.length;\n\tconst canSort = expanded && ruleCount >= 2;\n\n\treturn <Container>\n\t\t<ToggleLine>\n\t\t\t<ToggleButton data-expanded={expanded} data-can-sort={canSort} onClick={onToggleFilterSettingsClicked}>\n\t\t\t\t<FilterLabel topic={topic} count={ruleCount}>\n\t\t\t\t\t<FontAwesomeIcon icon={expanded ? faCompressArrowsAlt : faExpandArrowsAlt}/>\n\t\t\t\t</FilterLabel>\n\t\t\t\t<div onClick={onSortAlphaDown}><FontAwesomeIcon icon={faSortAlphaDown}/></div>\n\t\t\t\t<div onClick={onSortAlphaUp}><FontAwesomeIcon icon={faSortAlphaUp}/></div>\n\t\t\t</ToggleButton>\n\t\t</ToggleLine>\n\t\t{topic\n\t\t\t? <Body lines={ruleCount} expanded={expanded}>\n\t\t\t\t<MappingRuleContent lines={ruleCount}>\n\t\t\t\t\t{(holder.mapping || []).map((rule, index) => {\n\t\t\t\t\t\treturn <PipelineUnitActionMappingContextProvider key={index}>\n\t\t\t\t\t\t\t<div/>\n\t\t\t\t\t\t\t<RuleNode holder={holder} rule={rule} onRemove={onRuleRemove}/>\n\t\t\t\t\t\t</PipelineUnitActionMappingContextProvider>;\n\t\t\t\t\t})}\n\t\t\t\t</MappingRuleContent>\n\t\t\t\t<AddButton data-can-sort={canSort}>\n\t\t\t\t\t<span onClick={onAppendMappingRuleClicked}>\n\t\t\t\t\t\t<span>Append Mapping Rule</span>\n\t\t\t\t\t\t<FontAwesomeIcon icon={faPlus}/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<div onClick={onSortAlphaDown}><FontAwesomeIcon icon={faSortAlphaDown}/></div>\n\t\t\t\t\t<div onClick={onSortAlphaUp}><FontAwesomeIcon icon={faSortAlphaUp}/></div>\n\t\t\t\t</AddButton>\n\t\t\t</Body>\n\t\t\t: null}\n\t</Container>;\n};","import { EventEmitter } from 'events';\nimport React, { useState } from 'react';\nimport { usePipelineEditContext } from './pipeline-edit-context';\n\nexport enum PipelineUnitConditionEvent {\n\t// TOPIC_CHANGED = 'topic-changed',\n\t// FACTOR_CHANGED = 'factor-changed',\n\tFILTER_ADDED = 'filter-added',\n\tFILTER_REMOVED = 'filter-removed',\n\tFILTER_CHANGED = 'filter-changed',\n\tFILTER_INDENT = 'filter-indent',\n\tFILTER_OUTDENT = 'filter-outdent'\n}\n\nexport type PropertyChangeListener = () => void;\n\nexport interface PipelineUnitConditionContextUsable {\n\tfirePropertyChange: (event: PipelineUnitConditionEvent) => void;\n\taddPropertyChangeListener: (event: PipelineUnitConditionEvent, listener: PropertyChangeListener) => void;\n\tremovePropertyChangeListener: (event: PipelineUnitConditionEvent, listener: PropertyChangeListener) => void;\n}\n\nexport interface PipelineUnitConditionContext extends PipelineUnitConditionContextUsable {\n}\n\nconst Context = React.createContext<PipelineUnitConditionContext>({} as PipelineUnitConditionContext);\nContext.displayName = 'PipelineUnitConditionContext';\n\nexport const PipelineUnitConditionContextProvider = (props: {\n\tchildren?: ((props: any) => React.ReactNode) | React.ReactNode;\n}) => {\n\tconst { children } = props;\n\n\tconst { firePipelineContentChange } = usePipelineEditContext();\n\tconst [ emitter ] = useState<EventEmitter>(() => {\n\t\tconst emitter = new EventEmitter();\n\t\temitter.setMaxListeners(1000);\n\t\treturn emitter;\n\t});\n\n\treturn <Context.Provider value={{\n\t\tfirePropertyChange: (event) => {\n\t\t\temitter.emit(event);\n\t\t\tfirePipelineContentChange();\n\t\t},\n\t\taddPropertyChangeListener: (event, listener) => emitter.on(event, listener),\n\t\tremovePropertyChangeListener: (event, listener) => emitter.off(event, listener)\n\t}}>{children}</Context.Provider>;\n};\n\nexport const usePipelineUnitConditionContext = () => {\n\treturn React.useContext(Context);\n};\n","import React from 'react';\nimport { UnitAction, UnitActionMergeRow } from '../../../../../services/admin/pipeline-types';\nimport { TopicFinder } from '../components/topic-finder';\nimport { PipelineUnitActionEvent, usePipelineUnitActionContext } from '../pipeline-unit-action-context';\nimport { ActionBody2Columns, ActionBodyItemLabel } from './action-body';\nimport { TopicMapper } from './topic-mapper';\nimport { TopicRowMatcher } from './topic-row-matcher';\n\nexport const WriteTopicMergeRow = (props: { action: UnitAction }) => {\n\tconst { action } = props;\n\tconst write = action as UnitActionMergeRow;\n\n\tconst { firePropertyChange } = usePipelineUnitActionContext();\n\n\treturn <ActionBody2Columns>\n\t\t<ActionBodyItemLabel>To:</ActionBodyItemLabel>\n\t\t<TopicFinder holder={write} onChange={() => firePropertyChange(PipelineUnitActionEvent.TOPIC_CHANGED)}/>\n\t\t<ActionBodyItemLabel>On:</ActionBodyItemLabel>\n\t\t<TopicRowMatcher holder={write}/>\n\t\t<ActionBodyItemLabel>Use:</ActionBodyItemLabel>\n\t\t<TopicMapper holder={write}/>\n\t</ActionBody2Columns>;\n};","import { ReactNode } from 'react';\nimport {\n\tReadTopicActionType,\n\tSystemActionType,\n\tUnitAction,\n\tUnitActionType,\n\tWriteTopicActionType\n} from '../../../../services/admin/pipeline-types';\nimport { Alarm } from './unit-actions/alarm';\nimport { ReadTopicExists } from './unit-actions/read-topic-exists';\nimport { ReadTopicFindFactor } from './unit-actions/read-topic-find-factor';\nimport { ReadTopicFindRow } from './unit-actions/read-topic-find-row';\nimport { WriteFactor } from './unit-actions/write-factor';\nimport { WriteToMemory } from './unit-actions/write-to-memory';\nimport { WriteTopicInsertRow } from './unit-actions/write-topic-insert-row';\nimport { WriteTopicMergeRow } from './unit-actions/write-topic-merge-row';\n\nexport type UnitActionReactNode = (props: { action: UnitAction }) => ReactNode;\n\nexport const UnitActionNodes: { [key in UnitActionType]: UnitActionReactNode | undefined } = {\n\t[WriteTopicActionType.INSERT_ROW]: WriteTopicInsertRow,\n\t[WriteTopicActionType.MERGE_ROW]: WriteTopicMergeRow,\n\t[WriteTopicActionType.INSERT_OR_MERGE_ROW]: WriteTopicMergeRow,\n\t[WriteTopicActionType.WRITE_FACTOR]: WriteFactor,\n\n\t[ReadTopicActionType.READ_ROW]: ReadTopicFindRow,\n\t[ReadTopicActionType.READ_FACTOR]: ReadTopicFindFactor,\n\t[ReadTopicActionType.EXISTS]: ReadTopicExists,\n\n\t[SystemActionType.COPY_TO_MEMORY]: WriteToMemory,\n\t[SystemActionType.ALARM]: Alarm\n};\n","import React from 'react';\nimport { UnitAction, UnitActionInsertRow } from '../../../../../services/admin/pipeline-types';\nimport { TopicFinder } from '../components/topic-finder';\nimport { PipelineUnitActionEvent, usePipelineUnitActionContext } from '../pipeline-unit-action-context';\nimport { ActionBody2Columns, ActionBodyItemLabel } from './action-body';\nimport { TopicMapper } from './topic-mapper';\n\nexport const WriteTopicInsertRow = (props: { action: UnitAction }) => {\n\tconst { action } = props;\n\tconst write = action as UnitActionInsertRow;\n\n\tconst { firePropertyChange } = usePipelineUnitActionContext();\n\n\treturn <ActionBody2Columns>\n\t\t<ActionBodyItemLabel>To:</ActionBodyItemLabel>\n\t\t<TopicFinder holder={write} onChange={() => firePropertyChange(PipelineUnitActionEvent.TOPIC_CHANGED)}/>\n\t\t<ActionBodyItemLabel>Use:</ActionBodyItemLabel>\n\t\t<TopicMapper holder={write}/>\n\t</ActionBody2Columns>;\n};","import React from 'react';\nimport { UnitAction, UnitActionWriteFactor } from '../../../../../services/admin/pipeline-types';\nimport { FacterValueFinder } from '../components/facter-value-finder';\nimport { TopicFactorFinder } from '../components/topic-factor-finder';\nimport { PipelineUnitActionEvent, usePipelineUnitActionContext } from '../pipeline-unit-action-context';\nimport { ActionBody2Columns, ActionBodyItemLabel } from './action-body';\nimport { TopicRowMatcher } from './topic-row-matcher';\n\nexport const WriteFactor = (props: { action: UnitAction }) => {\n\tconst { action } = props;\n\tconst write = action as UnitActionWriteFactor;\n\n\tconst { firePropertyChange } = usePipelineUnitActionContext();\n\tconst onTopicChange = () => firePropertyChange(PipelineUnitActionEvent.TOPIC_CHANGED);\n\tconst onFactorChange = () => firePropertyChange(PipelineUnitActionEvent.FACTOR_CHANGED);\n\tconst onVariableChange = () => firePropertyChange(PipelineUnitActionEvent.VARIABLE_CHANGED);\n\tconst onArithmeticChange = () => firePropertyChange(PipelineUnitActionEvent.ARITHMETIC_CHANGED);\n\n\treturn <ActionBody2Columns>\n\t\t<ActionBodyItemLabel>From:</ActionBodyItemLabel>\n\t\t<FacterValueFinder holder={write.value}\n\t\t                   onTopicChange={onTopicChange} onFactorChange={onFactorChange}\n\t\t                   onVariableChange={onVariableChange} onArithmeticChange={onArithmeticChange}\n\t\t                   aggregate={true}/>\n\t\t<ActionBodyItemLabel>To:</ActionBodyItemLabel>\n\t\t<TopicFactorFinder holder={write} onTopicChange={onTopicChange} onFactorChange={onFactorChange}/>\n\t\t<ActionBodyItemLabel>On:</ActionBodyItemLabel>\n\t\t<TopicRowMatcher holder={write}/>\n\t</ActionBody2Columns>;\n};","import React from 'react';\nimport { useForceUpdate } from '../../../../../common/utils';\nimport { UnitAction, UnitActionReadRow } from '../../../../../services/admin/pipeline-types';\nimport { ActionInput } from '../components/action-input';\nimport { TopicFinder } from '../components/topic-finder';\nimport { PipelineUnitActionEvent, usePipelineUnitActionContext } from '../pipeline-unit-action-context';\nimport { ActionBody2Columns, ActionBodyItemLabel } from './action-body';\nimport { TopicRowMatcher } from './topic-row-matcher';\n\nexport const ReadTopicFindRow = (props: { action: UnitAction }) => {\n\tconst { action } = props;\n\tconst read = action as UnitActionReadRow;\n\n\tconst { firePropertyChange } = usePipelineUnitActionContext();\n\tconst forceUpdate = useForceUpdate();\n\tconst onTargetNameChanged = (event: React.ChangeEvent<HTMLInputElement>) => {\n\t\tread.targetName = event.target.value;\n\t\tfirePropertyChange(PipelineUnitActionEvent.VARIABLE_CHANGED);\n\t\tforceUpdate();\n\t};\n\n\treturn <ActionBody2Columns>\n\t\t<ActionBodyItemLabel>From:</ActionBodyItemLabel>\n\t\t<TopicFinder holder={read} onChange={() => firePropertyChange(PipelineUnitActionEvent.TOPIC_CHANGED)}/>\n\t\t<ActionBodyItemLabel>By:</ActionBodyItemLabel>\n\t\t<TopicRowMatcher holder={read}/>\n\t\t<ActionBodyItemLabel>To:</ActionBodyItemLabel>\n\t\t<ActionInput value={read.targetName || ''} onChange={onTargetNameChanged}\n\t\t             placeholder='Variable name...'/>\n\t</ActionBody2Columns>;\n};","import React from 'react';\nimport { useForceUpdate } from '../../../../../common/utils';\nimport { UnitAction, UnitActionReadFactor } from '../../../../../services/admin/pipeline-types';\nimport { ActionInput } from '../components/action-input';\nimport { TopicFactorFinder } from '../components/topic-factor-finder';\nimport { PipelineUnitActionEvent, usePipelineUnitActionContext } from '../pipeline-unit-action-context';\nimport { ActionBody2Columns, ActionBodyItemLabel } from './action-body';\nimport { TopicRowMatcher } from './topic-row-matcher';\n\nexport const ReadTopicFindFactor = (props: { action: UnitAction }) => {\n\tconst { action } = props;\n\tconst read = action as UnitActionReadFactor;\n\n\tconst { firePropertyChange } = usePipelineUnitActionContext();\n\tconst forceUpdate = useForceUpdate();\n\tconst onTargetNameChanged = (event: React.ChangeEvent<HTMLInputElement>) => {\n\t\tread.targetName = event.target.value;\n\t\tfirePropertyChange(PipelineUnitActionEvent.VARIABLE_CHANGED);\n\t\tforceUpdate();\n\t};\n\tconst onTopicChange = () => firePropertyChange(PipelineUnitActionEvent.TOPIC_CHANGED);\n\tconst onFactorChange = () => firePropertyChange(PipelineUnitActionEvent.FACTOR_CHANGED);\n\n\treturn <ActionBody2Columns>\n\t\t<ActionBodyItemLabel>From:</ActionBodyItemLabel>\n\t\t<TopicFactorFinder holder={read} onTopicChange={onTopicChange} onFactorChange={onFactorChange}/>\n\t\t<ActionBodyItemLabel>By:</ActionBodyItemLabel>\n\t\t<TopicRowMatcher holder={read}/>\n\t\t<ActionBodyItemLabel>To:</ActionBodyItemLabel>\n\t\t<ActionInput value={read.targetName || ''} onChange={onTargetNameChanged}\n\t\t             placeholder='Variable name...'/>\n\t</ActionBody2Columns>;\n};","import React from 'react';\nimport { useForceUpdate } from '../../../../../common/utils';\nimport { UnitAction, UnitActionExists } from '../../../../../services/admin/pipeline-types';\nimport { ActionInput } from '../components/action-input';\nimport { TopicFinder } from '../components/topic-finder';\nimport { PipelineUnitActionEvent, usePipelineUnitActionContext } from '../pipeline-unit-action-context';\nimport { ActionBody2Columns, ActionBodyItemLabel } from './action-body';\nimport { TopicRowMatcher } from './topic-row-matcher';\n\nexport const ReadTopicExists = (props: { action: UnitAction }) => {\n\tconst { action } = props;\n\tconst read = action as UnitActionExists;\n\n\tconst { firePropertyChange } = usePipelineUnitActionContext();\n\tconst forceUpdate = useForceUpdate();\n\tconst onTargetNameChanged = (event: React.ChangeEvent<HTMLInputElement>) => {\n\t\tread.targetName = event.target.value;\n\t\tfirePropertyChange(PipelineUnitActionEvent.VARIABLE_CHANGED);\n\t\tforceUpdate();\n\t};\n\n\treturn <ActionBody2Columns>\n\t\t<ActionBodyItemLabel>Exists In:</ActionBodyItemLabel>\n\t\t<TopicFinder holder={read} onChange={() => firePropertyChange(PipelineUnitActionEvent.TOPIC_CHANGED)}/>\n\t\t<ActionBodyItemLabel>By:</ActionBodyItemLabel>\n\t\t<TopicRowMatcher holder={read}/>\n\t\t<ActionBodyItemLabel>To:</ActionBodyItemLabel>\n\t\t<ActionInput value={read.targetName || ''} onChange={onTargetNameChanged}\n\t\t             placeholder='Variable name...'/>\n\t</ActionBody2Columns>;\n};","import React from 'react';\nimport { useForceUpdate } from '../../../../../common/utils';\nimport { UnitAction, UnitActionCopyToMemory } from '../../../../../services/admin/pipeline-types';\nimport { ActionInput } from '../components/action-input';\nimport { FacterValueFinder } from '../components/facter-value-finder';\nimport { PipelineUnitActionEvent, usePipelineUnitActionContext } from '../pipeline-unit-action-context';\nimport { ActionBody2Columns, ActionBodyItemLabel } from './action-body';\n\nexport const WriteToMemory = (props: { action: UnitAction }) => {\n\tconst { action } = props;\n\tconst write = action as UnitActionCopyToMemory;\n\n\tconst { firePropertyChange } = usePipelineUnitActionContext();\n\tconst forceUpdate = useForceUpdate();\n\tconst onTopicChange = () => firePropertyChange(PipelineUnitActionEvent.TOPIC_CHANGED);\n\tconst onFactorChange = () => firePropertyChange(PipelineUnitActionEvent.FACTOR_CHANGED);\n\tconst onVariableChange = () => firePropertyChange(PipelineUnitActionEvent.VARIABLE_CHANGED);\n\tconst onArithmeticChange = () => firePropertyChange(PipelineUnitActionEvent.ARITHMETIC_CHANGED);\n\tconst onTargetNameChanged = (event: React.ChangeEvent<HTMLInputElement>) => {\n\t\twrite.targetName = event.target.value;\n\t\tfirePropertyChange(PipelineUnitActionEvent.VARIABLE_CHANGED);\n\t\tforceUpdate();\n\t};\n\n\treturn <ActionBody2Columns>\n\t\t<ActionBodyItemLabel>From:</ActionBodyItemLabel>\n\t\t<FacterValueFinder holder={write.value}\n\t\t                   onTopicChange={onTopicChange} onFactorChange={onFactorChange}\n\t\t                   onVariableChange={onVariableChange} onArithmeticChange={onArithmeticChange}\n\t\t                   aggregate={false}/>\n\t\t<ActionBodyItemLabel>To:</ActionBodyItemLabel>\n\t\t<ActionInput value={write.targetName || ''} onChange={onTargetNameChanged}\n\t\t             placeholder='Variable name...'/>\n\t</ActionBody2Columns>;\n};","import { faTrashAlt } from '@fortawesome/free-regular-svg-icons';\nimport { faCompressAlt, faExpandAlt, faLongArrowAltLeft, faLongArrowAltRight } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { useEffect, useRef, useState } from 'react';\nimport styled from 'styled-components';\nimport { useCollapseFixedThing, useForceUpdate } from '../../../../../common/utils';\nimport {\n\tCompositeCondition,\n\tCompositeMode,\n\tFactorValue,\n\tInMemoryValue,\n\tNoArithmetic,\n\tPlainCondition,\n\tSomeValueType\n} from '../../../../../services/admin/pipeline-types';\nimport { QueriedTopicForPipeline } from '../../../../../services/admin/types';\nimport { ActionInput } from '../components/action-input';\nimport { ConditionOperatorSelect } from '../components/condition-operator-select';\nimport { FactorFinder } from '../components/factor-finder';\nimport { isFactorValue, isMemoryValue } from '../components/utils';\nimport { usePipelineEditContext } from '../pipeline-edit-context';\nimport { PipelineUnitConditionEvent, usePipelineUnitConditionContext } from '../pipeline-unit-condition-context';\nimport { ArithmeticSelect } from '../unit-actions/arithmetic-select';\nimport { asDisplayArithmetic, asDisplayOperator } from '../utils';\n\ninterface DropdownRect {\n\ttop: number;\n\tleft: number;\n\twidth: number;\n\tatTop: boolean;\n}\n\nconst Container = styled.div.attrs({\n\t'data-widget': 'plain-condition'\n})`\n\tdisplay: flex;\n\talign-items: center;\n\tposition: relative;\n\theight: 32px;\n\t&:before,\n\t&:after {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\tbackground-color: var(--border-color);\n\t}\n\t&:before {\n\t\ttop: 16px;\n\t\tleft: calc(var(--margin) / -2);\n\t\twidth: calc(var(--margin) / 2 - 4px);\n\t\theight: 1px;\n\t}\n\t&:after {\n\t\ttop: 0;\n\t\tleft: calc(var(--margin) / -2);\n\t\twidth: 1px;\n\t\theight: 16px;\n\t}\n\t&:not(:last-child):after {\n\t\theight: 100%;\n\t}\n`;\nconst DisplayLabel = styled.div`\n\tdisplay: flex;\n\tposition: relative;\n\tjustify-self: flex-start;\n\tborder-radius: 12px;\n\tbackground-color: transparent;\n\theight: 22px;\n\tline-height: 22px;\n\toutline: none;\n\tappearance: none;\n\twhite-space: nowrap;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\tcursor: pointer;\n\ttransition: all 300ms ease-in-out;\n\t&[data-expanded=true],\n\t&:hover {\n\t\tbackground-color: var(--pipeline-bg-color);\n\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t\t> div:first-child {\n\t\t\tpadding-left: calc(var(--margin) / 2);\n\t\t}\n\t\t> div:not(:first-child) {\n\t\t\topacity: 1;\n\t\t\tpointer-events: auto;\n\t\t}\n\t}\n\t&[data-expanded=true] > div:nth-child(2) > svg {\n\t\ttransform: rotateZ(180deg);\n\t}\n\t> div:first-child {\n\t\tflex-grow: 1;\n\t\tposition: relative;\n\t\tfont-weight: var(--font-bold);\n\t\tfont-variant: petite-caps;\n\t\tborder-top-left-radius: 12px;\n\t\tborder-bottom-left-radius: 12px;\n\t\ttransition: all 300ms ease-in-out;\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t}\n\t> div:not(:first-child) {\n\t\tposition: relative;\n\t\tpadding: 0 calc(var(--margin) / 3);\n\t\topacity: 0;\n\t\tpointer-events: none;\n\t\ttransition: all 300ms ease-in-out;\n\t\t> svg {\n\t\t\tfont-size: 0.8em;\n\t\t\ttransition: all 300ms ease-in-out;\n\t\t}\n\t\t&:not(:nth-child(2)):before {\n\t\t\tcontent: '';\n\t\t\tdisplay: block;\n\t\t\tposition: absolute;\n\t\t\tleft: 0;\n\t\t\ttop: 20%;\n\t\t\twidth: 1px;\n\t\t\theight: 60%;\n\t\t\tbackground-color: var(--border-color);\n\t\t}\n\t}\n`;\nconst DropdownHeight = 120;\nconst Dropdown = styled.div.attrs<DropdownRect>(({ top, left, width, atTop }) => {\n\treturn {\n\t\tstyle: {\n\t\t\ttop, left, minWidth: Math.max(width, 600),\n\t\t\ttransformOrigin: atTop ? 'bottom' : 'top'\n\t\t}\n\t};\n})<DropdownRect>`\n\tdisplay: flex;\n\tposition: fixed;\n\tflex-direction: column;\n\tz-index: 1000;\n\theight: ${DropdownHeight}px;\n\tpadding: 0 calc(var(--margin) / 2);\n\ttransform: scaleY(0);\n\ttransition: transform 300ms ease-in-out;\n\tpointer-events: none;\n\tbackground-color: var(--bg-color);\n\tborder-radius: calc(var(--border-radius) * 3);\n\tbox-shadow: var(--console-primary-hover-shadow);\n\t&[data-expanded=true] {\n\t\ttransform: none;\n\t\tpointer-events: auto;\n\t}\n\t> div {\n\t\theight: 28px;\n\t\t&:first-child {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\theight: 32px;\n\t\t\tbackground-color: var(--pipeline-bg-color);\n\t\t\tmargin: 0 calc(var(--margin) / -2) 2px;\n\t\t\tpadding: 0 calc(var(--margin) / 2);\n\t\t\tfont-weight: var(--font-bold);\n\t\t}\n\t\t&:last-child {\n\t\t\tmargin-bottom: 2px;\n\t\t}\n\t}\n`;\nconst LeftAsFactorContainer = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\t> div:first-child {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\theight: 22px;\n\t\tpadding: 0 calc(var(--margin) / 2);\n\t\tfont-variant: petite-caps;\n\t\tfont-weight: var(--font-demi-bold);\n\t\tbackground-color: var(--pipeline-bg-color);\n\t\tbox-shadow: 0 0 0 1px var(--border-color);\n\t\tborder-top-left-radius: var(--border-radius);\n\t\tborder-bottom-left-radius: var(--border-radius);\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t}\n\t> div:nth-child(2) {\n\t\tflex-grow: 1;\n\t\tborder-top-left-radius: 0;\n\t\tborder-bottom-left-radius: 0;\n\t\tbox-shadow: 0 1px 0 0 var(--border-color), 0 -1px 0 0 var(--border-color), 1px 0 0 0 var(--border-color);\n\t\t&:hover {\n\t\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t\t}\n\t\t> input {\n\t\t\tborder-top-left-radius: 0;\n\t\t\tborder-bottom-left-radius: 0;\n\t\t}\n\t}\n`;\nconst OperatorAndRightContainer = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n`;\nconst RightAsInMemoryContainer = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\t> div:first-child {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\theight: 22px;\n\t\tborder-top-left-radius: var(--border-radius);\n\t\tborder-bottom-left-radius: var(--border-radius);\n\t\tbox-shadow: 0 0 0 1px var(--border-color);\n\t\tfont-variant: petite-caps;\n\t\tfont-weight: var(--font-demi-bold);\n\t\tpadding: 0 calc(var(--margin) / 2);\n\t\tbackground-color: var(--pipeline-bg-color);\n\t}\n\t> input {\n\t\tflex-grow: 1;\n\t\tborder-radius: 0;\n\t\tbox-shadow: 0 1px 0 0 var(--border-color), 0 -1px 0 0 var(--border-color), 1px 0 0 0 var(--border-color);\n\t}\n\t> div:last-child {\n\t\tborder-top-left-radius: 0;\n\t\tborder-bottom-left-radius: 0;\n\t\tbox-shadow: 0 1px 0 0 var(--border-color), 0 -1px 0 0 var(--border-color), 1px 0 0 0 var(--border-color);\n\t\t&:hover {\n\t\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t\t}\n\t}\n`;\n\nconst buildLabel = (options: {\n\ttopic?: QueriedTopicForPipeline;\n\tcondition: PlainCondition;\n}) => {\n\tconst { topic, condition } = options;\n\n\tlet label = '';\n\tif (topic) {\n\t\tconst left = condition.left as FactorValue;\n\t\t// topic never changed\n\t\tlabel += `${topic.name}.`;\n\t\tif (left.factorId) {\n\t\t\t// eslint-disable-next-line\n\t\t\tconst factor = topic.factors.find(factor => factor.factorId == left.factorId);\n\t\t\tlabel += factor ? factor.label : '?';\n\t\t} else {\n\t\t\tlabel += '?';\n\t\t}\n\t}\n\tlabel += ` ${asDisplayOperator(condition.operator)} `;\n\n\tlet right = '';\n\t// if (isFactorValue(condition.right)) {\n\t// \tconst topicId = condition.right.topicId;\n\t// \t// eslint-disable-next-line\n\t// \tconst topic = topicId ? topics.find(topic => topic.topicId == topicId) : null;\n\t// \tif (topic) {\n\t// \t\tright += `${topic.name}.`;\n\t// \t\tconst factorId = condition.right.factorId;\n\t// \t\t// eslint-disable-next-line\n\t// \t\tconst factor = factorId ? topic.factors.find(factor => factor.factorId == factorId) : null;\n\t// \t\tif (factor) {\n\t// \t\t\tright += factor.label;\n\t// \t\t} else {\n\t// \t\t\tright += '?';\n\t// \t\t}\n\t// \t} else {\n\t// \t\tright += '?.?';\n\t// \t}\n\t// } else\n\tif (isMemoryValue(condition.right)) {\n\t\tright += `Memory Context.${condition.right.name || '?'}`;\n\t}\n\n\tconst arithmetic = asDisplayArithmetic(condition.right.arithmetic);\n\tif (arithmetic) {\n\t\tright = `${arithmetic}(${right})`;\n\t}\n\n\treturn label + right;\n};\n\nconst Statement = (props: {\n\ttopic?: QueriedTopicForPipeline;\n\tcondition: PlainCondition;\n}) => {\n\tconst { topic, condition } = props;\n\n\tconst { addPropertyChangeListener, removePropertyChangeListener } = usePipelineUnitConditionContext();\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\taddPropertyChangeListener(PipelineUnitConditionEvent.FILTER_CHANGED, forceUpdate);\n\t\treturn () => removePropertyChangeListener(PipelineUnitConditionEvent.FILTER_CHANGED, forceUpdate);\n\t});\n\n\treturn <div>{buildLabel({ topic, condition })}</div>;\n};\n\nconst fillCondition = (options: {\n\tcondition: PlainCondition;\n\ttopic?: QueriedTopicForPipeline,\n}) => {\n\tconst { condition, topic } = options;\n\n\tif (!condition.left) {\n\t\tcondition.left = { arithmetic: NoArithmetic.NO_FUNC };\n\t\tif (topic) {\n\t\t\tcondition.left.type = SomeValueType.FACTOR;\n\t\t\t(condition.left as FactorValue).topicId = topic.topicId;\n\t\t} else {\n\t\t\tcondition.left.type = SomeValueType.IN_MEMORY;\n\t\t}\n\t}\n\tif (!condition.right) {\n\t\t// right part comes from memory or pipeline source target\n\t\tcondition.right = {\n\t\t\ttype: SomeValueType.IN_MEMORY,\n\t\t\tarithmetic: NoArithmetic.NO_FUNC\n\t\t} as InMemoryValue;\n\t}\n};\n\nexport const PlainConditionRow = (props: {\n\tleft?: QueriedTopicForPipeline;\n\tgrandParent?: CompositeCondition;\n\tparent: CompositeCondition;\n\tcondition: PlainCondition;\n}) => {\n\tconst { left: topic, grandParent: grandParentCondition, parent: parentCondition, condition } = props;\n\n\tconst { firePipelineContentChange } = usePipelineEditContext();\n\tconst { firePropertyChange } = usePipelineUnitConditionContext();\n\n\tconst topContainerRef = useRef<HTMLDivElement>(null);\n\tconst containerRef = useRef<HTMLDivElement>(null);\n\tconst dropdownRef = useRef<HTMLDivElement>(null);\n\tconst [ expanded, setExpanded ] = useState(false);\n\tconst [ dropdownRect, setDropdownRect ] = useState<DropdownRect>({ top: 0, left: 0, width: 0, atTop: false });\n\tconst forceUpdate = useForceUpdate();\n\tuseCollapseFixedThing(topContainerRef, () => setExpanded(false));\n\n\tfillCondition({ condition, topic });\n\n\tconst onExpandClick = () => {\n\t\tif (!expanded) {\n\t\t\tconst rect = containerRef.current!.getBoundingClientRect();\n\t\t\tconst top = rect.top + rect.height + 2;\n\t\t\tconst bottom = top + DropdownHeight;\n\t\t\tif (bottom > window.innerHeight) {\n\t\t\t\tsetDropdownRect({\n\t\t\t\t\ttop: rect.top - DropdownHeight - 2,\n\t\t\t\t\tleft: rect.left,\n\t\t\t\t\twidth: rect.width,\n\t\t\t\t\tatTop: true\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tsetDropdownRect({ top, left: rect.left, width: rect.width, atTop: false });\n\t\t\t}\n\t\t\tsetExpanded(true);\n\t\t}\n\t};\n\tconst onOutdentClicked = (event: React.MouseEvent<HTMLDivElement>) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tif (!grandParentCondition || !parentCondition) {\n\t\t\treturn;\n\t\t}\n\t\tconst indexInParent = parentCondition.children.findIndex(child => child === condition);\n\t\tconst indexInGrand = grandParentCondition.children.findIndex(child => child === parentCondition);\n\t\t// remove from parent\n\t\tparentCondition.children.splice(indexInParent, 1);\n\t\t// add into grand, after parent\n\t\tgrandParentCondition.children.splice(indexInGrand + 1, 0, condition);\n\t\tfirePipelineContentChange();\n\t\tfirePropertyChange(PipelineUnitConditionEvent.FILTER_OUTDENT);\n\t};\n\tconst onIndentClicked = (event: React.MouseEvent<HTMLDivElement>) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tconst newParent: CompositeCondition = { mode: CompositeMode.AND, children: [ condition ] };\n\t\tconst mode = parentCondition.mode;\n\t\tif (mode === CompositeMode.AND) {\n\t\t\tnewParent.mode = CompositeMode.OR;\n\t\t}\n\t\tconst index = parentCondition.children.findIndex(child => child === condition);\n\t\tparentCondition.children.splice(index, 1, newParent);\n\t\tfirePipelineContentChange();\n\t\tfirePropertyChange(PipelineUnitConditionEvent.FILTER_INDENT);\n\t};\n\tconst onRemoveClicked = (event: React.MouseEvent<HTMLDivElement>) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tif (!parentCondition) {\n\t\t\treturn;\n\t\t}\n\t\tconst index = parentCondition.children.findIndex(child => child === condition);\n\t\tparentCondition.children.splice(index, 1);\n\t\tfirePipelineContentChange();\n\t\tfirePropertyChange(PipelineUnitConditionEvent.FILTER_REMOVED);\n\t};\n\tconst onFilterChange = () => {\n\t\tfirePipelineContentChange();\n\t\tfirePropertyChange(PipelineUnitConditionEvent.FILTER_CHANGED);\n\t};\n\tconst onInMemoryVariableNameChanged = (event: React.ChangeEvent<HTMLInputElement>) => {\n\t\tconst name = event.target.value;\n\t\tif (isMemoryValue(condition.right)) {\n\t\t\tcondition.right.name = name;\n\t\t\tonFilterChange();\n\t\t}\n\t\tforceUpdate();\n\t};\n\n\treturn <Container ref={topContainerRef}>\n\t\t<DisplayLabel ref={containerRef} tabIndex={0} data-expanded={expanded}\n\t\t              onClick={onExpandClick}>\n\t\t\t<Statement topic={topic} condition={condition}/>\n\t\t\t<div><FontAwesomeIcon icon={expanded ? faCompressAlt : faExpandAlt}/></div>\n\t\t\t{!!grandParentCondition ?\n\t\t\t\t<div onClick={onOutdentClicked}><FontAwesomeIcon icon={faLongArrowAltLeft}/></div> : null}\n\t\t\t<div onClick={onIndentClicked}><FontAwesomeIcon icon={faLongArrowAltRight}/></div>\n\t\t\t<div onClick={onRemoveClicked}><FontAwesomeIcon icon={faTrashAlt}/></div>\n\t\t</DisplayLabel>\n\t\t<Dropdown ref={dropdownRef} data-expanded={expanded} {...dropdownRect}>\n\t\t\t<div>Expression Setting</div>\n\t\t\t{isFactorValue(condition.left)\n\t\t\t\t? <LeftAsFactorContainer>\n\t\t\t\t\t<div>Topic: {topic?.name}</div>\n\t\t\t\t\t<FactorFinder holder={condition.left} onChange={onFilterChange}/>\n\t\t\t\t</LeftAsFactorContainer>\n\t\t\t\t: null}\n\t\t\t<OperatorAndRightContainer>\n\t\t\t\t<ConditionOperatorSelect condition={condition} onChange={onFilterChange}/>\n\t\t\t</OperatorAndRightContainer>\n\t\t\t{isMemoryValue(condition.right)\n\t\t\t\t? <RightAsInMemoryContainer>\n\t\t\t\t\t<div>Memory Context</div>\n\t\t\t\t\t<ActionInput value={condition.right.name} onChange={onInMemoryVariableNameChanged}\n\t\t\t\t\t             placeholder='Variable name...'/>\n\t\t\t\t\t<ArithmeticSelect aggregate={false} value={condition.right} right={true} onChange={onFilterChange}/>\n\t\t\t\t</RightAsInMemoryContainer>\n\t\t\t\t: null}\n\t\t</Dropdown>\n\t</Container>;\n};\n","import { faTrashAlt } from '@fortawesome/free-regular-svg-icons';\nimport { faChevronDown, faLongArrowAltLeft, faLongArrowAltRight, faPlus } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { useState } from 'react';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../../../common/utils';\nimport {\n\tCompositeCondition,\n\tCompositeMode,\n\tConditionOperator,\n\tPlainCondition\n} from '../../../../../services/admin/pipeline-types';\nimport { QueriedTopicForPipeline } from '../../../../../services/admin/types';\nimport { HorizontalOptions } from '../components/horizontal-options';\nimport { computeConditionLines, isCompositeCondition } from '../components/utils';\nimport { PipelineUnitConditionEvent, usePipelineUnitConditionContext } from '../pipeline-unit-condition-context';\nimport { PlainConditionRow } from './plain-condition-row';\n\nconst Container = styled.div.attrs({\n\t'data-widget': 'composite-condition'\n})`\n\tdisplay: flex;\n\tposition: relative;\n\tflex-direction: column;\n\t&[data-removable=true] {\n\t\t&:before,\n\t\t&:after {\n\t\t\tcontent: '';\n\t\t\tdisplay: block;\n\t\t\tposition: absolute;\n\t\t\tbackground-color: var(--border-color);\n\t\t}\n\t\t&:before {\n\t\t\ttop: 16px;\n\t\t\tleft: calc(var(--margin) / -2);\n\t\t\twidth: calc(var(--margin) / 2 - 4px);\n\t\t\theight: 1px;\n\t\t}\n\t\t&:after {\n\t\t\ttop: 0;\n\t\t\tleft: calc(var(--margin) / -2);\n\t\t\twidth: 1px;\n\t\t\theight: 16px;\n\t\t}\n\t\t&:not(:last-child):after {\n\t\t\theight: 100%;\n\t\t}\n\t}\n`;\nconst Title = styled.div.attrs({\n\t'data-widget': 'composite-condition-title'\n})`\n\tdisplay: grid;\n\tgrid-template-columns: auto auto auto 1fr;\n\theight: 32px;\n\tmin-height: 32px;\n\talign-items: center;\n\ttransition: all 300ms ease-in-out;\n\t&:hover {\n\t\t> div:nth-child(3) {\n\t\t\tborder-top-right-radius: 0;\n\t\t\tborder-bottom-right-radius: 0;\n\t\t}\n\t\t> div:nth-child(4) {\n\t\t\topacity: 1;\n\t\t\tpointer-events: auto;\n\t\t}\n\t}\n\t&[data-expanded=false] {\n\t\t> div:first-child > svg {\n\t\t\ttransform: rotateZ(-90deg);\n\t\t}\n\t\t+ div {\n\t\t\tmin-height: 0;\n\t\t\theight: 0;\n\t\t}\n\t}\n\t> div:first-child {\n\t\tdisplay: flex;\n\t\twidth: var(--margin);\n\t\tjustify-content: center;\n\t\tcursor: pointer;\n\t\t> svg {\n\t\t\topacity: 0.7;\n\t\t\ttransition: all 300ms ease-in-out;\n\t\t}\n\t}\n\t> div:nth-child(2) {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\theight: 22px;\n\t\tfont-variant: petite-caps;\n\t\tfont-weight: var(--font-demi-bold);\n\t\tborder-top-left-radius: 11px;\n\t\tborder-bottom-left-radius: 11px;\n\t\tpadding: 0 calc(var(--margin) / 3);\n\t\tbackground-color: var(--pipeline-bg-color);\n\t\tbox-shadow: 0 1px 0 0 var(--border-color), 0 -1px 0 0 var(--border-color), -1px 0 0 0 var(--border-color);\n\t}\n\t> div:nth-child(3) {\n\t\tfont-variant: petite-caps;\n\t\tfont-weight: var(--font-demi-bold);\n\t\ttext-transform: capitalize;\n\t\tborder-top-left-radius: 0;\n\t\tborder-bottom-left-radius: 0;\n\t}\n\t> div:nth-child(4) {\n\t\tdisplay: flex;\n\t\tjustify-self: start;\n\t\tcursor: pointer;\n\t\tborder-top-right-radius: 11px;\n\t\tborder-bottom-right-radius: 11px;\n\t\tbackground-color: var(--pipeline-bg-color);\n\t\topacity: 0;\n\t\tpointer-events: none;\n\t\ttransition: all 300ms ease-in-out;\n\t\t> div {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tjustify-content: center;\n\t\t\theight: 22px;\n\t\t\tbox-shadow: 0 1px 0 0 var(--border-color), 0 -1px 0 0 var(--border-color), 1px 0 0 0 var(--border-color);\n\t\t\tpadding: 0 calc(var(--margin) / 3);\n\t\t\tfont-size: 0.8em;\n\t\t\ttransition: all 300ms ease-in-out;\n\t\t\t&:hover {\n\t\t\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t\t\t\tpointer-events: auto;\n\t\t\t}\n\t\t\t&:last-child {\n\t\t\t\tborder-top-right-radius: 11px;\n\t\t\t\tborder-bottom-right-radius: 11px;\n\t\t\t}\n\t\t}\n\t}\n`;\nconst NoChild = styled.div.attrs({\n\t'data-widget': 'composite-condition-no-child'\n})`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\tpadding: 0 var(--margin);\n\tmin-height: 32px;\n\theight: 32px;\n\toverflow: hidden;\n\ttransition: all 300ms ease-in-out;\n\t&:before,\n\t&:after {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\tbackground-color: var(--border-color);\n\t}\n\t&:before {\n\t\ttop: 16px;\n\t\tleft: calc(var(--margin) / 2);\n\t\twidth: calc(var(--margin) / 2 - 4px);\n\t\theight: 1px;\n\t}\n\t&:after {\n\t\ttop: 0;\n\t\tleft: calc(var(--margin) / 2);\n\t\twidth: 1px;\n\t\theight: 16px;\n\t}\n`;\nconst ChildConditionsNode = styled.div.attrs<{ count: number, visible: boolean }>(\n\t({ count, visible }) => {\n\t\treturn {\n\t\t\t'data-widget': 'composite-condition-children',\n\t\t\tstyle: {\n\t\t\t\tmaxHeight: visible ? count * 32 : 0,\n\t\t\t\ttransform: visible ? 'none' : 'rotateX(90deg)'\n\t\t\t}\n\t\t};\n\t})<{ count: number, visible: boolean }>`\n\tdisplay: flex;\n\tflex-direction: column;\n\tpadding-left: var(--margin);\n\ttransform-origin: top;\n\ttransition: all 300ms ease-in-out;\n`;\n\nconst ChildConditions = (props: {\n\tleft?: QueriedTopicForPipeline;\n\tparent?: CompositeCondition;\n\tcondition: CompositeCondition;\n\tvisible: boolean;\n\tlevel: number;\n}) => {\n\tconst { left: topic, parent: parentCondition, condition, visible, level } = props;\n\n\tconst lines = computeConditionLines(condition) - 1;\n\n\treturn <ChildConditionsNode visible={visible} count={lines}>\n\t\t{condition.children.map((child, index) => {\n\t\t\tif (isCompositeCondition(child)) {\n\t\t\t\treturn <CompositeConditionRow left={topic}\n\t\t\t\t                              grandParent={parentCondition} parent={condition} condition={child}\n\t\t\t\t                              removable={true} level={level}\n\t\t\t\t                              key={index}/>;\n\t\t\t} else {\n\t\t\t\tconst plain = child as PlainCondition;\n\t\t\t\treturn <PlainConditionRow left={topic}\n\t\t\t\t                          grandParent={parentCondition} parent={condition} condition={plain}\n\t\t\t\t                          key={index}/>;\n\t\t\t}\n\t\t})}\n\t</ChildConditionsNode>;\n};\n\nexport const CompositeConditionRow = (props: {\n\tleft?: QueriedTopicForPipeline;\n\tgrandParent?: CompositeCondition;\n\tparent?: CompositeCondition;\n\tcondition: CompositeCondition;\n\tremovable: boolean;\n\tlevel: number;\n}) => {\n\tconst {\n\t\tleft: topic,\n\t\tgrandParent: grandParentCondition,\n\t\tparent: parentCondition,\n\t\tcondition,\n\t\tremovable,\n\t\tlevel\n\t} = props;\n\n\tconst { firePropertyChange } = usePipelineUnitConditionContext();\n\tconst [ expanded, setExpanded ] = useState(true);\n\tconst forceUpdate = useForceUpdate();\n\n\tconst label = condition.mode;\n\tconst onToggleExpandedClicked = () => setExpanded(!expanded);\n\tconst onSelect = (mode: CompositeMode) => {\n\t\tcondition.mode = mode;\n\t\tfirePropertyChange(PipelineUnitConditionEvent.FILTER_CHANGED);\n\t\tforceUpdate();\n\t};\n\tconst onAddSubFilterClicked = () => {\n\t\tcondition.children.push({ operator: ConditionOperator.EQUALS });\n\t\texpanded ? forceUpdate() : setExpanded(true);\n\t\tfirePropertyChange(PipelineUnitConditionEvent.FILTER_ADDED);\n\t};\n\tconst onOutdentClicked = () => {\n\t\tif (!grandParentCondition || !parentCondition) {\n\t\t\treturn;\n\t\t}\n\t\tconst indexInParent = parentCondition.children.findIndex(child => child === condition);\n\t\tconst indexInGrand = grandParentCondition.children.findIndex(child => child === parentCondition);\n\t\t// remove from parent\n\t\tparentCondition.children.splice(indexInParent, 1);\n\t\t// add into grand, after parent\n\t\tgrandParentCondition.children.splice(indexInGrand + 1, 0, condition);\n\t\tfirePropertyChange(PipelineUnitConditionEvent.FILTER_OUTDENT);\n\t};\n\tconst onIndentClicked = () => {\n\t\tif (!parentCondition) {\n\t\t\treturn;\n\t\t}\n\t\tconst newParent: CompositeCondition = { mode: CompositeMode.AND, children: [ condition ] };\n\t\tconst mode = parentCondition.mode;\n\t\tif (mode === CompositeMode.AND) {\n\t\t\tnewParent.mode = CompositeMode.OR;\n\t\t}\n\t\tconst index = parentCondition.children.findIndex(child => child === condition);\n\t\tparentCondition.children.splice(index, 1, newParent);\n\t\tfirePropertyChange(PipelineUnitConditionEvent.FILTER_INDENT);\n\t};\n\tconst onRemoveClicked = () => {\n\t\tif (!parentCondition) {\n\t\t\treturn;\n\t\t}\n\t\tconst index = parentCondition.children.findIndex(child => child === condition);\n\t\tparentCondition.children.splice(index, 1);\n\t\tfirePropertyChange(PipelineUnitConditionEvent.FILTER_REMOVED);\n\t};\n\n\treturn <Container data-expanded={expanded} data-removable={removable}>\n\t\t<Title data-expanded={expanded}>\n\t\t\t<div onClick={onToggleExpandedClicked}><FontAwesomeIcon icon={faChevronDown}/></div>\n\t\t\t<div>Lv{level}</div>\n\t\t\t<HorizontalOptions label={label}\n\t\t\t                   options={[ CompositeMode.AND, CompositeMode.OR ].filter(x => x !== condition.mode)}\n\t\t\t                   toLabel={(mode: CompositeMode) => mode}\n\t\t\t                   onSelect={onSelect}/>\n\t\t\t<div>\n\t\t\t\t<div onClick={onAddSubFilterClicked}>\n\t\t\t\t\t<FontAwesomeIcon icon={faPlus}/>\n\t\t\t\t</div>\n\t\t\t\t{!!grandParentCondition\n\t\t\t\t\t? <div onClick={onOutdentClicked}>\n\t\t\t\t\t\t<FontAwesomeIcon icon={faLongArrowAltLeft}/>\n\t\t\t\t\t</div>\n\t\t\t\t\t: null}\n\t\t\t\t{removable\n\t\t\t\t\t? <div onClick={onIndentClicked}>\n\t\t\t\t\t\t<FontAwesomeIcon icon={faLongArrowAltRight}/>\n\t\t\t\t\t</div>\n\t\t\t\t\t: null}\n\t\t\t\t{removable\n\t\t\t\t\t? <div onClick={onRemoveClicked}>\n\t\t\t\t\t\t<FontAwesomeIcon icon={faTrashAlt}/>\n\t\t\t\t\t</div>\n\t\t\t\t\t: null}\n\t\t\t</div>\n\t\t</Title>\n\t\t{condition.children.length === 0\n\t\t\t? <NoChild>No Child Defined.</NoChild>\n\t\t\t: <ChildConditions left={topic} parent={parentCondition} condition={condition} visible={expanded}\n\t\t\t                   level={level + 1}/>}\n\t</Container>;\n};\n","import React, { useEffect } from 'react';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../../../common/utils';\nimport { usePipelineContext } from '../../pipeline-context';\nimport { ArrangedProcessUnit } from '../../types';\nimport { computeConditionLines } from '../components/utils';\nimport { PipelineUnitConditionEvent, usePipelineUnitConditionContext } from '../pipeline-unit-condition-context';\nimport { CompositeConditionRow } from './composite-condition-row';\n\nconst Container = styled.div`\n\tdisplay: flex;\n\tflex-direction: column;\n\tgrid-column: 2 / span 3;\n`;\nconst FilterContent = styled.div.attrs<{ lines: number, expanded: boolean }>(({ lines, expanded }) => {\n\treturn { style: { maxHeight: expanded ? lines * 32 : 0, transform: expanded ? 'unset' : 'scaleY(0)' } };\n})<{ lines: number, expanded: boolean }>`\n\tdisplay: flex;\n\tflex-direction: column;\n\tflex-grow: 1;\n\ttransform-origin: top;\n\ttransition: all 300ms ease-in-out;\n\t&::-webkit-scrollbar {\n\t\tbackground-color: transparent;\n\t\twidth: 4px;\n\t}\n\t&::-webkit-scrollbar-track {\n\t\tbackground-color: transparent;\n\t\tborder-radius: 2px;\n\t}\n\t&::-webkit-scrollbar-thumb {\n\t\tbackground-color: var(--console-favorite-color);\n\t\tborder-radius: 2px;\n\t}\n`;\n\nexport const ConditionMatcher = (props: {\n\tunit: ArrangedProcessUnit;\n\texpanded: boolean;\n}) => {\n\tconst { unit, expanded } = props;\n\n\tconst { store: { topics, selectedPipeline } } = usePipelineContext();\n\tconst { addPropertyChangeListener, removePropertyChangeListener } = usePipelineUnitConditionContext();\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\taddPropertyChangeListener(PipelineUnitConditionEvent.FILTER_ADDED, forceUpdate);\n\t\taddPropertyChangeListener(PipelineUnitConditionEvent.FILTER_REMOVED, forceUpdate);\n\t\taddPropertyChangeListener(PipelineUnitConditionEvent.FILTER_INDENT, forceUpdate);\n\t\taddPropertyChangeListener(PipelineUnitConditionEvent.FILTER_OUTDENT, forceUpdate);\n\t\treturn () => {\n\t\t\tremovePropertyChangeListener(PipelineUnitConditionEvent.FILTER_ADDED, forceUpdate);\n\t\t\tremovePropertyChangeListener(PipelineUnitConditionEvent.FILTER_REMOVED, forceUpdate);\n\t\t\tremovePropertyChangeListener(PipelineUnitConditionEvent.FILTER_INDENT, forceUpdate);\n\t\t\tremovePropertyChangeListener(PipelineUnitConditionEvent.FILTER_OUTDENT, forceUpdate);\n\t\t};\n\t});\n\n\t// eslint-disable-next-line\n\tconst topic = topics.find(topic => topic.topicId == selectedPipeline?.topicId);\n\n\tconst linesCount = computeConditionLines(unit.on!);\n\treturn <Container>\n\t\t{topic\n\t\t\t? <FilterContent lines={linesCount} expanded={expanded}>\n\t\t\t\t<CompositeConditionRow left={topic} condition={unit.on!} removable={false} level={1}/>\n\t\t\t</FilterContent>\n\t\t\t: null}\n\t</Container>;\n};","import { faCompressArrowsAlt, faExpandArrowsAlt } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { useEffect, useState } from 'react';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../../common/utils';\nimport { CompositeMode } from '../../../../services/admin/pipeline-types';\nimport { ArrangedProcessUnit } from '../types';\nimport { HorizontalOptions } from './components/horizontal-options';\nimport { computeConditionCount } from './components/utils';\nimport { usePipelineEditContext } from './pipeline-edit-context';\nimport {\n\tPipelineUnitConditionContextProvider,\n\tPipelineUnitConditionEvent,\n\tusePipelineUnitConditionContext\n} from './pipeline-unit-condition-context';\nimport { ConditionMatcher } from './unit-condition/condition-matcher';\n\nconst UnitCondition = styled.div.attrs({\n\t'data-widget': 'stage-unit-condition'\n})`\n\tdisplay: grid;\n\tpadding: 0 calc(var(--margin) / 2);\n\tgrid-template-columns: calc(120px - var(--margin) / 2) auto auto 1fr;\n\tgrid-column-gap: calc(var(--margin) / 2);\n\t&[data-conditional=true] {\n\t\t> div:nth-child(2) {\n\t\t\tborder-top-right-radius: 0;\n\t\t\tborder-bottom-right-radius: 0;\n\t\t}\n\t\t> div:nth-child(3) {\n\t\t\topacity: 1;\n\t\t\tpointer-events: auto;\n\t\t}\n\t}\n\t> div:nth-child(2) {\n\t\talign-self: center;\n\t\tfont-variant: petite-caps;\n\t\tfont-weight: var(--font-demi-bold);\n\t}\n\t> div:nth-child(3) {\n\t\tdisplay: flex;\n\t\talign-self: center;\n\t\talign-items: center;\n\t\theight: 22px;\n\t\tbackground-color: var(--pipeline-bg-color);\n\t\tpadding: 0 calc(var(--margin) / 3);\n\t\tmargin-left: calc(var(--margin) / -2);\n\t\tbox-shadow: 1px 0 0 0 var(--border-color), 0 1px 0 0 var(--border-color), 0 -1px 0 0 var(--border-color);\n\t\topacity: 0;\n\t\tpointer-events: none;\n\t\ttransition: all 300ms ease-in-out;\n\t\tborder-top-right-radius: 11px;\n\t\tborder-bottom-right-radius: 11px;\n\t\tfont-variant: petite-caps;\n\t\tfont-weight: var(--font-demi-bold);\n\t\tcursor: pointer;\n\t\t&:hover {\n\t\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t\t}\n\t\t&[data-condition-expanded=true] {\n\t\t\t> svg {\n\t\t\t\ttransform: rotateZ(180deg);\n\t\t\t}\n\t\t}\n\t\t> svg {\n\t\t\tmargin-left: calc(var(--margin) / 3);\n\t\t\tfont-size: 0.9em;\n\t\t\ttransition: all 300ms ease-in-out;\n\t\t}\n\t}\n\t> button {\n\t\talign-self: center;\n\t\tjustify-self: end;\n\t\t> svg {\n\t\t\ttransition: all 300ms ease-in-out;\n\t\t}\n\t}\n`;\nconst UnitSectionLabel = styled.div.attrs({\n\t'data-widget': 'stage-unit-label'\n})`\n\twhite-space: nowrap;\n\tfont-weight: var(--font-demi-bold);\n\tfont-variant: petite-caps;\n\theight: 24px;\n\tline-height: 24px;\n\tmargin-top: 4px;\n\talign-self: start;\n`;\n\nconst FilterLabel = (props: { unit: ArrangedProcessUnit; visible: boolean }) => {\n\tconst { unit, visible } = props;\n\n\tconst { addPropertyChangeListener, removePropertyChangeListener } = usePipelineUnitConditionContext();\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\taddPropertyChangeListener(PipelineUnitConditionEvent.FILTER_ADDED, forceUpdate);\n\t\taddPropertyChangeListener(PipelineUnitConditionEvent.FILTER_REMOVED, forceUpdate);\n\t\taddPropertyChangeListener(PipelineUnitConditionEvent.FILTER_INDENT, forceUpdate);\n\t\taddPropertyChangeListener(PipelineUnitConditionEvent.FILTER_OUTDENT, forceUpdate);\n\t\treturn () => {\n\t\t\tremovePropertyChangeListener(PipelineUnitConditionEvent.FILTER_ADDED, forceUpdate);\n\t\t\tremovePropertyChangeListener(PipelineUnitConditionEvent.FILTER_REMOVED, forceUpdate);\n\t\t\tremovePropertyChangeListener(PipelineUnitConditionEvent.FILTER_INDENT, forceUpdate);\n\t\t\tremovePropertyChangeListener(PipelineUnitConditionEvent.FILTER_OUTDENT, forceUpdate);\n\t\t};\n\t});\n\n\tif (!visible) {\n\t\treturn <span/>;\n\t}\n\n\tconst filtersCount = computeConditionCount(unit.on!);\n\tif (filtersCount === 0) {\n\t\treturn <span>No Filter Defined</span>;\n\t} else if (filtersCount === 1) {\n\t\treturn <span>1 Filter</span>;\n\t} else {\n\t\treturn <span>{filtersCount} Filters</span>;\n\t}\n};\n\nexport const PipelineUnitCondition = (props: {\n\tunit: ArrangedProcessUnit;\n\texpanded: boolean;\n\tchildren?: ((props: any) => React.ReactNode) | React.ReactNode;\n}) => {\n\tconst { unit, expanded, children } = props;\n\n\tconst { firePipelineContentChange } = usePipelineEditContext();\n\tconst [ conditional, setConditional ] = useState(!!unit.on);\n\tconst [ conditionExpanded, setConditionExpanded ] = useState(false);\n\n\tconst toLabel = (withCondition: boolean) => withCondition ? 'Conditional' : 'Anyway';\n\tconst onConditionExpandClicked = () => setConditionExpanded(!conditionExpanded);\n\tconst onTypeChanged = (withCondition: boolean) => {\n\t\tif (withCondition) {\n\t\t\tunit.on = unit.on || { mode: CompositeMode.AND, children: [] };\n\t\t} else {\n\t\t\tdelete unit.on;\n\t\t}\n\t\tfirePipelineContentChange();\n\t\tsetConditional(withCondition);\n\t};\n\n\tconst conditionLabel = toLabel(conditional);\n\tif (conditional) {\n\t\tif (!unit.on) {\n\t\t\tunit.on = { mode: CompositeMode.AND, children: [] };\n\t\t}\n\t}\n\n\treturn <PipelineUnitConditionContextProvider>\n\t\t<UnitCondition data-conditional={conditional}>\n\t\t\t<UnitSectionLabel>When:</UnitSectionLabel>\n\t\t\t<HorizontalOptions label={conditionLabel}\n\t\t\t                   options={[ !conditional ]} toLabel={toLabel}\n\t\t\t                   onSelect={onTypeChanged}/>\n\t\t\t<div data-visible={conditional} onClick={onConditionExpandClicked}\n\t\t\t     data-condition-expanded={conditionExpanded}>\n\t\t\t\t<FilterLabel unit={unit} visible={conditional}/>\n\t\t\t\t<FontAwesomeIcon icon={conditionExpanded ? faCompressArrowsAlt : faExpandArrowsAlt}/>\n\t\t\t</div>\n\t\t\t{children}\n\t\t\t{conditional && expanded ? <ConditionMatcher unit={unit} expanded={conditionExpanded}/> : null}\n\t\t</UnitCondition>\n\t</PipelineUnitConditionContextProvider>;\n};","import { faMinus } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React from 'react';\nimport styled from 'styled-components';\n\nconst AL = styled.div.attrs({\n\t'data-widget': 'stage-unit-action-lead'\n})`\n\twhite-space: nowrap;\n\tfont-weight: var(--font-demi-bold);\n\theight: 32px;\n\tline-height: 32px;\n\talign-self: start;\n\tjustify-self: end;\n\tpadding-right: calc(var(--margin) / 2);\n`;\n\nexport const ActionLead = () => {\n\treturn <AL><FontAwesomeIcon icon={faMinus}/></AL>;\n};\n","import { faCompressAlt, faExpandAlt } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { Fragment, useRef, useState } from 'react';\nimport styled from 'styled-components';\nimport { useCollapseFixedThing } from '../../../../../common/utils';\nimport {\n\tCompositeMode,\n\tNoArithmetic,\n\tReadTopicActionType,\n\tSomeValueType,\n\tSystemActionType,\n\tUnitActionAlarmSeverity,\n\tUnitActionType,\n\tWriteTopicActionType\n} from '../../../../../services/admin/pipeline-types';\nimport { ArrangedUnitAction } from '../../types';\nimport { unitActionTypeAsDisplay } from '../utils';\n\ninterface DropdownRect {\n\ttop: number;\n\tleft: number;\n\twidth: number;\n\tatTop: boolean;\n}\n\nconst ActionSelectContainer = styled.div.attrs({\n\t'data-widget': 'stage-unit-action-select'\n})`\n\tdisplay: flex;\n\tposition: relative;\n\tjustify-self: flex-start;\n\tborder: var(--border);\n\tborder-color: transparent;\n\tborder-radius: 12px;\n\tbackground-color: transparent;\n\theight: 24px;\n\tline-height: 22px;\n\toutline: none;\n\tappearance: none;\n\twhite-space: nowrap;\n\tcursor: pointer;\n\ttransition: all 300ms ease-in-out;\n\t&[data-expanded=true],\n\t&:hover {\n\t\tborder-color: transparent;\n\t\tbackground-color: var(--pipeline-bg-color);\n\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t\t> div:first-child {\n\t\t\tpadding-left: calc(var(--margin) / 2);\n\t\t}\n\t\t> div:last-child {\n\t\t\topacity: 1;\n\t\t\tpointer-events: auto;\n\t\t}\n\t}\n\t&[data-expanded=true] > div:last-child > svg {\n\t\ttransform: rotateZ(180deg);\n\t}\n\t> div:first-child {\n\t\tposition: relative;\n\t\tfont-weight: var(--font-bold);\n\t\tfont-variant: petite-caps;\n\t\tborder-top-left-radius: 12px;\n\t\tborder-bottom-left-radius: 12px;\n\t\ttransition: all 300ms ease-in-out;\n\t}\n\t> div:last-child {\n\t\tposition: relative;\n\t\tpadding: 0 calc(var(--margin) / 3);\n\t\topacity: 0;\n\t\tpointer-events: none;\n\t\ttransition: all 300ms ease-in-out;\n\t\t> svg {\n\t\t\ttransition: all 300ms ease-in-out;\n\t\t}\n\t}\n`;\nconst Dropdown = styled.div.attrs<DropdownRect>(({ top, left, width, atTop }) => {\n\treturn {\n\t\tstyle: {\n\t\t\ttop, left, minWidth: Math.max(width, 200),\n\t\t\ttransformOrigin: atTop ? 'bottom' : 'top'\n\t\t}\n\t};\n})<DropdownRect>`\n\tdisplay: flex;\n\tposition: fixed;\n\tflex-direction: column;\n\tz-index: 1000;\n\theight: 180px;\n\ttransform: scaleY(0);\n\ttransition: transform 300ms ease-in-out;\n\tpointer-events: none;\n\tbackground-color: var(--bg-color);\n\tborder-radius: 12px;\n\tbox-shadow: var(--console-primary-hover-shadow);\n\t&[data-expanded=true] {\n\t\ttransform: scaleY(1);\n\t\tpointer-events: auto;\n\t\t&:before {\n\t\t\tcontent: '';\n\t\t\tdisplay: block;\n\t\t\tposition: absolute;\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t\tborder-radius: 12px;\n\t\t\tbackground-color: var(--pipeline-bg-color);\n\t\t\tz-index: -1;\n\t\t}\n\t}\n\t> div {\n\t\tmin-height: 28px;\n\t\tpadding: 0 calc(var(--margin) / 2);\n\t}\n\t> div[data-role='action-category'] {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tfont-weight: var(--font-bold);\n\t\tcursor: default;\n\t}\n\t> div[data-role='actions'] {\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t\tgrid-column-gap: calc(var(--margin) / 4);\n\t\tgrid-row-gap: calc(var(--margin) / 8);\n\t\tbackground-color: var(--bg-color);\n\t\tpadding: calc(var(--margin) / 8) calc(var(--margin) / 2);\n\t\tcursor: default;\n\t\t&:last-child {\n\t\t\tborder-bottom-left-radius: 12px;\n\t\t\tborder-bottom-right-radius: 12px;\n\t\t}\n\t\t> div {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\theight: 24px;\n\t\t\tline-height: 22px;\n\t\t\tborder-radius: 12px;\n\t\t\tborder: var(--border);\n\t\t\tpadding: 0 calc(var(--margin) / 4);\n\t\t\ttransition: all 300ms ease-in-out;\n\t\t\tcursor: pointer;\n\t\t\t&:hover,\n\t\t\t&[data-current=true] {\n\t\t\t\tborder-color: var(--console-favorite-color);\n\t\t\t\tcolor: var(--invert-color);\n\t\t\t\tbackground-color: var(--console-favorite-color);\n\t\t\t}\n\t\t\t&[data-current=true] {\n\t\t\t\tcursor: default;\n\t\t\t}\n\t\t}\n\t}\n`;\n\nconst ActionTypes = [\n\t{ label: 'Write to Topic', enum: WriteTopicActionType },\n\t{ label: 'Read from Topic', enum: ReadTopicActionType },\n\t{ label: 'System', enum: SystemActionType }\n];\n\ninterface ActionDefault {\n\tkeep: Array<string>,\n\tdefault: { [key in string]: number | string | boolean | object }\n}\n\nconst OnActionTypeChanged: { [key in WriteTopicActionType | ReadTopicActionType | SystemActionType]: ActionDefault } = {\n\t[WriteTopicActionType.INSERT_ROW]: { keep: [ 'topicId' ], default: { mapping: [] } },\n\t[WriteTopicActionType.MERGE_ROW]: {\n\t\tkeep: [ 'topicId' ],\n\t\tdefault: { by: { mode: CompositeMode.AND, children: [] }, mapping: [] }\n\t},\n\t[WriteTopicActionType.INSERT_OR_MERGE_ROW]: {\n\t\tkeep: [ 'topicId' ],\n\t\tdefault: { by: { mode: CompositeMode.AND, children: [] }, mapping: [] }\n\t},\n\t[WriteTopicActionType.WRITE_FACTOR]: {\n\t\tkeep: [ 'topicId', 'factorId' ],\n\t\tdefault: {\n\t\t\tvalue: { type: SomeValueType.FACTOR, arithmetic: NoArithmetic.NO_FUNC },\n\t\t\tby: { mode: CompositeMode.AND, children: [] }\n\t\t}\n\t},\n\t[ReadTopicActionType.EXISTS]: { keep: [ 'topicId' ], default: { by: { mode: CompositeMode.AND, children: [] } } },\n\t[ReadTopicActionType.READ_ROW]: { keep: [ 'topicId' ], default: { by: { mode: CompositeMode.AND, children: [] } } },\n\t[ReadTopicActionType.READ_FACTOR]: {\n\t\tkeep: [ 'topicId', 'factorId' ],\n\t\tdefault: { by: { mode: CompositeMode.AND, children: [] } }\n\t},\n\n\t[SystemActionType.COPY_TO_MEMORY]: {\n\t\tkeep: [],\n\t\tdefault: { value: { type: SomeValueType.FACTOR, arithmetic: NoArithmetic.NO_FUNC } }\n\t},\n\t[SystemActionType.ALARM]: { keep: [ 'severity' ], default: { severity: UnitActionAlarmSeverity.MEDIUM } }\n};\n\nconst ActionTypeButton = (props: {\n\ttype: UnitActionType;\n\tcurrent: UnitActionType;\n\tonClick: (type: UnitActionType) => void;\n}) => {\n\tconst { type, current, onClick } = props;\n\n\treturn <div data-current={current === type} onClick={() => onClick(type)}>{unitActionTypeAsDisplay(type)}</div>;\n};\n\nexport const ActionSelect = (props: {\n\taction: ArrangedUnitAction;\n\tonTypeChanged: () => void;\n}) => {\n\tconst { action, onTypeChanged } = props;\n\tconst { type } = action;\n\n\tconst containerRef = useRef<HTMLDivElement>(null);\n\tconst dropdownRef = useRef<HTMLDivElement>(null);\n\tconst [ expanded, setExpanded ] = useState(false);\n\tconst [ dropdownRect, setDropdownRect ] = useState<DropdownRect>({ top: 0, left: 0, width: 0, atTop: false });\n\tuseCollapseFixedThing(containerRef, () => setExpanded(false));\n\n\tconst onExpandClick = () => {\n\t\tif (!expanded) {\n\t\t\tconst rect = containerRef.current!.getBoundingClientRect();\n\t\t\tconst top = rect.top + rect.height + 2;\n\t\t\tconst bottom = top + 180;\n\t\t\tif (bottom > window.innerHeight) {\n\t\t\t\tsetDropdownRect({ top: rect.top - 180 - 2, left: rect.left, width: rect.width, atTop: true });\n\t\t\t} else {\n\t\t\t\tsetDropdownRect({ top, left: rect.left, width: rect.width, atTop: false });\n\t\t\t}\n\t\t\tsetExpanded(true);\n\t\t}\n\t};\n\tconst onActionTypeClicked = (type: UnitActionType) => {\n\t\tif (type === action.type) {\n\t\t\treturn;\n\t\t}\n\t\taction.type = type;\n\t\tconst actionDefault = OnActionTypeChanged[type];\n\t\t// remove irrelevant properties\n\t\tObject.keys(action)\n\t\t\t.filter(key => ![ 'type', 'uuid' ].includes(key) && !actionDefault.keep.includes(key))\n\t\t\t.forEach(key => delete (action as any)[key]);\n\t\t// set default values\n\t\tObject.keys(actionDefault.default).forEach(key => (action as any)[key] = actionDefault.default[key]);\n\t\tsetExpanded(false);\n\t\tonTypeChanged();\n\t};\n\tconst onCaretClicked = (event: React.MouseEvent<HTMLDivElement>) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tsetExpanded(!expanded);\n\t};\n\n\treturn <ActionSelectContainer data-expanded={expanded} tabIndex={0} ref={containerRef}\n\t                              onClick={onExpandClick}>\n\t\t<div>{unitActionTypeAsDisplay(type)}</div>\n\t\t<Dropdown ref={dropdownRef} data-expanded={expanded} {...dropdownRect}>\n\t\t\t{ActionTypes.map(item => {\n\t\t\t\treturn <Fragment key={item.label}>\n\t\t\t\t\t<div data-role='action-category'>{item.label}</div>\n\t\t\t\t\t<div data-role='actions'>\n\t\t\t\t\t\t{Object.values(item.enum).map(candidateType => {\n\t\t\t\t\t\t\treturn <ActionTypeButton current={type} type={candidateType} key={candidateType}\n\t\t\t\t\t\t\t                         onClick={onActionTypeClicked}/>;\n\t\t\t\t\t\t})}\n\t\t\t\t\t</div>\n\t\t\t\t</Fragment>;\n\t\t\t})}\n\t\t</Dropdown>\n\t\t<div onClick={onCaretClicked}><FontAwesomeIcon icon={expanded ? faCompressAlt : faExpandAlt}/></div>\n\t</ActionSelectContainer>;\n};","import {faTrashAlt} from '@fortawesome/free-regular-svg-icons';\nimport {\n\tfaCompressArrowsAlt,\n\tfaEraser,\n\tfaExpandArrowsAlt,\n\tfaMicrochip,\n\tfaPencilRuler\n} from '@fortawesome/free-solid-svg-icons';\nimport {FontAwesomeIcon} from '@fortawesome/react-fontawesome';\nimport React, {Fragment, useState} from 'react';\nimport styled from 'styled-components';\nimport {useForceUpdate} from '../../../../common/utils';\nimport Button, {ButtonType} from '../../../component/button';\nimport {DangerObjectButton, PrimaryObjectButton, WaiveObjectButton} from '../../../component/object-button';\nimport {DialogContext, useDialog} from '../../../context/dialog';\nimport {ArrangedProcessUnit, ArrangedStage, ArrangedUnitAction} from '../types';\nimport {DropdownButton} from './components/dropdown-button';\nimport {usePipelineEditContext} from './pipeline-edit-context';\nimport {PipelineUnitActionContextProvider} from './pipeline-unit-action-context';\nimport {UnitActionNodes} from './pipeline-unit-actions';\nimport {PipelineUnitCondition} from './pipeline-unit-condition';\nimport {ActionLead} from './unit-actions/action-lead';\nimport {ActionSelect} from './unit-actions/action-select';\nimport {createAlarmAction} from './utils';\n\nconst UnitContainer = styled.div.attrs({\n\t'data-widget': 'stage-unit'\n})`\n\tdisplay: flex;\n\tposition: relative;\n\tflex-direction: column;\n\tfont-size: 0.8em;\n\t&:not(:first-child) {\n\t\tpadding-top: calc(var(--margin) / 4);\n\t}\n\t&:not(:last-child) {\n\t\tpadding-bottom: calc(var(--margin) / 4);\n\t}\n\t&:not(:last-child):before {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\tleft: calc(var(--margin) / 2);\n\t\tbottom: 0;\n\t\twidth: calc(100% - var(--margin));\n\t\theight: 1px;\n\t\tborder-bottom: 1px dashed var(--border-color);\n\t\tz-index: -1;\n\t}\n\t&:first-child:after {\n\t\ttop: 0;\n\t\theight: 100%;\n\t}\n\t&:after {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\ttop: 8px;\n\t\tleft: 0;\n\t\twidth: var(--margin);\n\t\theight: calc(100% - 8px);\n\t\tbackground-color: var(--console-primary-color);\n\t\tborder-radius: 0 calc(var(--margin) / 4) var(--margin) 0;\n\t\topacity: 0;\n\t\tz-index: -1;\n\t\ttransition: all 300ms ease-in-out;\n\t}\n\t&:hover {\n\t\tdiv[data-widget='stage-unit-label'] {\n\t\t\tbackground-color: var(--bg-color);\n\t\t\tborder-radius: var(--border-radius);\n\t\t\tmargin-left: calc(var(--margin) / -4);\n\t\t\tpadding-left: calc(var(--margin) / 4);\n\t\t}\n\t\t&:after {\n\t\t\topacity: 0.1;\n\t\t}\n\t}\n`;\nconst ToggleExpandButton = styled(WaiveObjectButton)`\n\t&[data-expanded=false] {\n\t\t> svg {\n\t\t\ttransform: rotateZ(180deg);\n\t\t}\n\t}\n`;\nconst UnitActions = styled.div.attrs({\n\t'data-widget': 'stage-unit-actions'\n})`\n\tdisplay: flex;\n\tflex-direction: column;\n\tpadding: 0 calc(var(--margin) / 2);\n\t&[data-expanded=false] {\n\t\tdisplay: none;\n\t}\n`;\nconst UnitActionContainer = styled.div.attrs({\n\t'data-widget': 'stage-unit-action'\n})`\n\tdisplay: grid;\n\tposition: relative;\n\tgrid-template-columns: calc(120px - var(--margin) / 2) 1fr auto;\n\tgrid-column-gap: calc(var(--margin) / 2);\n\t&:first-child {\n\t\tmargin: 4px 0;\n\t}\n\t&:before {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\tleft: calc(var(--margin) / -2);\n\t\twidth: var(--margin);\n\t\theight: 100%;\n\t\tbackground-color: var(--console-waive-color);\n\t\tborder-radius: 0 calc(var(--margin) / 4) var(--margin) 0;\n\t\topacity: 0;\n\t\tz-index: -1;\n\t\ttransition: all 300ms ease-in-out;\n\t}\n\t&:hover {\n\t\t&:before {\n\t\t\topacity: 0.25;\n\t\t}\n\t\t> button:nth-child(3) {\n\t\t\topacity: 1;\n\t\t\tpointer-events: auto;\n\t\t}\n\t}\n\t> div:nth-child(2) {\n\t\talign-self: center;\n\t}\n\t> button:nth-child(3) {\n\t\talign-self: center;\n\t\topacity: 0;\n\t\tpointer-events: none;\n\t}\n\t> *:nth-child(4) {\n\t\tgrid-column: span 3;\n\t}\n\tdiv[data-role='action-part-not-impl'],\n\tdiv[data-role='action-not-impl'] {\n\t\theight: 32px;\n\t\tline-height: 32px;\n\t\tfont-family: var(--console-title-font-family);\n\t\topacity: 0.5;\n\t}\n\tdiv[data-role='action-not-impl'] {\n\t\tgrid-column: span 2;\n\t}\n`;\nconst UnitButtons = styled.div.attrs({\n\t'data-widget': 'stage-unit-buttons'\n})`\n\tgrid-column: span 2;\n\tdisplay: grid;\n\tgrid-template-columns: 1fr auto auto auto;\n\tgrid-column-gap: calc(var(--margin) / 4);\n\talign-items: center;\n\tpadding: calc(var(--margin) / 4) 0;\n`;\n\nconst UnitActionNode = (props: {\n\tunit: ArrangedProcessUnit;\n\taction: ArrangedUnitAction;\n\tdeleteAction: (action: ArrangedUnitAction) => void;\n}) => {\n\tconst {unit, action, deleteAction} = props;\n\tconst {type} = action;\n\n\tconst dialog = useDialog();\n\tconst {firePipelineContentChange} = usePipelineEditContext();\n\tconst forceUpdate = useForceUpdate();\n\n\tconst onActionTypeChanged = () => {\n\t\tfirePipelineContentChange();\n\t\tforceUpdate();\n\t}\n\tconst onActionDeleteConfirmClicked = () => {\n\t\tdeleteAction(action);\n\t\tdialog.hide();\n\t};\n\tconst onClearSettingsConfirmClicked = () => {\n\t\tunit.do.length = 0;\n\t\tunit.do.push(createAlarmAction());\n\t\tfirePipelineContentChange();\n\t\tdialog.hide();\n\t};\n\tconst onDeleteActionClicked = () => {\n\t\tif (unit.do.length !== 1) {\n\t\t\tdialog.show(\n\t\t\t\t<div data-widget='dialog-console-delete'>\n\t\t\t\t\t<span>Are you sure to delete this action?</span>\n\t\t\t\t</div>,\n\t\t\t\tbuildDialogButtons(dialog, onActionDeleteConfirmClicked)\n\t\t\t);\n\t\t} else {\n\t\t\tdialog.show(\n\t\t\t\t<div data-widget='dialog-console-delete'>\n\t\t\t\t\t<span>This is the last one in process unit, are you sure to clear all settings?</span>\n\t\t\t\t</div>,\n\t\t\t\tbuildDialogButtons(dialog, onClearSettingsConfirmClicked)\n\t\t\t);\n\t\t}\n\t};\n\n\tconst UnitNode = UnitActionNodes[type];\n\n\treturn <PipelineUnitActionContextProvider>\n\t\t<UnitActionContainer>\n\t\t\t<ActionLead/>\n\t\t\t<ActionSelect action={action} onTypeChanged={onActionTypeChanged}/>\n\t\t\t<DangerObjectButton onClick={onDeleteActionClicked}>\n\t\t\t\t<FontAwesomeIcon icon={faTrashAlt}/>\n\t\t\t\t<span>Delete This Action</span>\n\t\t\t</DangerObjectButton>\n\t\t\t{\n\t\t\t\tUnitNode\n\t\t\t\t\t// @ts-ignore\n\t\t\t\t\t? <UnitNode action={action}/>\n\t\t\t\t\t: <div data-role='action-not-impl'>[{type}] Not implemented yet</div>\n\t\t\t}\n\t\t</UnitActionContainer>\n\t</PipelineUnitActionContextProvider>;\n};\n\nconst buildDialogButtons = (dialog: DialogContext, onConfirm: () => void) => {\n\treturn <Fragment>\n\t\t<div style={{ flexGrow: 1 }}/>\n\t\t<Button inkType={ButtonType.PRIMARY} onClick={onConfirm}>Yes</Button>\n\t\t<Button inkType={ButtonType.DEFAULT} onClick={dialog.hide}>Cancel</Button>\n\t</Fragment>;\n};\n\nexport const PipelineUnit = (props: {\n\tstage: ArrangedStage;\n\tunit: ArrangedProcessUnit;\n\tappendUnit: () => void;\n\tprependUnit: (on: ArrangedProcessUnit) => void;\n\tdeleteUnit: (unit: ArrangedProcessUnit) => void;\n}) => {\n\tconst { stage, unit, appendUnit, prependUnit, deleteUnit } = props;\n\n\tconst dialog = useDialog();\n\tconst { firePipelineContentChange } = usePipelineEditContext();\n\tconst [ expanded, setExpanded ] = useState(true);\n\tconst forceUpdate = useForceUpdate();\n\n\tconst onExpandClicked = () => setExpanded(!expanded);\n\tconst onDeleteAction = (action: ArrangedUnitAction) => {\n\t\tconst index = unit.do.findIndex(exists => exists === action);\n\t\tif (index !== -1) {\n\t\t\tunit.do.splice(index, 1);\n\t\t\tfirePipelineContentChange();\n\t\t\tforceUpdate();\n\t\t}\n\t};\n\tconst onAppendActionClicked = () => {\n\t\tunit.do.push(createAlarmAction());\n\t\tfirePipelineContentChange();\n\t\tforceUpdate();\n\t};\n\tconst onUnitDeleteConfirmClicked = () => {\n\t\tdeleteUnit(unit);\n\t\tdialog.hide();\n\t};\n\tconst onClearActionsConfirmClicked = () => {\n\t\tunit.do = [ createAlarmAction() ];\n\t\tfirePipelineContentChange();\n\t\tdialog.hide();\n\t};\n\tconst onUnitDeleteClicked = () => {\n\t\tif (stage.units.length !== 1) {\n\t\t\tdialog.show(\n\t\t\t\t<div data-widget='dialog-console-delete'>\n\t\t\t\t\t<span>Are you sure to delete this unit?</span>\n\t\t\t\t</div>,\n\t\t\t\tbuildDialogButtons(dialog, onUnitDeleteConfirmClicked)\n\t\t\t);\n\t\t} else {\n\t\t\tdialog.show(\n\t\t\t\t<div data-widget='dialog-console-delete'>\n\t\t\t\t\t<span>This is the last one in stage, are you sure to clear all actions?</span>\n\t\t\t\t</div>,\n\t\t\t\tbuildDialogButtons(dialog, onClearActionsConfirmClicked)\n\t\t\t);\n\t\t}\n\t};\n\tconst onClearActionsClicked = () => {\n\t\tdialog.show(\n\t\t\t<div data-widget='dialog-console-delete'>\n\t\t\t\t<span>Are you sure to clear all actions?</span>\n\t\t\t</div>,\n\t\t\tbuildDialogButtons(dialog, onClearActionsConfirmClicked)\n\t\t);\n\t};\n\n\treturn <UnitContainer>\n\t\t<PipelineUnitCondition unit={unit} expanded={expanded}>\n\t\t\t<ToggleExpandButton onClick={onExpandClicked} data-expanded={expanded}>\n\t\t\t\t<FontAwesomeIcon icon={expanded ? faCompressArrowsAlt : faExpandArrowsAlt}/>\n\t\t\t\t<span>{expanded ? 'Hide This Process Unit' : 'Show This Process Unit'}</span>\n\t\t\t</ToggleExpandButton>\n\t\t</PipelineUnitCondition>\n\t\t<UnitActions data-expanded={expanded}>\n\t\t\t{unit.do.map(action => {\n\t\t\t\treturn <UnitActionNode unit={unit} action={action}\n\t\t\t\t                       deleteAction={onDeleteAction}\n\t\t\t\t                       key={action.uuid}/>;\n\t\t\t})}\n\t\t\t<UnitButtons>\n\t\t\t\t<div/>\n\t\t\t\t<PrimaryObjectButton onClick={onAppendActionClicked}>\n\t\t\t\t\t<FontAwesomeIcon icon={faPencilRuler}/>\n\t\t\t\t\t<span>Append Action</span>\n\t\t\t\t</PrimaryObjectButton>\n\t\t\t\t<DropdownButton icon={faMicrochip} type={ButtonType.PRIMARY} label='Append Process Unit'\n\t\t\t\t                onClick={appendUnit}\n\t\t\t\t                menus={[ {\n\t\t\t\t\t                icon: faMicrochip,\n\t\t\t\t\t                label: 'Prepend Process Unit',\n\t\t\t\t\t                onClick: () => prependUnit(unit)\n\t\t\t\t                } ]}/>\n\t\t\t\t<DropdownButton icon={faTrashAlt} type={ButtonType.DANGER} label='Delete This Unit'\n\t\t\t\t                onClick={onUnitDeleteClicked}\n\t\t\t\t                menus={[ {\n\t\t\t\t\t                icon: faEraser,\n\t\t\t\t\t                label: 'Clear Actions',\n\t\t\t\t\t                onClick: onClearActionsClicked\n\t\t\t\t                } ]}/>\n\t\t\t</UnitButtons>\n\t\t</UnitActions>\n\t</UnitContainer>;\n};","import { faTrashAlt } from '@fortawesome/free-regular-svg-icons';\nimport { faCompressArrowsAlt, faEraser, faExpandArrowsAlt, faProjectDiagram } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { Fragment, useRef, useState } from 'react';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../../common/utils';\nimport Button, { ButtonType } from '../../../component/button';\nimport { WaiveObjectButton } from '../../../component/object-button';\nimport { DialogContext, useDialog } from '../../../context/dialog';\nimport { ArrangedPipeline, ArrangedProcessUnit, ArrangedStage } from '../types';\nimport { AutoSwitchInput } from './components/auto-switch-input';\nimport { DropdownButton } from './components/dropdown-button';\nimport { usePipelineEditContext } from './pipeline-edit-context';\nimport { PipelineUnit } from './pipeline-unit';\nimport { createAlarmUnit } from './utils';\n\nconst StageContainer = styled.div.attrs({\n\t'data-widget': 'stage'\n})`\n\tdisplay: flex;\n\tposition: relative;\n\tflex-direction: column;\n\t&:before {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\twidth: var(--margin);\n\t\theight: 100%;\n\t\tbackground-color: var(--console-waive-color);\n\t\tborder-top-right-radius: calc(var(--margin) / 4);\n\t\tborder-bottom-right-radius: var(--margin);\n\t\topacity: 0;\n\t\tz-index: -1;\n\t\ttransition: all 300ms ease-in-out;\n\t}\n\t&:hover:before {\n\t\topacity: 0.25;\n\t}\n`;\nconst StageTitle = styled.div.attrs({\n\t'data-widget': 'stage-title'\n})`\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tposition: relative;\n\tfont-size: 0.8em;\n\tpadding: 0 calc(var(--margin) / 4);\n\tfont-family: var(--console-title-font-family);\n\theight: 32px;\n\tline-height: 32px;\n\t&:before {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\ttop: 50%;\n\t\tleft: -1px;\n\t\twidth: calc(100% + 2px);\n\t\theight: 50%;\n\t\tborder: 1px dashed var(--border-color);\n\t\tborder-bottom: 0;\n\t\tz-index: -1;\n\t}\n\t&[data-expanded=false] {\n\t\t> button {\n\t\t\t> svg {\n\t\t\t\ttransform: rotateZ(180deg);\n\t\t\t}\n\t\t}\n\t}\n\t> div:first-child {\n\t\tmargin-right: calc(var(--margin) / 4);\n\t}\n\t> button {\n\t\tmargin-right: calc(var(--margin) / 4);\n\t\t> svg {\n\t\t\ttransition: all 300ms ease-in-out;\n\t\t}\n\t}\n`;\nconst StageBody = styled.div.attrs({\n\t'data-widget': 'stage-body'\n})`\n\tflex-grow: 1;\n\t&[data-expanded=false] {\n\t\tdisplay: none;\n\t}\n`;\nconst StageFooter = styled.div.attrs({\n\t'data-widget': 'stage-footer'\n})`\n\tdisplay: grid;\n\tgrid-template-columns: 1fr auto auto;\n\tgrid-column-gap: calc(var(--margin) / 4);\n\talign-items: center;\n\tpadding: calc(var(--margin) / 2) calc(var(--margin) / 2);\n\tfont-size: 0.8em;\n\tborder-bottom: 1px dashed var(--border-color);\n\tmargin-bottom: calc(var(--margin) / 2);\n`;\n\nconst buildDialogButtons = (dialog: DialogContext, onConfirm: () => void) => {\n\treturn <Fragment>\n\t\t<div style={{ flexGrow: 1 }}/>\n\t\t<Button inkType={ButtonType.PRIMARY} onClick={onConfirm}>Yes</Button>\n\t\t<Button inkType={ButtonType.DEFAULT} onClick={dialog.hide}>Cancel</Button>\n\t</Fragment>;\n};\n\nexport const StageEditor = (props: {\n\tpipeline: ArrangedPipeline;\n\tstage: ArrangedStage;\n\tindex: number;\n\tappendStage: () => void;\n\tprependStage: (on: ArrangedStage) => void;\n\tdeleteStage: (stage: ArrangedStage) => void;\n}) => {\n\tconst { pipeline, stage, index, appendStage, prependStage, deleteStage } = props;\n\n\tconst dialog = useDialog();\n\tconst { firePipelineContentChange } = usePipelineEditContext();\n\tconst bodyRef = useRef<HTMLDivElement>(null);\n\tconst [ expanded, setExpanded ] = useState(true);\n\tconst forceUpdate = useForceUpdate();\n\n\tconst onNameChanged = (value: string) => {\n\t\tstage.name = value;\n\t\tfirePipelineContentChange();\n\t\tforceUpdate();\n\t};\n\tconst onExpandClicked = () => setExpanded(!expanded);\n\tconst onAppendUnit = () => {\n\t\tstage.units.push(createAlarmUnit());\n\t\tfirePipelineContentChange();\n\t\tforceUpdate();\n\t};\n\tconst onPrependUnit = (on: ArrangedProcessUnit) => {\n\t\tconst index = stage.units.findIndex(exists => exists === on);\n\t\tif (index === -1) {\n\t\t\tstage.units.unshift(createAlarmUnit());\n\t\t} else {\n\t\t\tstage.units.splice(index, 0, createAlarmUnit());\n\t\t}\n\t\tfirePipelineContentChange();\n\t\tforceUpdate();\n\t};\n\tconst onStageDeleteConfirmClicked = () => {\n\t\tdeleteStage(stage);\n\t\tdialog.hide();\n\t};\n\tconst onClearUnitsConfirmClicked = () => {\n\t\tstage.units = [ createAlarmUnit() ];\n\t\tfirePipelineContentChange();\n\t\tdialog.hide();\n\t};\n\tconst onStageDeleteClicked = () => {\n\t\tif (pipeline.stages.length !== 1) {\n\t\t\tdialog.show(\n\t\t\t\t<div data-widget='dialog-console-delete'>\n\t\t\t\t\t<span>\n\t\t\t\t\t\t<span>Are you sure to delete stage </span>\n\t\t\t\t\t\t<span data-widget='dialog-console-object'>{stage.name || 'Untitled Stage'}</span>\n\t\t\t\t\t\t<span>?</span>\n\t\t\t\t\t</span>\n\t\t\t\t</div>,\n\t\t\t\tbuildDialogButtons(dialog, onStageDeleteConfirmClicked)\n\t\t\t);\n\t\t} else {\n\t\t\tdialog.show(\n\t\t\t\t<div data-widget='dialog-console-delete'>\n\t\t\t\t\t<span>\n\t\t\t\t\t\t<span data-widget='dialog-console-object'>{stage.name || 'Untitled Stage'}</span>\n\t\t\t\t\t\t<span> is the last one in pipeline, are you sure to clear all process units?</span>\n\t\t\t\t\t</span>\n\t\t\t\t</div>,\n\t\t\t\tbuildDialogButtons(dialog, onClearUnitsConfirmClicked)\n\t\t\t);\n\t\t}\n\t};\n\tconst onClearUnitsClicked = () => {\n\t\tdialog.show(\n\t\t\t<div data-widget='dialog-console-delete'>\n\t\t\t\t<span>Are you sure to clear all process units?</span>\n\t\t\t</div>,\n\t\t\tbuildDialogButtons(dialog, onClearUnitsConfirmClicked)\n\t\t);\n\t};\n\tconst onDeleteUnit = (unit: ArrangedProcessUnit) => {\n\t\tconst index = stage.units.findIndex(exists => exists === unit);\n\t\tif (index !== -1) {\n\t\t\tstage.units.splice(index, 1);\n\t\t\tfirePipelineContentChange();\n\t\t\tforceUpdate();\n\t\t}\n\t};\n\n\treturn <StageContainer data-expanded={expanded}>\n\t\t<StageTitle data-expanded={expanded}>\n\t\t\t<AutoSwitchInput onChange={onNameChanged}\n\t\t\t                 prefixLabel={`#${index}`} value={stage.name} placeholder='Untitled Stage'\n\t\t\t                 styles={{ inputFontSize: '0.8em' }}/>\n\t\t\t<WaiveObjectButton onClick={onExpandClicked}>\n\t\t\t\t<FontAwesomeIcon icon={expanded ? faCompressArrowsAlt : faExpandArrowsAlt}/>\n\t\t\t\t<span>{expanded ? 'Hide This Stage' : 'Show This Stage'}</span>\n\t\t\t</WaiveObjectButton>\n\t\t</StageTitle>\n\t\t<StageBody data-expanded={expanded} ref={bodyRef}>\n\t\t\t{stage.units.map(unit => {\n\t\t\t\treturn <PipelineUnit stage={stage} unit={unit}\n\t\t\t\t                     appendUnit={onAppendUnit} prependUnit={onPrependUnit} deleteUnit={onDeleteUnit}\n\t\t\t\t                     key={unit.uuid}/>;\n\t\t\t})}\n\t\t\t<StageFooter>\n\t\t\t\t<div/>\n\t\t\t\t<DropdownButton icon={faProjectDiagram} type={ButtonType.PRIMARY} label='Append Stage'\n\t\t\t\t                onClick={appendStage}\n\t\t\t\t                menus={[ {\n\t\t\t\t\t                icon: faProjectDiagram,\n\t\t\t\t\t                label: 'Prepend Stage',\n\t\t\t\t\t                onClick: () => prependStage(stage)\n\t\t\t\t                } ]}/>\n\t\t\t\t<DropdownButton icon={faTrashAlt} type={ButtonType.DANGER} label='Delete Above Stage'\n\t\t\t\t                onClick={onStageDeleteClicked}\n\t\t\t\t                menus={[ {\n\t\t\t\t\t                icon: faEraser,\n\t\t\t\t\t                label: 'Clear Process Units',\n\t\t\t\t\t                onClick: onClearUnitsClicked\n\t\t\t\t                } ]}/>\n\t\t\t</StageFooter>\n\t\t</StageBody>\n\t</StageContainer>;\n};\n","import React from 'react';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../../common/utils';\nimport { Pipeline, PipelineTriggerType } from '../../../../services/admin/pipeline-types';\nimport { TopicType } from '../../../../services/admin/types';\nimport { usePipelineContext } from '../pipeline-context';\nimport { HorizontalOptions } from './components/horizontal-options';\nimport { usePipelineEditContext } from './pipeline-edit-context';\n\nconst Trigger = styled.div`\n\tdisplay: grid;\n\tgrid-template-columns: 120px 1fr;\n\talign-items: center;\n\tpadding: 0 calc(var(--margin) / 2);\n\theight: 36px;\n\tfont-size: 0.8em;\n\t> div:first-child {\n\t\twhite-space: nowrap;\n\t\tfont-weight: var(--font-demi-bold);\n\t\tfont-variant: petite-caps;\n\t}\n\t> div:nth-child(2) {\n\t\tfont-variant: petite-caps;\n\t\tfont-weight: var(--font-demi-bold);\n\t}\n`;\n\nconst TriggerTypeOptions: { [key in PipelineTriggerType]: string } = {\n\t[PipelineTriggerType.INSERT]: 'Insert',\n\t[PipelineTriggerType.MERGE]: 'Merge',\n\t[PipelineTriggerType.INSERT_OR_MERGE]: 'Insert or Merge',\n\t[PipelineTriggerType.DELETE]: 'Delete'\n};\n\nexport const PipelineTrigger = (props: { pipeline: Pipeline }) => {\n\tconst { pipeline } = props;\n\n\tconst { store: { topics } } = usePipelineContext();\n\tconst { firePipelineContentChange } = usePipelineEditContext();\n\tconst forceUpdate = useForceUpdate();\n\tconst onTypeChanged = (newType: PipelineTriggerType) => {\n\t\tpipeline.type = newType;\n\t\tfirePipelineContentChange();\n\t\tforceUpdate();\n\t};\n\n\tlet availableTypes = Object.values(PipelineTriggerType);\n\t// eslint-disable-next-line\n\tconst topic = topics.find(topic => topic.topicId == pipeline.topicId);\n\tif (topic?.type === TopicType.RAW) {\n\t\tavailableTypes = availableTypes.filter(type => [ PipelineTriggerType.INSERT, PipelineTriggerType.DELETE ].includes(type));\n\t}\n\n\treturn <Trigger>\n\t\t<div>Trigger On:</div>\n\t\t<HorizontalOptions label={TriggerTypeOptions[pipeline.type]}\n\t\t                   options={availableTypes.filter(type => type !== pipeline.type)}\n\t\t                   toLabel={(type) => TriggerTypeOptions[type as PipelineTriggerType]}\n\t\t                   onSelect={onTypeChanged}/>\n\t</Trigger>;\n};","import React from 'react';\nimport styled from 'styled-components';\nimport { v4 } from 'uuid';\nimport { useForceUpdate } from '../../../../common/utils';\nimport { QueriedTopicForPipeline } from '../../../../services/admin/types';\nimport { usePipelineContext } from '../pipeline-context';\nimport { ArrangedPipeline, ArrangedStage } from '../types';\nimport { AutoSwitchInput } from './components/auto-switch-input';\nimport { usePipelineEditContext } from './pipeline-edit-context';\nimport { StageEditor } from './pipeline-stage';\nimport { PipelineTrigger } from './pipeline-trigger';\nimport { createStage } from './utils';\n\nconst Container = styled.div`\n\tdisplay: flex;\n\tflex-direction: column;\n\tmargin-top: calc(var(--margin) / 4);\n\tborder: var(--border);\n\tborder-color: var(--pipeline-border-color);\n\tborder-radius: var(--border-radius);\n\toverflow: hidden;\n`;\nconst Title = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\tfont-family: var(--console-title-font-family);\n\theight: 32px;\n\tline-height: 32px;\n\tbackground-color: var(--pipeline-bg-color);\n\tpadding: 0 calc(var(--margin) / 2) 0 calc(var(--margin) / 4);\n\t> div:first-child {\n\t\tflex-grow: 1;\n\t\tmargin-right: calc(var(--margin) / 4);\n\t}\n`;\nconst Body = styled.div`\n\tdisplay: flex;\n\tflex-direction: column;\n\tflex-grow: 1;\n\tpadding-bottom: calc(var(--margin) / 4);\n`;\n\nexport const PipelineEditor = (props: {\n\toutbound: boolean;\n\ttopic: QueriedTopicForPipeline;\n\tpipeline: ArrangedPipeline;\n}) => {\n\tconst { outbound, pipeline } = props;\n\n\tconst { changeSelectedPipeline } = usePipelineContext();\n\tconst { firePipelineContentChange } = usePipelineEditContext();\n\tconst forceUpdate = useForceUpdate();\n\n\tconst onNameChange = (value: string) => {\n\t\t// change both well known pipeline and original one\n\t\tpipeline.name = value;\n\t\tpipeline.origin.name = value;\n\t\tchangeSelectedPipeline(pipeline);\n\t\tfirePipelineContentChange();\n\t\tforceUpdate();\n\t};\n\tconst onAppendStage = () => {\n\t\tpipeline.stages.push(createStage());\n\t\tfirePipelineContentChange();\n\t\tforceUpdate();\n\t};\n\tconst onPrependStage = (on: ArrangedStage) => {\n\t\tconst index = pipeline.stages.findIndex(exists => exists === on);\n\t\tif (index === -1) {\n\t\t\tpipeline.stages.unshift(createStage());\n\t\t} else {\n\t\t\tpipeline.stages.splice(index, 0, createStage());\n\t\t}\n\t\tfirePipelineContentChange();\n\t\tforceUpdate();\n\t};\n\tconst onDeleteStage = (stage: ArrangedStage) => {\n\t\tconst index = pipeline.stages.findIndex(exists => exists === stage);\n\t\tif (index !== -1) {\n\t\t\tpipeline.stages.splice(index, 1);\n\t\t\tfirePipelineContentChange();\n\t\t\tforceUpdate();\n\t\t}\n\t};\n\n\treturn <Container>\n\t\t<Title>\n\t\t\t<AutoSwitchInput onChange={onNameChange}\n\t\t\t                 prefixLabel={`# ${outbound ? 'Outbound' : 'Inbound'}`} value={pipeline.name}\n\t\t\t                 placeholder='Untitled Pipeline'\n\t\t\t                 styles={{ backgroundColor: 'transparent' }}/>\n\t\t</Title>\n\t\t<Body>\n\t\t\t<PipelineTrigger pipeline={pipeline}/>\n\t\t\t{pipeline.stages.map((stage, index) => {\n\t\t\t\tif (!stage.uuid) {\n\t\t\t\t\tstage.uuid = v4();\n\t\t\t\t}\n\t\t\t\treturn <StageEditor pipeline={pipeline} stage={stage}\n\t\t\t\t                    appendStage={onAppendStage}\n\t\t\t\t                    prependStage={onPrependStage}\n\t\t\t\t                    deleteStage={onDeleteStage}\n\t\t\t\t                    index={index + 1} key={stage.uuid}/>;\n\t\t\t})}\n\t\t</Body>\n\t</Container>;\n};\n","import { faCheck, faWaveSquare } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { useEffect, useRef, useState } from 'react';\nimport styled from 'styled-components';\nimport { v4 } from 'uuid';\nimport { useCollapseFixedThing, useForceUpdate } from '../../../../common/utils';\nimport { Pipeline, PipelineTriggerType } from '../../../../services/admin/pipeline-types';\nimport { QueriedTopicForPipeline } from '../../../../services/admin/types';\nimport { PrimaryObjectButton } from '../../../component/object-button';\nimport { usePipelineContext } from '../pipeline-context';\nimport { ArrangedPipeline, PipelinesTopicNode } from '../types';\nimport { PipelineEditContextProvider } from './pipeline-edit-context';\nimport { PipelineEditor } from './pipeline-editor';\nimport { createStage } from './utils';\n\ninterface DropdownState {\n\tvisible: boolean;\n\ttop: number;\n\tright: number\n}\n\nconst EditorContainer = styled.div`\n\tdisplay: grid;\n\tgrid-template-columns: 1fr;\n\tgrid-template-rows: auto 1fr;\n\tposition: relative;\n\tflex-grow: 1;\n\theight: 100%;\n\tpadding: calc(var(--margin) / 2);\n\toverflow-y: scroll;\n\t&::-webkit-scrollbar {\n\t\tbackground-color: transparent;\n\t\twidth: 4px;\n\t}\n\t&::-webkit-scrollbar-track {\n\t\tbackground-color: transparent;\n\t\tborder-radius: 2px;\n\t}\n\t&::-webkit-scrollbar-thumb {\n\t\tbackground-color: var(--console-favorite-color);\n\t\tborder-radius: 2px;\n\t}\n`;\nconst EditorTitle = styled.div`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: flex-end;\n\tfont-family: var(--console-title-font-family);\n\tmargin-top: calc(var(--margin) / -2);\n\theight: 40px;\n\toverflow: hidden;\n\tborder-bottom: var(--border);\n\t> div:first-child {\n\t\tflex-grow: 1;\n\t\tfont-size: 1.4em;\n\t}\n\t> button {\n\t\theight: 22px;\n\t\tmargin-left: calc(var(--margin) / 4);\n\t\tmargin-bottom: 4px;\n\t}\n`;\nconst PipelineSwitcher = styled.div`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\tfont-size: 0.8em;\n\theight: 22px;\n\tborder-radius: 11px;\n\tcolor: var(--invert-color);\n\tbackground-color: var(--console-primary-color);\n\tpadding: 0 calc(var(--margin) / 2);\n\tmargin-left: calc(var(--margin) / 4);\n\tmargin-bottom: 4px;\n\tcursor: pointer;\n\ttransition: all 300ms ease-in-out;\n\t&:hover {\n\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t}\n\t&:before {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\tbottom: 0;\n\t\tleft: 0;\n\t\twidth: 100%;\n\t\theight: 1px;\n\t\tbackground-color: var(--invert-color);\n\t\topacity: 0;\n\t\ttransition: all 300ms ease-in-out;\n\t}\n\t&[data-can-expand=false] {\n\t\tcursor: default;\n\t\t&:hover {\n\t\t\tbox-shadow: none;\n\t\t}\n\t}\n\t&[data-expanded=true] {\n\t\tborder-bottom-left-radius: 0;\n\t\tborder-bottom-right-radius: 0;\n\t\t&:before {\n\t\t\topacity: 0.5;\n\t\t}\n\t}\n\t> span {\n\t\tposition: relative;\n\t}\n\t> span:first-child {\n\t\tmargin-right: calc(var(--margin) / 3);\n\t}\n\t> span:nth-child(2) {\n\t\tpadding-left: calc(var(--margin) / 3);\n\t\t&:before {\n\t\t\tcontent: '';\n\t\t\tdisplay: block;\n\t\t\tposition: absolute;\n\t\t\ttop: 20%;\n\t\t\tleft: 0;\n\t\t\twidth: 1px;\n\t\t\theight: 60%;\n\t\t\tbackground-color: var(--invert-color);\n\t\t\topacity: 0.5;\n\t\t}\n\t}\n`;\nconst Dropdown = styled.div.attrs<DropdownState>(({ visible, top, right }) => {\n\treturn {\n\t\tstyle: {\n\t\t\topacity: visible ? 1 : 0,\n\t\t\tpointerEvents: visible ? 'auto' : 'none',\n\t\t\ttop,\n\t\t\tright\n\t\t}\n\t};\n})<DropdownState>`\n\tdisplay: flex;\n\tflex-direction: column;\n\tposition: fixed;\n\toverflow-x: hidden;\n\tcolor: var(--invert-color);\n\ttransition: opacity 300ms ease-in-out;\n\tborder-radius: var(--border-radius);\n\tborder-top-right-radius: 0;\n\tmin-width: 120px;\n\tbox-shadow: var(--console-primary-hover-shadow);\n\tz-index: 1;\n\t> div {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\theight: 28px;\n\t\tpadding: 0 calc(var(--margin) / 2);\n\t\tbackground-color: var(--console-primary-color);\n\t\t&[data-current=true] {\n\t\t\tcursor: default;\n\t\t}\n\t\t&:hover {\n\t\t\tfilter: brightness(140%);\n\t\t}\n\t\t> svg {\n\t\t\tmargin-right: calc(var(--margin) / 4);\n\t\t}\n\t\t> span:first-child {\n\t\t\tmargin-left: calc(var(--margin) / 4 + 14px * 0.8);\n\t\t}\n\t}\n`;\nconst EditorBody = styled.div`\n\tflex-grow: 1;\n\tpadding-bottom: var(--margin);\n`;\n\nconst PipelineButton = (props: {\n\tlabel: 'Inbound' | 'Outbound',\n\tcount: number;\n\tpipelines?: Array<ArrangedPipeline>;\n\tpipeline: ArrangedPipeline;\n}) => {\n\tconst { label, count, pipelines, pipeline: selectedPipeline } = props;\n\n\tconst { changeSelectedPipeline } = usePipelineContext();\n\tconst containerRef = useRef<HTMLDivElement>(null);\n\tconst [ expanded, setExpanded ] = useState({ visible: false, right: 0, top: 0 });\n\tuseCollapseFixedThing(containerRef, () => setExpanded({ ...expanded, visible: false }));\n\n\tconst onExpandClicked = (event: React.MouseEvent<HTMLSpanElement>) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tif (count === 0) {\n\t\t\treturn;\n\t\t}\n\t\tconst rect = containerRef.current!.getBoundingClientRect();\n\t\tsetExpanded({\n\t\t\tvisible: true,\n\t\t\ttop: rect.top + rect.height,\n\t\t\tright: window.innerWidth - rect.left - rect.width\n\t\t});\n\t};\n\tconst onMenuClicked = (pipeline: ArrangedPipeline) => (event: React.MouseEvent<HTMLDivElement>) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tif (pipeline === selectedPipeline) {\n\t\t\treturn;\n\t\t}\n\t\tsetExpanded({ ...expanded, visible: false });\n\t\tchangeSelectedPipeline(pipeline);\n\t};\n\n\treturn <PipelineSwitcher onClick={onExpandClicked}\n\t                         data-can-expand={count !== 0}\n\t                         data-expanded={expanded.visible}\n\t                         ref={containerRef}>\n\t\t<span>{label}</span>\n\t\t<span>{count}</span>\n\t\t<Dropdown {...expanded}>\n\t\t\t{pipelines?.map((pipeline, index) => {\n\t\t\t\treturn <div key={v4()} data-current={pipeline === selectedPipeline}\n\t\t\t\t            onClick={onMenuClicked(pipeline)}>\n\t\t\t\t\t{selectedPipeline === pipeline ? <FontAwesomeIcon icon={faCheck}/> : null}\n\t\t\t\t\t<span>{pipeline.name || `Untitled Pipeline #${index + 1}`}</span>\n\t\t\t\t</div>;\n\t\t\t})}\n\t\t</Dropdown>\n\t</PipelineSwitcher>;\n};\n\nexport const Editor = (props: {\n\ttopic?: QueriedTopicForPipeline;\n\tnodes: Array<PipelinesTopicNode>;\n}) => {\n\tconst { topic, nodes } = props;\n\n\tconst {\n\t\tstore: { selectedPipeline },\n\t\tchangeSelectedPipeline, addPipelineSelectionChangedListener, removePipelineSelectionChangedListener\n\t} = usePipelineContext();\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\taddPipelineSelectionChangedListener(forceUpdate);\n\t\treturn () => removePipelineSelectionChangedListener(forceUpdate);\n\t});\n\n\tif (!topic) {\n\t\treturn null;\n\t}\n\n\tconst node = nodes.find(node => node.topic === topic)!;\n\tconst inboundCount = node.toMe?.length || 0;\n\tconst outboundCount = node.fromMe?.length || 0;\n\n\tconst selectNextPipeline = () => {\n\t\tif (node.toNext) {\n\t\t\tchangeSelectedPipeline(node.toNext);\n\t\t\treturn node.toNext;\n\t\t} else if (node.toMe) {\n\t\t\tchangeSelectedPipeline(node.toMe[0]);\n\t\t\treturn node.toMe[0];\n\t\t} else if (node.fromMe) {\n\t\t\tchangeSelectedPipeline(node.fromMe[0]);\n\t\t\treturn node.fromMe[0];\n\t\t} else {\n\t\t\treturn (void 0);\n\t\t}\n\t};\n\tlet pipeline = selectedPipeline;\n\tif (pipeline) {\n\t\t// check the given selected pipeline is belongs to current topic or not\n\t\tif (!node.toMe?.includes(pipeline) && !node.fromMe?.includes(pipeline) && node.toNext !== pipeline) {\n\t\t\tpipeline = selectNextPipeline();\n\t\t}\n\t} else {\n\t\tpipeline = selectNextPipeline();\n\t}\n\n\tconst onCreatePipelineClicked = () => {\n\t\tconst newPipeline: Pipeline = {\n\t\t\ttopicId: topic.topicId,\n\t\t\ttype: PipelineTriggerType.INSERT_OR_MERGE,\n\t\t\tstages: [ createStage() ]\n\t\t};\n\t\tconst arrangedPipeline = {\n\t\t\t...newPipeline,\n\t\t\ttargetTopicIds: [] as Array<string>,\n\t\t\torigin: newPipeline,\n\t\t\tuuid: v4()\n\t\t} as ArrangedPipeline;\n\t\tif (!node.fromMe) {\n\t\t\tnode.fromMe = [];\n\t\t}\n\t\tnode.fromMe.push(arrangedPipeline);\n\t\tif (pipeline) {\n\t\t\tchangeSelectedPipeline(arrangedPipeline);\n\t\t} else {\n\t\t\t// pipeline = selectNextPipeline();\n\t\t\tforceUpdate();\n\t\t}\n\t};\n\n\t// eslint-disable-next-line\n\tconst isOutbound = pipeline?.topicId == topic.topicId;\n\n\treturn <EditorContainer>\n\t\t<EditorTitle data-topic-type={topic.type}>\n\t\t\t<div>{topic.name}</div>\n\t\t\t{pipeline\n\t\t\t\t? <PipelineButton label='Inbound' count={inboundCount} pipelines={node.toMe} pipeline={pipeline}/>\n\t\t\t\t: null}\n\t\t\t{pipeline\n\t\t\t\t? <PipelineButton label='Outbound' count={outboundCount} pipelines={node.fromMe} pipeline={pipeline}/>\n\t\t\t\t: null}\n\t\t\t<PrimaryObjectButton onClick={onCreatePipelineClicked}>\n\t\t\t\t<FontAwesomeIcon icon={faWaveSquare}/>\n\t\t\t\t<span>New Outbound Pipeline</span>\n\t\t\t</PrimaryObjectButton>\n\t\t</EditorTitle>\n\t\t<EditorBody>\n\t\t\t<PipelineEditContextProvider pipeline={pipeline}>\n\t\t\t\t{pipeline ?\n\t\t\t\t\t<PipelineEditor outbound={isOutbound} topic={topic} pipeline={pipeline}/>\n\t\t\t\t\t: null}\n\t\t\t</PipelineEditContextProvider>\n\t\t</EditorBody>\n\t</EditorContainer>;\n};\n","import React, { useEffect } from 'react';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../common/utils';\nimport { Editor } from './editor';\nimport { usePipelineContext } from './pipeline-context';\nimport { PipelinesTopicNode } from './types';\n\nconst Container = styled.div`\n\tdisplay: block;\n\tposition: relative;\n\tflex-grow: 1;\n\theight: 100%;\n`;\nconst NoTopicSelected = styled.div`\n\tdisplay: flex;\n\tposition: absolute;\n\twidth: 100%;\n\theight: 100%;\n\talign-items: center;\n\tjustify-content: center;\n\tfont-family: var(--console-title-font-family);\n\tfont-size: 3em;\n\topacity: 0;\n\tpointer-events: none;\n\ttransition: opacity 300ms ease-in-out;\n\t&[data-visible=true] {\n\t\topacity: 0.2;\n\t\tpointer-events: auto;\n\t}\n`;\n\nexport const PipelineEditor = (props: {\n\tnodes: Array<PipelinesTopicNode>;\n\tvisible: boolean;\n}) => {\n\tconst { nodes, visible } = props;\n\n\tconst {\n\t\tstore: { selectedTopic },\n\t\taddTopicSelectionChangedListener, removeTopicSelectionChangedListener\n\t} = usePipelineContext();\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\taddTopicSelectionChangedListener(forceUpdate);\n\t\treturn () => removeTopicSelectionChangedListener(forceUpdate);\n\t});\n\n\tif (!visible) {\n\t\treturn null;\n\t}\n\n\treturn <Container>\n\t\t<Editor topic={selectedTopic} nodes={nodes}/>\n\t\t<NoTopicSelected data-visible={selectedTopic == null}>Pick a topic please.</NoTopicSelected>\n\t</Container>;\n};","import { QueriedTopicForPipeline, TopicType } from '../../../services/admin/types';\nimport { ArrangedPipeline, ArrangedPipelines, PipelinesTopicNode } from './types';\n\nconst computePipelines = (options: {\n\ttarget: QueriedTopicForPipeline;\n\tarranged: ArrangedPipelines;\n\tallTopics: Map<string, QueriedTopicForPipeline>;\n\tfindPipelines: (topicId: string) => Array<ArrangedPipeline> | undefined;\n\tgetNextTopicId: (pipeline: ArrangedPipeline) => string;\n}) => {\n\tconst { target: { topicId }, arranged: { starts, ends }, allTopics, findPipelines, getNextTopicId } = options;\n\n\tconst nodes = [];\n\tlet targetTopicId = topicId;\n\twhile (targetTopicId) {\n\t\tconst pipelines = findPipelines(targetTopicId);\n\t\t// console.log(targetTopicId, pipelines);\n\t\tif (!pipelines || pipelines.length === 0) {\n\t\t\t// reaches start, no pipeline to me\n\t\t\tbreak;\n\t\t}\n\n\t\tconst votedPipeline = pipelines[0];\n\t\tconst topicId = getNextTopicId(votedPipeline);\n\t\t// create a wrapper topic only if topic is not loaded yet\n\t\tconst topic = allTopics.get(topicId) || {\n\t\t\ttopicId,\n\t\t\tcode: topicId,\n\t\t\tname: topicId,\n\t\t\ttype: TopicType.NOT_DEFINED,\n\t\t\tfactors: []\n\t\t};\n\t\tconst node = { topic, fromMe: starts.get(topicId), toMe: ends.get(topicId), use: votedPipeline };\n\t\tnodes.push(node);\n\t\t// move backward, target is me\n\t\ttargetTopicId = topicId;\n\t}\n\treturn nodes;\n};\nconst computePipelinesTo = (target: QueriedTopicForPipeline, arranged: ArrangedPipelines, topics: Map<string, QueriedTopicForPipeline>) => {\n\treturn computePipelines({\n\t\ttarget,\n\t\tarranged,\n\t\tallTopics: topics,\n\t\tfindPipelines: topicId => arranged.ends.get(topicId),\n\t\tgetNextTopicId: pipeline => pipeline.topicId\n\t});\n};\nconst computePipelinesFrom = (target: QueriedTopicForPipeline, arranged: ArrangedPipelines, topics: Map<string, QueriedTopicForPipeline>) => {\n\treturn computePipelines({\n\t\ttarget,\n\t\tarranged,\n\t\tallTopics: topics,\n\t\tfindPipelines: topicId => arranged.starts.get(topicId),\n\t\tgetNextTopicId: pipeline => pipeline.targetTopicIds[0]\n\t});\n};\n\nexport const buildPipelines = (options: {\n\ttopic?: QueriedTopicForPipeline;\n\tarranged: ArrangedPipelines;\n\ttopics: Map<string, QueriedTopicForPipeline>;\n}): Array<PipelinesTopicNode> => {\n\tconst { topic, arranged, topics } = options;\n\tif (!topic) {\n\t\treturn [];\n\t}\n\n\tconst { starts, ends } = arranged;\n\n\t// compute pipelines from root to given topic\n\tconst toCurrent = computePipelinesTo(topic, arranged, topics).reverse();\n\t// current topic\n\tconst current = { topic, fromMe: starts.get(topic.topicId), toMe: ends.get(topic.topicId), current: true };\n\t// compute pipelines from given topic to end\n\tconst fromCurrent = computePipelinesFrom(topic, arranged, topics);\n\n\treturn [\n\t\t...toCurrent.map(node => ({ ...node, toNext: node.use })),\n\t\t{ ...current, toNext: fromCurrent[0] ? fromCurrent[0].use : (void 0) },\n\t\t...fromCurrent.map((node, index, nodes) => ({\n\t\t\t...node,\n\t\t\ttoNext: nodes[index + 1] ? nodes[index + 1].use : (void 0)\n\t\t}))\n\t].map((node, index, nodes) => {\n\t\treturn {\n\t\t\t...node,\n\t\t\tprevious: index !== 0 ? nodes[index - 1].topic : (void 0),\n\t\t\tnext: index !== nodes.length - 1 ? nodes[index + 1].topic : (void 0)\n\t\t};\n\t});\n};\n","import React, { useEffect, useState } from 'react';\nimport styled from 'styled-components';\nimport { v4 } from 'uuid';\nimport {\n\tPipelineFlow,\n\tUnitAction,\n\tUnitActionWriteTopic,\n\tWriteTopicActionType\n} from '../../../services/admin/pipeline-types';\nimport { QueriedTopicForPipeline } from '../../../services/admin/types';\nimport { PipelineCanvas } from './pipeline-canvas';\nimport { usePipelineContext } from './pipeline-context';\nimport { PipelineEditor } from './pipeline-editor';\nimport { buildPipelines } from './pipelines-builder';\nimport { ArrangedPipeline, ArrangedPipelines } from './types';\n\nconst Body = styled.div.attrs({\n\t'data-widget': 'console-pipeline-body'\n})`\n\tdisplay: flex;\n\tposition: relative;\n\talign-self: stretch;\n\toverflow: hidden;\n`;\nconst WaitData = styled.div`\n\tdisplay: flex;\n\tposition: absolute;\n\twidth: 100%;\n\theight: 100%;\n\talign-items: center;\n\tjustify-content: center;\n\tfont-family: var(--console-title-font-family);\n\tfont-size: 3em;\n\topacity: 0;\n\tpointer-events: none;\n\ttransition: opacity 300ms ease-in-out;\n\t&[data-visible=true] {\n\t\topacity: 0.3;\n\t\tpointer-events: auto;\n\t}\n`;\n\nconst isWriteTopicAction = (action: UnitAction): action is UnitActionWriteTopic => {\n\t// @ts-ignore\n\treturn !!action.type && Object.values(WriteTopicActionType).includes(action.type);\n};\nconst getOrCreateFromMap = <T extends any>(key: string, map: Map<string, Array<T>>) => {\n\tlet array = map.get(key);\n\tif (!array) {\n\t\tarray = [];\n\t\tmap.set(key, array);\n\t}\n\treturn array;\n};\nconst arrangeFlow = (flow: PipelineFlow): ArrangedPipelines => {\n\t// key is topic, value is pipeline array which triggered by this topic\n\tconst sourceMap = new Map<string, Array<ArrangedPipeline>>();\n\tconst targetMap = new Map<string, Array<ArrangedPipeline>>();\n\t[ flow.consume, flow.produce ].forEach(pipelines => pipelines.forEach(pipeline => {\n\t\tconst { topicId, stages } = pipeline;\n\n\t\t// compute targets of given pipeline's\n\t\tconst targetTopicIds = stages.map(({ units }) => {\n\t\t\treturn units.map(({ do: actions }) => {\n\t\t\t\treturn actions.map(action => {\n\t\t\t\t\tif (isWriteTopicAction(action)) {\n\t\t\t\t\t\t// pipeline writes data to topic\n\t\t\t\t\t\treturn action.topicId;\n\t\t\t\t\t}\n\t\t\t\t\treturn null;\n\t\t\t\t}).flat().filter(x => x);\n\t\t\t}).flat();\n\t\t}).flat() as Array<string>;\n\n\t\tconst arrangedPipeline: ArrangedPipeline = {\n\t\t\t...pipeline,\n\t\t\tstages: pipeline.stages.map(stage => {\n\t\t\t\treturn {\n\t\t\t\t\tuuid: v4(),\n\t\t\t\t\t...stage,\n\t\t\t\t\tunits: stage.units.map(unit => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tuuid: v4(),\n\t\t\t\t\t\t\t...unit,\n\t\t\t\t\t\t\tdo: unit.do.map(action => {\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\tuuid: v4(),\n\t\t\t\t\t\t\t\t\t...action\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t};\n\t\t\t\t\t})\n\t\t\t\t};\n\t\t\t}),\n\t\t\ttargetTopicIds: [ ...new Set<string>(targetTopicIds) ],\n\t\t\torigin: pipeline,\n\t\t\tuuid: v4()\n\t\t};\n\n\t\t// take care of source from\n\t\tconst startsFrom = getOrCreateFromMap(topicId, sourceMap);\n\t\tif (startsFrom.findIndex(pipeline => arrangedPipeline.origin === pipeline.origin) === -1) {\n\t\t\tstartsFrom.push(arrangedPipeline);\n\t\t}\n\t\t// take care of target to\n\t\tarrangedPipeline.targetTopicIds.forEach(targetTopicId => {\n\t\t\tconst endsTo = getOrCreateFromMap(targetTopicId, targetMap);\n\t\t\tif (endsTo.findIndex(pipeline => arrangedPipeline.origin === pipeline.origin) === -1) {\n\t\t\t\tendsTo.push(arrangedPipeline);\n\t\t\t}\n\t\t});\n\t}));\n\treturn { starts: sourceMap, ends: targetMap };\n};\n\nexport const PipelineBody = () => {\n\tconst {\n\t\tstore: { topics, topic, flow },\n\t\tchangeSelectedTopic,\n\t\taddFlowChangedListener, removeFlowChangedListener\n\t} = usePipelineContext();\n\tconst [ ordered, setOrdered ] = useState(false);\n\tconst [ arranged, setArranged ] = useState<ArrangedPipelines>({ starts: new Map(), ends: new Map() });\n\tuseEffect(() => {\n\t\tconst onFlowChanged = () => {\n\t\t\t// clear selected topic, arranged pipelines\n\t\t\t// set ordered to false to trigger repaint\n\t\t\tchangeSelectedTopic();\n\t\t\tsetArranged({ starts: new Map(), ends: new Map() });\n\t\t\tsetOrdered(false);\n\t\t};\n\t\taddFlowChangedListener(onFlowChanged);\n\t\treturn () => removeFlowChangedListener(onFlowChanged);\n\t});\n\tuseEffect(() => {\n\t\tif (flow && topic) {\n\t\t\tsetArranged(arrangeFlow(flow));\n\t\t\tsetOrdered(true);\n\t\t\t// select the given topic\n\t\t\tchangeSelectedTopic(topic);\n\t\t}\n\t}, [ topic, topics, flow, changeSelectedTopic ]);\n\n\tconst topicMap = topics.reduce((map, topic) => map.set(topic.topicId, topic),\n\t\tnew Map<string, QueriedTopicForPipeline>());\n\tconst nodes = buildPipelines({ topic, arranged, topics: topicMap });\n\n\treturn <Body>\n\t\t<PipelineCanvas topic={topic} nodes={nodes} visible={ordered}/>\n\t\t<PipelineEditor nodes={nodes} visible={ordered}/>\n\t\t<WaitData data-visible={flow == null}>Pick a topic please.</WaitData>\n\t\t<WaitData data-visible={flow != null && !ordered}>Arrange pipelines...</WaitData>\n\t</Body>;\n};","import { IconProp } from '@fortawesome/fontawesome-svg-core';\nimport { faBars, faWaveSquare } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { Fragment, useEffect } from 'react';\nimport styled from 'styled-components';\nimport { useForceUpdate } from '../../../common/utils';\nimport { LinkButton } from '../../component/console/link-button';\nimport { usePipelineContext } from './pipeline-context';\n\nconst Header = styled.div.attrs({\n\t'data-widget': 'console-pipeline-header'\n})`\n\tdisplay: flex;\n\tposition: sticky;\n\tgrid-column: span 2;\n\theight: var(--console-space-header-height);\n\t&:after {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\tz-index: 1;\n\t\tbottom: 0;\n\t\twidth: 100%;\n\t\theight: 1px;\n\t\tbackground-color: var(--border-color);\n\t}\n`;\nconst Slice = styled.div`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\tfont-family: var(--console-title-font-family);\n\tfont-size: 1.6em;\n\tpadding: 0 calc(var(--margin) / 3);\n\tmargin-right: calc(var(--margin) / 3);\n\t&:first-child {\n\t\tpadding-left: calc(var(--margin) / 2);\n\t}\n\t&:before,\n\t&:after {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\ttop: -2px;\n\t\theight: calc(var(--console-space-header-height) + 3px);\n\t\tborder-right: 0;\n\t\tborder-top: calc(var(--console-space-header-height) / 2 + 1.5px) solid transparent;\n\t\tborder-bottom: calc(var(--console-space-header-height) / 2 + 1.5px) solid transparent;\n\t\tborder-left: 10px solid var(--border-color);\n\t}\n\t&:before {\n\t\tright: -10px;\n\t}\n\t&:after {\n\t\tright: -9px;\n\t\tborder-left-color: var(--bg-color);\n\t}\n\t> span {\n\t\tfont-variant: petite-caps;\n\t}\n`;\nconst Placeholder = styled.div`\n\tflex-grow: 1;\n`;\nconst Buttons = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\tpadding-right: calc(var(--margin) / 2);\n`;\nconst Button = styled.div`\n\twidth: 44px;\n\theight: 36px;\n\tborder-radius: calc(var(--border-radius) * 2);\n\toverflow: hidden;\n\t&:not(:first-child) {\n\t\tmargin-left: calc(var(--margin) / 3);\n\t}\n\t&[data-pressed=true] {\n\t\tcolor: var(--invert-color);\n\t\tbackground-color: var(--console-primary-color);\n\t}\n\t> button {\n\t\twidth: 44px;\n\t\theight: 36px;\n\t\tfont-size: 1.4em;\n\t\tpadding: 8px;\n\t\tborder-radius: calc(var(--border-radius) * 2);\n\t}\n`;\n\nconst ToggleButton = (props: {\n\tonClick: () => void;\n\ticon: IconProp;\n\tpressed: boolean;\n}) => {\n\tconst { onClick, icon, pressed } = props;\n\n\treturn <Button data-pressed={pressed}>\n\t\t<LinkButton ignoreHorizontalPadding={true} onClick={onClick}>\n\t\t\t<FontAwesomeIcon icon={icon}/>\n\t\t</LinkButton>\n\t</Button>;\n};\n\nconst CanvasToggleButton = () => {\n\tconst {\n\t\tstore: { canvasVisible },\n\t\tchangeCanvasVisible,\n\t\taddCanvasVisibilityListener,\n\t\tremoveCanvasVisibilityListener\n\t} = usePipelineContext();\n\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\taddCanvasVisibilityListener(forceUpdate);\n\t\treturn () => removeCanvasVisibilityListener(forceUpdate);\n\t});\n\tconst onMenuClicked = () => changeCanvasVisible(!canvasVisible);\n\n\treturn <ToggleButton icon={faWaveSquare} onClick={onMenuClicked} pressed={canvasVisible}/>;\n};\n\nconst MenuToggleButton = () => {\n\tconst {\n\t\tstore: { menuVisible },\n\t\tchangeMenuVisible, addMenuVisibilityListener, removeMenuVisibilityListener\n\t} = usePipelineContext();\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\taddMenuVisibilityListener(forceUpdate);\n\t\treturn () => removeMenuVisibilityListener(forceUpdate);\n\t});\n\n\tconst onMenuClicked = () => changeMenuVisible(!menuVisible);\n\n\treturn <ToggleButton icon={faBars} onClick={onMenuClicked} pressed={menuVisible}/>;\n};\n\nexport const PipelineHeader = () => {\n\tconst {\n\t\tstore: { topics, topic, selectedTopic, selectedPipeline },\n\t\taddFlowChangedListener, removeFlowChangedListener,\n\t\taddTopicSelectionChangedListener, removeTopicSelectionChangedListener,\n\t\taddPipelineSelectionChangedListener, removePipelineSelectionChangedListener\n\t} = usePipelineContext();\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\tconst render = () => setTimeout(forceUpdate, 1);\n\t\taddFlowChangedListener(render);\n\t\taddTopicSelectionChangedListener(render);\n\t\taddPipelineSelectionChangedListener(render);\n\t\treturn () => {\n\t\t\tremoveFlowChangedListener(render);\n\t\t\tremoveTopicSelectionChangedListener(render);\n\t\t\tremovePipelineSelectionChangedListener(render);\n\t\t};\n\t});\n\n\tconst asDirection = () => {\n\t\tif (!selectedPipeline) {\n\t\t\treturn '';\n\t\t} else if (selectedPipeline.topicId === selectedTopic?.topicId) {\n\t\t\treturn 'From ';\n\t\t} else {\n\t\t\treturn 'To ';\n\t\t}\n\t};\n\tconst buildTopicSlice = () => {\n\t\tif (!topic) {\n\t\t\treturn null;\n\t\t} else if (topic === selectedTopic) {\n\t\t\treturn <Slice>{`${asDirection()} ${topic.name}`.trim()}</Slice>;\n\t\t} else {\n\t\t\treturn <Slice>Through {topic.name}</Slice>;\n\t\t}\n\t};\n\tconst buildSelectedTopicSlice = () => {\n\t\tif (!selectedTopic) {\n\t\t\treturn null;\n\t\t} else if (selectedTopic === topic) {\n\t\t\treturn null;\n\t\t} else {\n\t\t\tconst direction = asDirection();\n\t\t\tif (direction === 'To ') {\n\t\t\t\t// eslint-disable-next-line\n\t\t\t\tconst fromTopic = topics.find(topic => topic.topicId == selectedPipeline?.topicId)!;\n\t\t\t\treturn <Fragment>\n\t\t\t\t\t<Slice>From {`${fromTopic.name}`.trim()}</Slice>\n\t\t\t\t\t<Slice>To {`${selectedTopic.name}`.trim()}</Slice>\n\t\t\t\t</Fragment>;\n\t\t\t} else {\n\t\t\t\treturn <Slice>From {`${selectedTopic.name}`.trim()}</Slice>;\n\t\t\t}\n\t\t}\n\t};\n\tconst buildPipelineSlice = () => {\n\t\tif (selectedPipeline) {\n\t\t\treturn <Slice>{selectedPipeline.name || 'Untitled Pipeline'}</Slice>;\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t};\n\n\treturn <Header>\n\t\t<Slice>Pipelines</Slice>\n\t\t{buildTopicSlice()}\n\t\t{buildSelectedTopicSlice()}\n\t\t{buildPipelineSlice()}\n\t\t<Placeholder/>\n\t\t<Buttons>\n\t\t\t<CanvasToggleButton/>\n\t\t\t<MenuToggleButton/>\n\t\t</Buttons>\n\t</Header>;\n};","import React from 'react';\nimport styled, { useTheme } from 'styled-components';\nimport { LightColors24 } from '../../../charts/color-theme';\nimport { QueriedFactorForPipeline, QueriedTopicForPipeline, TopicType } from '../../../services/admin/types';\nimport { Theme } from '../../../theme/types';\n\nconst Icon = styled.div.attrs<{ color: string }>(({ color }) => {\n\treturn { style: { backgroundColor: color } };\n})<{ color: string }>`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\tjustify-content: center;\n\tfont-family: var(--console-title-font-family);\n\tfont-weight: var(--console-title-font-weight);\n\tfont-size: 0.8em;\n\tmin-height: 20px;\n\theight: 20px;\n\tmin-width: 20px;\n\twidth: 20px;\n\tborder-radius: 100%;\n\tcolor: var(--invert-color);\n\tuser-select: none;\n\ttext-transform: uppercase;\n\t> span:first-child {\n\t\tmargin-left: -1px;\n\t}\n`;\nconst TypeChar = styled.span.attrs<{ left: number }>(({ left }) => {\n\treturn { style: { transform: `scale(0.7) translateY(-4px) translateX(${left}px)` } };\n})<{ left: number }>`\n\tdisplay: block;\n\tposition: absolute;\n\tz-index: 0;\n\tright: 0;\n\tbottom: 0;\n\ttransform-origin: bottom;\n`;\n\nconst getTopicColor = (topic: QueriedTopicForPipeline, theme: Theme) => {\n\tswitch (topic.type) {\n\t\tcase TopicType.RAW:\n\t\t\treturn theme.consoleRawTopicColor;\n\t\tcase TopicType.RATIO:\n\t\t\treturn theme.consoleRatioTopicColor;\n\t\tcase TopicType.DISTINCT:\n\t\t\treturn theme.consoleDistinctTopicColor;\n\t\tcase TopicType.AGGREGATE:\n\t\t\treturn theme.consoleAggregateTopicColor;\n\t\tcase TopicType.TIME:\n\t\t\treturn theme.consoleTimeTopicColor;\n\t\tcase TopicType.NOT_DEFINED:\n\t\t\treturn theme.consoleUndefinedTopicColor;\n\t}\n};\n\nexport const TopicIcon = (props: { topic: QueriedTopicForPipeline }) => {\n\tconst { topic } = props;\n\n\tconst theme = useTheme() as Theme;\n\tconst color = getTopicColor(topic, theme);\n\n\treturn <Icon color={color}>\n\t\t<span>{(topic.type || 'u')[0]}</span>\n\t\t<TypeChar left={-3}>T</TypeChar>\n\t</Icon>;\n};\n\nexport const FactorIcon = (props: { factor: QueriedFactorForPipeline }) => {\n\tconst { factor } = props;\n\n\tconst color = LightColors24[(factor.type || 'u').split('').reduce((x, char) => x + char.charCodeAt(0), 0) % LightColors24.length];\n\n\treturn <Icon color={color}>\n\t\t<span>{(factor.type || 'u')[0]}</span>\n\t\t<TypeChar left={-4}>F</TypeChar>\n\t</Icon>;\n};\n","import React from 'react';\nimport styled from 'styled-components';\nimport { v4 } from 'uuid';\n\nconst Label = styled.span`\n\twhite-space: nowrap;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\tflex-grow: 1;\n\t> span {\n\t\tcolor: var(--invert-color);\n\t\tbackground-color: var(--console-favorite-color);\n\t\tborder-radius: var(--border-radius);\n\t\tpadding: 0 1px;\n\t}\n`;\n\nexport const PipelineNavigatorNodeLabel = (props: { name: string; filter: string }) => {\n\tconst { name, filter } = props;\n\n\tconst { length } = filter;\n\tif (length === 0) {\n\t\treturn <Label>{name}</Label>;\n\t} else {\n\t\tconst find = (text: string) => {\n\t\t\tconst pos = text.toLowerCase().indexOf(filter);\n\t\t\tif (pos === -1) {\n\t\t\t\treturn [ text, false, false ];\n\t\t\t} else {\n\t\t\t\treturn [\n\t\t\t\t\ttext.substr(0, pos),\n\t\t\t\t\t<span key={v4()}>{text.substr(pos, length)}</span>,\n\t\t\t\t\ttext.substr(pos + length)\n\t\t\t\t];\n\t\t\t}\n\t\t};\n\n\t\tconst content = [];\n\t\tlet text = name;\n\t\twhile (true) {\n\t\t\tconst [ left, mid, right ] = find(text);\n\t\t\tleft && content.push(left);\n\t\t\tif (mid === false) {\n\t\t\t\t// to end\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tcontent.push(mid);\n\t\t\t\ttext = right as string;\n\t\t\t}\n\t\t}\n\t\treturn <Label>{content}</Label>;\n\t}\n};\n","import React from 'react';\nimport styled from 'styled-components';\nimport { QueriedFactorForPipeline, QueriedTopicForPipeline } from '../../../services/admin/types';\nimport { FactorIcon } from './components';\nimport { PipelineNavigatorNodeLabel } from './pipeline-navigator-node-label';\n\nconst FactorsContainer = styled.div.attrs<{ visible: boolean, count: number }>(({ visible, count }) => {\n\treturn {\n\t\tstyle: {\n\t\t\theight: visible ? count * 32 : 0\n\t\t}\n\t};\n})<{ visible: boolean, count: number }>`\n\tdisplay: flex;\n\tflex-direction: column;\n\tflex-grow: 1;\n\toverflow: hidden;\n\ttransition: height 300ms ease-in-out;\n`;\nconst FactorNode = styled.div`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\theight: 32px;\n\tpadding: 0 calc(var(--margin) / 2) 0 calc(var(--margin) / 2 + 15px);\n\tcursor: pointer;\n\t&:hover {\n\t\tbackground-color: var(--hover-color);\n\t}\n\t&:before,\n\t&:after {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\tbackground-color: var(--console-waive-color);\n\t}\n\t&:before {\n\t\tleft: calc(var(--margin) / 2 + 3px);\n\t\ttop: -16px;\n\t\theight: 32px;\n\t\twidth: 1px;\n\t}\n\t&:after {\n\t\tleft: calc(var(--margin) / 2 + 3px);\n\t\ttop: 16px;\n\t\twidth: 8px;\n\t\theight: 1px;\n\t\ttransform: translateY(-50%);\n\t}\n\t> div:first-child {\n\t\tfont-size: 0.8em;\n\t\tmin-height: 20px;\n\t\theight: 20px;\n\t\tmin-width: 20px;\n\t\twidth: 20px;\n\t\tmargin-right: calc(var(--margin) / 4);\n\t}\n`;\n\nexport const NavigatorFactors = (props: {\n\tvisible: boolean;\n\ttopic: QueriedTopicForPipeline;\n\tvisibleFactors: Array<QueriedFactorForPipeline>;\n\tfilterText: string;\n}) => {\n\tconst { topic, visible, visibleFactors, filterText } = props;\n\n\tconst displayFactors = visibleFactors.length === 0 ? topic.factors : visibleFactors;\n\n\treturn <FactorsContainer visible={visible} count={displayFactors.length}>\n\t\t{displayFactors.map(factor => {\n\t\t\treturn <FactorNode key={factor.factorId}>\n\t\t\t\t<FactorIcon factor={factor}/>\n\t\t\t\t<PipelineNavigatorNodeLabel name={factor.name} filter={filterText}/>\n\t\t\t</FactorNode>;\n\t\t})}\n\t</FactorsContainer>;\n};","import { faChevronRight, faWaveSquare } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { Fragment, useEffect, useState } from 'react';\nimport styled from 'styled-components';\nimport { fetchPipeline } from '../../../services/admin/topic';\nimport { QueriedFactorForPipeline, QueriedTopicForPipeline } from '../../../services/admin/types';\nimport { LinkButton } from '../../component/console/link-button';\nimport { useDialog } from '../../context/dialog';\nimport { TopicIcon } from './components';\nimport { usePipelineContext } from './pipeline-context';\nimport { NavigatorFactors } from './pipeline-nagivator-factor';\nimport { PipelineNavigatorNodeLabel } from './pipeline-navigator-node-label';\n\nconst TopicContainer = styled.div.attrs({\n\t'data-widget': 'pipeline-navigator-topic'\n})`\n\tdisplay: flex;\n\tflex-direction: column;\n\tfont-size: 0.8em;\n\t&[data-visible=false] {\n\t\tdisplay: none;\n\t}\n`;\nconst TopicContent = styled.div`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\theight: 32px;\n\tpadding: 0 calc(var(--margin) / 2);\n\tcursor: pointer;\n\t&:hover {\n\t\tbackground-color: var(--console-navigator-hover-color);\n\t\t> button:last-child {\n\t\t\topacity: 0.8;\n\t\t\tpointer-events: auto;\n\t\t}\n\t}\n\t&[data-factors-visible=true] {\n\t\t&:before {\n\t\t\tcontent: '';\n\t\t\tdisplay: block;\n\t\t\tposition: absolute;\n\t\t\twidth: 1px;\n\t\t\theight: 7px;\n\t\t\ttop: 25px;\n\t\t\tleft: calc(var(--margin) / 2 + 3px);\n\t\t\tbackground-color: var(--console-waive-color);\n\t\t}\n\t\t> svg:first-child {\n\t\t\ttransform: rotateZ(90deg);\n\t\t}\n\t}\n\t> svg:first-child {\n\t\tmargin-right: calc(var(--margin) / 4);\n\t\tcolor: var(--console-waive-color);\n\t\ttransition: transform 300ms ease-in-out;\n\t}\n\t> div:nth-child(2) {\n\t\tmargin-right: calc(var(--margin) / 4);\n\t}\n\t> button:last-child {\n\t\tfont-size: 1em;\n\t\topacity: 0;\n\t\tpointer-events: none;\n\t\tcursor: pointer;\n\t}\n`;\n\nexport const NavigatorTopic = (props: { topic: QueriedTopicForPipeline }) => {\n\tconst { topic } = props;\n\n\tconst { show: showDialog, hide: hideDialog } = useDialog();\n\tconst {\n\t\tstore: { topic: current },\n\t\tchangeFlow, addFlowChangedListener, removeFlowChangedListener,\n\t\taddCollapseAllTopicsListener, removeCollapseAllTopicsListener,\n\t\taddTopicFilterChangedListener, removeTopicFilterChangedListener\n\t} = usePipelineContext();\n\tconst [ factorsVisible, setFactorsVisible ] = useState<boolean>(false);\n\tconst [ active, setActive ] = useState(current === topic);\n\tconst [ filterText, setFilterText ] = useState('');\n\tuseEffect(() => {\n\t\tconst onFlowChanged = (pickedTopic: QueriedTopicForPipeline) => setActive(pickedTopic === topic);\n\t\tconst onCollapseAllTopics = () => setFactorsVisible(false);\n\t\tconst onFilterTextChange = (filterText: string) => setFilterText(filterText);\n\t\taddFlowChangedListener(onFlowChanged);\n\t\taddCollapseAllTopicsListener(onCollapseAllTopics);\n\t\taddTopicFilterChangedListener(onFilterTextChange);\n\t\treturn () => {\n\t\t\tremoveFlowChangedListener(onFlowChanged);\n\t\t\tremoveCollapseAllTopicsListener(onCollapseAllTopics);\n\t\t\tremoveTopicFilterChangedListener(onFilterTextChange);\n\t\t};\n\t});\n\n\tconst onTitleClicked = () => setFactorsVisible(!factorsVisible);\n\tconst onShowPipelineClicked = async (event: React.MouseEvent<HTMLButtonElement>) => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tif (active) {\n\t\t\treturn;\n\t\t}\n\n\t\tshowDialog(\n\t\t\t<div data-widget='dialog-console-loading'>\n\t\t\t\t<span>Loading pipeline of topic <span data-widget='dialog-console-object'>{topic.name}</span>.</span>\n\t\t\t\t<span>Don't close current page, it should take a while.</span>\n\t\t\t</div>,\n\t\t\t<Fragment>\n\t\t\t\t<div style={{ flexGrow: 1 }}/>\n\t\t\t</Fragment>\n\t\t);\n\t\tconst flow = await fetchPipeline(topic.topicId);\n\t\thideDialog();\n\t\tchangeFlow(topic, flow);\n\t};\n\n\tlet topicVisible = false;\n\tlet visibleFactors: Array<QueriedFactorForPipeline> = [];\n\tif (filterText) {\n\t\tif (topic.name.toLowerCase().includes(filterText)) {\n\t\t\t// topic contains filter text\n\t\t\ttopicVisible = true;\n\t\t} else {\n\t\t\tvisibleFactors = topic.factors.filter(factor => factor.name.toLowerCase().includes(filterText));\n\t\t\tif (visibleFactors.length !== 0) {\n\t\t\t\ttopicVisible = true;\n\t\t\t}\n\t\t}\n\t} else {\n\t\ttopicVisible = true;\n\t}\n\n\treturn <TopicContainer data-topic-id={topic.topicId} data-visible={topicVisible}>\n\t\t<TopicContent data-factors-visible={factorsVisible} onClick={onTitleClicked}>\n\t\t\t<FontAwesomeIcon icon={faChevronRight}/>\n\t\t\t<TopicIcon topic={topic}/>\n\t\t\t<PipelineNavigatorNodeLabel name={topic.name} filter={filterText}/>\n\t\t\t<LinkButton ignoreHorizontalPadding={true} tooltip='Show Pipeline' right={true} offsetX={-8}\n\t\t\t            onClick={onShowPipelineClicked}>\n\t\t\t\t<FontAwesomeIcon icon={faWaveSquare}/>\n\t\t\t</LinkButton>\n\t\t</TopicContent>\n\t\t<NavigatorFactors topic={topic} visible={factorsVisible} visibleFactors={visibleFactors}\n\t\t                  filterText={filterText}/>\n\t</TopicContainer>;\n};\n","import { faCircleNotch, faCompressAlt, faLink, faSearch } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { useEffect, useRef, useState } from 'react';\nimport styled, { keyframes, useTheme } from 'styled-components';\nimport { useForceUpdate } from '../../../common/utils';\nimport { QueriedTopicForPipeline } from '../../../services/admin/types';\nimport { Theme } from '../../../theme/types';\nimport { LinkButton } from '../../component/console/link-button';\nimport { ResizeHandle, ResizeHandleAlignment } from '../../component/console/menu/resize-handle';\nimport Input from '../../component/input';\nimport { usePipelineContext } from './pipeline-context';\nimport { NavigatorTopic } from './pipeline-navigator-topic';\n\nconst ScrollWidth = 15;\nconst Navigator = styled.div.attrs<{ width: number, visible: boolean }>(({ theme, width, visible }) => {\n\treturn {\n\t\t'data-widget': 'console-pipeline-topics-navigator',\n\t\tstyle: {\n\t\t\tposition: visible ? 'relative' : 'absolute',\n\t\t\tright: visible ? 0 : (-1 - width),\n\t\t\ttop: visible ? 'unset' : (theme as Theme).consoleSpaceHeaderHeight,\n\t\t\twidth,\n\t\t\theight: visible ? 'unset' : `calc(100% - ${(theme as Theme).consoleSpaceHeaderHeight}px)`,\n\t\t\tpointerEvents: visible ? 'auto' : 'none',\n\t\t\topacity: visible ? 1 : 0\n\t\t}\n\t};\n})<{ width: number, visible: boolean }>`\n\tdisplay: flex;\n\tflex-direction: column;\n\tborder-left: var(--border);\n\ttransition: opacity 300ms ease-in-out, right 300ms ease-in-out;\n\toverflow: hidden;\n`;\nconst Title = styled.div.attrs({\n\t'data-widget': 'console-pipeline-topics-navigator-title'\n})`\n\tdisplay: flex;\n\talign-items: center;\n\tfont-family: var(--console-title-font-family);\n\tmin-height: 40px;\n\tborder-bottom: var(--border);\n\tpadding: 0 calc(var(--margin) / 2);\n\t&[data-link-topic=true] {\n\t\t> button:last-child {\n\t\t\tcolor: var(--invert-color);\n\t\t\tbackground-color: var(--console-primary-color);\n\t\t}\n\t}\n\t> button {\n\t\tborder-radius: var(--border-radius);\n\t\tfont-size: 0.8em;\n\t\tpadding: calc(var(--margin) / 5);\n\t\twidth: 24px;\n\t\theight: 24px;\n\t}\n\t> button:not(:last-child) {\n\t\tmargin-right: calc(var(--margin) / 6);\n\t}\n`;\nconst Search = styled.div.attrs({\n\t'data-widget': 'console-pipeline-topics-navigator-search'\n})`\n\tflex-grow: 1;\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\tjustify-content: flex-end;\n\tpadding-left: calc(var(--margin) / 2);\n\tmargin-right: calc(var(--margin) / 6);\n\t> input {\n\t\tflex-grow: 0;\n\t\tmin-width: 0;\n\t\theight: 24px;\n\t\tfont-size: 0.8em;\n\t\tborder-radius: 0;\n\t\tborder: 0;\n\t\tpadding: 0 24px 0 0;\n\t\t&[data-on-search=false] {\n\t\t\tpadding-right: 0;\n\t\t\twidth: 0;\n\t\t}\n\t\t&[data-on-search=true] {\n\t\t\twidth: 100%;\n\t\t\tbox-shadow: 0 1px 0 0 var(--border-color);\n\t\t}\n\t}\n\t> button {\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\tright: 0;\n\t\ttop: 1px;\n\t\twidth: 24px;\n\t\theight: 24px;\n\t\tfont-size: 0.8em;\n\t}\n`;\nconst Body = styled.div.attrs({\n\t'data-widget': 'console-pipeline-topics-navigator-body'\n})`\n\tdisplay: flex;\n\tflex-direction: column;\n\tflex-grow: 1;\n\toverflow: auto;\n\t&::-webkit-scrollbar {\n\t\tbackground-color: transparent;\n\t\twidth: 4px;\n\t}\n\t&::-webkit-scrollbar-track {\n\t\tbackground-color: transparent;\n\t\tborder-radius: 2px;\n\t}\n\t&::-webkit-scrollbar-thumb {\n\t\tbackground-color: var(--console-favorite-color);\n\t\tborder-radius: 2px;\n\t}\n`;\n\nconst Spin = keyframes`\n\tfrom {\n\t\ttransform: rotateZ(0deg);\n\t}\n\tto {\n\t\ttransform: rotateZ(360deg);\n\t}\n`;\nconst LoadingInCenterDiv = styled.div`\n\tdisplay: flex;\n\tflex-direction: column;\n\tflex-grow: 1;\n\talign-items: center;\n\tjustify-content: center;\n\t> svg {\n\t\tfont-size: 3em;\n\t\topacity: 0.2;\n\t\tfilter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.5));\n\t\tanimation: ${Spin} infinite 2s forwards linear;\n\t\tmargin-bottom: calc(var(--margin) / 4);\n\t}\n\t> span {\n\t\tfont-size: 1.2em;\n\t\topacity: 0.3;\n\t\tfont-family: var(--console-title-font-family);\n\t}\n`;\nconst LoadingInCenter = () => {\n\tconst {\n\t\tstore: { topics, topicsLoadCompleted }\n\t} = usePipelineContext();\n\n\tif (topicsLoadCompleted) {\n\t\treturn null;\n\t}\n\n\tif (topics.length !== 0) {\n\t\treturn null;\n\t}\n\n\t// setTimeout(forceUpdate, 500);\n\n\treturn <LoadingInCenterDiv>\n\t\t<FontAwesomeIcon icon={faCircleNotch}/>\n\t\t<span>Loading...</span>\n\t</LoadingInCenterDiv>;\n};\nconst LoadingInBottomDiv = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: flex-end;\n\tfont-size: 0.8em;\n\tpadding: 0 calc(var(--margin) / 2);\n\tmin-height: 36px;\n\tfont-family: var(--console-title-font-family);\n\tborder-top: var(--border);\n\tcolor: var(--console-favorite-color);\n\t> svg {\n\t\tanimation: ${Spin} infinite 2s forwards linear;\n\t\tmargin-right: calc(var(--margin) / 3);\n\t}\n`;\nconst LoadingInBottom = () => {\n\tconst {\n\t\tstore: { topics, topicsLoadCompleted }\n\t} = usePipelineContext();\n\n\tif (topicsLoadCompleted) {\n\t\treturn null;\n\t}\n\n\tif (topics.length === 0) {\n\t\treturn null;\n\t}\n\n\treturn <LoadingInBottomDiv>\n\t\t<FontAwesomeIcon icon={faCircleNotch}/>\n\t\t<span>More Data On Loading...</span>\n\t</LoadingInBottomDiv>;\n};\n\nconst SearchInTitle = () => {\n\tconst { changeTopicFilter } = usePipelineContext();\n\tconst searchInputRef = useRef<HTMLInputElement>(null);\n\tconst [ onSearch, setOnSearch ] = useState(false);\n\tconst [ searchThrottle, setSearchThrottle ] = useState<number | null>(null);\n\tconst [ searchText, setSearchText ] = useState('');\n\n\tconst onSearchInputChange = () => {\n\t\tconst value = searchInputRef.current?.value;\n\t\tsetSearchText(value || '');\n\t\tconst searchText = (value || '').trim();\n\t\tif (searchThrottle) {\n\t\t\tclearTimeout(searchThrottle);\n\t\t\tsetSearchThrottle(null);\n\t\t}\n\t\tsetSearchThrottle(setTimeout(() => {\n\t\t\tsetSearchThrottle(null);\n\t\t\tchangeTopicFilter(searchText);\n\t\t}, 300));\n\t};\n\tconst onSearchInputFocus = () => searchInputRef.current?.select();\n\tconst onSearchInputBlur = () => !searchInputRef.current?.value && setOnSearch(false);\n\tconst onSearchClicked = () => {\n\t\tsetOnSearch(true);\n\t\tsearchInputRef.current?.focus();\n\t};\n\n\treturn <Search>\n\t\t<Input data-on-search={onSearch}\n\t\t       value={searchText} placeholder='Filter by name'\n\t\t       onChange={onSearchInputChange}\n\t\t       onFocus={onSearchInputFocus} onBlur={onSearchInputBlur}\n\t\t       ref={searchInputRef}/>\n\t\t<LinkButton ignoreHorizontalPadding={true} tooltip='Search by Name' right={true} offsetX={-8}\n\t\t            onClick={onSearchClicked}>\n\t\t\t<FontAwesomeIcon icon={faSearch}/>\n\t\t</LinkButton>\n\t</Search>;\n};\n\nexport const PipelineNavigator = () => {\n\tconst { consoleSpaceHeaderHeight } = useTheme() as Theme;\n\tconst {\n\t\tstore: { topics, menuVisible },\n\t\taddMenuVisibilityListener, removeMenuVisibilityListener,\n\t\taddTopicsChangedListener, removeTopicsChangedListener,\n\t\taddTopicSelectionChangedListener, removeTopicSelectionChangedListener,\n\t\tcollapseAllTopics\n\t} = usePipelineContext();\n\tconst bodyRef = useRef<HTMLDivElement>(null);\n\tconst [ width, setWidth ] = useState(300 + ScrollWidth);\n\tconst [ linkTopic, setLinkTopic ] = useState(false);\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\tconst onVisibleChanged = (visible: boolean) => {\n\t\t\tif (visible) {\n\t\t\t\tsetWidth(Math.max(width, 300 + ScrollWidth));\n\t\t\t}\n\t\t\tforceUpdate();\n\t\t};\n\t\tconst onTopicLink = (topic?: QueriedTopicForPipeline) => {\n\t\t\tif (!topic || !linkTopic || !bodyRef.current) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst topicNode = bodyRef.current.querySelector(`div[data-topic-id=\"${topic.topicId}\"]`);\n\t\t\tif (!topicNode) {\n\t\t\t\t// not found\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ttopicNode.scrollIntoView({ behavior: 'smooth', block: 'start' });\n\t\t};\n\t\taddMenuVisibilityListener(onVisibleChanged);\n\t\taddTopicsChangedListener(forceUpdate);\n\t\taddTopicSelectionChangedListener(onTopicLink);\n\t\treturn () => {\n\t\t\tremoveMenuVisibilityListener(onVisibleChanged);\n\t\t\tremoveTopicsChangedListener(forceUpdate);\n\t\t\tremoveTopicSelectionChangedListener(onTopicLink);\n\t\t};\n\t});\n\n\tconst onLinkTopicClicked = () => setLinkTopic(!linkTopic);\n\tconst onCollapseAllClicked = () => collapseAllTopics();\n\tconst onResize = (width: number) => setWidth(Math.min(Math.max(width, ScrollWidth), 500));\n\n\treturn <Navigator width={width - ScrollWidth} visible={menuVisible}>\n\t\t<Title data-link-topic={linkTopic}>\n\t\t\t<span>Topics</span>\n\t\t\t<SearchInTitle/>\n\t\t\t<LinkButton ignoreHorizontalPadding={true} tooltip='Collapse All' right={true} offsetX={-8}\n\t\t\t            onClick={onCollapseAllClicked}>\n\t\t\t\t<FontAwesomeIcon icon={faCompressAlt} transform={{ rotate: -45 }}/>\n\t\t\t</LinkButton>\n\t\t\t<LinkButton ignoreHorizontalPadding={true} tooltip='Synchronized with Editor' right={true} offsetX={-8}\n\t\t\t            onClick={onLinkTopicClicked}>\n\t\t\t\t<FontAwesomeIcon icon={faLink}/>\n\t\t\t</LinkButton>\n\t\t</Title>\n\t\t<Body ref={bodyRef}>\n\t\t\t{topics.map(topic => <NavigatorTopic topic={topic} key={topic.topicId}/>)}\n\t\t\t<LoadingInCenter/>\n\t\t</Body>\n\t\t<LoadingInBottom/>\n\t\t<ResizeHandle top={consoleSpaceHeaderHeight} width={width} onResize={onResize}\n\t\t              alignment={ResizeHandleAlignment.RIGHT}/>\n\t</Navigator>;\n};","import React from \"react\";\nimport styled from 'styled-components';\nimport { PipelineBody } from './pipeline-body';\nimport { PipelineContextProvider } from './pipeline-context';\nimport { PipelineHeader } from './pipeline-header';\nimport { PipelineNavigator } from './pipeline-navigator';\n\nconst Container = styled.div.attrs({\n\t'data-widget': 'console-pipeline-container'\n})`\n\tdisplay: grid;\n\tgrid-template-columns: 1fr auto;\n\tgrid-template-rows: auto 1fr;\n\tflex-grow: 1;\n\toverflow: hidden;\n`;\n\nexport const Pipeline = () => {\n\treturn <PipelineContextProvider>\n\t\t<Container>\n\t\t\t<PipelineHeader/>\n\t\t\t<PipelineBody/>\n\t\t\t<PipelineNavigator/>\n\t\t</Container>\n\t</PipelineContextProvider>;\n};","export default __webpack_public_path__ + \"static/media/report-background.99d6aff5.png\";","import { DataPage, QueriedReport } from './types';\n\nexport const listReports = async (options: {\n\tsearch: string;\n\tpageNumber?: number;\n\tpageSize?: number;\n}): Promise<DataPage<QueriedReport>> => {\n\tconst { pageNumber = 1, pageSize = 9 } = options;\n\n\treturn new Promise(resolve => {\n\t\tsetTimeout(() => {\n\t\t\tresolve({\n\t\t\t\tdata: [\n\t\t\t\t\t// {\n\t\t\t\t\t// \treportId: '1',\n\t\t\t\t\t// \tname: 'Premium on State',\n\t\t\t\t\t// \tdescription: 'Annual premium summary group by state.',\n\t\t\t\t\t// \tpredefined: true,\n\t\t\t\t\t// \ttopicCount: 2,\n\t\t\t\t\t// \tgroupCount: 1,\n\t\t\t\t\t// \tspaceCount: 2\n\t\t\t\t\t// }\n\t\t\t\t],\n\t\t\t\titemCount: 0,\n\t\t\t\tpageNumber,\n\t\t\t\tpageSize,\n\t\t\t\tpageCount: 1\n\t\t\t});\n\t\t}, 1000);\n\t});\n};\n","import { EventEmitter } from 'events';\nimport React, { useEffect, useState } from \"react\";\nimport styled from 'styled-components';\n\nconst EditContainer = styled.div`\n\tdisplay: grid;\n\tgrid-template-columns: 30% calc(70% - var(--margin));\n\tgrid-column-gap: var(--margin);\n\tmin-height: 300px;\n\tmargin-top: -50px;\n\tmargin-bottom: 50px;\n\tpadding-bottom: 50px;\n\topacity: 1;\n\tpointer-events: auto;\n\tz-index: 1;\n\ttransition: all 300ms ease-in-out;\n\tposition: absolute;\n\ttop: 230px;\n\twidth: 100%;\n\t&[data-visible=false] {\n\t\topacity: 0;\n\t\tpointer-events: none;\n\t}\n`;\nconst Editor = styled.div`\n\tdisplay: grid;\n\tgrid-template-columns: 150px 1fr;\n\tgrid-column-gap: var(--margin);\n\tgrid-auto-rows: minmax(40px, auto);\n\tgrid-row-gap: calc(var(--margin) / 4);\n\talign-items: center;\n`;\nconst EditorTitle = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\tgrid-column: span 2;\n\tfont-variant: petite-caps;\n\tfont-weight: var(--font-demi-bold);\n\tfont-size: 1.4em;\n\tborder-bottom: var(--border);\n\theight: 44px;\n\tmargin-bottom: calc(var(--margin) / 2);\n`;\nconst Image = styled.div.attrs<{ background: string, position: string }>(({ background, position }) => {\n\treturn { style: { backgroundImage: `url(${background})`, backgroundPosition: position } };\n})<{ background: string, position: string }>`\n\tbackground-repeat: no-repeat;\n\tbackground-size: 80%;\n\tfilter: drop-shadow(2px 4px 6px rgba(0, 0, 0, 0.7)) grayscale(0.9);\n\ttransition: all 300ms ease-in-out;\n`;\n\nexport enum EditPanelEvent {\n\tBACKGROUND_POSITION_CHANGED = 'background-position-changed',\n}\n\nexport type BackgroundPositionChangeListener = (position: string) => void;\n\nexport interface EditPanelContext {\n\tchangeBackgroundPosition: (position: string) => void;\n\taddBackgroundPositionChangeListener: (listener: BackgroundPositionChangeListener) => void;\n\tremoveBackgroundPositionChangeListener: (listener: BackgroundPositionChangeListener) => void;\n}\n\nconst Context = React.createContext<EditPanelContext>({} as EditPanelContext);\nContext.displayName = 'EditPanelContext';\n\nexport const EditPanelContextProvider = (props: {\n\tchildren?: ((props: any) => React.ReactNode) | React.ReactNode;\n}) => {\n\tconst { children } = props;\n\n\tconst [ emitter ] = useState<EventEmitter>(() => {\n\t\tconst emitter = new EventEmitter();\n\t\temitter.setMaxListeners(1000);\n\t\treturn emitter;\n\t});\n\n\treturn <Context.Provider value={{\n\t\tchangeBackgroundPosition: (position: string) => emitter.emit(EditPanelEvent.BACKGROUND_POSITION_CHANGED, position),\n\t\taddBackgroundPositionChangeListener: (listener: BackgroundPositionChangeListener) => emitter.on(EditPanelEvent.BACKGROUND_POSITION_CHANGED, listener),\n\t\tremoveBackgroundPositionChangeListener: (listener: BackgroundPositionChangeListener) => emitter.off(EditPanelEvent.BACKGROUND_POSITION_CHANGED, listener)\n\t}}>{children}</Context.Provider>;\n};\nexport const useEditPanelContext = () => {\n\treturn React.useContext(Context);\n};\n\nexport const EditImage = (props: { background: string }) => {\n\tconst { background } = props;\n\n\tconst { addBackgroundPositionChangeListener, removeBackgroundPositionChangeListener } = useEditPanelContext();\n\tconst [ backgroundPosition, setBackgroundPosition ] = useState('left');\n\n\tuseEffect(() => {\n\t\taddBackgroundPositionChangeListener(setBackgroundPosition);\n\t\treturn () => removeBackgroundPositionChangeListener(setBackgroundPosition);\n\t}, [ addBackgroundPositionChangeListener, removeBackgroundPositionChangeListener ]);\n\n\treturn <Image background={background} position={backgroundPosition}/>;\n};\nexport const EditArea = (props: {\n\ttitle: string;\n\tbackground: string;\n\tvisible: boolean;\n\tchildren?: ((props: any) => React.ReactNode) | React.ReactNode;\n}) => {\n\tconst { title, background, visible, children } = props;\n\n\treturn <EditContainer data-visible={visible}>\n\t\t<EditImage background={background}/>\n\t\t<Editor>\n\t\t\t<EditorTitle>{title}</EditorTitle>\n\t\t\t{children}\n\t\t</Editor>\n\t</EditContainer>;\n};\n\nexport const EditPanel = (props: {\n\ttitle: string;\n\tbackground: string;\n\tvisible: boolean;\n\tchildren?: ((props: any) => React.ReactNode) | React.ReactNode;\n}) => {\n\tconst { title, background, visible, children } = props;\n\n\treturn <EditPanelContextProvider>\n\t\t<EditArea title={title} background={background} visible={visible}>\n\t\t\t{children}\n\t\t</EditArea>\n\t</EditPanelContextProvider>;\n};","import styled from 'styled-components';\n\nexport const EditPanelButtons = styled.div`\n\tgrid-column: span 2;\n\tdisplay: flex;\n\tjustify-content: flex-end;\n\ttransition: all 300ms ease-in-out;\n\t> button {\n\t\tfont-size: 1.2em;\n\t\theight: 32px;\n\t\tmin-width: 120px;\n\t\t&:not(:first-child) {\n\t\t\tmargin-left: calc(var(--margin) / 2);\n\t\t}\n\t}\n`;","import { DataPage } from '../../services/admin/types';\n\nexport const createBlankDataPage = <T>(pageSize: number = 9): DataPage<T> => {\n\treturn {\n\t\tpageNumber: 1,\n\t\tpageSize,\n\t\tpageCount: 1,\n\t\titemCount: 0,\n\t\tdata: []\n\t};\n};","import { faPlus, faSearch } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { Fragment, useEffect, useRef, useState } from 'react';\nimport styled from 'styled-components';\nimport { DataPage } from '../../../services/admin/types';\nimport { CarvedButton } from '../../component/console/carved-button';\nimport { HorizontalLoading } from '../../component/console/horizontal-loading';\nimport { LinkButton } from '../../component/console/link-button';\nimport Input from '../../component/input';\nimport { createBlankDataPage } from '../utils';\n\ninterface State<T> extends DataPage<T> {\n\tqueried: boolean;\n\tsearched?: string;\n}\n\nconst Main = styled.div`\n\tdisplay: flex;\n\tposition: relative;\n\tflex-direction: column;\n\tmargin-top: 30px;\n\t&[data-visible=false] {\n\t\t> div:nth-child(2),\n\t\t> div:nth-child(3) > *:not(:nth-child(2)) {\n\t\t\topacity: 0;\n\t\t\tpointer-events: none;\n\t\t}\n\t}\n\t> div:nth-child(2),\n\t> div:nth-child(3) > *:not(:nth-child(2)) {\n\t\topacity: 1;\n\t\tpointer-events: auto;\n\t}\n`;\nconst Operators = styled.div`\n\tdisplay: grid;\n\tgrid-template-columns: auto 1fr;\n\tmargin-bottom: calc(var(--margin) / 2);\n\t&[data-can-create=false] {\n\t\t> button {\n\t\t\tdisplay: none;\n\t\t}\n\t\t> div {\n\t\t\tgrid-column: span 2;\n\t\t\t&[data-on-before-search=false] {\n\t\t\t\t> button {\n\t\t\t\t\tborder-bottom-color: transparent;\n\t\t\t\t}\n\t\t\t}\n\t\t\t> button {\n\t\t\t\tborder-radius: 0;\n\t\t\t\tbackground-color: transparent;\n\t\t\t\tborder-bottom: 2px solid var(--border-color);\n\t\t\t\t&:before {\n\t\t\t\t\tborder-radius: calc(var(--border-radius) * 2);\n\t\t\t\t}\n\t\t\t}\n\t\t\t> input {\n\t\t\t\tborder-top: 0;\n\t\t\t\tborder-right: 0;\n\t\t\t\tborder-radius: 0;\n\t\t\t\tpadding-left: 0;\n\t\t\t}\n\t\t}\n\t}\n\t> button {\n\t\tfont-variant: petite-caps;\n\t\tfont-weight: var(--font-bold);\n\t\tfont-size: 1.2em;\n\t\tbackground-color: var(--border-color);\n\t\tborder-top-left-radius: calc(var(--border-radius) * 2);\n\t\tborder-bottom-left-radius: calc(var(--border-radius) * 2);\n\t\tpadding: 0 var(--margin);\n\t\t&:before {\n\t\t\tborder-radius: calc(var(--border-radius) * 2) 0 0 calc(var(--border-radius) * 2);\n\t\t}\n\t\t&:after {\n\t\t\tcontent: '';\n\t\t\tdisplay: block;\n\t\t\tposition: absolute;\n\t\t\ttop: 30%;\n\t\t\tright: 0;\n\t\t\twidth: 1px;\n\t\t\theight: 40%;\n\t\t\tbackground-color: var(--invert-color);\n\t\t\topacity: 0.7;\n\t\t}\n\t\t> svg {\n\t\t\tfont-size: 0.7em;\n\t\t\tmargin-right: calc(var(--margin) / 2);\n\t\t}\n\t}\n`;\nconst SearchOperator = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\t&[data-on-before-search=true] {\n\t\t> button {\n\t\t\tborder-radius: 0;\n\t\t\t&:before {\n\t\t\t\tborder-radius: 0;\n\t\t\t}\n\t\t}\n\t\t> input {\n\t\t\tpadding: 0 calc(var(--margin) / 2);\n\t\t\tborder-style: solid;\n\t\t\tborder-right-width: 2px;\n\t\t\tborder-top-right-radius: calc(var(--border-radius) * 2);\n\t\t\tborder-bottom-right-radius: calc(var(--border-radius) * 2);\n\t\t\twidth: 100%;\n\t\t}\n\t}\n\t> button {\n\t\tdisplay: block;\n\t\talign-self: stretch;\n\t\tfont-size: 1.2em;\n\t\twidth: 44px;\n\t\tbackground-color: var(--border-color);\n\t\t//color: var(--invert-color);\n\t\tborder-top-right-radius: calc(var(--border-radius) * 2);\n\t\tborder-bottom-right-radius: calc(var(--border-radius) * 2);\n\t\tcursor: pointer;\n\t\t&:before {\n\t\t\tborder-radius: 0 calc(var(--border-radius) * 2) calc(var(--border-radius) * 2) 0;\n\t\t}\n\t\t> svg {\n\t\t\tfont-size: 0.7em;\n\t\t}\n\t}\n`;\nconst Search = styled(Input)`\n\tborder-radius: 0;\n\tborder-width: 2px;\n\tborder-color: var(--border-color);\n\tborder-left: 0;\n\tborder-right-width: 0;\n\tpadding: 0;\n\tfont-size: 1.4em;\n\tline-height: 1.6em;\n\theight: calc(1.6em + 12px);\n\twidth: 0;\n\tcolor: var(--console-font-color);\n\ttransition: all 300ms ease-in-out;\n`;\nconst List = styled.div`\n\tgrid-column: span 2;\n\tdisplay: none;\n\tgrid-template-columns: repeat(3, 1fr);\n\tgrid-column-gap: calc(var(--margin) / 2);\n\tgrid-row-gap: calc(var(--margin) / 2);\n\tpadding-top: calc(var(--margin) / 2);\n\t&[data-visible=true] {\n\t\tdisplay: grid;\n\t}\n`;\nconst NoData = styled.div`\n\tdisplay: none;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding-top: calc(var(--margin) / 2);\n\tgrid-column: span 3;\n\tfont-family: var(--console-title-font-family);\n\tfont-weight: var(--font-demi-bold);\n\tfont-size: 1.2em;\n\t&[data-visible=true] {\n\t\tdisplay: flex;\n\t}\n`;\nconst Bottom = styled.div`\n\tgrid-column: span 2;\n\tdisplay: flex;\n\tmargin-top: calc(var(--margin) / 2);\n\tmargin-bottom: 50px;\n\t&[data-visible=false] {\n\t\tdisplay: none;\n\t}\n\t> div:nth-child(2) {\n\t\tflex-grow: 1;\n\t}\n\t> div:nth-child(3) {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tpadding: 4px 0;\n\t}\n\t> div:nth-child(3),\n\t> button {\n\t\tline-height: 1.6em;\n\t\tfont-family: var(--console-title-font-family);\n\t\tfont-weight: var(--font-demi-bold);\n\t\tcolor: var(--console-font-color);\n\t\t&[data-visible=false] {\n\t\t\tdisplay: none;\n\t\t}\n\t}\n\t> button:last-child {\n\t\tmargin-left: calc(var(--margin) / 2);\n\t}\n`;\n\nexport const SingleSearchItemCard = styled.div`\n\tdisplay: flex;\n\tflex-direction: column;\n\tpadding: calc(var(--margin) / 2) var(--margin);\n\tposition: relative;\n\tborder-radius: calc(var(--border-radius) * 2);\n\tbox-shadow: var(--console-shadow);\n\tcursor: pointer;\n\ttransition: all 300ms ease-in-out;\n\t&:hover {\n\t\tbox-shadow: var(--console-hover-shadow);\n\t}\n\t> div:first-child {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tfont-family: var(--console-title-font-family);\n\t\tfont-size: 1.4em;\n\t}\n\t> div:nth-child(2) {\n\t\tdisplay: flex;\n\t\tflex-grow: 1;\n\t\tposition: relative;\n\t\tword-break: break-word;\n\t\tfont-size: 0.8em;\n\t\topacity: 0.8;\n\t\tmargin-top: calc(var(--margin) / 2);\n\t\tmin-height: 3.5em;\n\t\tline-height: 1.5em;\n\t}\n\t> div:nth-child(3) {\n\t\tdisplay: flex;\n\t\tjustify-content: space-around;\n\t\tline-height: 1.2em;\n\t\topacity: 0.7;\n\t\tmargin-top: calc(var(--margin) / 2);\n\t\t> button {\n\t\t\tfont-size: 0.8em;\n\t\t\tcolor: var(--console-font-color);\n\t\t\tsvg {\n\t\t\t\tmargin-right: calc(var(--margin) / 4);\n\t\t\t}\n\t\t}\n\t}\n`;\n\nexport const SingleSearch = <T extends any>(props: {\n\tsearchPlaceholder?: string;\n\tcreateButtonLabel?: string;\n\tonCreate?: () => void;\n\tonSearched?: () => void;\n\tlistData: (options: { search: string; pageNumber: number; pageSize: number }) => Promise<DataPage<T>>;\n\trenderItem: (item: T) => React.ReactNode;\n\tgetKeyOfItem: (item: T) => string;\n\tvisible?: boolean;\n}) => {\n\tconst {\n\t\tsearchPlaceholder,\n\t\tcreateButtonLabel = 'Create One',\n\t\tonCreate,\n\t\tonSearched = () => {\n\t\t},\n\t\tlistData,\n\t\trenderItem,\n\t\tgetKeyOfItem,\n\t\tvisible = true\n\t} = props;\n\n\tconst searchRef = useRef<HTMLInputElement>(null);\n\tconst [ beforeSearch, setBeforeSearch ] = useState<boolean>(true);\n\tconst [ loading, setLoading ] = useState<boolean>(false);\n\tconst [ state, setState ] = useState<State<T>>({ queried: false, ...createBlankDataPage() });\n\tconst [ searchText, setSearchText ] = useState<string>('');\n\tuseEffect(() => {\n\t\tif (searchRef.current) {\n\t\t\tsearchRef.current.focus();\n\t\t}\n\t}, [ searchRef ]);\n\n\tconst onBeforeSearchClicked = () => {\n\t\t!beforeSearch && setBeforeSearch(true);\n\t\tsearchRef.current!.focus();\n\t\tsearchRef.current!.select();\n\t};\n\tconst onSearchChanged = (event: React.ChangeEvent<HTMLInputElement>) => setSearchText(event.target.value);\n\tconst searchPage = async (searchText: string, pageNumber: number, clear: boolean = false, collapseSearchText: boolean = false) => {\n\t\ttry {\n\t\t\tsetLoading(true);\n\t\t\tif (clear) {\n\t\t\t\tsetState({ queried: false, ...createBlankDataPage<T>() });\n\t\t\t}\n\t\t\tconst result = await listData({ search: searchText, pageNumber, pageSize: state.pageSize });\n\t\t\tsetState({ queried: true, searched: searchText, ...result });\n\t\t\tif (collapseSearchText && result.data.length !== 0) {\n\t\t\t\tsetBeforeSearch(false);\n\t\t\t}\n\t\t\tsetLoading(false);\n\t\t\tonSearched();\n\t\t} catch (e) {\n\t\t\tconsole.groupCollapsed(`%cError on fetch data.`, 'color:rgb(251,71,71)');\n\t\t\tconsole.error(e);\n\t\t\tconsole.groupEnd();\n\t\t}\n\t};\n\tconst onSearchKeyPressed = async (event: React.KeyboardEvent<HTMLInputElement>) => {\n\t\tif (event.key !== 'Enter') {\n\t\t\treturn;\n\t\t}\n\n\t\tawait searchPage(searchText, 1, true, true);\n\t};\n\tconst onPreviousPageClicked = () => searchPage(state.searched!, state.pageNumber - 1);\n\tconst onNextPageClicked = () => searchPage(state.searched!, state.pageNumber + 1);\n\n\treturn <Main data-visible={visible}>\n\t\t<Operators data-can-create={!!onCreate}>\n\t\t\t<LinkButton onClick={onCreate}>\n\t\t\t\t<FontAwesomeIcon icon={faPlus}/>\n\t\t\t\t<span>{createButtonLabel}</span>\n\t\t\t</LinkButton>\n\t\t\t<SearchOperator data-on-before-search={beforeSearch}>\n\t\t\t\t<LinkButton ignoreHorizontalPadding={true} onClick={onBeforeSearchClicked}>\n\t\t\t\t\t<FontAwesomeIcon icon={faSearch}/>\n\t\t\t\t</LinkButton>\n\t\t\t\t<Search placeholder={searchPlaceholder}\n\t\t\t\t        value={searchText} onChange={onSearchChanged}\n\t\t\t\t        onKeyPress={onSearchKeyPressed}\n\t\t\t\t        ref={searchRef}/>\n\t\t\t</SearchOperator>\n\t\t</Operators>\n\t\t<List data-visible={state.queried}>\n\t\t\t<NoData data-visible={state.data.length === 0}>No matched data.</NoData>\n\t\t\t{state.data.map(item => {\n\t\t\t\treturn <Fragment key={getKeyOfItem(item)}>{renderItem(item)}</Fragment>;\n\t\t\t})}\n\t\t</List>\n\t\t<Bottom data-visible={!state.queried || state.data.length !== 0}>\n\t\t\t<CarvedButton data-visible={state.queried && state.pageNumber !== 1}\n\t\t\t              onClick={onPreviousPageClicked}>\n\t\t\t\tPrevious Page\n\t\t\t</CarvedButton>\n\t\t\t<HorizontalLoading visible={loading}/>\n\t\t\t<div data-visible={state.queried}>\n\t\t\t\t<sub>#</sub>{state.pageNumber} of {state.pageCount} Pages\n\t\t\t</div>\n\t\t\t<CarvedButton\n\t\t\t\tdata-visible={state.queried && state.pageNumber !== state.pageCount}\n\t\t\t\tonClick={onNextPageClicked}>\n\t\t\t\tNext Page\n\t\t\t</CarvedButton>\n\t\t</Bottom>\n\t</Main>;\n};","import React, { useEffect, useState } from 'react';\nimport styled, { keyframes } from 'styled-components';\nimport { useForceUpdate } from '../../../common/utils';\nimport { DataPage } from '../../../services/admin/types';\nimport { NarrowPageTitle } from '../../component/console/narrow-page-title';\nimport { PlainNarrowContainer } from '../../component/console/page-container';\nimport { DangerObjectButton, PrimaryObjectButton } from '../../component/object-button';\nimport { EditPanel } from './edit-panel';\nimport { EditPanelButtons } from './edit-panel-buttons';\nimport { SingleSearch } from './single-search';\n\nconst Saved = keyframes`\n\t0% {\n\t\ttransform: scale(1);\n\t}\n\t5% {\n\t\ttransform: scale(1.5);\n\t}\n\t20%, 80% {\n\t\ttransform: scale(1);\n\t\topacity: 1;\n\t}\n\t100% {\n\t\ttransform: scale(1);\n\t\topacity: 0;\n\t}\n`;\nconst InformMessage = styled.div`\n\tflex-grow: 1;\n\tdisplay: flex;\n\talign-items: center;\n\tfont-size: 0.8em;\n\tfont-variant: petite-caps;\n\tfont-weight: var(--font-bold);\n\topacity: 0.5;\n\ttransition: all 300ms ease-in-out;\n\t&[data-change-kind=changed] {\n\t\tcolor: var(--console-success-color);\n\t}\n\t&[data-change-kind=saving] {\n\t\tcolor: var(--console-danger-color);\n\t}\n\t&[data-change-kind=saved] {\n\t\tcolor: var(--console-danger-color);\n\t\t> span {\n\t\t\tanimation: ${Saved} 6000ms ease-in-out forwards;\n\t\t\ttransform-origin: left;\n\t\t}\n\t}\n\t&:empty {\n\t\topacity: 0;\n\t}\n`;\n\nconst Editor = <Entity extends object>(props: {\n\tentityLabel: string;\n\tentityImage: string;\n\tentity?: Entity\n\tcreateEntity: (fake: boolean) => Entity;\n\tsaveEntity?: (entity: Entity) => Promise<void>;\n\tisEntityOnCreate: (entity: Entity) => boolean;\n\trenderEditContent: (entity: Entity, onDataChanged: () => void) => React.ReactNode;\n\tonClosed: () => void;\n}) => {\n\tconst {\n\t\tentityLabel, entityImage,\n\t\tentity: originEntity,\n\t\tcreateEntity, saveEntity, isEntityOnCreate,\n\t\tonClosed,\n\t\trenderEditContent\n\t} = props;\n\tconst {\n\t\t// create a fake entity here for render editor background\n\t\t// for animation purpose\n\t\tentity = createEntity(true)\n\t} = props;\n\n\tconst [ dataChanged, setDataChanged ] = useState(false);\n\tconst [ dataSaving, setDataSaving ] = useState(false);\n\tconst [ dataSaved, setDataSaved ] = useState(false);\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\tsetDataSaved(false);\n\t\tsetDataSaving(false);\n\t\tsetDataChanged(false);\n\t}, [ entity ]);\n\n\tconst onDataChanged = () => {\n\t\tif (dataSaved) {\n\t\t\tsetDataSaved(false);\n\t\t}\n\t\tsetDataChanged(true);\n\t\tforceUpdate();\n\t};\n\tconst onDataSaved = () => {\n\t\tsetDataSaving(false);\n\t\tsetDataSaved(true);\n\t\tforceUpdate();\n\t};\n\tconst onConfirmClicked = async () => {\n\t\tif (!saveEntity) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetDataSaving(true);\n\t\tsetDataChanged(false);\n\t\tawait saveEntity(entity);\n\t\tonDataSaved();\n\t};\n\tconst onCloseClicked = () => onClosed();\n\n\tconst visible = !!originEntity;\n\tconst onEditing = !isEntityOnCreate(entity);\n\tconst title = onEditing ? `An Exists ${entityLabel}` : `A New ${entityLabel}`;\n\tconst kind = dataSaved ? 'saved' : (dataSaving ? 'saving' : (dataChanged ? 'changed' : ''));\n\tconst message = dataSaved ? 'Data Saved.' : (dataSaving ? 'Data Saving...' : (dataChanged ? 'Data Changed.' : ''));\n\n\treturn <EditPanel title={title} background={entityImage} visible={visible}>\n\t\t{renderEditContent(entity, onDataChanged)}\n\t\t<EditPanelButtons>\n\t\t\t<InformMessage data-change-kind={kind}><span>{message}</span></InformMessage>\n\t\t\t{saveEntity ? <PrimaryObjectButton onClick={onConfirmClicked}>\n\t\t\t\t<span>Confirm</span>\n\t\t\t</PrimaryObjectButton> : null}\n\t\t\t<DangerObjectButton onClick={onCloseClicked}>\n\t\t\t\t<span>Close</span>\n\t\t\t</DangerObjectButton>\n\t\t</EditPanelButtons>\n\t</EditPanel>;\n};\n\nexport const SearchAndEditPanel = <Entity extends object, QueriedEntity extends object>(props: {\n\ttitle: string;\n\tsearchPlaceholder?: string;\n\tcreateButtonLabel?: string;\n\tentityLabel: string;\n\tentityImage: string;\n\tcreateEntity: (fake: boolean) => Entity;\n\tfetchEntityAndCodes: (queriedEntity: QueriedEntity) => Promise<{ entity: Entity }>;\n\tfetchEntityList: (options: { search: string; pageNumber?: number; pageSize?: number }) => Promise<DataPage<QueriedEntity>>;\n\tsaveEntity?: (entity: Entity) => Promise<void>;\n\tisEntityOnCreate: (entity: Entity) => boolean;\n\trenderEntityInList: (entity: QueriedEntity, onEdit: (entity: QueriedEntity) => (() => void)) => React.ReactNode;\n\tgetKeyOfEntity: (entity: QueriedEntity) => string;\n\trenderEditContent: (entity: Entity, onDataChanged: () => void) => React.ReactNode;\n}) => {\n\tconst {\n\t\ttitle, searchPlaceholder, createButtonLabel, entityLabel, entityImage,\n\t\tcreateEntity,\n\t\tfetchEntityAndCodes, fetchEntityList,\n\t\tsaveEntity, isEntityOnCreate,\n\t\trenderEntityInList,\n\t\tgetKeyOfEntity,\n\t\trenderEditContent\n\t} = props;\n\n\tconst [ editEntity, setEditEntity ] = useState<{ entity?: Entity }>({});\n\n\tconst onCreate = () => setEditEntity({ entity: createEntity(false) });\n\tconst onEdit = (queriedEntity: QueriedEntity) => async () => {\n\t\tconst result = await fetchEntityAndCodes(queriedEntity);\n\t\tsetEditEntity(result);\n\t};\n\tconst onSearched = () => setEditEntity({});\n\tconst onCreateOrEditDiscarded = () => setEditEntity({});\n\tconst renderItem = (entity: QueriedEntity) => renderEntityInList(entity, onEdit);\n\n\treturn <PlainNarrowContainer>\n\t\t<NarrowPageTitle title={title}/>\n\t\t<SingleSearch searchPlaceholder={searchPlaceholder}\n\t\t              createButtonLabel={createButtonLabel}\n\t\t              onCreate={onCreate}\n\t\t              onSearched={onSearched}\n\t\t              listData={fetchEntityList}\n\t\t              renderItem={renderItem} getKeyOfItem={getKeyOfEntity}\n\t\t              visible={!editEntity.entity}/>\n\t\t<Editor entityLabel={entityLabel}\n\t\t        entityImage={entityImage}\n\t\t        entity={editEntity.entity}\n\t\t        createEntity={createEntity}\n\t\t        saveEntity={saveEntity}\n\t\t        isEntityOnCreate={isEntityOnCreate}\n\t\t        renderEditContent={renderEditContent}\n\t\t        onClosed={onCreateOrEditDiscarded}/>\n\t</PlainNarrowContainer>;\n};","import { faGlobe, faTags, faUsers } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { Fragment } from \"react\";\nimport styled from 'styled-components';\nimport ReportBackground from '../../../assets/report-background.png';\nimport { listReports } from '../../../services/admin/report';\nimport { QueriedReport, Report } from '../../../services/admin/types';\nimport { TooltipCarvedButton } from '../../component/console/carved-button';\nimport { SearchAndEditPanel } from '../component/search-and-edit-panel';\nimport { SingleSearchItemCard } from '../component/single-search';\n\nconst Explanation = styled.div`\n\tgrid-column: span 2;\n\tfont-variant: petite-caps;\n\tfont-weight: var(--font-demi-bold);\n\tfont-size: 1.2em;\n\t+ ol {\n\t\tgrid-column: span 2;\n\t\tcounter-reset: item;\n\t\t> li {\n\t\t\tlist-style: none;\n\t\t\tline-height: 2em;\n\t\t\tfont-size: 0.9em;\n\t\t\t&:before {\n\t\t\t\tdisplay: inline-block;\n\t\t\t\tcontent: counters(item, \".\") \". \";\n\t\t\t\tcounter-increment: item;\n\t\t\t\twidth: 20px;\n\t\t\t}\n\t\t}\n\t}\n\t+ ol + ul {\n\t\tgrid-column: span 2;\n\t\tfont-size: 0.9em;\n\t\tline-height: 1.6em;\n\t\tmargin-top: 10px;\n\t\t> li {\n\t\t\tlist-style: none;\n\t\t\tfont-weight: var(--font-demi-bold);\n\t\t}\n\t}\n`;\n\nexport const Reports = () => {\n\tconst createEntity = () => {\n\t\treturn {} as Report;\n\t};\n\tconst fetchEntityAndCodes = async () => {\n\t\t// no report created here, report should be create in connected space\n\t\treturn { entity: {} as Report };\n\t};\n\tconst fetchEntityList = listReports;\n\tconst isEntityOnCreate = (report: Report) => !report.reportId;\n\tconst renderItemInList = (report: QueriedReport, onEdit: (report: QueriedReport) => (() => void)) => {\n\t\treturn <SingleSearchItemCard key={report.reportId} onClick={onEdit(report)}>\n\t\t\t<div>{report.name}</div>\n\t\t\t<div>{report.description}</div>\n\t\t\t<div>\n\t\t\t\t<TooltipCarvedButton tooltip='Topics Count' center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faTags}/>\n\t\t\t\t\t<span>{report.topicCount}</span>\n\t\t\t\t</TooltipCarvedButton>\n\t\t\t\t<TooltipCarvedButton tooltip='In User Groups' center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faUsers}/>\n\t\t\t\t\t<span>{report.groupCount}</span>\n\t\t\t\t</TooltipCarvedButton>\n\t\t\t\t<TooltipCarvedButton tooltip='In Spaces' center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faGlobe}/>\n\t\t\t\t\t<span>{report.spaceCount}</span>\n\t\t\t\t</TooltipCarvedButton>\n\t\t\t</div>\n\t\t</SingleSearchItemCard>;\n\t};\n\tconst getKeyOfEntity = (item: QueriedReport) => item.reportId;\n\n\tconst renderEditContent = () => {\n\t\treturn <Fragment>\n\t\t\t<Explanation>Guide to Create Predefined Report:</Explanation>\n\t\t\t<ol>\n\t\t\t\t<li>Create an user group, include yourself into this group,</li>\n\t\t\t\t<li>Create a new space or pick an existed one,</li>\n\t\t\t\t<li>Grant space to user group in step (1),</li>\n\t\t\t\t<li>Open client console and sign-in,</li>\n\t\t\t\t<li>Find space in step (3), and connect,</li>\n\t\t\t\t<li>Create reports in connected space, and set as predefined.</li>\n\t\t\t</ol>\n\t\t\t<ul>\n\t\t\t\t<li>Unlike user-defined reports, predefined reports are shared following space assignment.</li>\n\t\t\t\t<li>Only administrators are empowered to create predefined reports.</li>\n\t\t\t</ul>\n\t\t</Fragment>;\n\t};\n\n\treturn <SearchAndEditPanel title='Reports'\n\t                           searchPlaceholder='Search by report name, topic name, description, etc.'\n\t                           createButtonLabel='Create Report'\n\t                           entityLabel='Report'\n\t                           entityImage={ReportBackground}\n\t                           createEntity={createEntity}\n\t                           fetchEntityAndCodes={fetchEntityAndCodes}\n\t                           fetchEntityList={fetchEntityList}\n\t                           isEntityOnCreate={isEntityOnCreate}\n\t                           renderEntityInList={renderItemInList}\n\t                           getKeyOfEntity={getKeyOfEntity}\n\t                           renderEditContent={renderEditContent}/>;\n};","export default __webpack_public_path__ + \"static/media/space-background.c2d174f9.png\";","// import { findToken } from \"../account/account-session\";\nimport { getServiceHost, isMockService } from \"../service_utils\";\nimport {\n\tDataPage,\n\tQueriedSpace,\n\tQueriedSpaceForUserGroup,\n\tQueriedTopicForSpace,\n\tQueriedUserGroupForGroupsHolder,\n\tSpace,\n} from \"./types\";\n\nexport const listSpaces = async (options: {\n\tsearch: string;\n\tpageNumber?: number;\n\tpageSize?: number;\n}): Promise<DataPage<QueriedSpace>> => {\n\tif (isMockService()) {\n\t\t// call api\n\t\tconst { pageNumber = 1, pageSize = 9 } = options;\n\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tresolve({\n\t\t\t\t\tdata: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tspaceId: \"1\",\n\t\t\t\t\t\t\tname: \"Quotation & Policy\",\n\t\t\t\t\t\t\tdescription: \"All Sales Data\",\n\t\t\t\t\t\t\ttopicCount: 3,\n\t\t\t\t\t\t\treportCount: 2,\n\t\t\t\t\t\t\tgroupCount: 2,\n\t\t\t\t\t\t\tconnectionCount: 8,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\titemCount: 0,\n\t\t\t\t\tpageNumber,\n\t\t\t\t\tpageSize,\n\t\t\t\t\tpageCount: 1,\n\t\t\t\t});\n\t\t\t}, 1000);\n\t\t});\n\n\t\t// const token: string = Storage.findToken();\n\t\t// const account = Storage.findAccount();\n\t} else {\n\t\t// console.log(mock_flag);\n\n\t\t// const token = findToken();\n\n\t\tconst response = await fetch(`${getServiceHost()}space/name?query_name=${options.search}`, {\n\t\t\tmethod: \"POST\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t},\n\t\t\tbody: JSON.stringify({ pageNumber: options.pageNumber, pageSize: options.pageSize }),\n\t\t});\n\n\t\tconst result = await response.json();\n\n\t\treturn result;\n\t}\n};\n\nexport const listSpacesForUserGroup = async (search: string): Promise<Array<QueriedSpaceForUserGroup>> => {\n\tif (isMockService()) {\n\t\t// call api\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tresolve(\n\t\t\t\t\t[{ spaceId: \"1\", name: \"Quotation & Policy\", description: \"All Sales Data\" }].filter((x) =>\n\t\t\t\t\t\tx.name.toUpperCase().includes(search.toUpperCase())\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}, 500);\n\t\t});\n\n\t\t// const token: string = Storage.findToken();\n\t\t// const account = Storage.findAccount();\n\t} else {\n\t\t// console.log(mock_flag);\n\t\tconst response = await fetch(`${getServiceHost()}query/space/group?query_name=${search}`, {\n\t\t\tmethod: \"GET\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// authorization: token,\n\t\t\t},\n\t\t});\n\n\t\t// const result = await\n\t\treturn await response.json();\n\t}\n};\n\nexport const fetchSpace = async (\n\tspaceId: string\n): Promise<{ space: Space; groups: Array<QueriedUserGroupForGroupsHolder>; topics: Array<QueriedTopicForSpace> }> => {\n\tconsole.log(spaceId);\n\tif (isMockService()) {\n\t\t// call api\n\t\tlet space: Space;\n\t\tswitch (spaceId) {\n\t\t\tcase \"1\":\n\t\t\t\tspace = {\n\t\t\t\t\tspaceId: \"1\",\n\t\t\t\t\tname: \"Quotation & Policy\",\n\t\t\t\t\tdescription: \"All Sales Data\",\n\t\t\t\t\tgroupIds: [\"1\"],\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tspace = {};\n\t\t}\n\t\treturn {\n\t\t\tspace,\n\t\t\tgroups: [{ userGroupId: \"1\", name: \"Oklahoma\", description: \"Northwest market analysis squad.\" }],\n\t\t\ttopics: [\n\t\t\t\t{ topicId: \"1\", name: \"Quotation\" },\n\t\t\t\t{ topicId: \"2\", name: \"Policy\" },\n\t\t\t\t{ topicId: \"3\", name: \"Participant\" },\n\t\t\t],\n\t\t};\n\n\t\t// const token: string = Storage.findToken();\n\t\t// const account = Storage.findAccount();\n\t} else {\n\t\t// console.log(mock_flag);\n\t\tconst response = await fetch(`${getServiceHost()}space?space_id=${spaceId}`, {\n\t\t\tmethod: \"GET\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// authorization: token,\n\t\t\t},\n\t\t});\n\n\t\t// const result = await\n\t\tconst space = await response.json();\n\n\t\tconst topic_response = await fetch(`${getServiceHost()}topic/ids`, {\n\t\t\tmethod: \"POST\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// authorization: token,\n\t\t\t},\n\t\t\tbody: JSON.stringify(space[\"topicIds\"]),\n\t\t});\n\n\t\tconst topic_list = await topic_response.json();\n\n\t\tconst group_response = await fetch(`${getServiceHost()}user_groups/ids`, {\n\t\t\tmethod: \"POST\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// authorization: token,\n\t\t\t},\n\t\t\tbody: JSON.stringify(space[\"groupIds\"]),\n\t\t});\n\n\t\tconst group_list = await group_response.json();\n\n\t\treturn { space, groups: group_list, topics: topic_list };\n\t}\n};\n\nexport const saveSpace = async (space: Space): Promise<void> => {\n\tif (space.spaceId) {\n\t\tconst response = await fetch(`${getServiceHost()}update/space?space_id=${space.spaceId}`, {\n\t\t\tmethod: \"POST\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// authorization: token,\n\t\t\t},\n\t\t\tbody: JSON.stringify(space),\n\t\t});\n\t\treturn await response.json();\n\t} else {\n\t\tif (isMockService()) {\n\t\t\t// call api\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tspace.spaceId = \"10000\";\n\t\t\t\tsetTimeout(() => resolve(), 500);\n\t\t\t});\n\n\t\t\t// const token: string = Storage.findToken();\n\t\t\t// const account = Storage.findAccount();\n\t\t} else {\n\t\t\t// console.log(mock_flag);\n\t\t\tconst response = await fetch(`${getServiceHost()}space`, {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders: {\n\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\t// authorization: token,\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify(space),\n\t\t\t});\n\n\t\t\t// const result = await\n\t\t\treturn await response.json();\n\t\t}\n\t}\n};\n","import { getServiceHost, isMockService } from \"../service_utils\";\nimport {\n\tDataPage,\n\tQueriedSpaceForUserGroup,\n\tQueriedUser,\n\tQueriedUserForUserGroup,\n\tQueriedUserGroup,\n\tQueriedUserGroupForGroupsHolder,\n\tUser,\n\tUserGroup,\n} from \"./types\";\n\nexport const listUserGroups = async (options: {\n\tsearch: string;\n\tpageNumber?: number;\n\tpageSize?: number;\n}): Promise<DataPage<QueriedUserGroup>> => {\n\tif (isMockService()) {\n\t\t// call api\n\t\tconst { pageNumber = 1, pageSize = 9 } = options;\n\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tresolve({\n\t\t\t\t\tdata: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tuserGroupId: \"1\",\n\t\t\t\t\t\t\tname: \"Oklahoma\",\n\t\t\t\t\t\t\tdescription: \"South-center market analysis squad.\",\n\t\t\t\t\t\t\tuserCount: 4,\n\t\t\t\t\t\t\tspaceCount: 2,\n\t\t\t\t\t\t\ttopicCount: 3,\n\t\t\t\t\t\t\treportCount: 21,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\titemCount: 0,\n\t\t\t\t\tpageNumber,\n\t\t\t\t\tpageSize,\n\t\t\t\t\tpageCount: 1,\n\t\t\t\t});\n\t\t\t}, 1000);\n\t\t});\n\n\t\t// const token: string = Storage.findToken();\n\t\t// const account = Storage.findAccount();\n\t} else {\n\t\t// console.log(mock_flag);\n\t\tconst response = await fetch(`${getServiceHost()}user_group/name?query_name=${options.search}`, {\n\t\t\tmethod: \"POST\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// authorization: token,\n\t\t\t},\n\t\t\tbody: JSON.stringify({ pageNumber: options.pageNumber, pageSize: options.pageSize }),\n\t\t});\n\n\t\treturn await response.json();\n\t}\n};\n\nexport const listUsers = async (options: {\n\tsearch: string;\n\tpageNumber?: number;\n\tpageSize?: number;\n}): Promise<DataPage<QueriedUser>> => {\n\tif (isMockService()) {\n\t\t// call api\n\t\tconst { pageNumber = 1, pageSize = 9 } = options;\n\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tresolve({\n\t\t\t\t\tdata: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tuserId: \"1\",\n\t\t\t\t\t\t\tname: \"Damon Lindelof\",\n\t\t\t\t\t\t\tspaceCount: 2,\n\t\t\t\t\t\t\ttopicCount: 3,\n\t\t\t\t\t\t\treportCount: 7,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tuserId: \"2\",\n\t\t\t\t\t\t\tname: \"Sally Jupiter\",\n\t\t\t\t\t\t\tspaceCount: 2,\n\t\t\t\t\t\t\ttopicCount: 3,\n\t\t\t\t\t\t\treportCount: 2,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tuserId: \"3\",\n\t\t\t\t\t\t\tname: \"Roy Raymond\",\n\t\t\t\t\t\t\tspaceCount: 2,\n\t\t\t\t\t\t\ttopicCount: 3,\n\t\t\t\t\t\t\treportCount: 4,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tuserId: \"4\",\n\t\t\t\t\t\t\tname: \"Walter Kovacs\",\n\t\t\t\t\t\t\tspaceCount: 2,\n\t\t\t\t\t\t\ttopicCount: 3,\n\t\t\t\t\t\t\treportCount: 8,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tuserId: \"5\",\n\t\t\t\t\t\t\tname: \"Jeffrey Dean Morgan\",\n\t\t\t\t\t\t\tspaceCount: 2,\n\t\t\t\t\t\t\ttopicCount: 3,\n\t\t\t\t\t\t\treportCount: 0,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\titemCount: 0,\n\t\t\t\t\tpageNumber,\n\t\t\t\t\tpageSize,\n\t\t\t\t\tpageCount: 1,\n\t\t\t\t});\n\t\t\t}, 1000);\n\t\t});\n\n\t\t// const token: string = Storage.findToken();\n\t\t// const account = Storage.findAccount();\n\t} else {\n\t\t// console.log(mock_flag);\n\t\tconst response = await fetch(`${getServiceHost()}user/name?query_name=${options.search}`, {\n\t\t\tmethod: \"POST\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// authorization: token,\n\t\t\t},\n\t\t\tbody: JSON.stringify({ pageNumber: options.pageNumber, pageSize: options.pageSize }),\n\t\t});\n\n\t\treturn await response.json();\n\t}\n};\n\nexport const listUserGroupsForUser = async (search: string): Promise<Array<QueriedUserGroupForGroupsHolder>> => {\n\tif (isMockService()) {\n\t\t// call api\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tresolve(\n\t\t\t\t\t[\n\t\t\t\t\t\t{ userGroupId: \"1\", name: \"Oklahoma\", description: \"South-center market analysis squad.\" },\n\t\t\t\t\t\t{ userGroupId: \"2\", name: \"Delaware\" },\n\t\t\t\t\t\t{ userGroupId: \"3\", name: \"Hawaii\" },\n\t\t\t\t\t\t{ userGroupId: \"4\", name: \"Alaska\" },\n\t\t\t\t\t\t{ userGroupId: \"5\", name: \"Missouri\" },\n\t\t\t\t\t\t{ userGroupId: \"6\", name: \"Arkansas\" },\n\t\t\t\t\t].filter((x) => x.name.toUpperCase().includes(search.toUpperCase()))\n\t\t\t\t);\n\t\t\t}, 500);\n\t\t});\n\n\t\t// const token: string = Storage.findToken();\n\t\t// const account = Storage.findAccount();\n\t} else {\n\t\t// console.log(mock_flag);\n\t\tconst response = await fetch(`${getServiceHost()}query/user_group/space?query_name=${search}`, {\n\t\t\tmethod: \"GET\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// authorization: token,\n\t\t\t},\n\t\t});\n\n\t\t// const result = await\n\t\treturn await response.json();\n\t}\n};\n\nexport const fetchUser = async (\n\tuserId: string\n): Promise<{ user: User; groups: Array<QueriedUserGroupForGroupsHolder> }> => {\n\tconsole.log(isMockService());\n\tif (isMockService()) {\n\t\t// call api\n\t\tlet user;\n\t\tswitch (userId) {\n\t\t\tcase \"1\":\n\t\t\t\tuser = { userId: \"1\", name: \"Damon Lindelof\", groupIds: [\"1\"] };\n\t\t\t\tbreak;\n\t\t\tcase \"2\":\n\t\t\t\tuser = { userId: \"2\", name: \"Sally Jupiter\", groupIds: [\"1\"] };\n\t\t\t\tbreak;\n\t\t\tcase \"3\":\n\t\t\t\tuser = { userId: \"3\", name: \"Roy Raymond\", groupIds: [\"1\"] };\n\t\t\t\tbreak;\n\t\t\tcase \"4\":\n\t\t\t\tuser = { userId: \"4\", name: \"Walter Kovacs\", groupIds: [\"1\"] };\n\t\t\t\tbreak;\n\t\t\tcase \"5\":\n\t\t\t\tuser = { userId: \"5\", name: \"Jeffrey Dean Morgan\", groupIds: [\"1\"] };\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tuser = {};\n\t\t}\n\t\treturn {\n\t\t\tuser,\n\t\t\tgroups: [{ userGroupId: \"1\", name: \"Oklahoma\", description: \"Northwest market analysis squad.\" }],\n\t\t};\n\n\t\t// const token: string = Storage.findToken();\n\t\t// const account = Storage.findAccount();\n\t} else {\n\t\tconst response = await fetch(`${getServiceHost()}user?user_id=${userId}`, {\n\t\t\tmethod: \"GET\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// authorization: token,\n\t\t\t},\n\t\t});\n\n\t\tlet user = await response.json();\n\n\t\tconst groupIds = user[\"groupIds\"];\n\t\tif (groupIds) {\n\t\t\tconst result = await fetch(`${getServiceHost()}user_groups/ids`, {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders: {\n\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\t// authorization: token,\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify(groupIds),\n\t\t\t});\n\t\t\tconst group_list = await result.json();\n\t\t\treturn { user, groups: group_list };\n\t\t} else {\n\t\t\treturn { user, groups: [] };\n\t\t}\n\t}\n};\n\nexport const saveUser = async (user: User): Promise<void> => {\n\tconsole.log(isMockService());\n\tif (isMockService()) {\n\t\t// call api\n\t\treturn new Promise((resolve) => {\n\t\t\tuser.userId = \"10000\";\n\t\t\tsetTimeout(() => resolve(), 500);\n\t\t});\n\n\t\t// const token: string = Storage.findToken();\n\t\t// const account = Storage.findAccount();\n\t} else {\n\t\tconst response = await fetch(`${getServiceHost()}user`, {\n\t\t\tmethod: \"POST\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// authorization: token,\n\t\t\t},\n\t\t\tbody: JSON.stringify(user),\n\t\t});\n\n\t\treturn await response.json();\n\t}\n};\n\nexport const fetchUserGroup = async (\n\tuserGroupId: string\n): Promise<{ group: UserGroup; users: Array<QueriedUserForUserGroup>; spaces: Array<QueriedSpaceForUserGroup> }> => {\n\tconsole.log(isMockService());\n\tif (isMockService()) {\n\t\t// call api\n\t\tlet group: UserGroup;\n\t\tswitch (userGroupId) {\n\t\t\tcase \"1\":\n\t\t\t\tgroup = {\n\t\t\t\t\tuserGroupId: \"1\",\n\t\t\t\t\tname: \"Oklahoma\",\n\t\t\t\t\tdescription: \"South-center market analysis squad.\",\n\t\t\t\t\tuserIds: [\"1\", \"2\", \"3\", \"4\", \"5\"],\n\t\t\t\t\tspaceIds: [\"1\"],\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase \"2\":\n\t\t\t\tgroup = { userGroupId: \"2\", name: \"Delaware\", userIds: [], spaceIds: [] };\n\t\t\t\tbreak;\n\t\t\tcase \"3\":\n\t\t\t\tgroup = { userGroupId: \"3\", name: \"Hawaii\", userIds: [], spaceIds: [] };\n\t\t\t\tbreak;\n\t\t\tcase \"4\":\n\t\t\t\tgroup = { userGroupId: \"4\", name: \"Alaska\", userIds: [], spaceIds: [] };\n\t\t\t\tbreak;\n\t\t\tcase \"5\":\n\t\t\t\tgroup = { userGroupId: \"5\", name: \"Missouri\", userIds: [], spaceIds: [] };\n\t\t\t\tbreak;\n\t\t\tcase \"6\":\n\t\t\t\tgroup = { userGroupId: \"6\", name: \"Arkansas\", userIds: [], spaceIds: [] };\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tgroup = {};\n\t\t}\n\t\treturn {\n\t\t\tgroup,\n\t\t\tusers: [\n\t\t\t\t{ userId: \"1\", name: \"Damon Lindelof\" },\n\t\t\t\t{ userId: \"2\", name: \"Sally Jupiter\" },\n\t\t\t\t{ userId: \"3\", name: \"Roy Raymond\" },\n\t\t\t\t{ userId: \"4\", name: \"Walter Kovacs\" },\n\t\t\t\t{ userId: \"5\", name: \"Jeffrey Dean Morgan\" },\n\t\t\t],\n\t\t\tspaces: [{ spaceId: \"1\", name: \"Quotation & Policy\", description: \"All Sales Data\" }],\n\t\t};\n\n\t\t// const token: string = Storage.findToken();\n\t\t// const account = Storage.findAccount();\n\t} else {\n\t\tconst response = await fetch(`${getServiceHost()}user_group?user_group_id=${userGroupId}`, {\n\t\t\tmethod: \"GET\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// authorization: token,\n\t\t\t},\n\t\t});\n\n\t\tlet group = await response.json();\n\n\t\tconst user_response = await fetch(`${getServiceHost()}user/ids`, {\n\t\t\tmethod: \"POST\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// authorization: token,\n\t\t\t},\n\t\t\tbody: JSON.stringify(group[\"userIds\"]),\n\t\t});\n\n\t\tconst user_list = await user_response.json();\n\n\t\tconst space_response = await fetch(`${getServiceHost()}space/ids`, {\n\t\t\tmethod: \"POST\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// authorization: token,\n\t\t\t},\n\t\t\tbody: JSON.stringify(group[\"spaceIds\"]),\n\t\t});\n\n\t\tconst space_list = await space_response.json();\n\n\t\treturn { group, users: user_list, spaces: space_list };\n\t}\n};\n\nexport const saveUserGroup = async (group: UserGroup): Promise<void> => {\n\tconsole.log(isMockService());\n\tif (isMockService()) {\n\t\t// call api\n\t\treturn new Promise((resolve) => {\n\t\t\tgroup.userGroupId = \"10000\";\n\t\t\tsetTimeout(() => resolve(), 500);\n\t\t});\n\n\t\t// const token: string = Storage.findToken();\n\t\t// const account = Storage.findAccount();\n\t} else {\n\t\t// console.log(mock_flag);\n\t\tconst response = await fetch(`${getServiceHost()}user_group`, {\n\t\t\tmethod: \"POST\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// authorization: token,\n\t\t\t},\n\t\t\tbody: JSON.stringify(group),\n\t\t});\n\n\t\t// const result = await\n\t\treturn await response.json();\n\t}\n};\n\nexport const listUsersForUserGroup = async (search: string): Promise<Array<QueriedUserForUserGroup>> => {\n\tif (isMockService()) {\n\t\t// call api\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tresolve(\n\t\t\t\t\t[\n\t\t\t\t\t\t{ userId: \"1\", name: \"Damon Lindelof\" },\n\t\t\t\t\t\t{ userId: \"2\", name: \"Sally Jupiter\" },\n\t\t\t\t\t\t{ userId: \"3\", name: \"Roy Raymond\" },\n\t\t\t\t\t\t{ userId: \"4\", name: \"Walter Kovacs\" },\n\t\t\t\t\t\t{ userId: \"5\", name: \"Jeffrey Dean Morgan\" },\n\t\t\t\t\t].filter((x) => x.name.toUpperCase().includes(search.toUpperCase()))\n\t\t\t\t);\n\t\t\t}, 500);\n\t\t});\n\n\t\t// const token: string = Storage.findToken();\n\t\t// const account = Storage.findAccount();\n\t} else {\n\t\t// console.log(mock_flag);\n\t\tconst response = await fetch(`${getServiceHost()}query/user/group?query_name=${search}`, {\n\t\t\tmethod: \"GET\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// authorization: token,\n\t\t\t},\n\t\t});\n\n\t\t// const result = await\n\t\treturn await response.json();\n\t}\n};\n\nexport const listUserGroupsForSpace = async (search: string): Promise<Array<QueriedUserGroupForGroupsHolder>> => {\n\tif (isMockService()) {\n\t\t// call api\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tresolve(\n\t\t\t\t\t[\n\t\t\t\t\t\t{ userGroupId: \"1\", name: \"Oklahoma\", description: \"South-center market analysis squad.\" },\n\t\t\t\t\t\t{ userGroupId: \"2\", name: \"Delaware\" },\n\t\t\t\t\t\t{ userGroupId: \"3\", name: \"Hawaii\" },\n\t\t\t\t\t\t{ userGroupId: \"4\", name: \"Alaska\" },\n\t\t\t\t\t\t{ userGroupId: \"5\", name: \"Missouri\" },\n\t\t\t\t\t\t{ userGroupId: \"6\", name: \"Arkansas\" },\n\t\t\t\t\t].filter((x) => x.name.toUpperCase().includes(search.toUpperCase()))\n\t\t\t\t);\n\t\t\t}, 500);\n\t\t});\n\n\t\t// const token: string = Storage.findToken();\n\t\t// const account = Storage.findAccount();\n\t} else {\n\t\t// console.log(mock_flag);\n\t\tconst response = await fetch(`${getServiceHost()}query/user_group/space?query_name=${search}`, {\n\t\t\tmethod: \"GET\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t// authorization: token,\n\t\t\t},\n\t\t});\n\n\t\t// const result = await\n\t\treturn await response.json();\n\t}\n};\n","import { faBan, faCheck, faPlus, faSpinner, faTimes } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { Fragment, useRef, useState } from \"react\";\nimport styled from 'styled-components';\nimport { useCollapseFixedThing } from '../../../common/utils';\nimport Input from '../../component/input';\nimport { PrimaryObjectButton } from '../../component/object-button';\n\ninterface DropdownState {\n\tvisible: boolean;\n\ttop?: number;\n\tbottom?: number;\n\tleft: number;\n\tminWidth: number;\n\tatTop: boolean\n}\n\nconst PropItemsPickerContainer = styled.div`\n\tdisplay: flex;\n\tflex-direction: column;\n\tmin-height: 40px;\n`;\nconst Items = styled.div`\n\tpadding: 6px 0;\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tmargin-left: calc(var(--margin) / -3);\n\t&:empty {\n\t\tpadding: 0;\n\t}\n\t> div {\n\t\tmargin: 2px 0 2px calc(var(--margin) / 3);\n\t}\n`;\nexport const SelectedItemInItemPicker = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\theight: 24px;\n\tpadding-left: calc(var(--margin) / 2);\n\tcolor: var(--invert-color);\n\tfont-size: 0.8em;\n\tbackground-color: var(--console-primary-color);\n\tborder-radius: 12px;\n\tcursor: pointer;\n\ttransition: all 300ms ease-in-out;\n\t&:hover {\n\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t}\n\t> span {\n\t\tposition: relative;\n\t\tpadding-right: calc(var(--margin) / 4);\n\t\tcursor: default;\n\t}\n\t> div {\n\t\tdisplay: flex;\n\t\tposition: relative;\n\t\talign-items: center;\n\t\theight: 24px;\n\t\tpadding: 0 calc(var(--margin) / 3) 0 calc(var(--margin) / 4);\n\t\tborder-top-right-radius: 12px;\n\t\tborder-bottom-right-radius: 12px;\n\t\t&:before {\n\t\t\tcontent: '';\n\t\t\tdisplay: block;\n\t\t\tposition: absolute;\n\t\t\ttop: 25%;\n\t\t\tleft: 0;\n\t\t\twidth: 1px;\n\t\t\theight: 50%;\n\t\t\tbackground-color: var(--invert-color);\n\t\t\topacity: 0.7;\n\t\t}\n\t\t> svg {\n\t\t}\n\t}\n`;\nconst ItemFinder = styled.div`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\theight: 32px;\n\tmargin: 4px 0;\n\tborder: var(--border);\n\tborder-color: transparent;\n\tborder-radius: var(--border-radius);\n\t&[data-in-search=true] {\n\t\tborder-color: var(--border-color);\n\t\t> input {\n\t\t\tflex-grow: 1;\n\t\t\tpadding-left: var(--input-indent);\n\t\t\tmargin-right: var(--input-indent);\n\t\t}\n\t\t> button {\n\t\t\tmargin-left: 0;\n\t\t\tmargin-right: 4px;\n\t\t\tborder-radius: var(--border-radius);\n\t\t}\n\t}\n\t> input {\n\t\twidth: 0;\n\t\tborder: 0;\n\t\tpadding: 5px 0;\n\t\tfont-size: 0.8em;\n\t\theight: 30px;\n\t}\n\t> button {\n\t\tmargin-left: -1px;\n\t\tborder-radius: 12px;\n\t}\n`;\nconst Dropdown = styled.div.attrs<DropdownState>(({ visible, top, bottom, left, minWidth, atTop }) => {\n\treturn {\n\t\t'data-at-top': atTop,\n\t\tstyle: {\n\t\t\topacity: visible ? 1 : 0,\n\t\t\tpointerEvents: visible ? 'auto' : 'none',\n\t\t\tminWidth,\n\t\t\ttop,\n\t\t\tbottom,\n\t\t\tleft\n\t\t}\n\t};\n})<DropdownState>`\n\tdisplay: flex;\n\tposition: fixed;\n\tflex-direction: column;\n\tfont-size: 0.8em;\n\tmin-height: 32px;\n\tmax-height: 256px;\n\tbackground-color: var(--bg-color);\n\tborder-radius: var(--border-radius);\n\tbox-shadow: var(--console-primary-hover-shadow);\n\toverflow-x: hidden;\n\tz-index: 1000;\n\ttransition: opacity 300ms ease-in-out;\n\t&::-webkit-scrollbar {\n\t\tbackground-color: transparent;\n\t\twidth: 4px;\n\t}\n\t&::-webkit-scrollbar-track {\n\t\tbackground-color: transparent;\n\t\tborder-radius: 2px;\n\t}\n\t&::-webkit-scrollbar-thumb {\n\t\tbackground-color: var(--console-favorite-color);\n\t\tborder-radius: 2px;\n\t}\n\t> div[data-widget='no-data'] {\n\t\theight: 32px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tpadding: 0 calc(var(--margin) / 2);\n\t\t> svg {\n\t\t\tmargin-right: calc(var(--margin) / 3);\n\t\t}\n\t}\n`;\nexport const CandidateItemInItemPicker = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\tmin-height: 32px;\n\theight: 32px;\n\tcursor: pointer;\n\t&:hover {\n\t\tcolor: var(--invert-color);\n\t\tbackground-color: var(--console-primary-color);\n\t}\n\t> div:first-child {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\twidth: 32px;\n\t\t&[data-visible=false] {\n\t\t\topacity: 0;\n\t\t}\n\t}\n\t> span:nth-child(3) {\n\t\tmargin-left: calc(var(--margin) / 4);\n\t\ttransform: scale(0.8);\n\t\ttransform-origin: left bottom;\n\t\topacity: 0.7;\n\t}\n`;\n\nconst ItemPicker = <T extends any>(props: {\n\tlabel: string;\n\tselectedItems: Array<T>;\n\trenderSelectedItem: (item: T) => React.ReactNode;\n\trenderCandidateItem: (item: T) => React.ReactNode;\n\tgetKeyOfItem: (item: T) => string;\n\tfetchItems: (searchText: string) => Promise<Array<T>>;\n}) => {\n\tconst {\n\t\tlabel,\n\t\tselectedItems,\n\t\trenderSelectedItem,\n\t\trenderCandidateItem,\n\t\tgetKeyOfItem,\n\t\tfetchItems\n\t} = props;\n\n\tconst containerRef = useRef<HTMLDivElement>(null);\n\tconst inputRef = useRef<HTMLInputElement>(null);\n\tconst [ inSearch, setInSearch ] = useState(false);\n\tconst [ searchText, setSearchText ] = useState('');\n\tconst [ searchItems, setSearchItems ] = useState<Array<T>>([]);\n\tconst [ searchHandle, setSearchHandle ] = useState<number | null>(null);\n\tconst [ expanded, setExpanded ] = useState<DropdownState>({ visible: false, left: 0, minWidth: 0, atTop: false });\n\tuseCollapseFixedThing(containerRef, () => setExpanded({ ...expanded, visible: false }));\n\n\tconst onSearchClicked = () => {\n\t\tif (!inSearch) {\n\t\t\tsetInSearch(true);\n\t\t\tinputRef.current!.focus();\n\t\t} else {\n\t\t\tsetInSearch(false);\n\t\t}\n\t};\n\tconst onSearchTextChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n\t\tconst value = event.target.value;\n\n\t\tif (searchHandle) {\n\t\t\tclearTimeout(searchHandle);\n\t\t}\n\n\t\tif (value.trim().length === 0) {\n\t\t\tsetSearchItems([]);\n\t\t\t// no more search needed\n\t\t\tsetSearchHandle(null);\n\t\t} else {\n\t\t\tconst handle = setTimeout(async () => {\n\t\t\t\tconst items = await fetchItems(value.trim());\n\t\t\t\tsetSearchItems(items);\n\t\t\t\tsetSearchHandle(null);\n\t\t\t}, 500);\n\t\t\tsetSearchHandle(handle);\n\t\t}\n\n\t\t// update search input\n\t\tsetSearchText(value);\n\t};\n\tconst onSearchFocus = () => {\n\t\tconst rect = containerRef.current!.getBoundingClientRect();\n\t\t// always on top\n\t\tsetExpanded({\n\t\t\tvisible: true,\n\t\t\tbottom: window.innerHeight - rect.top + 2,\n\t\t\tleft: rect.left,\n\t\t\tminWidth: rect.width,\n\t\t\tatTop: true\n\t\t});\n\t};\n\n\tlet dropdownContent;\n\tif (searchText.trim().length === 0) {\n\t\tdropdownContent = <div data-widget='no-data'>No search text...</div>;\n\t} else if (!!searchHandle) {\n\t\t// in searching\n\t\tdropdownContent = <div data-widget='no-data'>\n\t\t\t<FontAwesomeIcon icon={faSpinner} spin={true}/>\n\t\t\t<span>Searching...</span>\n\t\t</div>;\n\t} else if (searchItems.length === 0) {\n\t\t// searched, but nothing found\n\t\tdropdownContent = <div data-widget='no-data'>No matched.</div>;\n\t} else {\n\t\t// searched, items found\n\t\tdropdownContent = searchItems.map(item => {\n\t\t\treturn <Fragment key={getKeyOfItem(item)}>\n\t\t\t\t{renderCandidateItem(item)}\n\t\t\t</Fragment>;\n\t\t});\n\t}\n\n\treturn <PropItemsPickerContainer>\n\t\t<ItemFinder data-in-search={inSearch} ref={containerRef}>\n\t\t\t<Input ref={inputRef}\n\t\t\t       placeholder='Search by Name...'\n\t\t\t       value={searchText} onChange={onSearchTextChange}\n\t\t\t       onFocus={onSearchFocus}/>\n\t\t\t<PrimaryObjectButton onClick={onSearchClicked}>\n\t\t\t\t<FontAwesomeIcon icon={inSearch ? faBan : faPlus}/>\n\t\t\t\t<span>{inSearch ? 'Done' : label}</span>\n\t\t\t</PrimaryObjectButton>\n\t\t\t<Dropdown {...expanded} visible={expanded.visible && inSearch}>\n\t\t\t\t{dropdownContent}\n\t\t\t</Dropdown>\n\t\t</ItemFinder>\n\t\t<Items>\n\t\t\t{selectedItems.map(item => {\n\t\t\t\treturn <Fragment key={getKeyOfItem(item)}>{renderSelectedItem(item)}</Fragment>;\n\t\t\t})}\n\t\t</Items>\n\t</PropItemsPickerContainer>;\n};\n\nexport const PropItemPicker = <Entity extends object, Item extends any>(props: {\n\tlabel: string;\n\tentity: Entity;\n\tcodes: Array<Item>;\n\tinitPropArray: (entity: Entity) => void;\n\taddItemToProp: (entity: Entity, item: Item) => void;\n\tremoveItemFromProp: (entity: Entity, item: Item) => void;\n\tisItemPicked: (entity: Entity, item: Item) => boolean;\n\taddItemToCodes: (codes: Array<Item>, item: Item) => void;\n\tremoveItemFromCodes: (codes: Array<Item>, item: Item) => void;\n\tgetKeyOfItem: (item: Item) => string;\n\tgetNameOfItem: (item: Item) => string;\n\tgetMinorNameOfItem: (item: Item) => string | undefined | null;\n\tlistItems: (searchText: string) => Promise<Array<Item>>;\n\tonDataChanged: () => void;\n}) => {\n\tconst {\n\t\tlabel,\n\t\tentity, codes,\n\t\tinitPropArray,\n\t\taddItemToProp, removeItemFromProp, isItemPicked, addItemToCodes, removeItemFromCodes,\n\t\tgetKeyOfItem, getNameOfItem, getMinorNameOfItem, listItems,\n\t\tonDataChanged\n\t} = props;\n\n\tconst onSpaceAdd = (entity: Entity, item: Item, onDataChanged: () => void) => {\n\t\tinitPropArray(entity);\n\t\taddItemToProp(entity, item);\n\t\taddItemToCodes(codes, item);\n\t\tonDataChanged();\n\t};\n\tconst onSpaceRemove = (entity: Entity, item: Item, onDataChanged: () => void) => {\n\t\tremoveItemFromProp(entity, item);\n\t\tremoveItemFromCodes(codes, item);\n\t\tonDataChanged();\n\t};\n\tconst renderSelectedItem = (entity: Entity, onDataChanged: () => void) => (item: Item) => {\n\t\treturn <SelectedItemInItemPicker>\n\t\t\t<span>{getNameOfItem(item)}</span>\n\t\t\t<div onClick={() => onSpaceRemove(entity, item, onDataChanged)}>\n\t\t\t\t<FontAwesomeIcon icon={faTimes}/>\n\t\t\t</div>\n\t\t</SelectedItemInItemPicker>;\n\t};\n\tconst renderCandidateItem = (entity: Entity, onDataChanged: () => void) => (item: Item) => {\n\t\t// eslint-disable-next-line\n\t\tconst checked = isItemPicked(entity, item);\n\t\tconst onClicked = () => {\n\t\t\tif (checked) {\n\t\t\t\tonSpaceRemove(entity, item, onDataChanged);\n\t\t\t} else {\n\t\t\t\tonSpaceAdd(entity, item, onDataChanged);\n\t\t\t}\n\t\t};\n\t\treturn <CandidateItemInItemPicker onClick={onClicked}>\n\t\t\t<div data-visible={checked}><FontAwesomeIcon icon={faCheck}/></div>\n\t\t\t<span>{getNameOfItem(item)}</span>\n\t\t\t<span>{getMinorNameOfItem(item)}</span>\n\t\t</CandidateItemInItemPicker>;\n\t};\n\tconst sortItem = (items: Array<Item>) => {\n\t\titems.sort((g1, g2) => getNameOfItem(g1).toUpperCase().localeCompare(getNameOfItem(g2).toUpperCase()));\n\t};\n\tconst fetchSpacesBySearch = async (searchText: string): Promise<Array<Item>> => {\n\t\tconst items = await listItems(searchText);\n\t\tsortItem(items);\n\t\treturn items;\n\t};\n\tsortItem(codes);\n\n\treturn <ItemPicker label={label}\n\t                   selectedItems={codes}\n\t                   renderSelectedItem={renderSelectedItem(entity, onDataChanged)}\n\t                   renderCandidateItem={renderCandidateItem(entity, onDataChanged)}\n\t                   getKeyOfItem={getKeyOfItem}\n\t                   fetchItems={fetchSpacesBySearch}/>;\n};","import React from 'react';\nimport { GroupsHolder, QueriedUserGroupForGroupsHolder } from '../../../services/admin/types';\nimport { PropItemPicker } from './prop-items-picker';\n\nconst initGroupArray = (holder: GroupsHolder) => holder.groupIds = holder.groupIds || [];\nconst addGroupToHolder = (holder: GroupsHolder, group: QueriedUserGroupForGroupsHolder) => holder.groupIds!.push(group.userGroupId);\n// eslint-disable-next-line\nconst removeGroupFromHolder = (holder: GroupsHolder, group: QueriedUserGroupForGroupsHolder) => holder.groupIds = (holder.groupIds || []).filter(groupId => groupId != group.userGroupId);\n// eslint-disable-next-line\nconst isGroupSelected = (holder: GroupsHolder, group: QueriedUserGroupForGroupsHolder) => !!holder.groupIds && holder.groupIds.findIndex(groupId => groupId == group.userGroupId) !== -1;\nconst addGroupToCodes = (codes: Array<QueriedUserGroupForGroupsHolder>, group: QueriedUserGroupForGroupsHolder) => {\n\t// eslint-disable-next-line\n\tconst exists = codes.findIndex(exists => exists.userGroupId == group.userGroupId) !== -1;\n\tif (!exists) {\n\t\tcodes.push(group);\n\t}\n};\nconst removeGroupFromCodes = (codes: Array<QueriedUserGroupForGroupsHolder>, group: QueriedUserGroupForGroupsHolder) => {\n\t// eslint-disable-next-line\n\tconst index = codes.findIndex(exists => exists.userGroupId == group.userGroupId);\n\tif (index !== -1) {\n\t\tcodes.splice(index, 1);\n\t}\n};\nconst getGroupId = (group: QueriedUserGroupForGroupsHolder) => group.userGroupId;\nconst getGroupName = (group: QueriedUserGroupForGroupsHolder) => group.name;\nconst getGroupDescription = (group: QueriedUserGroupForGroupsHolder) => group.description;\n\nexport const GroupPicker = (props: {\n\tlabel: string;\n\tholder: GroupsHolder;\n\tcodes: { groups: Array<QueriedUserGroupForGroupsHolder> };\n\tlistGroups: (searchText: string) => Promise<Array<QueriedUserGroupForGroupsHolder>>;\n\tonDataChanged: () => void;\n}) => {\n\tconst { label, holder, codes, listGroups, onDataChanged } = props;\n\n\treturn <PropItemPicker label={label}\n\t                       entity={holder}\n\t                       codes={codes.groups}\n\t                       initPropArray={initGroupArray}\n\t                       addItemToProp={addGroupToHolder}\n\t                       removeItemFromProp={removeGroupFromHolder}\n\t                       isItemPicked={isGroupSelected}\n\t                       addItemToCodes={addGroupToCodes}\n\t                       removeItemFromCodes={removeGroupFromCodes}\n\t                       getKeyOfItem={getGroupId}\n\t                       getNameOfItem={getGroupName}\n\t                       getMinorNameOfItem={getGroupDescription}\n\t                       listItems={listGroups}\n\t                       onDataChanged={onDataChanged}/>;\n};\n","import styled from 'styled-components';\nimport Input from '../../component/input';\n\nexport const PropInput = styled(Input)`\n\tfont-size: 12px;\n\t&::placeholder {\n\t\tfont-variant: petite-caps;\n\t\topacity: 0.5;\n\t}\n`;","import styled from 'styled-components';\n\nexport const PropInputLines = styled.textarea`\n\tappearance: none;\n\toutline: none;\n\tpadding: 6px var(--input-indent);\n\tborder: var(--border);\n\tborder-radius: var(--border-radius);\n\tfont-family: var(--font-family);\n\tfont-size: 12px;\n\theight: calc(var(--height) * 3);\n\tline-height: var(--line-height);\n\tcolor: var(--font-color);\n\tbackground-color: transparent;\n\tresize: none;\n\tmargin: 4px 0;\n\ttransition: all 300ms ease-in-out;\n\t&::-webkit-scrollbar {\n\t\tbackground-color: transparent;\n\t\theight: 4px;\n\t\twidth: 4px;\n\t}\n\t&::-webkit-scrollbar-track {\n\t\tbackground-color: var(--scrollbar-background-color);\n\t\tborder-radius: 2px;\n\t}\n\t&::-webkit-scrollbar-thumb {\n\t\tbackground-color: var(--console-favorite-color);\n\t\tborder-radius: 2px;\n\t}\n`;","import styled from 'styled-components';\n\nexport const PropLabel = styled.div`\n\tdisplay: flex;\n\talign-self: start;\n\talign-items: center;\n\tfont-variant: petite-caps;\n\tfont-weight: var(--font-demi-bold);\n\theight: 40px;\n`;","import React from 'react';\nimport { listTopicsForSpace } from '../../../services/admin/topic';\nimport { QueriedTopicForSpace, Space } from '../../../services/admin/types';\nimport { PropItemPicker } from './prop-items-picker';\n\nconst initTopicArray = (space: Space) => space.topicIds = space.topicIds || [];\nconst addTopicToSpace = (space: Space, topic: QueriedTopicForSpace) => space.topicIds!.push(topic.topicId);\n// eslint-disable-next-line\nconst removeTopicFromSpace = (space: Space, topic: QueriedTopicForSpace) => space.topicIds = (space.topicIds || []).filter(topicId => topicId != topic.topicId);\n// eslint-disable-next-line\nconst isTopicSelected = (space: Space, topic: QueriedTopicForSpace) => !!space.topicIds && space.topicIds.findIndex(topicId => topicId == topic.topicId) !== -1;\nconst addTopicToCodes = (codes: Array<QueriedTopicForSpace>, topic: QueriedTopicForSpace) => {\n\t// eslint-disable-next-line\n\tconst exists = codes.findIndex(exists => exists.topicId == topic.topicId) !== -1;\n\tif (!exists) {\n\t\tcodes.push(topic);\n\t}\n};\nconst removeTopicFromCodes = (codes: Array<QueriedTopicForSpace>, topic: QueriedTopicForSpace) => {\n\t// eslint-disable-next-line\n\tconst index = codes.findIndex(exists => exists.topicId == topic.topicId);\n\tif (index !== -1) {\n\t\tcodes.splice(index, 1);\n\t}\n};\nconst getTopicId = (topic: QueriedTopicForSpace) => topic.topicId;\nconst getTopicName = (topic: QueriedTopicForSpace) => topic.name;\nconst getTopicDescription = (topic: QueriedTopicForSpace) => topic.description;\n\nexport const TopicPicker = (props: {\n\tlabel: string;\n\tspace: Space;\n\tcodes: { topics: Array<QueriedTopicForSpace> };\n\tonDataChanged: () => void;\n}) => {\n\tconst { label, space, codes, onDataChanged } = props;\n\n\treturn <PropItemPicker label={label}\n\t                       entity={space}\n\t                       codes={codes.topics}\n\t                       initPropArray={initTopicArray}\n\t                       addItemToProp={addTopicToSpace}\n\t                       removeItemFromProp={removeTopicFromSpace}\n\t                       isItemPicked={isTopicSelected}\n\t                       addItemToCodes={addTopicToCodes}\n\t                       removeItemFromCodes={removeTopicFromCodes}\n\t                       getKeyOfItem={getTopicId}\n\t                       getNameOfItem={getTopicName}\n\t                       getMinorNameOfItem={getTopicDescription}\n\t                       listItems={listTopicsForSpace}\n\t                       onDataChanged={onDataChanged}/>;\n};\n","import { faChartBar } from '@fortawesome/free-regular-svg-icons';\nimport { faLink, faTags, faUsers } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { Fragment, useState } from \"react\";\nimport SpaceBackground from '../../../assets/space-background.png';\nimport { fetchSpace, listSpaces, saveSpace } from '../../../services/admin/space';\nimport {\n\tQueriedSpace,\n\tQueriedTopicForSpace,\n\tQueriedUserGroupForGroupsHolder,\n\tSpace\n} from '../../../services/admin/types';\nimport { listUserGroupsForSpace } from '../../../services/admin/user';\nimport { TooltipCarvedButton } from '../../component/console/carved-button';\nimport { GroupPicker } from '../component/group-picker';\nimport { PropInput } from '../component/prop-input';\nimport { PropInputLines } from '../component/prop-input-lines';\nimport { PropLabel } from '../component/prop-label';\nimport { SearchAndEditPanel } from '../component/search-and-edit-panel';\nimport { SingleSearchItemCard } from '../component/single-search';\nimport { TopicPicker } from '../component/topic-picker';\n\nexport const Spaces = () => {\n\tconst createCodes = () => ({\n\t\tgroups: [] as Array<QueriedUserGroupForGroupsHolder>,\n\t\ttopics: [] as Array<QueriedTopicForSpace>\n\t});\n\n\tconst [ codes, setCodes ] = useState(createCodes());\n\n\tconst createEntity = (fake: boolean) => {\n\t\tif (!fake) {\n\t\t\tsetCodes({ groups: [], topics: [] });\n\t\t}\n\t\treturn { groupIds: [], topicIds: [] } as Space;\n\t};\n\tconst fetchEntityAndCodes = async (queriedSpace: QueriedSpace) => {\n\t\tconst { space, groups, topics } = await fetchSpace(queriedSpace.spaceId);\n\t\tsetCodes({ groups, topics });\n\t\treturn { entity: space };\n\t};\n\tconst fetchEntityList = listSpaces;\n\tconst saveEntity = saveSpace;\n\tconst isEntityOnCreate = (space: Space) => !space.spaceId;\n\tconst renderItemInList = (space: QueriedSpace, onEdit: (space: QueriedSpace) => (() => void)) => {\n\t\treturn <SingleSearchItemCard key={space.spaceId} onClick={onEdit(space)}>\n\t\t\t<div>{space.name}</div>\n\t\t\t<div>{space.description}</div>\n\t\t\t<div>\n\t\t\t\t<TooltipCarvedButton tooltip='Topics Count' center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faTags}/>\n\t\t\t\t\t<span>{space.topicCount}</span>\n\t\t\t\t</TooltipCarvedButton>\n\t\t\t\t<TooltipCarvedButton tooltip='Reports Count' center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faChartBar}/>\n\t\t\t\t\t<span>{space.reportCount}</span>\n\t\t\t\t</TooltipCarvedButton>\n\t\t\t\t<TooltipCarvedButton tooltip='In User Groups' center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faUsers}/>\n\t\t\t\t\t<span>{space.groupCount}</span>\n\t\t\t\t</TooltipCarvedButton>\n\t\t\t\t<TooltipCarvedButton tooltip='Connections Count' center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faLink}/>\n\t\t\t\t\t<span>{space.connectionCount}</span>\n\t\t\t\t</TooltipCarvedButton>\n\t\t\t</div>\n\t\t</SingleSearchItemCard>;\n\t};\n\tconst getKeyOfEntity = (space: QueriedSpace) => space.spaceId;\n\n\tconst onPropChange = (space: Space, prop: 'name' | 'description', onDataChanged: () => void) => (event: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n\t\tif (space[prop] !== event.target.value) {\n\t\t\tspace[prop] = event.target.value;\n\t\t\tonDataChanged();\n\t\t}\n\t};\n\tconst renderEditContent = (space: Space, onDataChanged: () => void) => {\n\t\treturn <Fragment>\n\t\t\t<PropLabel>Space Name:</PropLabel>\n\t\t\t<PropInput value={space.name || ''} onChange={onPropChange(space, 'name', onDataChanged)}/>\n\t\t\t<PropLabel>Description:</PropLabel>\n\t\t\t<PropInputLines value={space.description || ''}\n\t\t\t                onChange={onPropChange(space, 'description', onDataChanged)}/>\n\t\t\t<PropLabel>Topics:</PropLabel>\n\t\t\t<TopicPicker label='Assign Topic' space={space} codes={codes} onDataChanged={onDataChanged}/>\n\t\t\t<PropLabel>Groups:</PropLabel>\n\t\t\t<GroupPicker label='Grant to Group' holder={space} codes={codes}\n\t\t\t             listGroups={listUserGroupsForSpace} onDataChanged={onDataChanged}/>\n\t\t</Fragment>;\n\t};\n\n\treturn <SearchAndEditPanel title='Spaces'\n\t                           searchPlaceholder='Search by space name, topic name, report name, description, etc.'\n\t                           createButtonLabel='Create Space'\n\t                           entityLabel='Space'\n\t                           entityImage={SpaceBackground}\n\t                           createEntity={createEntity}\n\t                           fetchEntityAndCodes={fetchEntityAndCodes}\n\t                           fetchEntityList={fetchEntityList}\n\t                           saveEntity={saveEntity}\n\t                           isEntityOnCreate={isEntityOnCreate}\n\t                           renderEntityInList={renderItemInList}\n\t                           getKeyOfEntity={getKeyOfEntity}\n\t                           renderEditContent={renderEditContent}/>;\n};","import React from \"react\";\nimport { NarrowPageTitle } from '../../component/console/narrow-page-title';\nimport { PlainNarrowContainer } from '../../component/console/page-container';\n\nexport const Tasks = () => {\n\treturn <PlainNarrowContainer>\n\t\t<NarrowPageTitle title='Tasks'/>\n\t\t<div style={{ marginTop: 50, fontSize: '2em', opacity: 0.5 }}>\n\t\t\tComing soon...\n\t\t</div>\n\t</PlainNarrowContainer>;\n};","export default __webpack_public_path__ + \"static/media/topic-background.3a001a7b.png\";","import styled from 'styled-components';\nimport Dropdown from '../../component/dropdown';\n\nexport const PropDropdown = styled(Dropdown)`\n\tfont-size: 12px;\n`;","import parseCSV from 'csv-parse';\nimport { Factor, FactorType } from './types';\n\nconst asFactors = async (data: any): Promise<Array<Factor>> => {\n\tif (data == null || !Array.isArray(data) || data.length === 0) {\n\t\tconsole.error('Cannot parse data to factors.', data);\n\t\tthrow new Error('Parsed data is not an array.');\n\t}\n\n\tconst columnMap: Map<string, Factor> = new Map();\n\treturn data.reduce<Array<Factor>>((columns, row) => {\n\t\tObject.keys(row)\n\t\t\t.forEach(name => {\n\t\t\t\tlet factor = columnMap.get(name);\n\t\t\t\tif (!factor) {\n\t\t\t\t\tfactor = { name } as Factor;\n\t\t\t\t\tcolumnMap.set(name, factor);\n\t\t\t\t\tcolumns.push(factor);\n\t\t\t\t}\n\t\t\t\tif (factor.type === FactorType.TEXT) {\n\t\t\t\t\t// already detected as text\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst value = row[name];\n\t\t\t\tif ((typeof value === 'number' || !isNaN(Number(value))) && !factor.type) {\n\t\t\t\t\tfactor.type = FactorType.NUMBER;\n\t\t\t\t} else if ((typeof value === 'boolean' || value.toLowerCase() === 'true' || value.toLowerCase() === 'false') && !factor.type) {\n\t\t\t\t\tfactor.type = FactorType.BOOLEAN;\n\t\t\t\t} else {\n\t\t\t\t\tfactor.type = FactorType.TEXT;\n\t\t\t\t}\n\t\t\t});\n\t\treturn columns;\n\t}, []);\n};\n\nexport const parseFromCsv = async (content: string): Promise<Array<Factor>> => {\n\treturn new Promise((resolve, reject) => {\n\t\tparseCSV(content, {\n\t\t\tcolumns: true,\n\t\t\tcomment: '#',\n\t\t\tskipEmptyLines: true,\n\t\t\tskipLinesWithError: true,\n\t\t\tskipLinesWithEmptyValues: true,\n\t\t\ttrim: true,\n\t\t\tautoParse: true,\n\t\t\tautoParseDate: true\n\t\t}, (err, data) => {\n\t\t\tif (err) {\n\t\t\t\treject(err);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tresolve(asFactors(data));\n\t\t\t} catch (e) {\n\t\t\t\treject(e);\n\t\t\t}\n\t\t});\n\t});\n};\n\nexport const parseFromJson = async (content: string): Promise<Array<Factor>> => {\n\treturn new Promise((resolve, reject) => {\n\t\ttry {\n\t\t\tconst data = JSON.parse(content);\n\t\t\ttry {\n\t\t\t\tresolve(asFactors(data));\n\t\t\t} catch (e) {\n\t\t\t\treject(e);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.group('Error occurred on parse JSON.');\n\t\t\tconsole.error(e);\n\t\t\tconsole.groupEnd();\n\t\t\treject(e);\n\t\t}\n\t});\n};","export const FACTOR_TABLE_HEADER_HEIGHT = 28;\nexport const FACTOR_TABLE_BODY_MAX_HEIGHT = 480;\nexport const FACTOR_ROW_HEIGHT = 32;\nexport const FACTOR_ROW_EDITOR_HEIGHT = 26;\nexport const FACTOR_TABLE_NAME_COLUMN_WIDTH = 150;\nexport const FACTOR_TABLE_LABEL_COLUMN_WIDTH = 150;\nexport const FACTOR_TABLE_TYPE_COLUMN_WIDTH = 125;\nexport const FACTOR_TABLE_MAX_NAME_COLUMN_WIDTH = 350;\nexport const FACTOR_TABLE_MAX_LABEL_COLUMN_WIDTH = 200;\nexport const FACTOR_BUTTONS_WIDTH = 68; // 24 * 2 + 4 + 8 * 2\nexport const FACTOR_TABLE_FOOTER_HEIGHT = 32;\nexport const FACTOR_TABLE_VERTICAL_GAP = 16;\n","import styled from 'styled-components';\nimport {\n\tFACTOR_BUTTONS_WIDTH,\n\tFACTOR_ROW_EDITOR_HEIGHT,\n\tFACTOR_ROW_HEIGHT,\n\tFACTOR_TABLE_BODY_MAX_HEIGHT,\n\tFACTOR_TABLE_LABEL_COLUMN_WIDTH,\n\tFACTOR_TABLE_MAX_LABEL_COLUMN_WIDTH,\n\tFACTOR_TABLE_MAX_NAME_COLUMN_WIDTH,\n\tFACTOR_TABLE_NAME_COLUMN_WIDTH,\n\tFACTOR_TABLE_TYPE_COLUMN_WIDTH\n} from './factor-table-constants';\n\nexport const FactorTableBody = styled.div`\n\tdisplay: grid;\n\tgrid-template-columns: ${FACTOR_TABLE_NAME_COLUMN_WIDTH}px ${FACTOR_TABLE_LABEL_COLUMN_WIDTH}px ${FACTOR_TABLE_TYPE_COLUMN_WIDTH}px 1fr;\n\tmargin: 0 -4px 0 ${0 - FACTOR_BUTTONS_WIDTH}px;\n\tpadding: 0 4px 0 ${FACTOR_BUTTONS_WIDTH}px;\n\tmax-height: ${FACTOR_TABLE_BODY_MAX_HEIGHT}px;\n\toverflow-x: visible;\n\toverflow-y: auto;\n\ttransition: all 300ms ease-in-out;\n\t&[data-max=true] {\n\t\tgrid-template-columns: ${FACTOR_TABLE_MAX_NAME_COLUMN_WIDTH}px ${FACTOR_TABLE_MAX_LABEL_COLUMN_WIDTH}px ${FACTOR_TABLE_TYPE_COLUMN_WIDTH}px 1fr;\n\t}\n\t&::-webkit-scrollbar {\n\t\tbackground-color: transparent;\n\t\theight: 4px;\n\t\twidth: 4px;\n\t}\n\t&::-webkit-scrollbar-track {\n\t\tbackground-color: var(--scrollbar-background-color);\n\t\tborder-radius: 2px;\n\t}\n\t&::-webkit-scrollbar-thumb {\n\t\tbackground-color: var(--console-favorite-color);\n\t\tborder-radius: 2px;\n\t}\n`;\nexport const FactorCell = styled.div`\n\tdisplay: flex;\n\tposition: relative;\n\talign-items: center;\n\theight: ${FACTOR_ROW_HEIGHT}px;\n\tpadding-left: calc(var(--margin) / 2);\n\ttransition: all 300ms ease-in-out;\n\t//&[data-valid=false] {\n\t//\tbackground-color: var(--console-grid-error-bg-color);\n\t//}\n\t&:nth-child(8n + 5), &:nth-child(8n + 6), &:nth-child(8n + 7), &:nth-child(8n) {\n\t\tbackground-color: var(--pipeline-bg-color);\n\t}\n\t> input {\n\t\theight: ${FACTOR_ROW_EDITOR_HEIGHT}px;\n\t\twidth: calc(100% + var(--input-indent));\n\t\tborder-color: transparent;\n\t\tmargin-left: calc(var(--input-indent) * -1);\n\t\tcolor: var(--console-font-color);\n\t\t&:hover {\n\t\t\tborder-color: var(--border-color);\n\t\t\tbox-shadow: var(--console-hover-shadow);\n\t\t}\n\t\t&:focus {\n\t\t\tborder-color: var(--console-primary-color);\n\t\t\tcolor: var(--font-color);\n\t\t\tbackground-color: var(--bg-color);\n\t\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t\t\tz-index: 1;\n\t\t}\n\t}\n\t> div[data-widget=dropdown] {\n\t\theight: ${FACTOR_ROW_EDITOR_HEIGHT}px;\n\t\twidth: calc(100% + var(--input-indent));\n\t\tborder-color: transparent;\n\t\tmargin-left: calc(var(--input-indent) * -1);\n\t\tcolor: var(--console-font-color);\n\t\t&:hover {\n\t\t\tborder-color: var(--border-color);\n\t\t\tbox-shadow: var(--console-hover-shadow);\n\t\t}\n\t\t&:focus {\n\t\t\tborder-color: var(--console-primary-color);\n\t\t\tcolor: var(--font-color);\n\t\t\tbackground-color: var(--bg-color);\n\t\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t\t\tz-index: 1;\n\t\t}\n\t\t&[data-options-visible=true] {\n\t\t\t> div {\n\t\t\t\tborder-color: var(--console-primary-color);\n\t\t\t}\n\t\t}\n\t}\n`;\nexport const FactorNameCell = styled(FactorCell)`\n\tborder-top-left-radius: var(--border-radius);\n\tborder-bottom-left-radius: var(--border-radius);\n\t&:hover + div + div + div {\n\t\t> div {\n\t\t\topacity: 1;\n\t\t\tpointer-events: auto;\n\t\t}\n\t}\n`;\nexport const FactorLabelCell = styled(FactorCell)`\n\t&:hover + div + div {\n\t\t> div {\n\t\t\topacity: 1;\n\t\t\tpointer-events: auto;\n\t\t}\n\t}\n`;\nexport const FactorTypeCell = styled(FactorCell)`\n\t&:hover + div {\n\t\t> div {\n\t\t\topacity: 1;\n\t\t\tpointer-events: auto;\n\t\t}\n\t}\n`;\nexport const FactorDescCell = styled(FactorCell)`\n\tpadding-right: calc(var(--margin) / 2);\n\tborder-top-right-radius: var(--border-radius);\n\tborder-bottom-right-radius: var(--border-radius);\n\t&:hover {\n\t\t// buttons\n\t\t> div {\n\t\t\topacity: 1;\n\t\t\tpointer-events: auto;\n\t\t}\n\t}\n\t> input {\n\t\tmargin-right: calc(var(--margin) / -2);\n\t\twidth: calc(100% + var(--input-indent) * 2);\n\t}\n`;\nexport const FactorButtons = styled.div`\n\tdisplay: flex;\n\tposition: absolute;\n\topacity: 0;\n\tpointer-events: none;\n\tpadding: 4px 8px;\n\tleft: calc((${FACTOR_TABLE_NAME_COLUMN_WIDTH}px + ${FACTOR_TABLE_LABEL_COLUMN_WIDTH}px + ${FACTOR_TABLE_TYPE_COLUMN_WIDTH}px + ${FACTOR_BUTTONS_WIDTH}px) * -1);\n\theight: ${FACTOR_ROW_HEIGHT}px;\n\t&[data-max=true] {\n\t\tleft: calc((${FACTOR_TABLE_MAX_NAME_COLUMN_WIDTH}px + ${FACTOR_TABLE_MAX_LABEL_COLUMN_WIDTH}px + ${FACTOR_TABLE_TYPE_COLUMN_WIDTH}px + ${FACTOR_BUTTONS_WIDTH}px) * -1);\n\t}\n\tbutton {\n\t\twidth: 24px;\n\t\theight: 24px;\n\t\tfont-size: 1em;\n\t\tcolor: var(--invert-color);\n\t\tborder-radius: 12px;\n\t\t&:before {\n\t\t\tborder-radius: 12px;\n\t\t}\n\t\t&:first-child {\n\t\t\tbackground-color: var(--console-danger-color);\n\t\t\tmargin-right: calc(var(--margin) / 8);\n\t\t}\n\t\t&:last-child {\n\t\t\tbackground-color: var(--console-primary-color);\n\t\t}\n\t}\n`;\n","import { faLevelDownAlt, faTimes } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { Fragment } from 'react';\nimport styled from 'styled-components';\nimport { Factor, FactorType, Topic, TopicType } from '../../../services/admin/types';\nimport { LinkButton } from '../../component/console/link-button';\nimport { DropdownOption } from '../../component/dropdown';\nimport { PropDropdown } from '../component/prop-dropdown';\nimport { PropInput } from '../component/prop-input';\nimport { FactorButtons, FactorDescCell, FactorLabelCell, FactorNameCell, FactorTypeCell } from './factor-table-body';\n\nconst IncorrectFactorType = styled.span`\n\tcolor: var(--console-danger-color);\n\ttext-decoration: line-through;\n`;\n\nconst FactorTypeOptions = [\n\t{ value: FactorType.TEXT, label: 'Text' },\n\t{ value: FactorType.NUMBER, label: 'Number' },\n\t{ value: FactorType.BOOLEAN, label: 'Boolean' },\n\t{ value: FactorType.DATETIME, label: 'DateTime' },\n\t{ value: FactorType.ENUM, label: 'Enumeration' },\n\t{ value: FactorType.SEQUENCE, label: 'Sequence' },\n\t{ value: FactorType.OBJECT, label: 'Nested Object' },\n\t{ value: FactorType.ARRAY, label: 'Nested Array' }\n];\n\nconst prepareFactorPainting = (topic: Topic, factor: Factor) => {\n\tconst { type: topicType } = topic;\n\tif (topicType !== TopicType.RAW) {\n\t\t// nested factor type is not allowed\n\t\tconst { type: factorType } = factor;\n\t\tif (factorType === FactorType.OBJECT) {\n\t\t\treturn {\n\t\t\t\tpass: false,\n\t\t\t\ttypeOptions: FactorTypeOptions.filter(({ value }) => value !== FactorType.ARRAY)\n\t\t\t\t\t.map(option => {\n\t\t\t\t\t\treturn option.value !== FactorType.OBJECT ? option : {\n\t\t\t\t\t\t\tvalue: FactorType.OBJECT,\n\t\t\t\t\t\t\tlabel: <IncorrectFactorType>Nested Object</IncorrectFactorType>\n\t\t\t\t\t\t};\n\t\t\t\t\t})\n\t\t\t};\n\t\t} else if (factorType === FactorType.ARRAY) {\n\t\t\treturn {\n\t\t\t\tpass: false,\n\t\t\t\ttypeOptions: FactorTypeOptions.filter(({ value }) => value !== FactorType.OBJECT)\n\t\t\t\t\t.map(option => {\n\t\t\t\t\t\treturn option.value !== FactorType.ARRAY ? option : {\n\t\t\t\t\t\t\tvalue: FactorType.ARRAY,\n\t\t\t\t\t\t\tlabel: <IncorrectFactorType>Nested Array</IncorrectFactorType>\n\t\t\t\t\t\t};\n\t\t\t\t\t})\n\t\t\t};\n\t\t} else {\n\t\t\treturn {\n\t\t\t\tpass: true,\n\t\t\t\ttypeOptions: FactorTypeOptions.filter(({ value }) => value !== FactorType.ARRAY && value !== FactorType.OBJECT)\n\t\t\t};\n\t\t}\n\t} else {\n\t\treturn { pass: true, typeOptions: FactorTypeOptions };\n\t}\n};\n\nconst findParentFactor = (topic: Topic, factor: Factor): Factor | undefined => {\n\tconst factorIndex = topic.factors.indexOf(factor);\n\tif (factorIndex === 0) {\n\t\treturn (void 0);\n\t}\n\n\tfor (let index = factorIndex - 1; index >= 0; index--) {\n\t\tconst f = topic.factors[index];\n\t\tif (f.type === FactorType.OBJECT || f.type === FactorType.ARRAY) {\n\t\t\treturn f;\n\t\t}\n\t}\n\n\treturn (void 0);\n};\n\nexport const FactorRow = (props: {\n\ttopic: Topic;\n\tfactor: Factor;\n\tmax: boolean;\n\tonDataChanged: () => void\n}) => {\n\tconst {\n\t\ttopic, factor,\n\t\tmax,\n\t\tonDataChanged\n\t} = props;\n\n\tconst onFactorNameChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n\t\tconst { value } = event.target;\n\t\tif (value === '.') {\n\t\t\tconst parent = findParentFactor(topic, factor);\n\t\t\tif (parent) {\n\t\t\t\tconst { name = '' } = parent;\n\t\t\t\tfactor.name = name.endsWith('.') ? name : `${name}.`;\n\t\t\t} else {\n\t\t\t\tfactor.name = event.target.value;\n\t\t\t}\n\t\t} else {\n\t\t\tfactor.name = event.target.value;\n\t\t}\n\t\tonDataChanged();\n\t};\n\tconst onFactorPropChange = (prop: | 'label' | 'description') => (event: React.ChangeEvent<HTMLInputElement>) => {\n\t\tif (event.target.value === factor[prop]) {\n\t\t\treturn;\n\t\t}\n\t\tfactor[prop] = event.target.value;\n\t\tonDataChanged();\n\t};\n\tconst onFactorTypeChange = async (option: DropdownOption) => {\n\t\tfactor.type = option.value as FactorType;\n\t\tonDataChanged();\n\t};\n\tconst onFactorDeleteClicked = () => {\n\t\ttopic.factors = topic.factors.filter(exists => exists !== factor);\n\t\tonDataChanged();\n\t};\n\tconst onInsertBeforeClicked = () => {\n\t\tconst index = topic.factors.indexOf(factor);\n\t\ttopic.factors.splice(index, 0, { type: FactorType.TEXT });\n\t\tonDataChanged();\n\t};\n\n\tconst { pass: passTypeCheck, typeOptions } = prepareFactorPainting(topic, factor);\n\tconst isValid = passTypeCheck;\n\tconst namePlaceholder = findParentFactor(topic, factor) ? 'Dot to append into nested' : (void 0);\n\n\treturn <Fragment key={factor.factorId}>\n\t\t<FactorNameCell data-valid={isValid}>\n\t\t\t<PropInput value={factor.name || ''} onChange={onFactorNameChange}\n\t\t\t           placeholder={namePlaceholder}/>\n\t\t</FactorNameCell>\n\t\t<FactorLabelCell data-valid={isValid}>\n\t\t\t<PropInput value={factor.label || ''} onChange={onFactorPropChange('label')}/>\n\t\t</FactorLabelCell>\n\t\t<FactorTypeCell data-valid={isValid}>\n\t\t\t<PropDropdown value={factor.type} options={typeOptions} onChange={onFactorTypeChange}/>\n\t\t</FactorTypeCell>\n\t\t<FactorDescCell data-valid={isValid}>\n\t\t\t<PropInput value={factor.description || ''} onChange={onFactorPropChange('description')}/>\n\t\t\t<FactorButtons data-max={max}>\n\t\t\t\t<LinkButton ignoreHorizontalPadding={true} tooltip='Delete Factor' center={true}\n\t\t\t\t            onClick={onFactorDeleteClicked}>\n\t\t\t\t\t<FontAwesomeIcon icon={faTimes}/>\n\t\t\t\t</LinkButton>\n\t\t\t\t<LinkButton ignoreHorizontalPadding={true} tooltip='Prepend Factor' center={true}\n\t\t\t\t            onClick={onInsertBeforeClicked}>\n\t\t\t\t\t<FontAwesomeIcon icon={faLevelDownAlt} rotation={270}/>\n\t\t\t\t</LinkButton>\n\t\t\t</FactorButtons>\n\t\t</FactorDescCell>\n\t</Fragment>;\n};","import styled from 'styled-components';\nimport {\n\tFACTOR_BUTTONS_WIDTH,\n\tFACTOR_ROW_HEIGHT,\n\tFACTOR_TABLE_BODY_MAX_HEIGHT,\n\tFACTOR_TABLE_FOOTER_HEIGHT,\n\tFACTOR_TABLE_HEADER_HEIGHT,\n\tFACTOR_TABLE_VERTICAL_GAP\n} from './factor-table-constants';\n\nexport const FactorTable = styled.div.attrs<{ expanded: boolean, factorCount: number }>(({ expanded, factorCount }) => {\n\tconst offset = FACTOR_TABLE_HEADER_HEIGHT + FACTOR_TABLE_FOOTER_HEIGHT + FACTOR_TABLE_VERTICAL_GAP;\n\treturn {\n\t\tstyle: {\n\t\t\theight: expanded ? (Math.min(FACTOR_TABLE_BODY_MAX_HEIGHT + offset, factorCount * FACTOR_ROW_HEIGHT + offset)) : 0\n\t\t}\n\t};\n})<{ expanded: boolean, factorCount: number }>`\n\tgrid-column: span 2;\n\tdisplay: flex;\n\tflex-direction: column;\n\tfont-size: 0.8em;\n\tmargin: 0 -40px 24px ${0 - FACTOR_BUTTONS_WIDTH}px;\n\tpadding: 0 40px 0 ${FACTOR_BUTTONS_WIDTH}px;\n\toverflow-x: hidden;\n\toverflow-y: hidden;\n\ttransition: all 300ms ease-in-out;\n\n\t&[data-max=true] {\n\t\t// editor in grid layout, 30% 70%, column gap is 32px, table is second column in editor.\n\t\tmargin-left: calc((100% + 32px) / 0.7 * 0.3 * -1 - 32px - ${FACTOR_BUTTONS_WIDTH}px);\n\t\tz-index: 1;\n\t\t+ div {\n\t\t\tmargin-left: calc((100% + 32px) / 0.7 * 0.3 * -1 - 32px);\n\t\t}\n\t}\n`;\n","import styled from 'styled-components';\nimport { FACTOR_TABLE_FOOTER_HEIGHT } from './factor-table-constants';\n\nexport const FactorTableFooter = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: flex-end;\n\theight: ${FACTOR_TABLE_FOOTER_HEIGHT}px;\n\tborder-top: var(--border);\n\ttransition: all 300ms ease-in-out;\n\t> button:not(:first-child) {\n\t\tmargin-left: calc(var(--margin) / 3);\n\t}\n\t> button[data-max=true] > svg {\n\t\ttransform: rotateZ(225deg);\n\t}\n\t> button[data-max=false] > svg {\n\t\ttransform: rotateZ(45deg);\n\t\ttransition: all 300ms ease-in-out;\n\t\tmargin-top: 2px;\n\t\tmargin-right: calc(var(--margin) / 3);\n\t}\n`;\n","import styled from 'styled-components';\nimport {\n\tFACTOR_TABLE_HEADER_HEIGHT,\n\tFACTOR_TABLE_LABEL_COLUMN_WIDTH,\n\tFACTOR_TABLE_MAX_LABEL_COLUMN_WIDTH,\n\tFACTOR_TABLE_MAX_NAME_COLUMN_WIDTH,\n\tFACTOR_TABLE_NAME_COLUMN_WIDTH,\n\tFACTOR_TABLE_TYPE_COLUMN_WIDTH\n} from './factor-table-constants';\n\nexport const FactorTableHeader = styled.div`\n\tdisplay: grid;\n\tgrid-template-columns: ${FACTOR_TABLE_NAME_COLUMN_WIDTH}px ${FACTOR_TABLE_LABEL_COLUMN_WIDTH}px ${FACTOR_TABLE_TYPE_COLUMN_WIDTH}px 1fr;\n\ttransition: all 300ms ease-in-out;\n\t&[data-max=true] {\n\t\tgrid-template-columns: ${FACTOR_TABLE_MAX_NAME_COLUMN_WIDTH}px ${FACTOR_TABLE_MAX_LABEL_COLUMN_WIDTH}px ${FACTOR_TABLE_TYPE_COLUMN_WIDTH}px 1fr;\n\t}\n\t> div {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\theight: ${FACTOR_TABLE_HEADER_HEIGHT}px;\n\t\tborder-bottom: var(--border);\n\t\tpadding-left: calc(var(--margin) / 2);\n\t\tfont-variant: petite-caps;\n\t\tfont-weight: var(--font-bold);\n\t}\n`;\n","import styled from 'styled-components';\n\nexport const FactorsTableButtons = styled.div`\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-self: start;\n\tfont-size: 0.8em;\n\tfont-variant: petite-caps;\n\tfont-weight: var(--font-bold);\n\theight: 24px;\n\tborder-radius: 12px;\n\tcolor: var(--invert-color);\n\tbackground-color: var(--console-primary-color);\n\tpadding: 0 calc(var(--margin) / 3) 0 calc(var(--margin) / 2);\n\tcursor: pointer;\n\t&:hover {\n\t\tbox-shadow: var(--console-primary-hover-shadow);\n\t}\n\t&[data-expanded=true] {\n\t\t> svg {\n\t\t\ttransform: rotateZ(360deg);\n\t\t}\n\t}\n\t> span {\n\t\tposition: relative;;\n\t\tpadding-right: calc(var(--margin) / 3);\n\t\t&:after {\n\t\t\tcontent: '';\n\t\t\tdisplay: block;\n\t\t\tposition: absolute;\n\t\t\ttop: 10%;\n\t\t\tright: 0;\n\t\t\twidth: 1px;\n\t\t\theight: 80%;\n\t\t\tbackground-color: var(--invert-color);\n\t\t\topacity: 0.7;\n\t\t}\n\t}\n\t> svg {\n\t\tmargin-left: calc(var(--margin) / 3);\n\t\ttransition: all 300ms ease-in-out;\n\t}\n`;\n","import { faCompressAlt, faExpandAlt, faPlus, faUpload } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { Fragment, useState } from 'react';\nimport { v4 } from 'uuid';\nimport { parseFromCsv, parseFromJson } from '../../../services/admin/topic-import';\nimport { FactorType, Topic } from '../../../services/admin/types';\nimport { PrimaryObjectButton, SuccessObjectButton } from '../../component/object-button';\nimport { useNotImplemented } from '../../context/not-implemented';\nimport { useEditPanelContext } from '../component/edit-panel';\nimport { FactorRow } from './factor-row';\nimport { FactorTable } from './factor-table';\nimport { FactorTableBody } from './factor-table-body';\nimport { FactorTableFooter } from './factor-table-footer';\nimport { FactorTableHeader } from './factor-table-header';\nimport { FactorsTableButtons } from './factors-table-buttons';\n\nexport const Factors = (props: { topic: Topic, onDataChanged: () => void }) => {\n\tconst { topic, onDataChanged } = props;\n\n\tconst notImpl = useNotImplemented();\n\tconst { changeBackgroundPosition } = useEditPanelContext();\n\tconst [ expanded, setExpanded ] = useState(false);\n\tconst [ max, setMax ] = useState(false);\n\n\tconst onExpandToggleClicked = () => setExpanded(!expanded);\n\tconst onFactorAddClicked = () => {\n\t\ttopic.factors.push({ type: FactorType.TEXT });\n\t\tonDataChanged();\n\t};\n\tconst onFactorExpandToggleClicked = () => {\n\t\tsetMax(!max);\n\t\tif (max) {\n\t\t\tchangeBackgroundPosition('left');\n\t\t} else {\n\t\t\tchangeBackgroundPosition('top 50px left');\n\t\t}\n\t};\n\tconst onFileSelected = (input: HTMLInputElement) => async () => {\n\t\tif (!input.files || input.files.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tconst file = input.files.item(0);\n\t\tif (!file) {\n\t\t\treturn;\n\t\t}\n\t\tconst name = file.name;\n\t\tswitch (true) {\n\t\t\tcase name.endsWith('.txt'):\n\t\t\tcase name.endsWith('.csv'): {\n\t\t\t\tconst content = await file.text();\n\t\t\t\ttopic.factors = await parseFromCsv(content);\n\t\t\t\tonDataChanged();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase name.endsWith('.json'): {\n\t\t\t\tconst content = await file.text();\n\t\t\t\ttopic.factors = await parseFromJson(content);\n\t\t\t\tonDataChanged();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase name.endsWith('.xml'):\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tnotImpl.show();\n\t\t}\n\t};\n\tconst onImportClicked = () => {\n\t\tconst input = document.createElement('input');\n\t\tinput.type = 'file';\n\t\tinput.multiple = false;\n\t\tinput.accept = '.txt,.csv,.json';\n\t\tinput.onchange = onFileSelected(input);\n\t\tinput.click();\n\t};\n\n\tconst factorCount = topic.factors.length;\n\tconst buttonLabel = factorCount === 0 ? 'No Factor Defined' : (factorCount === 1 ? '1 Factor' : `${factorCount} Factors`);\n\n\treturn <Fragment>\n\t\t<FactorsTableButtons onClick={onExpandToggleClicked} data-expanded={expanded}>\n\t\t\t<span>{buttonLabel}</span>\n\t\t\t<FontAwesomeIcon icon={expanded ? faCompressAlt : faExpandAlt}/>\n\t\t</FactorsTableButtons>\n\t\t<FactorTable expanded={expanded} factorCount={factorCount} data-max={max}>\n\t\t\t<FactorTableHeader data-max={max}>\n\t\t\t\t<div>Name</div>\n\t\t\t\t<div>Label</div>\n\t\t\t\t<div>Type</div>\n\t\t\t\t<div>Description</div>\n\t\t\t</FactorTableHeader>\n\t\t\t<FactorTableBody data-max={max}>\n\t\t\t\t{topic.factors.map(factor => {\n\t\t\t\t\tif (!factor.factorId) {\n\t\t\t\t\t\tfactor.factorId = v4();\n\t\t\t\t\t}\n\t\t\t\t\treturn <FactorRow topic={topic} factor={factor} max={max}\n\t\t\t\t\t                  onDataChanged={onDataChanged}\n\t\t\t\t\t                  key={factor.factorId}/>;\n\t\t\t\t})}\n\t\t\t</FactorTableBody>\n\t\t\t<FactorTableFooter>\n\t\t\t\t<PrimaryObjectButton onClick={onFactorAddClicked}>\n\t\t\t\t\t<FontAwesomeIcon icon={faPlus}/>\n\t\t\t\t\t<span>Append Factor</span>\n\t\t\t\t</PrimaryObjectButton>\n\t\t\t\t<PrimaryObjectButton onClick={onFactorExpandToggleClicked} data-max={max}>\n\t\t\t\t\t<FontAwesomeIcon icon={max ? faCompressAlt : faExpandAlt}/>\n\t\t\t\t\t<span>{max ? 'Shrink Table' : 'Expand Table'}</span>\n\t\t\t\t</PrimaryObjectButton>\n\t\t\t\t<SuccessObjectButton onClick={onImportClicked}>\n\t\t\t\t\t<FontAwesomeIcon icon={faUpload}/>\n\t\t\t\t\t<span>Import from File</span>\n\t\t\t\t</SuccessObjectButton>\n\t\t\t</FactorTableFooter>\n\t\t</FactorTable>\n\t</Fragment>;\n};\n","import { faChartBar } from '@fortawesome/free-regular-svg-icons';\nimport { faGlobe, faList, faUsers } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { Fragment } from \"react\";\nimport TopicBackground from '../../../assets/topic-background.png';\nimport { fetchTopic, listTopics, saveTopic } from '../../../services/admin/topic';\nimport { QueriedTopic, Topic, TopicType } from '../../../services/admin/types';\nimport { TooltipCarvedButton } from '../../component/console/carved-button';\nimport { DropdownOption } from '../../component/dropdown';\nimport { PropDropdown } from '../component/prop-dropdown';\nimport { PropInput } from '../component/prop-input';\nimport { PropInputLines } from '../component/prop-input-lines';\nimport { PropLabel } from '../component/prop-label';\nimport { SearchAndEditPanel } from '../component/search-and-edit-panel';\nimport { SingleSearchItemCard } from '../component/single-search';\nimport { Factors } from './factors';\n\nconst TopicTypeOptions = [\n\t{ value: TopicType.RAW, label: 'Raw' },\n\t{ value: TopicType.DISTINCT, label: 'Distinct' },\n\t{ value: TopicType.AGGREGATE, label: 'Aggregate' },\n\t{ value: TopicType.TIME, label: 'Time Aggregate' },\n\t{ value: TopicType.RATIO, label: 'Ratio' },\n\t{ value: TopicType.NOT_DEFINED, label: 'Not Defined' }\n];\n\nconst renderEditContent = (topic: Topic, onDataChanged: () => void) => {\n\tconst onPropChange = (prop: 'code' | 'name' | 'description') => (event: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n\t\tif (topic[prop] !== event.target.value) {\n\t\t\ttopic[prop] = event.target.value;\n\t\t\tonDataChanged();\n\t\t}\n\t};\n\tconst onTypeChange = async (option: DropdownOption) => {\n\t\ttopic.type = option.value as TopicType;\n\t\tonDataChanged();\n\t};\n\n\treturn <Fragment>\n\t\t<PropLabel>Topic Code:</PropLabel>\n\t\t<PropInput value={topic.code || ''} onChange={onPropChange('code')}/>\n\t\t<PropLabel>Topic Name:</PropLabel>\n\t\t<PropInput value={topic.name || ''} onChange={onPropChange('name')}/>\n\t\t<PropLabel>Topic Type:</PropLabel>\n\t\t<PropDropdown value={topic.type} options={TopicTypeOptions} onChange={onTypeChange}/>\n\t\t<PropLabel>Description:</PropLabel>\n\t\t<PropInputLines value={topic.description || ''} onChange={onPropChange('description')}/>\n\t\t<PropLabel>Factors:</PropLabel>\n\t\t<Factors topic={topic} onDataChanged={onDataChanged}/>\n\t</Fragment>;\n};\n\nexport const Topics = () => {\n\tconst createEntity = () => {\n\t\treturn { type: TopicType.DISTINCT, factors: [] } as Topic;\n\t};\n\tconst fetchEntityAndCodes = async (queriedTopic: QueriedTopic) => {\n\t\tconst { topic } = await fetchTopic(queriedTopic.topicId);\n\t\treturn { entity: topic };\n\t};\n\tconst fetchEntityList = listTopics;\n\tconst saveEntity = saveTopic;\n\tconst isEntityOnCreate = (topic: Topic) => !topic.topicId;\n\tconst renderItemInList = (topic: QueriedTopic, onEdit: (topic: QueriedTopic) => (() => void)) => {\n\t\treturn <SingleSearchItemCard key={topic.topicId} onClick={onEdit(topic)}>\n\t\t\t<div>{topic.name}</div>\n\t\t\t<div>{topic.description}</div>\n\t\t\t<div>\n\t\t\t\t<TooltipCarvedButton tooltip='Factors Count' center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faList}/>\n\t\t\t\t\t<span>{topic.factorCount}</span>\n\t\t\t\t</TooltipCarvedButton>\n\t\t\t\t<TooltipCarvedButton tooltip='In User Groups' center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faUsers}/>\n\t\t\t\t\t<span>{topic.groupCount}</span>\n\t\t\t\t</TooltipCarvedButton>\n\t\t\t\t<TooltipCarvedButton tooltip='In Spaces' center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faGlobe}/>\n\t\t\t\t\t<span>{topic.spaceCount}</span>\n\t\t\t\t</TooltipCarvedButton>\n\t\t\t\t<TooltipCarvedButton tooltip='In Reports' center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faChartBar}/>\n\t\t\t\t\t<span>{topic.reportCount}</span>\n\t\t\t\t</TooltipCarvedButton>\n\t\t\t</div>\n\t\t</SingleSearchItemCard>;\n\t};\n\tconst getKeyOfEntity = (item: QueriedTopic) => item.topicId;\n\n\treturn <SearchAndEditPanel title='Topics'\n\t                           searchPlaceholder='Search by topic name, factor name, description, etc.'\n\t                           createButtonLabel='Create Topic'\n\t                           entityLabel='Topic'\n\t                           entityImage={TopicBackground}\n\t                           createEntity={createEntity}\n\t                           fetchEntityAndCodes={fetchEntityAndCodes}\n\t                           fetchEntityList={fetchEntityList}\n\t                           saveEntity={saveEntity}\n\t                           isEntityOnCreate={isEntityOnCreate}\n\t                           renderEntityInList={renderItemInList}\n\t                           getKeyOfEntity={getKeyOfEntity}\n\t                           renderEditContent={renderEditContent}/>;\n};","export default __webpack_public_path__ + \"static/media/user-background.3c1eb5e6.png\";","import { faChartBar } from '@fortawesome/free-regular-svg-icons';\nimport { faGlobe, faTags } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { Fragment, useState } from \"react\";\nimport styled from 'styled-components';\nimport UserBackground from '../../../assets/user-background.png';\nimport { QueriedUser, QueriedUserGroupForGroupsHolder, User } from '../../../services/admin/types';\nimport { fetchUser, listUserGroupsForUser, listUsers, saveUser } from '../../../services/admin/user';\nimport { TooltipCarvedButton } from '../../component/console/carved-button';\nimport { UserAvatar } from '../../component/console/user-avatar';\nimport { GroupPicker } from '../component/group-picker';\nimport { PropInput } from '../component/prop-input';\nimport { PropLabel } from '../component/prop-label';\nimport { SearchAndEditPanel } from '../component/search-and-edit-panel';\nimport { SingleSearchItemCard } from '../component/single-search';\n\nconst ItemCard = styled(SingleSearchItemCard)`\n\t> div:nth-child(2) {\n\t\tposition: absolute;\n\t\ttop: calc(var(--margin) / 2);\n\t\tright: var(--margin);\n\t\tmargin-top: 0;\n\t\tfont-size: 1.3em;\n\t\topacity: 1;\n\t\tmin-height: unset;\n\t\tline-height: unset;\n\t\ttransform: unset;\n\t}\n\t> div:nth-child(3) {\n\t\tmargin-top: var(--margin);\n\t}\n`;\n\nexport const Users = () => {\n\tconst createCodes = () => ({ groups: [] as Array<QueriedUserGroupForGroupsHolder> });\n\n\tconst [ codes, setCodes ] = useState(createCodes());\n\n\tconst createEntity = (fake: boolean) => {\n\t\tif (!fake) {\n\t\t\tsetCodes({ groups: [] });\n\t\t}\n\t\treturn { groupIds: [] } as User;\n\t};\n\tconst fetchEntityAndCodes = async (queriedUser: QueriedUser) => {\n\t\tconst { user, groups } = await fetchUser(queriedUser.userId);\n\t\tsetCodes({ groups });\n\t\treturn { entity: user };\n\t};\n\tconst fetchEntityList = listUsers;\n\tconst saveEntity = saveUser;\n\tconst isEntityOnCreate = (user: User) => !user.userId;\n\tconst renderItemInList = (user: QueriedUser, onEdit: (user: QueriedUser) => (() => void)) => {\n\t\treturn <ItemCard key={user.userId} onClick={onEdit(user)}>\n\t\t\t<div>{user.name}</div>\n\t\t\t<UserAvatar name={user.name}/>\n\t\t\t<div>\n\t\t\t\t<TooltipCarvedButton tooltip='Spaces Assigned' center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faGlobe}/>\n\t\t\t\t\t<span>{user.spaceCount}</span>\n\t\t\t\t</TooltipCarvedButton>\n\t\t\t\t<TooltipCarvedButton tooltip='Topics Available' center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faTags}/>\n\t\t\t\t\t<span>{user.topicCount}</span>\n\t\t\t\t</TooltipCarvedButton>\n\t\t\t\t<TooltipCarvedButton tooltip='Reports Created' center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faChartBar}/>\n\t\t\t\t\t<span>{user.reportCount}</span>\n\t\t\t\t</TooltipCarvedButton>\n\t\t\t</div>\n\t\t</ItemCard>;\n\t};\n\tconst getKeyOfEntity = (item: QueriedUser) => item.userId;\n\n\tconst onPropChange = (user: User, prop: 'name' | 'nickName', onDataChanged: () => void) => (event: React.ChangeEvent<HTMLInputElement>) => {\n\t\tif (user[prop] !== event.target.value) {\n\t\t\tuser[prop] = event.target.value;\n\t\t\tonDataChanged();\n\t\t}\n\t};\n\tconst renderEditContent = (user: User, onDataChanged: () => void) => {\n\t\treturn <Fragment>\n\t\t\t<PropLabel>User Name:</PropLabel>\n\t\t\t<PropInput value={user.name || ''} onChange={onPropChange(user, 'name', onDataChanged)}/>\n\t\t\t<PropLabel>Nick Name:</PropLabel>\n\t\t\t<PropInput value={user.nickName || ''} onChange={onPropChange(user, 'nickName', onDataChanged)}/>\n\t\t\t<PropLabel>Groups:</PropLabel>\n\t\t\t<GroupPicker label='Join Group' holder={user} codes={codes}\n\t\t\t             listGroups={listUserGroupsForUser} onDataChanged={onDataChanged}/>\n\t\t</Fragment>;\n\t};\n\n\treturn <SearchAndEditPanel title='Users'\n\t                           searchPlaceholder='Search by user name, group name, etc.'\n\t                           createButtonLabel='Create User'\n\t                           entityLabel='User'\n\t                           entityImage={UserBackground}\n\t                           createEntity={createEntity}\n\t                           fetchEntityAndCodes={fetchEntityAndCodes}\n\t                           fetchEntityList={fetchEntityList}\n\t                           saveEntity={saveEntity}\n\t                           isEntityOnCreate={isEntityOnCreate}\n\t                           renderEntityInList={renderItemInList}\n\t                           getKeyOfEntity={getKeyOfEntity}\n\t                           renderEditContent={renderEditContent}/>;\n};","export default __webpack_public_path__ + \"static/media/user-group-background.93b41542.png\";","import React from 'react';\nimport { listSpacesForUserGroup } from '../../../services/admin/space';\nimport { QueriedSpaceForUserGroup, UserGroup } from '../../../services/admin/types';\nimport { PropItemPicker } from './prop-items-picker';\n\nconst initSpaceArray = (group: UserGroup) => group.spaceIds = group.spaceIds || [];\nconst addSpaceToGroup = (group: UserGroup, space: QueriedSpaceForUserGroup) => group.spaceIds!.push(space.spaceId);\n// eslint-disable-next-line\nconst removeSpaceFromGroup = (group: UserGroup, space: QueriedSpaceForUserGroup) => group.spaceIds = (group.spaceIds || []).filter(spaceId => spaceId != space.spaceId);\n// eslint-disable-next-line\nconst isSpaceSelected = (group: UserGroup, space: QueriedSpaceForUserGroup) => !!group.spaceIds && group.spaceIds.findIndex(spaceId => spaceId == space.spaceId) !== -1;\nconst addSpaceToCodes = (codes: Array<QueriedSpaceForUserGroup>, space: QueriedSpaceForUserGroup) => {\n\t// eslint-disable-next-line\n\tconst exists = codes.findIndex(exists => exists.spaceId == space.spaceId) !== -1;\n\tif (!exists) {\n\t\tcodes.push(space);\n\t}\n};\nconst removeSpaceFromCodes = (codes: Array<QueriedSpaceForUserGroup>, space: QueriedSpaceForUserGroup) => {\n\t// eslint-disable-next-line\n\tconst index = codes.findIndex(exists => exists.spaceId == space.spaceId);\n\tif (index !== -1) {\n\t\tcodes.splice(index, 1);\n\t}\n};\nconst getSpaceId = (space: QueriedSpaceForUserGroup) => space.spaceId;\nconst getSpaceName = (space: QueriedSpaceForUserGroup) => space.name;\nconst getSpaceDescription = (space: QueriedSpaceForUserGroup) => space.description;\n\nexport const SpacePicker = (props: {\n\tgroup: UserGroup;\n\tcodes: { spaces: Array<QueriedSpaceForUserGroup> };\n\tonDataChanged: () => void;\n}) => {\n\tconst { group, codes, onDataChanged } = props;\n\n\treturn <PropItemPicker label='Assign Space'\n\t                       entity={group}\n\t                       codes={codes.spaces}\n\t                       initPropArray={initSpaceArray}\n\t                       addItemToProp={addSpaceToGroup}\n\t                       removeItemFromProp={removeSpaceFromGroup}\n\t                       isItemPicked={isSpaceSelected}\n\t                       addItemToCodes={addSpaceToCodes}\n\t                       removeItemFromCodes={removeSpaceFromCodes}\n\t                       getKeyOfItem={getSpaceId}\n\t                       getNameOfItem={getSpaceName}\n\t                       getMinorNameOfItem={getSpaceDescription}\n\t                       listItems={listSpacesForUserGroup}\n\t                       onDataChanged={onDataChanged}/>;\n};\n","import React from 'react';\nimport { QueriedUserForUserGroup, UserGroup } from '../../../services/admin/types';\nimport { listUsersForUserGroup } from '../../../services/admin/user';\nimport { PropItemPicker } from './prop-items-picker';\n\nconst initUserArray = (group: UserGroup) => group.userIds = group.userIds || [];\nconst addUserToGroup = (group: UserGroup, user: QueriedUserForUserGroup) => group.userIds!.push(user.userId);\n// eslint-disable-next-line\nconst removeUserFromGroup = (group: UserGroup, user: QueriedUserForUserGroup) => group.userIds = (group.userIds || []).filter(userId => userId != user.userId);\n// eslint-disable-next-line\nconst isUserSelected = (group: UserGroup, user: QueriedUserForUserGroup) => !!group.userIds && group.userIds.findIndex(userId => userId == user.userId) !== -1;\nconst addUserToCodes = (codes: Array<QueriedUserForUserGroup>, user: QueriedUserForUserGroup) => {\n\t// eslint-disable-next-line\n\tconst exists = codes.findIndex(exists => exists.userId == user.userId) !== -1;\n\tif (!exists) {\n\t\tcodes.push(user);\n\t}\n};\nconst removeUserFromCodes = (codes: Array<QueriedUserForUserGroup>, user: QueriedUserForUserGroup) => {\n\t// eslint-disable-next-line\n\tconst index = codes.findIndex(exists => exists.userId == user.userId);\n\tif (index !== -1) {\n\t\tcodes.splice(index, 1);\n\t}\n};\nconst getUserId = (user: QueriedUserForUserGroup) => user.userId;\nconst getUserName = (user: QueriedUserForUserGroup) => user.name;\nconst getUserNickName = (user: QueriedUserForUserGroup) => user.nickName;\n\nexport const UserPicker = (props: {\n\tgroup: UserGroup;\n\tcodes: { users: Array<QueriedUserForUserGroup> };\n\tonDataChanged: () => void;\n}) => {\n\tconst { group, codes, onDataChanged } = props;\n\n\treturn <PropItemPicker label='Include User'\n\t                       entity={group}\n\t                       codes={codes.users}\n\t                       initPropArray={initUserArray}\n\t                       addItemToProp={addUserToGroup}\n\t                       removeItemFromProp={removeUserFromGroup}\n\t                       isItemPicked={isUserSelected}\n\t                       addItemToCodes={addUserToCodes}\n\t                       removeItemFromCodes={removeUserFromCodes}\n\t                       getKeyOfItem={getUserId}\n\t                       getNameOfItem={getUserName}\n\t                       getMinorNameOfItem={getUserNickName}\n\t                       listItems={listUsersForUserGroup}\n\t                       onDataChanged={onDataChanged}/>;\n};\n","import { faChartBar } from '@fortawesome/free-regular-svg-icons';\nimport { faGlobe, faTags, faUsers } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { Fragment, useState } from \"react\";\nimport UserGroupBackground from '../../../assets/user-group-background.png';\nimport {\n\tQueriedSpaceForUserGroup,\n\tQueriedUserForUserGroup,\n\tQueriedUserGroup,\n\tUserGroup\n} from '../../../services/admin/types';\nimport { fetchUserGroup, listUserGroups, saveUserGroup } from '../../../services/admin/user';\nimport { TooltipCarvedButton } from '../../component/console/carved-button';\nimport { PropInput } from '../component/prop-input';\nimport { PropInputLines } from '../component/prop-input-lines';\nimport { PropLabel } from '../component/prop-label';\nimport { SearchAndEditPanel } from '../component/search-and-edit-panel';\nimport { SingleSearchItemCard } from '../component/single-search';\nimport { SpacePicker } from '../component/space-picker';\nimport { UserPicker } from '../component/user-picker';\n\nexport const UserGroups = () => {\n\tconst createCodes = () => {\n\t\treturn {\n\t\t\tusers: [] as Array<QueriedUserForUserGroup>,\n\t\t\tspaces: [] as Array<QueriedSpaceForUserGroup>\n\t\t};\n\t};\n\n\tconst [ codes, setCodes ] = useState(createCodes());\n\n\tconst createEntity = (fake: boolean) => {\n\t\tif (!fake) {\n\t\t\tsetCodes({ users: [], spaces: [] });\n\t\t}\n\t\treturn { userIds: [], spaceIds: [] } as UserGroup;\n\t};\n\tconst fetchEntityAndCodes = async (queriedGroup: QueriedUserGroup) => {\n\t\tconst { group, users, spaces } = await fetchUserGroup(queriedGroup.userGroupId);\n\t\tsetCodes({ users, spaces });\n\t\treturn { entity: group };\n\t};\n\tconst fetchEntityList = listUserGroups;\n\tconst saveEntity = saveUserGroup;\n\tconst isEntityOnCreate = (group: UserGroup) => !group.userGroupId;\n\tconst renderItemInList = (userGroup: QueriedUserGroup, onEdit: (entity: QueriedUserGroup) => (() => void)) => {\n\t\treturn <SingleSearchItemCard key={userGroup.userGroupId} onClick={onEdit(userGroup)}>\n\t\t\t<div>{userGroup.name}</div>\n\t\t\t<div>{userGroup.description}</div>\n\t\t\t<div>\n\t\t\t\t<TooltipCarvedButton tooltip='Users Count' center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faUsers}/>\n\t\t\t\t\t<span>{userGroup.userCount}</span>\n\t\t\t\t</TooltipCarvedButton>\n\t\t\t\t<TooltipCarvedButton tooltip='Spaces Assigned' center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faGlobe}/>\n\t\t\t\t\t<span>{userGroup.spaceCount}</span>\n\t\t\t\t</TooltipCarvedButton>\n\t\t\t\t<TooltipCarvedButton tooltip='Topics Available' center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faTags}/>\n\t\t\t\t\t<span>{userGroup.topicCount}</span>\n\t\t\t\t</TooltipCarvedButton>\n\t\t\t\t<TooltipCarvedButton tooltip='Reports Created' center={true}>\n\t\t\t\t\t<FontAwesomeIcon icon={faChartBar}/>\n\t\t\t\t\t<span>{userGroup.reportCount}</span>\n\t\t\t\t</TooltipCarvedButton>\n\t\t\t</div>\n\t\t</SingleSearchItemCard>;\n\t};\n\tconst getKeyOfEntity = (item: QueriedUserGroup) => item.userGroupId;\n\n\tconst onPropChange = (group: UserGroup, prop: 'name' | 'description', onDataChanged: () => void) => {\n\t\treturn (event: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n\t\t\tif (group[prop] !== event.target.value) {\n\t\t\t\tgroup[prop] = event.target.value;\n\t\t\t\tonDataChanged();\n\t\t\t}\n\t\t};\n\t};\n\tconst renderEditContent = (group: UserGroup, onDataChanged: () => void) => {\n\t\treturn <Fragment>\n\t\t\t<PropLabel>Group Name:</PropLabel>\n\t\t\t<PropInput value={group.name || ''} onChange={onPropChange(group, 'name', onDataChanged)}/>\n\t\t\t<PropLabel>Description:</PropLabel>\n\t\t\t<PropInputLines onChange={onPropChange(group, 'description', onDataChanged)}\n\t\t\t                value={group.description || ''}/>\n\t\t\t<PropLabel>Spaces:</PropLabel>\n\t\t\t<SpacePicker group={group} codes={codes} onDataChanged={onDataChanged}/>\n\t\t\t<PropLabel>Users:</PropLabel>\n\t\t\t<UserPicker group={group} codes={codes} onDataChanged={onDataChanged}/>\n\t\t</Fragment>;\n\t};\n\n\treturn <SearchAndEditPanel title='User Groups'\n\t                           searchPlaceholder='Search by group name, user name, description, etc.'\n\t                           createButtonLabel='Create User Group'\n\t                           entityLabel='User Group'\n\t                           entityImage={UserGroupBackground}\n\t                           createEntity={createEntity}\n\t                           fetchEntityAndCodes={fetchEntityAndCodes}\n\t                           fetchEntityList={fetchEntityList}\n\t                           saveEntity={saveEntity}\n\t                           isEntityOnCreate={isEntityOnCreate}\n\t                           renderEntityInList={renderItemInList}\n\t                           getKeyOfEntity={getKeyOfEntity}\n\t                           renderEditContent={renderEditContent}/>;\n};","import styled from 'styled-components';\nimport React, { RefObject, useRef } from 'react';\nimport { Chart } from '../../console/connected-space/subject-view/graphics/chart';\nimport { SubjectContextProvider } from '../../console/connected-space/subject-view/context';\nimport {\n\tConnectedConsoleSpace,\n\tConsoleSpace,\n\tConsoleSpaceSubject,\n\tConsoleSpaceSubjectChart,\n\tConsoleSpaceSubjectChartIndicatorAggregator,\n\tConsoleSpaceSubjectChartType,\n\tConsoleSpaceType,\n\tConsoleTopicFactorType\n} from '../../../services/console/types';\nimport dayjs from 'dayjs';\n\nconst Container = styled.div`\n\tdisplay        : flex;\n\tflex-direction : column;\n\twidth          : 100%;\n`;\nconst Header = styled.div`\n\tdisplay       : flex;\n\talign-items   : center;\n\tborder-bottom : var(--border);\n\t> button {\n\t\talign-self : flex-end;\n\t\twidth      : 28px;\n\t\theight     : 28px;\n\t\tfont-size  : 1.2em;\n\t}\n`;\nconst Title = styled.div`\n\tfont-size   : 3em;\n\tfont-family : var(--console-title-font-family);\n\tflex-grow   : 1;\n\tdisplay     : flex;\n\tpadding     : 0 var(--margin);\n\t> button {\n\t\tmargin-left : calc(var(--margin) / 2);\n\t\tfont-size   : 0.7em;\n\t\tpadding     : 0 calc(var(--margin) / 2);\n\t}\n`;\nconst Body = styled.div`\n\tdisplay               : grid;\n\tposition              : relative;\n\tflex-grow             : 1;\n\tgrid-template-columns : repeat(12, 1fr);\n\tgrid-column-gap       : var(--margin);\n\tgrid-row-gap          : var(--margin);\n\toverflow              : auto;\n\tpadding               : calc(var(--margin) / 2) var(--margin) var(--margin);\n\t&::-webkit-scrollbar {\n\t\tbackground-color : transparent;\n\t\theight           : 4px;\n\t\twidth            : 4px;\n\t}\n\t&::-webkit-scrollbar-track {\n\t\tbackground-color : var(--scrollbar-background-color);\n\t\tborder-radius    : 2px;\n\t}\n\t&::-webkit-scrollbar-thumb {\n\t\tbackground-color : var(--console-favorite-color);\n\t\tborder-radius    : 2px;\n\t}\n\t> div {\n\t\tposition : relative;\n\t\theight   : 400px;\n\t\t&:nth-child(2n + 1) {\n\t\t\tgrid-column : 1 / span 6;\n\t\t}\n\t\t&:nth-child(2n) {\n\t\t\tgrid-column : 7 / span 6;\n\t\t}\n\t\t&:last-child {\n\t\t\theight      : var(--margin);\n\t\t\tmin-height  : var(--margin);\n\t\t\tgrid-column : 1 / span 12;\n\t\t}\n\t\t> div {\n\t\t\twidth  : 100%;\n\t\t\theight : 100%;\n\t\t}\n\t}\n`;\n\nconst onChartDelete = (chart: ConsoleSpaceSubjectChart) => (void 0);\nconst onChartSave = async (subject: ConsoleSpaceSubject) => (void 0);\n\nconst createDef = (subjectId: string, chartId: string, chartName: string, dimensionName: string) => {\n\tconst space: ConsoleSpace = {\n\t\tspaceId: 'demo-admin-dashboard',\n\t\tname: 'Demo Admin Dashboard Space',\n\t\ttopics: [ {\n\t\t\ttopicId: '1',\n\t\t\tcode: 'top-slow-sql',\n\t\t\tname: 'Top Slow SQL',\n\t\t\tfactors: [\n\t\t\t\t{ factorId: '1', name: 'sql', label: dimensionName, type: ConsoleTopicFactorType.TEXT },\n\t\t\t\t{ factorId: '2', name: 'time', label: 'Time', type: ConsoleTopicFactorType.NUMBER }\n\t\t\t]\n\t\t} ],\n\t\ttopicRelations: []\n\t};\n\tconst chart: ConsoleSpaceSubjectChart = {\n\t\tchartId,\n\t\tname: chartName,\n\t\ttype: ConsoleSpaceSubjectChartType.BAR,\n\t\tindicators: [ {\n\t\t\ttopicId: '1',\n\t\t\tfactorId: '2',\n\t\t\taggregator: ConsoleSpaceSubjectChartIndicatorAggregator.NONE,\n\t\t\talias: 'Execution(ms)'\n\t\t} ],\n\t\tdimensions: [ {\n\t\t\ttopicId: '1',\n\t\t\tfactorId: '1',\n\t\t\talias: 'Topic'\n\t\t} ],\n\t\trect: { top: -1, left: -1, width: -1, height: -1 }\n\t};\n\tconst subject: ConsoleSpaceSubject = {\n\t\tsubjectId,\n\t\tname: 'Top Slow SQL',\n\t\ttopicCount: 1,\n\t\tgraphicsCount: 1,\n\t\tlastVisitTime: dayjs().format('YYYY-MM-DD HH:mm:ss'),\n\t\tcreatedAt: dayjs().format('YYYY-MM-DD HH:mm:ss'),\n\t\tdataset: {\n\t\t\tfilters: [],\n\t\t\tcolumns: [],\n\t\t\tjoins: []\n\t\t},\n\t\tgraphics: [ chart ]\n\t};\n\tconst connectedSpace: ConnectedConsoleSpace = {\n\t\tconnectId: 'demo-admin-dashboard',\n\t\ttype: ConsoleSpaceType.PRIVATE,\n\t\tlastVisitTime: dayjs().format('YYYY-MM-DD HH:mm:ss'),\n\t\tgroups: [],\n\t\tsubjects: [ subject ],\n\t\t// from space\n\t\tspaceId: space.spaceId,\n\t\tname: space.name,\n\t\ttopics: space.topics,\n\t\ttopicRelations: space.topicRelations\n\t};\n\treturn { connectedSpace, space, subject, chart };\n};\nconst TopX = (props: {\n\tcontainerRef: RefObject<HTMLDivElement>;\n\tsubjectId: string;\n\tchartId: string;\n\tchartName: string;\n\tdimensionName: string;\n}) => {\n\tconst { containerRef, subjectId, chartId, chartName, dimensionName } = props;\n\tconst { connectedSpace, space, subject, chart } = createDef(subjectId, chartId, chartName, dimensionName);\n\n\treturn <div>\n\t\t<SubjectContextProvider space={connectedSpace} subject={subject}\n\t\t                        doSave={onChartSave}>\n\t\t\t<Chart containerRef={containerRef}\n\t\t\t       space={space} subject={subject} chart={chart}\n\t\t\t       locked={true} relative={true} settings={false}\n\t\t\t       onDeleteChart={onChartDelete}/>\n\t\t</SubjectContextProvider>\n\t</div>;\n};\n\nexport const Home = () => {\n\tconst bodyRef = useRef<HTMLDivElement>(null);\n\n\treturn <Container>\n\t\t<Header>\n\t\t\t<Title>\n\t\t\t\t<span>Aerial View for Administrator</span>\n\t\t\t</Title>\n\t\t</Header>\n\t\t<Body ref={bodyRef}>\n\t\t\t<TopX containerRef={bodyRef} subjectId='SYS_001' chartId='TOP_10_SQL' chartName='Top Slow SQL'\n\t\t\t      dimensionName='SQL'/>\n\t\t\t<TopX containerRef={bodyRef} subjectId='SYS_001' chartId='TOP_10_SLOW_PIPELINE'\n\t\t\t      chartName='Top Slow Pipeline' dimensionName='Pipeline'/>\n\t\t\t<div/>\n\t\t</Body>\n\t</Container>;\n};","import React from 'react';\nimport { Redirect, Route, Switch } from 'react-router-dom';\nimport styled from 'styled-components';\nimport Path from '../../common/path';\nimport { AdminContextProvider } from './context/admin-context';\nimport { AdminMenu } from './menu';\nimport { Pipeline } from './pipeline';\nimport { Reports } from './report';\nimport { Spaces } from './space';\nimport { Tasks } from './task';\nimport { Topics } from './topic';\nimport { Users } from './user';\nimport { UserGroups } from './user-group';\nimport { Home } from './home';\n\nconst Container = styled.div.attrs({\n\t'data-widget': 'console-container'\n})`\n\tdisplay                        : flex;\n\tcolor                          : var(--console-font-color);\n\t--toggle-negative-slider-color : var(--border-color);\n\t--toggle-positive-bg-color     : var(--console-primary-color);\n\t--toggle-negative-bg-color     : transparent;\n\t--toggle-positive-border-color : var(--console-primary-color);\n\t--toggle-negative-border-color : var(--border-color);\n\t> main {\n\t\tflex-grow  : 1;\n\t\tdisplay    : flex;\n\t\theight     : 100vh;\n\t\toverflow-y : scroll;\n\t}\n\t> div[data-widget='console-favorite-container'][data-pinned=true] + main {\n\t\tmargin-top : var(--console-favorite-pinned-height);\n\t\theight     : calc(100vh - var(--console-favorite-pinned-height));\n\t}\n`;\n\nconst AdminIndex = () => {\n\treturn <AdminContextProvider>\n\t\t<Container>\n\t\t\t<AdminMenu/>\n\t\t\t<main>\n\t\t\t\t<Switch>\n\t\t\t\t\t<Route path={Path.ADMIN_HOME}><Home/></Route>\n\t\t\t\t\t<Route path={Path.ADMIN_TOPICS}><Topics/></Route>\n\t\t\t\t\t<Route path={Path.ADMIN_REPORTS}><Reports/></Route>\n\t\t\t\t\t<Route path={Path.ADMIN_SPACES}><Spaces/></Route>\n\t\t\t\t\t<Route path={Path.ADMIN_PIPELINE}><Pipeline/></Route>\n\t\t\t\t\t<Route path={Path.ADMIN_USER_GROUPS}><UserGroups/></Route>\n\t\t\t\t\t<Route path={Path.ADMIN_USERS}><Users/></Route>\n\t\t\t\t\t<Route path={Path.ADMIN_TASKS}><Tasks/></Route>\n\t\t\t\t\t<Route path='*'><Redirect to={Path.ADMIN_HOME}/></Route>\n\t\t\t\t</Switch>\n\t\t\t</main>\n\t\t</Container>\n\t</AdminContextProvider>;\n};\n\nexport default AdminIndex;"],"sourceRoot":""}